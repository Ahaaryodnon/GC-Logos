/*! For license information please see Player.Common.js.LICENSE.txt */
(function(){return this?this:window}())["@pa-client/player-common"]=function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}return r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(e,t,r){"use strict";r.r(t),r.d(t,"MetadataFileName",(function(){return a})),r.d(t,"ManifestFileName",(function(){return n})),r.d(t,"InitJsFileName",(function(){return o})),r.d(t,"AppIndexWebFileName",(function(){return i})),r.d(t,"JsFolderName",(function(){return s})),r.d(t,"PluginsFolderName",(function(){return c})),r.d(t,"CordovaFileName",(function(){return p})),r.d(t,"CordovaPluginsFileName",(function(){return l})),r.d(t,"AssetsFolderName",(function(){return u})),r.d(t,"DefaultAppLoadRetries",(function(){return d})),r.d(t,"ThinPackageMinimumApiVersion",(function(){return f})),r.d(t,"dragStartThreshold",(function(){return g})),r.d(t,"dragDistance",(function(){return h})),r.d(t,"dragHorizontalMax",(function(){return y})),r.d(t,"previewTime",(function(){return P})),r.d(t,"rightMouseButton",(function(){return _})),r.d(t,"cssClassNavbarActive",(function(){return m})),r.d(t,"cssClassAppExiting",(function(){return b})),r.d(t,"cssClassFirstTime",(function(){return v})),r.d(t,"cssSelectorNavBar",(function(){return D})),r.d(t,"cssSelectorClickEater",(function(){return A}));var a="metadata.json",n="manifest.json",o="init.js",i="index.web.html",s="js",c="plugins",p="cordova.js",l="cordova_plugins.js",u="Assets",d=5,f="2.1.0",g=3,h=20,y=40,P=3e3,_=2,m="navbar-active",b="app-exiting",v="first-time",D=".navigation-bar",A=".navbar-click-eater"},function(e,t,r){"use strict";r.r(t),r.d(t,"AppLogs",(function(){return a})),r.d(t,"CopyLogs",(function(){return n})),r.d(t,"CurrentEndpoint",(function(){return o})),r.d(t,"RequestNotification",(function(){return i})),r.d(t,"TestNotificationTitle",(function(){return s})),r.d(t,"UseLocallyGeneratedPlayerPackage",(function(){return c})),r.d(t,"OverrideCloudPackagingHeaderValue",(function(){return p})),r.d(t,"EnableAppVersionCheck",(function(){return l})),r.d(t,"ConnectedDataRequireDataEntityRecords",(function(){return u})),r.d(t,"ConnectedDataEnableCdpGetRowsFunction",(function(){return d})),r.d(t,"DelayDropBoxDescription",(function(){return f})),r.d(t,"LogsCopied",(function(){return g})),r.d(t,"SingleSignOnEnabled",(function(){return h})),r.d(t,"PerformanceRecoderEnabled",(function(){return y})),r.d(t,"SharepointFormAppOverride",(function(){return P})),r.d(t,"showConditionalControlsInTreeView",(function(){return _}));var a="App Logs",n="Copy Logs",o="Current PowerApps Endpoint is: ",i="Request Notification",s="Test Push Notifications",c="Use Locally Generated Player Package",p="Override cloud packaging header value",l="Enable app version checking",u="Require data entity records to modify connected data",d="Enable using cdp function to get rows instead of service function.",f="Delay in seconds: ",g="Logs copied!",h="Enable single sign on (SSO)",y="Enable Performance Recording",P="Create form app in AFD flow",_="Show Rules Panel conditional controls in the Tree View"},function(e,t,r){"use strict";r.d(t,"d",(function(){return o})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return s})),r.d(t,"c",(function(){return n}));var a,n,o="se",i="manifest.json",s="index.web.html";!function(e){e[e.InternalServerError=500]="InternalServerError",e[e.ServiceUnavailable=503]="ServiceUnavailable"}(a||(a={})),function(e){e.PublishedAppGetAppDetails="PublishedAppGetAppDetails",e.WebPlayerDownloadManifest="WebPlayerDownloadManifest",e.WebPlayerDownloadManifestRetry="WebPlayerDownloadManifestRetry",e.WebPlayerDownloadIndex="WebPlayerDownloadIndex",e.WebPlayerDownloadIndexRetry="WebPlayerDownloadIndexRetry",e.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata="PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata"}(n||(n={}))},function(e,t,r){"use strict";r.r(t);var a,n=r(2),o=r(9);function i(e){var t=[],r=e.controls;for(var a in r)a&&t.push(a.toLowerCase());return t}function s(e){var t={};e.staticDependencies&&e.staticDependencies.forEach((function(e){t[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl}));var r=e.controlDependencies;for(var a in r)a&&r[a].forEach((function(e){e&&e.sourcePath&&(t[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl)}));return t}function c(e){var t=[];return(null==e?void 0:e.app)&&(t=e.app),t}function p(e){var t,r={};return(null===(t=null==e?void 0:e.dataComponentDependencies)||void 0===t?void 0:t.expressionRuntime)&&e.dataComponentDependencies.expressionRuntime.forEach((function(e){r[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl})),r}function l(e,t){var r,a=[];return(null===(r=null==e?void 0:e.dataComponentDependencies)||void 0===r?void 0:r[t])&&(a=e.dataComponentDependencies[t]),a}!function(e){e[e.NotStart=0]="NotStart",e[e.InProgress=1]="InProgress",e[e.Processed=2]="Processed",e[e.Error=3]="Error"}(a||(a={}));var u=function(){function e(e,t){this._indexHtmlDownloader=e.indexHtmlDownloader,this._manifestJsonDownloader=e.manifestJsonDownloader,this._telemetryLogger=e.telemetryLogger,this._appMetadataResponseProcessor=e.appMetadataResponseProcessor,this._config=t,this._isInDebugMode=this._checkIfUsingDebugConfig(this._config.debugConfig)}return e.prototype._checkIfUsingDebugConfig=function(e){return e&&"string"==typeof e.publishedAppResourceHash&&"string"==typeof e.publishedAppResourceUrl},e.prototype._scrubOtherSensitiveDataSafe=function(e){var t=this;try{if(new RegExp(/(password|token|key|sig)/i).test(e)){var r=e;return["password","token","key","sig"].forEach((function(e){r=t._replaceRestOfStringIfFound(r,e,"_scrubbedSensitiveData_")})),r.toString()}return e}catch(e){return this._telemetryLogger.trackErrorEvent("BasePublishedAppMetadataParser._scrubOtherSensitiveDataSafe",{errorMessage:e.message,message:"Failed to scrub sensitive data from the URL"}),""}},e.prototype._replaceRestOfStringIfFound=function(e,t,r){return e.toLowerCase().indexOf(t)>0?e.replace(e.substring(e.toLowerCase().indexOf(t)),r):e},e.prototype.setAppDetails=function(t,r,a,o,i,s,c){var p=e._getSASKeyExpiryDate(t).getTime(),l=Date.now()+9e5,u=this._scrubOtherSensitiveDataSafe(t),d=this._scrubOtherSensitiveDataSafe(r);p<l?this._telemetryLogger.trackErrorEvent("BasePublishedAppMetadataParser.setAppDetails",{scrubbedIndexWebHtmlUrl:u,scrubbedReadonlyIndexWebHtmlUrl:d,source:c,errorMessage:"SAS key expired or very close to expire."}):(this._telemetryLogger.trackActivityEvent("BasePublishedAppMetadataParser.setAppDetails",{documentServerVersion:o?JSON.stringify(o):"",scrubbedIndexWebHtmlUrl:u,scrubbedReadonlyIndexWebHtmlUrl:d,source:c}),this._appVersion=i,this._updatedHash=s,this._primaryWebPlayerPackageUrl=t,this._secondaryWebPlayerPackageUrl=r,this._appPackageResourcesKind=a,this._documentServerVersion=o,this._packageKind=this._getPackageKindConfig(a,{isInDebugMode:this._isInDebugMode,isWebPlayerBVT:this._config.isWebPlayerBVT}),this._primaryWebPlayerManifestUrl=this._primaryWebPlayerPackageUrl.replace(n.a,n.b),this._secondaryWebPlayerManifestUrl=this._secondaryWebPlayerPackageUrl.replace(n.a,n.b),this._currentWebPlayerPackageUrl=this._primaryWebPlayerPackageUrl,this._currentWebPlayerManifestUrl=this._primaryWebPlayerManifestUrl,this._overrideSVGUpdateFunction=!o||o.minor<18e3&&o.major<3,this._overrideSVGUpdateFunction&&this._telemetryLogger.trackActivityEvent("WebPlayer.SVGUpdate.OverrideFunction"),this._isAppMetadataSet=!0)},e.prototype.getAppDetails=function(e,t){var r=this;if(!this._config.isWebPlayer)throw this._telemetryLogger.error("PublishedAppMetadataParser.getAppDetails","GetAppDetails should only be called in web player"),"Not supported";this._isAppMetadataSet||e.onFailure(new Error("Please make sure you call setAppDetails first"));var i,s,c,p,l,u,d,f=this._telemetryLogger.startScenario(n.c.PublishedAppGetAppDetails,new Date,{}),g={manifestType:"publishedApp"},h=this._telemetryLogger.startScenario(n.c.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata,new Date,__assign(__assign({},g),{operationName:"PlayerLifecycle.PlayerSDK.PlayApp.LoadMetadata.FetchAppPackageMetadata"}));this._telemetryLogger.updateOpenAppData({playerResourcesSplitEnabled:this._packageKind===o.a.split});var y=this._generateEmptyError(),P=this._generateEmptyError(),_=a.NotStart,m=a.NotStart;_=a.InProgress,this._downloadResourceImpl("manifest",{onSuccess:function(t){if(i=r._appMetadataResponseProcessor.getWebPlayerZipDetails(t,r._packageKind,r._isInDebugMode),s=r._appMetadataResponseProcessor.getSplitPackageDetails(t,r._packageKind),c=r._appMetadataResponseProcessor.generateWebPlayerDetails(r._currentWebPlayerPackageUrl),p=r._appMetadataResponseProcessor.generateWebPlayerResourceDetails(),u=r._appMetadataResponseProcessor.getDataComponentPackageDetails(t,r._packageKind),d=r._appMetadataResponseProcessor.getComponentLibraryPackageDetails(t,r._packageKind),_=a.Processed,m===a.Processed){r._telemetryLogger.endScenario(f),r._telemetryLogger.endScenario(h,g);var n={packageKind:r._packageKind,webPlayerZipDetails:i,webPlayerPackageDetails:c,webPlayerResourceDetails:p,splitPackageDetails:s,scriptPackageDetails:l,overrideSVGUpdateFunction:r._overrideSVGUpdateFunction,appVersion:r._appVersion,appId:r._config.appId};u&&(n.dataComponentPackageDetails=u),d&&(n.componentLibraryPackageDetails=d),e.onSuccess(n)}else m===a.Error&&(r._telemetryLogger.failScenario(f,{}),r._telemetryLogger.failScenario(h,{customScenarioData:__assign({manifestParsingState:r._getProcessStateString(_),htmlParsingState:r._getProcessStateString(m)},g)}),e.onFailure(r._mergeErrorMessage(y,P)))},onFailure:function(t){y=t,_=a.Error,m!==a.Processed&&m!==a.Error||(r._telemetryLogger.failScenario(f,{}),r._telemetryLogger.failScenario(h,{customScenarioData:__assign({manifestParsingState:r._getProcessStateString(_),htmlParsingState:r._getProcessStateString(m)},g)}),e.onFailure(r._mergeErrorMessage(y,P)))}},t,!0),m=a.InProgress,this._downloadResourceImpl("index",{onSuccess:function(t){if(l=r._appMetadataResponseProcessor.generateScriptPackageDetails(t,r._updatedHash),m=a.Processed,_===a.Processed){r._telemetryLogger.endScenario(f),r._telemetryLogger.endScenario(h,g);var n={packageKind:r._packageKind,webPlayerZipDetails:i,webPlayerPackageDetails:c,webPlayerResourceDetails:p,splitPackageDetails:s,scriptPackageDetails:l,overrideSVGUpdateFunction:r._overrideSVGUpdateFunction,appVersion:r._appVersion,appId:r._config.appId};u&&(n.dataComponentPackageDetails=u),d&&(n.componentLibraryPackageDetails=d),e.onSuccess(n)}else _===a.Error&&(r._telemetryLogger.failScenario(f,{}),r._telemetryLogger.failScenario(h,{customScenarioData:__assign({manifestParsingState:r._getProcessStateString(_),htmlParsingState:r._getProcessStateString(m)},g)}),e.onFailure(r._mergeErrorMessage(y,P)))},onFailure:function(t){P=t,m=a.Error,_!==a.Processed&&_!==a.Error||(r._telemetryLogger.failScenario(f,{}),r._telemetryLogger.failScenario(h,{customScenarioData:__assign({manifestParsingState:r._getProcessStateString(_),htmlParsingState:r._getProcessStateString(m)},g)}),e.onFailure(r._mergeErrorMessage(y,P)))}},t,!0)},e.prototype.getAppBaseMetadata=function(){return{indexWebHtmlUrl:this._primaryWebPlayerPackageUrl,readonlyIndexWebHtmlUrl:this._secondaryWebPlayerPackageUrl,appPackageResourcesKind:this._appPackageResourcesKind,documentServerVersion:this._documentServerVersion,appVersion:this._appVersion}},e.prototype._generateEmptyError=function(){var e=new Error;return e.name="",e.message="",e.stack="",e},e.prototype._mergeErrorMessage=function(e,t){var r=new Error;return r.name="Failed to get and parse appMetadata",r.message=e.message+"\n"+t.message,r.stack=e.stack+"\n"+t.stack,r},e.prototype.getAppControls=function(e,t){var r=this;this._downloadResourceImpl("manifest",{onSuccess:function(t){var a=r._appMetadataResponseProcessor.parseControlsListFromManifest(t);e.onSuccess(a)},onFailure:function(t){e.onFailure(t)}},t,!0)},e.prototype.getAppDependencies=function(e,t){this._downloadResourceImpl("manifest",{onSuccess:function(t){e.onSuccess(t)},onFailure:function(t){e.onFailure(t)}},t,!0)},e.prototype._downloadResourceImpl=function(e,t,r,a){var o=this,i="index"===e?n.c.WebPlayerDownloadIndex:n.c.WebPlayerDownloadManifest;a?"index"===e?this._currentWebPlayerPackageUrl=this._primaryWebPlayerPackageUrl:this._currentWebPlayerManifestUrl=this._primaryWebPlayerManifestUrl:"index"===e?this._currentWebPlayerPackageUrl=this._secondaryWebPlayerPackageUrl:this._currentWebPlayerManifestUrl=this._secondaryWebPlayerManifestUrl;var s="index"===e?this._indexHtmlDownloader:this._manifestJsonDownloader,c=this._telemetryLogger.startScenario(i,new Date),p={url:"index"===e?this._currentWebPlayerPackageUrl:this._currentWebPlayerManifestUrl,method:"GET"};s.downloadResource(p,{onSuccess:function(e){o._telemetryLogger.endScenario(c),t.onSuccess(e)},onFailure:function(r){var n="index"===e?"Failed to download indexWebHtml":"Failed to download manifest";o._telemetryLogger.failScenario(c,{message:n}),a?o._downloadResourceImpl(e,t,!0,!1):t.onFailure(r)}},r)},e._getSASKeyExpiryDate=function(e){var t=this.getUrlParams(e,n.d);return new Date(decodeURIComponent(t))},e.getUrlParams=function(e,t){var r=new RegExp("[?&]"+t+"=([^&#]*)").exec(e);return null==r?null:decodeURI(r[1])||null},e.isSASKeyExpired=function(e){var t=this._getSASKeyExpiryDate(e);return(new Date).getTime()>t.getTime()},e.getTimeUntilSASRenewalInMs=function(e){var t=this._getSASKeyExpiryDate(e).getTime();if(!isNaN(t)){var r=t-(new Date).getTime(),a=Math.floor(51*Math.random())+10;(a<10||a>60)&&(a=10);var n=r-(a*=6e4);return n<=0?0:n}},e.prototype._getPackageKindConfig=function(e,t){var r;return r=o.a.zip,t.isWebPlayerBVT||t.isInDebugMode||(r="split"===(null==e?void 0:e.toLocaleLowerCase())?o.a.split:o.a.zip),r},e.prototype._getProcessStateString=function(e){var t="";switch(e){case a.NotStart:t="NotStarted";break;case a.InProgress:t="InProgress";break;case a.Processed:t="Processed";break;case a.Error:t="Error"}return t},e}(),d=function(){function e(e){this._fetchResource=e,this._callbackArray=[],this._isDownloading=!1,this._cacheResource=void 0}return e.prototype.downloadResource=function(e,t,r){if(!this._isDownloading)return r?(this._cacheResource=void 0,void this._downloadResourceImpl(e,t,r)):void(this._cacheResource?t.onSuccess(this._cacheResource):this._downloadResourceImpl(e,t));this._callbackArray.push(t)},e.prototype._downloadResourceImpl=function(e,t,r){var a=this;this._callbackArray.push(t),this._isDownloading=!0,this._fetchResource(e,{onSuccess:function(e){a._cacheResource=e,a._isDownloading=!1;for(var t=a._callbackArray.length,r=0;r<t;r++){a._callbackArray.shift().onSuccess(e)}},onFailure:function(e){a._isDownloading=!1;for(var t=a._callbackArray.length,r=0;r<t;r++){a._callbackArray.shift().onFailure(e)}}},r)},e}(),f=function(){function e(e){this._config=e}return e.prototype.getWebPlayerZipDetails=function(e,t,r){var a=null;if(t===o.a.zip){var n=this._config.cdnPath,i=null;r&&(n=this._config.debugConfig.publishedAppResourceUrl,i=this._config.debugConfig.publishedAppResourceHash),"/"!==n.charAt(n.length-1)&&(n+="/"),null===i&&(i=e.hash),a={rootPath:n+=i+"/PlayerResources/"}}return a},e.prototype.getSplitPackageDetails=function(e,t){return t===o.a.split?{appDependencies:s(e),nonSharedAppResources:c(e)}:null},e.prototype.getDataComponentPackageDetails=function(e,t){return t===o.a.split&&(null==e?void 0:e.dataComponentDependencies)?{expressionRuntime:p(e),scripts:l(e,"scripts"),metadata:l(e,"metadata")}:void 0},e.prototype.getComponentLibraryPackageDetails=function(e,t){return t===o.a.split&&(null==e?void 0:e.componentNameMap)&&(null==e?void 0:e.expressionRuntime)?{componentNameMap:e.componentNameMap,expressionRuntime:e.expressionRuntime.map((function(e){var t;return(t={})[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl,t})).reduce((function(e,t){return __assign(__assign({},e),t)}))}:void 0},e.prototype.generateWebPlayerResourceDetails=function(){var e={};if(void 0!==window.ResourceLoader){e["js/MessageWorker.js"]=window.ResourceLoader.mapResourceUrl(document,"js/MessageWorker.js")}return{resourceMap:e}},e.prototype.generateWebPlayerDetails=function(e){var t=(e=e.split("#")[0]).split("?")[1],r=n.a+"?";return e.indexOf(r)>=0?{host:e.replace(r,"").replace(t,""),queryString:"?"+t,proxyPath:this._config.webPlayerProxyUrl,timeUntilSASRenewalInMs:u.getTimeUntilSASRenewalInMs(e)}:{host:e.replace(n.a,""),queryString:"",proxyPath:this._config.webPlayerProxyUrl}},e.prototype.generateScriptPackageDetails=function(e,t){var r=function(e){for(var t,r,a,n,o=(new DOMParser).parseFromString(e,"text/html").head.getElementsByTagName("script"),i=[],s=0;s<o.length;s++){var c=o[s].text;-1!==c.indexOf("AppResources")?t=o[s].innerText:-1!==c.indexOf("AppPrefetchResources")?r=o[s].innerText:-1!==c.indexOf("LanguageSpecificResources")?a=o[s].innerText:-1!==c.indexOf("PowerAppsTitle")?n=o[s].innerText:i.push(o[s].outerHTML)}return{appResourcesScript:t,prefetchAppResourcesScript:r,languageResourcesScript:a,powerAppsTitleScript:n,headerScripts:i}}(e);return{appResources:null==r?void 0:r.appResourcesScript,appLoadLinkResources:null==r?void 0:r.prefetchAppResourcesScript,languageSpecificResources:null==r?void 0:r.languageResourcesScript,powerAppsTitle:null==r?void 0:r.powerAppsTitleScript,headerScripts:null==r?void 0:r.headerScripts,updatedHash:t}},e.prototype.parseControlsListFromManifest=function(e){return i(e)},e.prototype.parseNestedCanvasAppsFromManifest=function(e){return function(e){return e.nestedCanvasApps}(e)},e}();r.d(t,"DefaultPublishedAppMetadataParser",(function(){return g}));var g=function(e){function t(t,r,a,n,o){var i=e.call(this,{indexHtmlDownloader:new d((function(e,t,r){return i._sendHttpTextResponseAsync(e,t,r)})),manifestJsonDownloader:new d((function(e,t,r){return i._sendHttpJsonResponseAsync(e,t,r)})),telemetryLogger:o||new h,appMetadataResponseProcessor:new f(r)},r)||this;return i._httpClient=t,i._listPackageClient=a,i._loadedPromise=new Promise((function(e){i._loadedPromiseResolve=e})),i._cache=n,i}return __extends(t,e),t.prototype._sendHttpTextResponseAsync=function(e,t,r){return __awaiter(this,void 0,Promise,(function(){var a,n;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),a=void 0,!this._cachedMetadata||r?[3,1]:(a=this._cachedMetadata.indexWebHtml,[3,3]);case 1:return[4,this._httpClient.sendHttpTextResponseAsync(e)];case 2:a=o.sent(),this._checkIfUpdateCache(a,null),o.label=3;case 3:return t.onSuccess(a),[3,5];case 4:return n=o.sent(),t.onFailure(n),[3,5];case 5:return[2]}}))}))},t.prototype._sendHttpJsonResponseAsync=function(e,t,r){return __awaiter(this,void 0,Promise,(function(){var a,n;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),a=void 0,!this._cachedMetadata||r?[3,1]:(a=JSON.parse(this._cachedMetadata.manifestJson),[3,3]);case 1:return[4,this._httpClient.sendHttpJsonResponseAsync(e)];case 2:a=o.sent(),this._checkIfUpdateCache(null,a),o.label=3;case 3:return t.onSuccess(a),[3,5];case 4:return n=o.sent(),t.onFailure(n),[3,5];case 5:return[2]}}))}))},t.prototype._checkIfUpdateCache=function(e,t){if(!this._indexWebHtml&&e&&(this._indexWebHtml=e),!this._manifestJsonObject&&t&&(this._manifestJsonObject=t),this._cache&&!this._cacheUpdate&&this._manifestJsonObject&&this._indexWebHtml){var r={indexWebHtml:this._indexWebHtml,manifestJson:JSON.stringify(this._manifestJsonObject)},a=u._getSASKeyExpiryDate(this._currentWebPlayerPackageUrl);this._cache.setCachedPublishedAppMetadataLater(this._config.appId,this._currentWebPlayerPackageUrl,a,r),this._cacheUpdate=!0}},t.prototype.setAppDetails=function(t,r,a,n,o,i,s){e.prototype.setAppDetails.call(this,t,r,a,n,o,i,s),this._loadCacheDataAsync()},t.prototype._loadCacheDataAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this._cache?(e=this,[4,this._cache.getCachedPublishedAppMetadataAsync(this._config.appId,this._currentWebPlayerPackageUrl)]):[3,2];case 1:e._cachedMetadata=t.sent(),t.label=2;case 2:return this._cachedMetadata&&this._telemetryLogger.trackActivityEvent("PublishedAppMetadataParser.usingCachedData"),this._loadedPromiseResolve(),[2]}}))}))},t.prototype.getAppDetails=function(e,t){this._getAppDetailsAsync(e,t)},t.prototype._getAppDetailsAsync=function(t,r){return __awaiter(this,void 0,Promise,(function(){var a;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._loadedPromise];case 1:return n.sent(),e.prototype.getAppDetails.call(this,t,r),[3,3];case 2:return a=n.sent(),t.onFailure(a),[3,3];case 3:return[2]}}))}))},t.prototype.refreshWebPlayerPackageDetails=function(e){this._refreshWebPlayerPackageDetailsAsync(e)},t.prototype._refreshWebPlayerPackageDetailsAsync=function(e){var t;return __awaiter(this,void 0,Promise,(function(){var r,a;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._listPackageClient.value.listPackageAsync()];case 1:return r=n.sent(),(null===(t=null==r?void 0:r.result)||void 0===t?void 0:t.webPackageUri)?e.onSuccess(this._appMetadataResponseProcessor.generateWebPlayerDetails(r.result.webPackageUri.value)):(null==r?void 0:r.error)?(Core.Telemetry.Log.trackErrorEvent("ListPackage failed when getting new SAS key",{error:r.error}),e.onFailure(r.error)):e.onFailure(new Error("Unknown Error in PublishedAppMetadataParser.refreshWebPlayerPackageDetailsAsync")),[3,3];case 2:return a=n.sent(),e.onFailure(a),[3,3];case 3:return[2]}}))}))},t.prototype.getAppControls=function(t,r){Core.Environment.isPublishedAppExternalToHost()&&Core.Environment.publishedAppHasCachedFiles()?this._getAppControlsAsync(t):e.prototype.getAppControls.call(this,t,r)},t.prototype._getAppControlsAsync=function(t,r){return __awaiter(this,void 0,Promise,(function(){var a,n,o,s;return __generator(this,(function(c){switch(c.label){case 0:a=Core.Loader.ObjectFactory.instance.getSingleton(Core.Player.IHostMessageProviderSingletonKey),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,a.getManifestJsonAsync()];case 2:return n=c.sent(),o=JSON.parse(n),t.onSuccess(i(o)),[3,4];case 3:return s=c.sent(),Core.Log.errorEx("PowerAppsClient.InstallApp.Error",{error:s,message:"Error occurred parsing the manifest json to get app controls"}),e.prototype.getAppControls.call(this,t,r),[3,4];case 4:return[2]}}))}))},t}(u),h=function(){function e(){}return e.prototype.trackActivityEvent=function(e,t){Core.Telemetry.Log.trackActivityEvent(e,t)},e.prototype.trackErrorEvent=function(e,t,r){Core.Telemetry.Log.trackErrorEvent(e,t,r)},e.prototype.error=function(e,t){Core.Log.errorEx(e,t)},e.prototype.startScenario=function(e,t,r){var a;switch(e){case n.c.PublishedAppGetAppDetails:a=Core.Telemetry.ScenarioName.PublishedAppGetAppDetails;break;case n.c.WebPlayerDownloadManifest:a=Core.Telemetry.ScenarioName.WebPlayerDownloadManifest;break;case n.c.WebPlayerDownloadManifestRetry:a=Core.Telemetry.ScenarioName.WebPlayerDownloadManifestRetry;break;case n.c.WebPlayerDownloadIndex:a=Core.Telemetry.ScenarioName.WebPlayerDownloadIndex;break;case n.c.WebPlayerDownloadIndexRetry:a=Core.Telemetry.ScenarioName.WebPlayerDownloadIndexRetry;break;case n.c.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata:a=Core.Telemetry.ScenarioName.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata}return Core.Telemetry.Log.startScenario(a,r,t)},e.prototype.endScenario=function(e,t){return Core.Telemetry.Log.endScenario(e,t)},e.prototype.updateOpenAppData=function(e){Core.Telemetry.Log.updateOpenAppData(e)},e.prototype.failScenario=function(e,t){Core.Telemetry.Log.failScenario(e,t)},e}()},function(e,t,r){},function(e,t,r){"use strict";r.r(t),r.d(t,"AppInfoPlayerAdapter",(function(){return n}));var a=r(12),n=function(){function e(e){this._appPreloadData=e}return Object.defineProperty(e.prototype,"name",{get:function(){return this._appPreloadData.displayName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"powerAppsName",{get:function(){return this._appPreloadData.appName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appId",{get:function(){return this._appPreloadData.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appType",{get:function(){return a.AppTypesFromRP[this._appPreloadData.appType]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this._appPreloadData.displayName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundImageUrl",{get:function(){return this._appPreloadData.imageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._appPreloadData.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"packageProperties",{get:function(){return this._appPreloadData.packageProperties},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appPackageResourcesKind",{get:function(){return this._appPreloadData.appPackageResourcesKind},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unauthenticatedWebPackageUrl",{get:function(){return this._appPreloadData.unauthenticatedWebPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webPackageUrl",{get:function(){return this._appPreloadData.webPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webReadOnlyPackageUrl",{get:function(){return this._appPreloadData.webReadOnlyPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerPackageUrl",{get:function(){return this._appPreloadData.playerPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerReadOnlyPackageUrl",{get:function(){return this._appPreloadData.playerReadOnlyPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minimumRequiredApiVersion",{get:function(){return this._appPreloadData.minimumRequiredApiVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"environment",{get:function(){return this._appPreloadData.environment},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionReferences",{get:function(){return this._appPreloadData.connectionReferences},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"databaseReferences",{get:function(){return this._appPreloadData.databaseReferences},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authResources",{get:function(){return this._appPreloadData.authResources},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userConsents",{get:function(){return this._appPreloadData.userConsents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceCapabilities",{get:function(){return this._appPreloadData.deviceCapabilities},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastModifiedDate",{get:function(){return this._appPreloadData.lastModifiedDate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"documentServerVersion",{get:function(){return this._appPreloadData.documentServerVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appVersion",{get:function(){return this._appPreloadData.appVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bypassConsent",{get:function(){return this._appPreloadData.bypassConsent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appDocumentComplexity",{get:function(){return this._appPreloadData.appDocumentComplexity},enumerable:!1,configurable:!0}),e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"rootRelativePath",(function(){return a}));var a=""},function(e,t,r){"use strict";r.r(t),r.d(t,"PlayerAppDataFolderLocator",(function(){return n}));var a=r(13),n=function(){function e(e,t){this._appIdWithVersion=e,t&&(this._previousLocator=t)}return e.prototype.locateAppDataFolder=function(e){var t=this;return this._getFolderToLocateFrom(e).then((function(e){return Object(a.createFolderFromRelativePathAsync)(e,t._appIdWithVersion)}))},e.prototype._getFolderToLocateFrom=function(e){return this._previousLocator?this._previousLocator.locateAppDataFolder(e):Promise.resolve(e)},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"PublishedAppMetadataCache",(function(){return a}));var a=function(){function e(e,t,r,a){this._asyncSettingsProvider=e,this._encryptedStorage=t,this._publishedAppMetadataPersistedPromiseResolver=r,this._schedulerFunction=a,this._loadPromise=Core.PromiseUtils.createCompletablePromise(),this._schedulerFunction=this._schedulerFunction||setTimeout,this._loadAsync()}return e.prototype._loadAsync=function(){return __awaiter(this,void 0,Promise,(function(){var t,r=this;return __generator(this,(function(a){switch(a.label){case 0:return[4,this._asyncSettingsProvider.getValueAsync(e.CacheKey)];case 1:if(t=a.sent())try{this._cache=JSON.parse(t)}catch(e){this._cache=HashTableUtility.create()}else this._cache=HashTableUtility.create();return this._loadPromise.complete(),this._schedulerFunction.apply(null,[function(){return r.clearExpiredEntriesAsync()},6e4]),[2]}}))}))},e.prototype._generateCacheIndexKey=function(e,t){if(-1===t.indexOf("index.web.html?"))return null;var r=new Core.Url(t).query;return"".concat(e,"-").concat(r).toLocaleLowerCase()},e.prototype.getCachedPublishedAppMetadataAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r,a,n;return __generator(this,(function(o){switch(o.label){case 0:return[4,this._loadPromise.promise];case 1:return o.sent(),null===(r=this._generateCacheIndexKey(e,t))?[2,null]:(a=this._cache[r])?[4,this._encryptedStorage.getStoredDataAsync(a.cacheKey)]:[3,3];case 2:n=o.sent();try{return[2,JSON.parse(n)]}catch(e){return[2,null]}o.label=3;case 3:return[2,null]}}))}))},e.prototype.setCachedPublishedAppMetadataAsync=function(t,r,a,n){var o;return __awaiter(this,void 0,Promise,(function(){var i,s;return __generator(this,(function(c){switch(c.label){case 0:return[4,this._loadPromise.promise];case 1:return c.sent(),null===(i=this._generateCacheIndexKey(t,r))?[3,4]:(s={cacheKey:"PublishedAppMetadata-".concat(Core.Utility.generate128BitUUID()),expiry:a},this._cache[i]=s,[4,this._asyncSettingsProvider.setValueAsync(e.CacheKey,JSON.stringify(this._cache))]);case 2:return c.sent(),[4,this._encryptedStorage.storeDataAsync(s.cacheKey,JSON.stringify(n))];case 3:c.sent(),null===(o=this._publishedAppMetadataPersistedPromiseResolver)||void 0===o||o.call(this),c.label=4;case 4:return[2]}}))}))},e.prototype.setCachedPublishedAppMetadataLater=function(e,t,r,a){var n=this;this._schedulerFunction.apply(null,[function(){return n.setCachedPublishedAppMetadataAsync(e,t,r,a)},6e4])},e.prototype.clearExpiredEntriesAsync=function(){return __awaiter(this,void 0,Promise,(function(){var t,r=this;return __generator(this,(function(a){switch(a.label){case 0:return t=[],HashTableUtility.forEach(this._cache,(function(e,a){new Date(e.expiry.toString())<new Date&&t.push(r._clearEntriesAsync(a,e.cacheKey))})),t.length>0?[4,Core.PromiseUtils.join(t)]:[3,3];case 1:return a.sent(),[4,this._asyncSettingsProvider.setValueAsync(e.CacheKey,JSON.stringify(this._cache))];case 2:a.sent(),Core.Telemetry.Log.trackActivityEvent("PublishedAppMetadataCache.clearExpiredEntries",{entriesCleared:t.length}),a.label=3;case 3:return[2]}}))}))},e.prototype._clearEntriesAsync=function(e,t){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this._encryptedStorage.removeStoredDataAsync(t)];case 1:return r.sent(),delete this._cache[e],[2]}}))}))},e.CacheKey="PublishedAppMetadata",e}()},function(e,t,r){"use strict";var a,n;r.d(t,"a",(function(){return a})),function(e){e[e.split=0]="split",e[e.zip=1]="zip",e[e.unknown=2]="unknown"}(a||(a={})),function(e){e.WebPackageUrl="WebPackageUrl",e.UnauthenticatedWebPackageUrl="UnauthenticatedWebPackageUrl"}(n||(n={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"RootAppMetadataParser",(function(){return i}));var a=r(3),n=r(9),o=r(2),i=function(e){function t(t,r,a,n,o){return e.call(this,t,r,a,n,o)||this}return __extends(t,e),t.prototype.getAppDetails=function(e,t,r){this._getAppDetailsInternalAsync(e,t,r)},t.prototype._getAppDetailsInternalAsync=function(e,t,r){return __awaiter(this,void 0,Promise,(function(){var a;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._loadedPromise];case 1:return n.sent(),this._getAppDetails(e,t,r),[3,3];case 2:return a=n.sent(),e.onFailure(a),[3,3];case 3:return[2]}}))}))},t.prototype.setAppDetails=function(t,r,a,n,o,i,s){t&&r?e.prototype.setAppDetails.call(this,t,r,a,n,o,i,s):(this._telemetryLogger.trackActivityEvent("RootAppMetadataParser.setAppDetails",{message:"setAppDetails invoked with indexWebHtmlUrl and/or readonlyIndexWebHtmlUrl undefined. This can happen when the model driven app does not have any custom pages."}),this._appVersion=o,this._isAppMetadataSet=!0,this._loadedPromiseResolve())},t.prototype._getAppDetails=function(e,t,r){var a=this;if(!this._config.isWebPlayer)throw this._telemetryLogger.error("PublishedAppMetadataParser.getAppDetails","GetAppDetails should only be called in web player"),new Error("Not supported");if(this._isAppMetadataSet||e.onFailure(new Error("Please make sure you call setAppDetails first")),this._primaryWebPlayerPackageUrl&&this._secondaryWebPlayerPackageUrl){var i=this._telemetryLogger.startScenario(o.c.PublishedAppGetAppDetails,new Date,{});this._telemetryLogger.updateOpenAppData({playerResourcesSplitEnabled:this._packageKind===n.a.split}),this._downloadResourceImpl("manifest",{onSuccess:function(t){var n=a._appMetadataResponseProcessor.generateWebPlayerDetails(a._currentWebPlayerPackageUrl),o=a._appMetadataResponseProcessor.generateWebPlayerResourceDetails(),s=a._appMetadataResponseProcessor.getDataComponentPackageDetails(t,a._packageKind),c=a._appMetadataResponseProcessor.getComponentLibraryPackageDetails(t,a._packageKind),p=a._appMetadataResponseProcessor.parseNestedCanvasAppsFromManifest(t);a._telemetryLogger.endScenario(i);var l={nestedCanvasApps:p,packageKind:a._packageKind,webPlayerZipDetails:null,webPlayerPackageDetails:n,webPlayerResourceDetails:o,splitPackageDetails:null,scriptPackageDetails:null,overrideSVGUpdateFunction:a._overrideSVGUpdateFunction,appVersion:a._appVersion,appId:a._config.appId,appName:r};s&&(l.dataComponentPackageDetails=s),c&&(l.componentLibraryPackageDetails=c),e.onSuccess(l)},onFailure:function(t){a._telemetryLogger.failScenario(i,{}),e.onFailure(t)}},t,!0)}else{this._telemetryLogger.trackActivityEvent("RootAppMetadataParser._getAppDetails",{message:"_primaryWebPlayerPackageUrl and/or _secondaryWebPlayerPackageUrl are null. This can happen when the model driven app does not have any custom pages."});var s={nestedCanvasApps:null,packageKind:null,webPlayerZipDetails:null,webPlayerPackageDetails:null,webPlayerResourceDetails:null,splitPackageDetails:null,scriptPackageDetails:null,overrideSVGUpdateFunction:null,appVersion:this._appVersion,appId:this._config.appId,appName:r};e.onSuccess(s)}},t}(a.DefaultPublishedAppMetadataParser)},function(e,t,r){},function(e,t){!function(){e.exports=function(){return this?this:window}()["@pa-client/core-services"]}()},function(e,t){!function(){e.exports=function(){return this?this:window}()["@pa-client/core-io"]}()},function(e,t,r){r(17),e.exports=r(16)},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var a=r(5);r.d(t,"AppInfoPlayerAdapter",(function(){return a.AppInfoPlayerAdapter}));var n=r(0);r.d(t,"AppIndexWebFileName",(function(){return n.AppIndexWebFileName})),r.d(t,"AssetsFolderName",(function(){return n.AssetsFolderName})),r.d(t,"CordovaFileName",(function(){return n.CordovaFileName})),r.d(t,"CordovaPluginsFileName",(function(){return n.CordovaPluginsFileName})),r.d(t,"DefaultAppLoadRetries",(function(){return n.DefaultAppLoadRetries})),r.d(t,"InitJsFileName",(function(){return n.InitJsFileName})),r.d(t,"JsFolderName",(function(){return n.JsFolderName})),r.d(t,"ManifestFileName",(function(){return n.ManifestFileName})),r.d(t,"MetadataFileName",(function(){return n.MetadataFileName})),r.d(t,"PluginsFolderName",(function(){return n.PluginsFolderName})),r.d(t,"ThinPackageMinimumApiVersion",(function(){return n.ThinPackageMinimumApiVersion})),r.d(t,"cssClassAppExiting",(function(){return n.cssClassAppExiting})),r.d(t,"cssClassFirstTime",(function(){return n.cssClassFirstTime})),r.d(t,"cssClassNavbarActive",(function(){return n.cssClassNavbarActive})),r.d(t,"cssSelectorClickEater",(function(){return n.cssSelectorClickEater})),r.d(t,"cssSelectorNavBar",(function(){return n.cssSelectorNavBar})),r.d(t,"dragDistance",(function(){return n.dragDistance})),r.d(t,"dragHorizontalMax",(function(){return n.dragHorizontalMax})),r.d(t,"dragStartThreshold",(function(){return n.dragStartThreshold})),r.d(t,"previewTime",(function(){return n.previewTime})),r.d(t,"rightMouseButton",(function(){return n.rightMouseButton}));var o=r(3);r.d(t,"DefaultPublishedAppMetadataParser",(function(){return o.DefaultPublishedAppMetadataParser}));var i=r(10);r.d(t,"RootAppMetadataParser",(function(){return i.RootAppMetadataParser}));var s=r(11);r.d(t,"IAppExtendedMetadata",(function(){return s.IAppExtendedMetadata}));var c=r(4);r.d(t,"IAppInfo",(function(){return c.IAppInfo})),r.d(t,"IAppInfoCorePlayer",(function(){return c.IAppInfoCorePlayer}));var p=r(6);r.d(t,"rootRelativePath",(function(){return p.rootRelativePath}));var l=r(7);r.d(t,"PlayerAppDataFolderLocator",(function(){return l.PlayerAppDataFolderLocator}));var u=r(1);r.d(t,"AppLogs",(function(){return u.AppLogs})),r.d(t,"ConnectedDataEnableCdpGetRowsFunction",(function(){return u.ConnectedDataEnableCdpGetRowsFunction})),r.d(t,"ConnectedDataRequireDataEntityRecords",(function(){return u.ConnectedDataRequireDataEntityRecords})),r.d(t,"CopyLogs",(function(){return u.CopyLogs})),r.d(t,"CurrentEndpoint",(function(){return u.CurrentEndpoint})),r.d(t,"DelayDropBoxDescription",(function(){return u.DelayDropBoxDescription})),r.d(t,"EnableAppVersionCheck",(function(){return u.EnableAppVersionCheck})),r.d(t,"LogsCopied",(function(){return u.LogsCopied})),r.d(t,"OverrideCloudPackagingHeaderValue",(function(){return u.OverrideCloudPackagingHeaderValue})),r.d(t,"PerformanceRecoderEnabled",(function(){return u.PerformanceRecoderEnabled})),r.d(t,"RequestNotification",(function(){return u.RequestNotification})),r.d(t,"SharepointFormAppOverride",(function(){return u.SharepointFormAppOverride})),r.d(t,"SingleSignOnEnabled",(function(){return u.SingleSignOnEnabled})),r.d(t,"TestNotificationTitle",(function(){return u.TestNotificationTitle})),r.d(t,"UseLocallyGeneratedPlayerPackage",(function(){return u.UseLocallyGeneratedPlayerPackage})),r.d(t,"showConditionalControlsInTreeView",(function(){return u.showConditionalControlsInTreeView}));var d=r(8);r.d(t,"PublishedAppMetadataCache",(function(){return d.PublishedAppMetadataCache}))},function(e,t,r){"use strict";r.r(t);r(15);var a=r(5);Core.exportToNamespace(["Player","Common"],a);var n=r(0);Core.exportToNamespace(["Player","Common","Constants"],n);r(4),r(11);var o=r(6);Core.exportToNamespace(["Player","Common","Paths"],o);var i=r(7);Core.exportToNamespace(["Player","Common"],i);var s=r(1);Core.exportToNamespace(["Player","NonLocalizedStrings","DebugStrings"],s);var c=r(8);Core.exportToNamespace(["Player","Common"],c);var p=r(3);Core.exportToNamespace(["Player","Common"],p);var l=r(10);Core.exportToNamespace(["Player","Common"],l)}]);
//# sourceMappingURL=D:/a/_work/1/s/obj/Assets/js/Player.Common/Player.Common.js.map