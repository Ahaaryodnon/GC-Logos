/*! For license information please see Core.Transport.js.LICENSE.txt */
(function(){return this?this:window}())["@pa-client/core-transport"]=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=27)}([function(e,t){!function(){e.exports=function(){return this?this:window}()["@pa-client/core"]}()},function(e,t,r){"use strict";r.r(t),r.d(t,"InternalConstants",(function(){return n}));var n=function(){function e(){}return e.deferredCall="dcall:",e.deferredCallResult="dresult",e.deferredCallError="dresult!",e.event="event",e.extendedTransportResponse="extendedTransportResponse",e.oldStyleCallResult="result:",e.propertyChange="prop:",e.reverseCall="rcall:",e.reverseCallResult="rresult:",e.serverSequenceNumber="seq",e.chunkTag=".chunked",e.chunkStoreFetchPrefix=".chunkstorefetch:",e}()},function(e,t,r){"use strict";var n;r.r(t),r.d(t,"TransportBatchingMode",(function(){return n})),function(e){e[e.default=0]="default",e[e.immediate=1]="immediate",e[e.normal=2]="normal",e[e.deferred=3]="deferred",e[e.lowPriority=4]="lowPriority"}(n||(n={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"FramedMessage",(function(){return i})),r.d(t,"repeat",(function(){return a}));var n=r(0),o=r(5),i=function(){function e(){this._entries=[]}return Object.defineProperty(e.prototype,"count",{get:function(){return this._entries.length},enumerable:!1,configurable:!0}),e.fromString=function(t){var r=new e,n=0;if(0===t.length)return r;var i="["===t[0],a=!0;for(i&&++n;a;){var s=n=e.expect(t,n,'{"'),u=n=t.indexOf('"',n);if(-1===n)throw new o.TransportException("At ".concat(s,"/").concat(t.length," could not find end of key"));var c=n=e.expect(t,n,'":'),l=void 0;i?-1!==(n=t.indexOf("\n",n))?(l=n-=2,n=e.expect(t,n,"},\n"),a=!0):(l=n=t.length-2,n=e.expect(t,n,"}"),a=!1):(l=n=t.length-1,n=e.expect(t,n,"}"),a=!1),r._entries.push({key:t.substr(s,u-s),value:t.substr(c,l-c)})}if(i&&(n=e.expect(t,n,"]")),n!==t.length)throw new o.TransportException("At ".concat(n,"/").concat(t.length," expected end of input. Context: ").concat(JSON.stringify(e.scrubbedContext(t,n)),"."));return r},e.scrubbedContext=function(t,r){var n=e.context(t,r);return n.before=e.scrub(n.before),n.cursor=e.scrub(n.cursor),n},e.context=function(e,t){var r={before:"",cursor:""};if(t>0){var n=Math.min(t,20);r.before=e.substr(t-n,n)}if(t<e.length){var o=Math.min(e.length-t,20);r.cursor=e.substr(t,o)}return r},e.scrub=function(e){var t,r=/(\d+)|(\w+)|([\u0080-\uffff]+)|(.|\n|\r)/g,n=[];if(!e||""===e)return e;for(;null!==(t=r.exec(e));)t[1]?n.push(a("1",t[1].length)):t[2]?n.push(a("a",t[2].length)):t[3]?n.push(a("b",t[3].length)):t[4]&&t[4].charCodeAt(0)<=127?n.push(t[4]):n.push(a("c",t[0].length));return n.join("")},e.expect=function(t,r,n){if(t.length<r+n.length||t.substr(r,n.length)!==n)throw new o.TransportException("At ".concat(r,"/").concat(t.length," expected '").concat(n,"'.Context: ").concat(JSON.stringify(e.scrubbedContext(t,r)),"."));return r+n.length},e.prototype.add=function(e,t){this._entries.push({key:e,value:t})},e.prototype.addRange=function(e){for(var t=0,r=e._entries;t<r.length;t++){var n=r[t];this._entries.push(n)}},e.prototype.toString=function(){if(0===this._entries.length)return"";var e=[];this._entries.length>1&&e.push("[");for(var t=0;t<this._entries.length;++t){var r=this._entries[t];0!==t&&e.push(",\n"),e.push('{"'),e.push(r.key),e.push('":'),e.push(r.value),e.push("}")}return this._entries.length>1&&e.push("]"),e.join("")},e.prototype.at=function(e){return this._entries[e]},e.prototype.readAll=function(e){return this._entries.filter((function(t){return 0===t.key.indexOf(e)}))},e.prototype.readSingle=function(e){var t=this.readAll(e);return Object(n.Contracts_check)(1===t.length,"Failed to find required entry with specified prefix."),t[0]},e}();function a(e,t){for(var r=[],n=0;n<t;++n)r.push(e);return r.join("")}},function(e,t,r){"use strict";r.r(t),r.d(t,"Chunking",(function(){return i})),r.d(t,"RemoteChunkStore",(function(){return a}));r(0);var n=r(3),o=r(1),i=function(){function e(){}return e.isChunked=function(e){return e.readAll(o.InternalConstants.chunkTag).length>0},e.parseChunkHeader=function(e){var t=e.readSingle(o.InternalConstants.chunkTag).value,r=JSON.parse(t);return{firstChunkId:r[0],totalChunks:r[1]}},e.unchunk=function(t,r,i){for(var a=new n.FramedMessage,s=e.parseChunkHeader(t),u=s.firstChunkId,c=s.totalChunks,l=0;l<t.count;++l){var d=t.at(l);d.key!==o.InternalConstants.chunkTag&&a.add(d.key,d.value)}for(l=u;c>0;--c,++l){var h=r.fetchAndRemove(l,i);a.addRange(h)}return a},e.unchunkAsync=function(t,r,i){return __awaiter(this,void 0,Promise,(function(){var a,s,u,c,l,d,h,f,p,v,m,_,C;return __generator(this,(function(g){switch(g.label){case 0:for(a=new n.FramedMessage,s=e.parseChunkHeader(t),u=s.firstChunkId,c=s.totalChunks,h=0;h<t.count;++h)(l=t.at(h)).key!==o.InternalConstants.chunkTag&&a.add(l.key,l.value);for(d=[],h=u;c>0;--c,++h)f=r.fetchAndRemoveAsync(h,i),d.push(f);p=0,v=d,g.label=1;case 1:return p<v.length?(m=v[p],C=(_=a).addRange,[4,m]):[3,4];case 2:C.apply(_,[g.sent()]),g.label=3;case 3:return p++,[3,1];case 4:return[2,a]}}))}))},e}(),a=function(){function e(e){this._wire=e}return e.prototype.fetchAndRemove=function(e,t){var r=this._wire.sendSynchronously(".chunkstore",0,"fetch",o.InternalConstants.chunkStoreFetchPrefix+e,t);return n.FramedMessage.fromString(r)},e.prototype.fetchAndRemoveAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r;return __generator(this,(function(i){switch(i.label){case 0:return[4,this._wire.send(".chunkstore",0,"fetch",o.InternalConstants.chunkStoreFetchPrefix+e,t)];case 1:return r=i.sent(),[2,n.FramedMessage.fromString(r)]}}))}))},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"TransportException",(function(){return o}));var n=r(0),o=function(e){function t(t){return e.call(this,t,"TransportException")||this}return __extends(t,e),t}(n.ErrorBase)},function(e,t,r){"use strict";var n;r.r(t),r.d(t,"NotifyCollectionChangedAction",(function(){return n})),function(e){e[e.Add=0]="Add",e[e.Remove=1]="Remove",e[e.Replace=2]="Replace",e[e.Move=3]="Move",e[e.Reset=4]="Reset"}(n||(n={}))},function(e,t,r){},function(e,t,r){"use strict";r.r(t),r.d(t,"EnumerableConverterHelper",(function(){return o}));var n=r(6),o=function(){function e(){}return e._fromDto=function(e,t,r,o,i,a){if(void 0===a&&(a=!1),a&&o.getIsOutOfOrderBlockingXhr())return e;if(Array.isArray(t))return t.map((function(e){return i(void 0,e,o)}));if(Array.isArray(r)){for(var s=e||[],u=0,c=r;u<c.length;u++){var l=c[u];if(l.a===n.NotifyCollectionChangedAction.Add){var d=i(void 0,l.v,o);s.length===l.i?s.push(d):s.splice(l.i,0,d)}else l.a===n.NotifyCollectionChangedAction.Replace?s[l.i]=i(s[l.i],l.v,o):l.a===n.NotifyCollectionChangedAction.Remove?s.splice(l.i,1):l.a===n.NotifyCollectionChangedAction.Reset&&(s=[])}return s}return void 0===e?null:e},e}()},function(e,t,r){"use strict";var n;r.r(t),r.d(t,"EventScope",(function(){return n})),function(e){e[e.EventInitiator=0]="EventInitiator",e[e.NonEventInitiator=1]="NonEventInitiator"}(n||(n={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"IdKeeper",(function(){return o}));r(0);var n=r(5),o=function(){function e(){this._nextOid=1,this._map={}}return e.prototype.tryFromOid=function(e){return this._map[e]||null},e.prototype.fromOid=function(e){var t=this.tryFromOid(e);if(null===t)throw new n.TransportException("No object with specified id exists, id = "+e);return t},e.prototype.tryGetExistingOid=function(e){return e&&e._oid?e._oid:null},e.prototype.getExistingOid=function(e){var t=this.tryGetExistingOid(e);if(null===t){var r=e&&e.constructor?"'"+function(e){if(!(e instanceof Function))return;if(e.name)return e.name;if(e.toString instanceof Function){var t=e.toString().match(/^function\s*(\S+?)\s*\(/);if(t)return t[1]}return}(e.constructor)+"'":"object";throw new n.TransportException("Could not find existing oid for "+r+" in idkeeper")}return t},e.prototype.getOid=function(e){var t=this.tryGetExistingOid(e);return null!==t||(t=this._nextOid++,e._oid=t,this._map[t]=e,this.onNewObject&&this.onNewObject(t)),t},e.prototype.addOid=function(e,t){if(e<=0)throw new n.TransportException("invalid argument; oid must be positive integer, id = "+e);this._map[e]=t,this.onNewObject&&this.onNewObject(e)},e.prototype.deleteOid=function(e){delete this._map[e]},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ConnectionState",(function(){return p}));var n,o=r(0),i=r(4),a=r(3),s=r(9),u=r(10),c=r(1),l=r(12),d=r(2);!function(e){e[e.queued=0]="queued",e[e.sent=1]="sent",e[e.canceled=2]="canceled"}(n||(n={}));var h=function(){function e(e,t){this._completions=null,Object(o.Contracts_checkArray)(e),Object(o.Contracts_checkValue)(t),this._deferredCalls=e,this._exceptionDeserializer=t}return e.prototype.encodeDeferredCalls=function(e){Object(o.Contracts_check)(null!==this._deferredCalls);var t=this._deferredCalls;this._deferredCalls=null;for(var r=0,i=t;r<i.length;r++){var a=i[r];a.state==n.queued&&(a.state=n.sent)}(t=t.filter((function(e){return e.state!==n.canceled}))).forEach((function(t){e.add(c.InternalConstants.deferredCall+t.className+"/"+t.oid+"/"+t.methodName,t.payload)})),this._completions=t.map((function(e){return e.completion}))},e.prototype.tryPeekLast=function(){for(;this._deferredCalls&&this._deferredCalls.length>0;){var e=this._deferredCalls[this._deferredCalls.length-1];if(e.state!==n.canceled)return e;this._deferredCalls.pop()}return null},Object.defineProperty(e.prototype,"isEmpty",{get:function(){if(!this._deferredCalls)return!0;for(var e=0,t=this._deferredCalls;e<t.length;e++){if(t[e].state!==n.canceled)return!1}return!0},enumerable:!1,configurable:!0}),e.prototype.completeDeferredCalls=function(e){Object(o.Contracts_check)(null!==this._completions);var t=this._completions;this._completions=null;var r=e.readAll(c.InternalConstants.deferredCallResult);r.length!==t.length&&Object(o.Contracts_check)(!1,"server and client disagree on number of batched calls; expected ".concat(t.length,", but found ").concat(r.length));for(var n=t.length,i=0;i<n;++i)if(r[i].key===c.InternalConstants.deferredCallError){var a=this._exceptionDeserializer(JSON.parse(r[i].value));a=a||Object(o.throwInline)(new o.ApplicationError("Unexpected, improper exception deserializer behavior in completeDeferredCalls")),t[i].error(a)}else t[i].complete(r[i].value)},e.prototype.onError=function(e){this._clearAndFailCompletions(e)},e.prototype.dispose=function(){this._clearAndFailCompletions(Object(o.createCanceledError)())},Object.defineProperty(e.prototype,"telemetryNames",{get:function(){for(var e=Object.create(null),t=[],r=0,n=this._deferredCalls;r<n.length;r++){var o=n[r];e[o.methodName]||(e[o.methodName]=!0,t.push(o.className))}return{classNames:t,methodNames:Object.keys(e)}},enumerable:!1,configurable:!0}),e.prototype._clearAndFailCompletions=function(e){var t=this._completions;if(null!==t){this._completions=null;for(var r=0,n=t;r<n.length;r++){n[r].error(e)}}},e}(),f=function(){function e(){this._currentMode=null}return e.prototype.schedule=function(e){var t,r=this;if(null!==this._currentMode&&this._currentMode<e)return Object(o.PromiseUtils_preventCancel)(this._currentTimer);null===(t=this._abortController)||void 0===t||t.abort(),this._abortController=new AbortController;var n=this._abortController.signal;return this._currentMode=e,this._currentTimer=this._makeTimer(e,n).then((function(){r._currentMode=null,r._abortController=null})),Object(o.PromiseUtils_preventCancel)(this._currentTimer)},e.prototype._makeTimer=function(e,t){switch(e){case d.TransportBatchingMode.immediate:return Promise.resolve();case d.TransportBatchingMode.normal:return Object(o.PromiseUtils_timeout)(0,t,!0);case d.TransportBatchingMode.deferred:return Object(o.PromiseUtils_timeout)(20,t,!0);case d.TransportBatchingMode.lowPriority:return Object(o.PromiseUtils_never)()}return Promise.resolve()},e}(),p=function(){function e(e,t,r,n){void 0===n&&(n=null);var a=this;this._wire=e,this._methodDispatcher=t,this._eventDispatcher=r,this.localObjects=new u.IdKeeper,this.remoteObjects=new u.IdKeeper,this._deferredCalls=[],this._isCoauthoringSession=!1,this._blockingXhrUpdates=[],this._completedReverseCalls=[],Object(o.Contracts_check)(!!e),Object(o.Contracts_check)(!!t||null===t),this._defaultBatchingMode=n&&void 0!==n.defaultBatchingMode?n.defaultBatchingMode:d.TransportBatchingMode.normal,this._batchedMethodScheduler=n&&void 0!==n.batchedMethodScheduler?n.batchedMethodScheduler:new f,this._exceptionDeserializer=n&&void 0!==n.exceptionDeserializer?n.exceptionDeserializer:function(e){return Object(o.throwInline)(new Error(e))},this._runExclusive=n&&n.runExclusive,this._propertyChangeTracker=new l.PropertyChangeTracker(this.remoteObjects),this._chunkStore=new i.RemoteChunkStore(e),this.remoteObjects.onNewObject=function(e){a._propertyChangeTracker.flushExtraneousPropertyChanges(a,e)},this._wire.init((function(e){return a._processOutOfBandInvokeResponse(e)}))}return e.prototype.getIsOutOfOrderBlockingXhr=function(){return this._isOutOfOrderBlockingXhr},e.prototype.setIsCoauthoringSession=function(e){this._isCoauthoringSession=e,this._wire.setIsCoauthoringSession(e)},e.prototype.enableCoauthoringOutOfBandUpdates=function(){this._wire.trySetOutOfBandInvokeHandlingEnabled(this._isCoauthoringSession)},e.prototype._popDeferredCallSet=function(){if(0===this._deferredCalls.length)return null;var e=new h(this._deferredCalls,this._exceptionDeserializer);return this._deferredCalls=[],e},e.prototype.popDeferredCallSet=function(){return this._popDeferredCallSet()},e.prototype.send=function(e,t,r,n,o){return void 0!==o&&o!==d.TransportBatchingMode.default||(o=this._defaultBatchingMode),this.sendDeferred(e,t,r,n,o)},e.prototype.sendWithoutResponse=function(e,t,r,n,o){this.send(e,t,r,n,o)},e.prototype._sendNow=function(){var e=this,t=this._popDeferredCallSet();return this._runExclusive?this._runExclusive((function(r){return e._realSend(t).then((function(){if(r)return Promise.reject(r)}))})):this._realSend(t)},e.prototype._realSend=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n,i,s,u,c,l,d,h,f,p;return __generator(this,(function(m){switch(m.label){case 0:if(e.isEmpty)return o.CoreLog.verbose("[Transport] _realSend skipped - all deferred calls have been canceled."),[2];t=e.tryPeekLast(),r=t.className,n=t.oid,i=t.methodName,s=new a.FramedMessage,u=e&&e.telemetryNames,c=u&&u.methodNames,l=u&&u.classNames,d=Object(o.generate128BitUUID)(),this._realSendPart1(s,e),m.label=1;case 1:return m.trys.push([1,5,,6]),[4,this._wire.send(r,n,i,s.toString(),v(l,c,d))];case 2:return h=m.sent(),[4,this._realSendPart2(h,{correlationResponseId:d,classNames:r,methodNames:i})];case 3:return f=m.sent(),[4,this._realSendPart3(e,f)];case 4:return m.sent(),[3,6];case 5:throw p=m.sent(),null!==e&&e.onError(p),p;case 6:return[2]}}))}))},e.prototype._realSendPart1=function(e,t){null!==t&&t.encodeDeferredCalls(e),this._encodeCompletedReverseCalls(e)},e.prototype._realSendPart2Synchronous=function(e,t){var r=a.FramedMessage.fromString(e);if(!i.Chunking.isChunked(r))return r;var n=i.Chunking.parseChunkHeader(r);return o.CoreLog.verbose("[Transport] Reassemblying a chunked response to method {0}, {1} parts.",t.methodNames,n.totalChunks),i.Chunking.unchunk(r,this._chunkStore,t)},e.prototype._processOutOfBandInvokeResponse=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,this._realSendPart2(e,{correlationResponseId:"",classNames:"",methodNames:""})];case 1:return t=r.sent(),this._dispatchIncomingMessage(t,!1,s.EventScope.NonEventInitiator),[2]}}))}))},e.prototype._realSendPart2=function(e,t){var r=a.FramedMessage.fromString(e);if(!i.Chunking.isChunked(r))return Promise.resolve(r);var n=i.Chunking.parseChunkHeader(r);return o.CoreLog.verbose("[Transport] Reassemblying a chunked response to method {0}, {1} parts.",t.methodNames,n.totalChunks),i.Chunking.unchunkAsync(r,this._chunkStore,t)},e.prototype._realSendPart3Synchronous=function(e,t){this._dispatchIncomingMessageSynchronous(t,!1),null!==e?e.completeDeferredCalls(t):Object(o.Contracts_check)(0===t.readAll(c.InternalConstants.deferredCallResult).length,"server and client disagree on number of batched calls; server sent no deferred results")},e.prototype._realSendPart3=function(e,t){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this._dispatchIncomingMessage(t,!1)];case 1:return r.sent(),null!==e?e.completeDeferredCalls(t):Object(o.Contracts_check)(0===t.readAll(c.InternalConstants.deferredCallResult).length,"server and client disagree on number of batched calls; server sent no deferred results"),[2]}}))}))},e.prototype.sendSynchronously=function(e,t,r,i){var s,u,c=!1,l={className:e,oid:t,methodName:r,payload:i,state:n.queued,completion:{complete:function(e){s=e,c=!0},error:function(e){u=e}}};this._deferredCalls.push(l);var d=new a.FramedMessage,h=this._popDeferredCallSet(),f=h&&h.telemetryNames,p=f&&f.methodNames,m=f&&f.classNames,_=Object(o.generate128BitUUID)();this._realSendPart1(d,h),o.CoreLog.verbose("[Transport] blocking xhr, framed message with {0} entries.",d.count);try{var C=this._wire.sendSynchronously(e,t,r,d.toString(),v(m,p,_)),g=this._realSendPart2Synchronous(C,{correlationResponseId:_,classNames:e,methodNames:r});this._realSendPart3Synchronous(h,g)}catch(e){throw null!==h&&h.onError(e),e}if(!c)throw u;return s},e.prototype.sendDeferred=function(e,t,r,i,a){var s=this,u=this._deferredCalls.length+1>=50,c={className:e,oid:t,methodName:r,payload:i,state:n.queued,completion:null},l=new WinJSPromise((function(e,t){c.completion={complete:e,error:t},s._deferredCalls.push(c)}),(function(){return s._cancelDeferredCall(c)}));return u?this._sendNow().catch((function(e){o.CoreLog.error("ConnectionState.sendDeferred",e,"Unexpected exception in ConnectionState._sendNow")})):this._startDeferredTimeout(a),l},e.prototype._cancelDeferredCall=function(e){if(e.state===n.queued){e.state=n.canceled;var t=this._deferredCalls.indexOf(e);t>=0&&this._deferredCalls.splice(t,1),e.completion.error(Object(o.createCanceledError)()),o.CoreLog.verbose("[Transport] deferred call to {0}/{1} canceled successfully.",e.className,e.methodName)}else o.CoreLog.verbose("[Transport] deferred call to {0}/{1} has already been sent and can no longer be canceled.",e.className,e.methodName)},e.prototype._startDeferredTimeout=function(e){var t=this;this._batchedMethodScheduler.schedule(e).then((function(){return t._finishDeferredTimeout()}),o.noOpFn)},e.prototype._finishDeferredTimeout=function(){var e=this,t=this._popDeferredCallSet();null!==t&&(this._runExclusive?this._runExclusive((function(){return e._deferredTimeout(t)})):this._deferredTimeout(t))},e.prototype._deferredTimeout=function(e){return this._realSend(e)},e.prototype._dispatchIncomingMessage=function(e,t,r){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(n){switch(n.label){case 0:return this._dispatchPropertyStateSynchronization(e,t),[4,this._dispatchEvents(e)];case 1:return n.sent(),this._dispatchDeferredCallEvents(e,r),this._dispatchReverseCalls(e),[2]}}))}))},e.prototype._dispatchDeferredCallEvents=function(e,t){var r=this,n=o.FeatureGates_coauthoring.enableDocumentEventBrokerAlways&&!o.FallbackSwitch.isActivated("DisableDocumentEventBrokerForNonCoauthoring");(this._isCoauthoringSession||n)&&e.readAll(c.InternalConstants.deferredCallResult).forEach((function(e){if(e.key===c.InternalConstants.deferredCallError){if(!r._isCoauthoringSession)return;var n;e.value&&r._exceptionDeserializer(JSON.parse(e.value))||Object(o.throwInline)(new o.ApplicationError("Unexpected, improper exception deserializer behavior in _dispatchDeferredCallEvents"))}else try{r._eventDispatcher.dispatchEvent(e.value,r,null!=t?t:s.EventScope.EventInitiator)}catch(n){Object(o.throwInline)(n)}}))},e.prototype._dispatchIncomingMessageSynchronous=function(e,t){this._dispatchPropertyStateSynchronization(e,t),this._dispatchEventsSynchronous(e),this._dispatchReverseCalls(e)},e.prototype._dispatchPropertyStateSynchronization=function(e,t){var r=this;this._isOutOfOrderBlockingXhr=t;var n=e.readAll(c.InternalConstants.propertyChange).map((function(e){var t=e.key.split(":");return{oid:parseInt(t[1],10),name:t[2],payload:JSON.parse(e.value)}}));if(n.length>0){var o=parseInt(e.readSingle(c.InternalConstants.serverSequenceNumber).value,10);if(this._propertyChangeTracker.unpackPropertyChanges(n,this),t)this._blockingXhrUpdates.push({seq:o,updates:n});else if(this._blockingXhrUpdates.length>0){var i=this._blockingXhrUpdates;this._blockingXhrUpdates=[],i.forEach((function(e){e.seq>o&&r._propertyChangeTracker.unpackPropertyChanges(e.updates,r)}))}}},e.prototype._dispatchEvents=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return t=e.readAll(c.InternalConstants.event).map((function(e){return e.value})),this.dispatchEventCollection&&t.length>0?[4,this.dispatchEventCollection(t)]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},e.prototype._dispatchEventsSynchronous=function(e){var t=e.readAll(c.InternalConstants.event).map((function(e){return e.value}));this.dispatchEventCollectionSynchronous&&t.length>0&&this.dispatchEventCollectionSynchronous(t)},e.prototype._decodeClientDataForEventCollector=function(e,t){return this._dispatchIncomingMessage(e,t)},e.prototype._decodeClientDataForEventCollectorSynchronous=function(e,t){this._dispatchIncomingMessageSynchronous(e,t)},e.prototype._dispatchReverseCalls=function(e){for(var t=0,r=e.readAll(c.InternalConstants.reverseCall);t<r.length;t++){var n=r[t],o=n.key.split(":",3),i=parseInt(o[1]),a=(o=o[2].split("/",3))[0],s=parseInt(o[1]),u=o[2],l=n.value;this._dispatchOneReverseCall(i,a,s,u,l)}},e.prototype._dispatchOneReverseCall=function(e,t,r,n,o){var i=this,a=this._methodDispatcher.invokeMethod(t,r,n,o,this);-1!==e&&a.then((function(t){i._completedReverseCalls.push({callId:e,result:t})}))},e.prototype._encodeCompletedReverseCalls=function(e){if(0!==this._completedReverseCalls.length){var t=this._completedReverseCalls;this._completedReverseCalls=[];for(var r=0,n=t;r<n.length;r++){var o=n[r];e.add(c.InternalConstants.reverseCallResult+o.callId,o.result)}}},e}();function v(e,t,r){return t&&0!==t.length&&e&&t.length===e.length?{classNames:encodeURI(e.join(";")),methodNames:encodeURI(t.join(";")),correlationResponseId:r}:{correlationResponseId:r}}},function(e,t,r){"use strict";r.r(t),r.d(t,"PropertyChangeTracker",(function(){return n}));r(0);var n=function(){function e(e){this._extraneous=Object.create(null),this._idKeeper=e}return e.prototype.flushExtraneousPropertyChanges=function(e,t){var r=this._idKeeper.fromOid(t),n=this._extraneous[t];n&&(delete this._extraneous[t],n.forEach((function(t){r._updateProperty(t,e)})))},e.prototype.unpackPropertyChanges=function(e,t){var r=this;e&&e.forEach((function(e){var n=r._idKeeper.tryFromOid(e.oid);if(!n){var o=r._extraneous[e.oid];return o||(o=r._extraneous[e.oid]=[]),void o.push(e)}n._updateProperty(e,t)}))},e}()},function(e,t,r){"use strict";r.d(t,"a",(function(){return n})),r.d(t,"b",(function(){return o}));var n=function(){return function(e,t){this.key=e,this.value=t}}(),o=function(){return function(e){this.value=e}}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ArrayConverter",(function(){return o}));var n=r(8),o=function(){function e(){}return e._fromDto=function(e,t,r,o,i){return void 0===i&&(i=!1),t?n.EnumerableConverterHelper._fromDto(e,t.f,t.d,r,o,i):null},e._toDto=function(e,t,r){return e?{f:e.map((function(e){return r(e,t)}))}:null},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"DateTimeConverter",(function(){return n})),r.d(t,"DateTimeOffsetConverter",(function(){return o}));var n=function(){function e(){}return e._fromSurrogate=function(e,t){if(!e)throw new Error("TransportException: Date dto was null or undefined");return new Date(e)},e._toSurrogate=function(e,t){return e.toJSON()},e}(),o=function(){function e(){}return e._fromSurrogate=function(e,t){if(!e)throw new Error("TransportException: Date dto was null or undefined");return new Date(e)},e._toSurrogate=function(e,t){return e.toJSON()},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"HashMapConverter",(function(){return o}));var n=r(6),o=function(){function e(){}return e._fromDto=function(e,t,r,o,i){if(void 0===i&&(i=!1),!t)return null;if(i&&r.getIsOutOfOrderBlockingXhr())return e;if(t.f){var a=Object.create(null);for(var s in t.f)a[s]=o(void 0,t.f[s],r);return a}if(t.d){a=e||Object.create(null);for(var u=0,c=t.d;u<c.length;u++){var l=c[u];l.a===n.NotifyCollectionChangedAction.Add||l.a===n.NotifyCollectionChangedAction.Replace?a[l.k]=o(a[l.k],l.v,r):l.a===n.NotifyCollectionChangedAction.Remove?delete a[l.k]:l.a===n.NotifyCollectionChangedAction.Reset&&(a=Object.create(null))}return a}return void 0===e?null:e},e._toDto=function(e,t,r){if(!e)return null;var n=Object.create(null);for(var o in e)n[o]=r(e[o],t);return{f:n}},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"KeyValuePairConverter",(function(){return n}));var n=function(){function e(){}return e._toSurrogate=function(e,t){return e},e._fromSurrogate=function(e,t){return e},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ListConverter",(function(){return o}));var n=r(8),o=function(){function e(){}return e._fromDto=function(e,t,r,o,i){return void 0===i&&(i=!1),t?n.EnumerableConverterHelper._fromDto(e,t.f,t.d,r,o,i):null},e._toDto=function(e,t,r){return e?{f:e.map((function(e){return r(e,t)}))}:null},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"UnionConverter",(function(){return n}));var n=function(){function e(){}return e._fromDto=function(e,t){for(var r=[],n=2;n<arguments.length;n++)r[n-2]=arguments[n];if(!e)return null;if(e.d<=0||e.d>r.length)throw new Error("Transport: union discriminator exceeds expected range. Expected value in range [1, "+r.length+"], found "+e.d);var o=JSON.parse(e.v);return r[e.d-1](void 0,o,t)},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"SimpleMethodDispatcher",(function(){return o}));r(0);var n=r(5),o=function(){function e(){this._handlers=Object.create(null)}return e.prototype.addMethod=function(e,t,r){var n=i(e,t);this._handlers[n]=r},e.prototype.invokeMethod=function(e,t,r,o,a){var s=i(e,r),u=this._handlers[s];if(!u)throw new n.TransportException("unknown method "+s);return u(t,o,a)},e}();function i(e,t){return e+"."+t}},function(e,t,r){"use strict";r.r(t),r.d(t,"WebAuthoringBatchingScheduler",(function(){return i}));var n=r(0),o=r(2),i=function(){function e(){this._currentMode=null}return e.prototype.schedule=function(e){var t,r=this;return null!==this._currentMode&&this._currentMode<e||this._currentMode===o.TransportBatchingMode.normal||(null===(t=this._abortController)||void 0===t||t.abort(),this._abortController=new AbortController,this._currentMode=e,this._currentTimer=this._makeTimer(e,this._abortController).then((function(){r._currentMode=null,r._abortController=null}))),Object(n.PromiseUtils_preventCancel)(this._currentTimer)},e.prototype._makeTimer=function(e,t){switch(e){case o.TransportBatchingMode.immediate:return Promise.resolve();case o.TransportBatchingMode.normal:return Object(n.CoreTasks_scheduleAsync)((function(){return Promise.resolve()}),"WebAuthoringBatchingScheduler",t);case o.TransportBatchingMode.deferred:return Object(n.CoreTasks_scheduleAsync)((function(){return Object(n.PromiseUtils_timeout)(100,t.signal,!0)}),"WebAuthoringBatchingScheduler",t);case o.TransportBatchingMode.lowPriority:return Object(n.PromiseUtils_never)();default:return Promise.resolve()}},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"NullableConverter",(function(){return n}));var n=function(){function e(){}return e._toSurrogate=function(e,t){if(null!=e)return{value:e}},e._fromSurrogate=function(e,t){return e?e.value:null},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ReliableWire",(function(){return n}));r(0);var n=function(){function e(e){this._nextSequenceNumber=0,this._unconfirmedSequenceNumbers=[],this._realWire=e}return e.prototype.setIsCoauthoringSession=function(e){this._realWire.setIsCoauthoringSession(e)},e.prototype.trySetOutOfBandInvokeHandlingEnabled=function(e){this._realWire.trySetOutOfBandInvokeHandlingEnabled(e)},e.prototype.init=function(e){this._realWire.init(e)},e.prototype.send=function(e,t,r,n,o){return __awaiter(this,void 0,Promise,(function(){var i,a,s,u;return __generator(this,(function(c){switch(c.label){case 0:i=this._nextSequenceNumber++,this._unconfirmedSequenceNumbers.push(i),a=this._currentConfirmationNumber,s={sequenceNumber:i,confirmationNumber:a},c.label=1;case 1:return c.trys.push([1,,3,4]),[4,this._realWire.send(e,t,r,n,s,o)];case 2:return[2,c.sent()];case 3:return u=this._unconfirmedSequenceNumbers.indexOf(i),this._unconfirmedSequenceNumbers.splice(u,1),[7];case 4:return[2]}}))}))},e.prototype.sendSynchronously=function(e,t,r,n,o){var i=this._nextSequenceNumber++;this._unconfirmedSequenceNumbers.push(i);var a={sequenceNumber:i,confirmationNumber:this._currentConfirmationNumber};try{return this._realWire.sendSynchronously(e,t,r,n,a,o)}finally{this._unconfirmedSequenceNumbers.pop()}},Object.defineProperty(e.prototype,"_currentConfirmationNumber",{get:function(){return this._unconfirmedSequenceNumbers.reduce((function(e,t){return Math.min(e,t)}))-1},enumerable:!1,configurable:!0}),e}()},function(e,t,r){"use strict";function n(e){return e.customizeCall instanceof Function}r.r(t),r.d(t,"isCustomizedProxy",(function(){return n}))},function(e,t,r){},function(e,t,r){},function(e,t,r){r(29),e.exports=r(28)},function(e,t,r){"use strict";r.r(t);var n=r(4);r.d(t,"Chunking",(function(){return n.Chunking})),r.d(t,"IChunkingHeader",(function(){return n.IChunkingHeader})),r.d(t,"RemoteChunkStore",(function(){return n.RemoteChunkStore}));var o=r(11);r.d(t,"ConnectionState",(function(){return o.ConnectionState})),r.d(t,"ICompletable",(function(){return o.ICompletable})),r.d(t,"IDeferredCallSet",(function(){return o.IDeferredCallSet}));var i=r(25);r.d(t,"ArrayChange",(function(){return i.ArrayChange}));var a=r(14);r.d(t,"ArrayConverter",(function(){return a.ArrayConverter})),r.d(t,"ArrayDto",(function(){return a.ArrayDto}));var s=r(15);r.d(t,"DateTimeConverter",(function(){return s.DateTimeConverter})),r.d(t,"DateTimeOffsetConverter",(function(){return s.DateTimeOffsetConverter}));var u=r(8);r.d(t,"EnumerableConverterHelper",(function(){return u.EnumerableConverterHelper}));var c=r(26);r.d(t,"HashMapChange",(function(){return c.HashMapChange}));var l=r(16);r.d(t,"HashMapConverter",(function(){return l.HashMapConverter})),r.d(t,"HashMapDto",(function(){return l.HashMapDto}));var d=r(17);r.d(t,"KeyValuePair",(function(){return d.KeyValuePair})),r.d(t,"KeyValuePairConverter",(function(){return d.KeyValuePairConverter}));var h=r(18);r.d(t,"ListConverter",(function(){return h.ListConverter})),r.d(t,"ListDto",(function(){return h.ListDto}));var f=r(6);r.d(t,"NotifyCollectionChangedAction",(function(){return f.NotifyCollectionChangedAction}));var p=r(22);r.d(t,"NullableConverter",(function(){return p.NullableConverter}));var v=r(19);r.d(t,"UnionConverter",(function(){return v.UnionConverter})),r.d(t,"UnionDto",(function(){return v.UnionDto}));var m=r(3);r.d(t,"FramedMessage",(function(){return m.FramedMessage})),r.d(t,"IFramedMessageEntry",(function(){return m.IFramedMessageEntry})),r.d(t,"repeat",(function(){return m.repeat}));var _=r(10);r.d(t,"IdKeeper",(function(){return _.IdKeeper}));var C=r(9);r.d(t,"IEventDispatcher",(function(){return C.IEventDispatcher}));var g=r(1);r.d(t,"InternalConstants",(function(){return g.InternalConstants}));var y=r(12);r.d(t,"PropertyChangeTracker",(function(){return y.PropertyChangeTracker}));var b=r(23);r.d(t,"ReliableWire",(function(){return b.ReliableWire}));var S=r(20);r.d(t,"IMethodHandler",(function(){return S.IMethodHandler})),r.d(t,"SimpleMethodDispatcher",(function(){return S.SimpleMethodDispatcher}));var O=r(2);r.d(t,"AppMagicAuthoring_TransportBatchingMode",(function(){return O.TransportBatchingMode})),r.d(t,"Core_TransportBatchingMode",(function(){return O.TransportBatchingMode}));var T=r(5);r.d(t,"TransportException",(function(){return T.TransportException}));var k=r(24);r.d(t,"isCustomizedProxy",(function(){return k.isCustomizedProxy}));var x=r(7);r.d(t,"IAbstractWire",(function(){return x.IAbstractWire})),r.d(t,"IConnectionState",(function(){return x.IConnectionState})),r.d(t,"IConnectionStateOptions",(function(){return x.IConnectionStateOptions})),r.d(t,"ICustomizedProxy",(function(){return x.ICustomizedProxy})),r.d(t,"IIdempotentWire",(function(){return x.IIdempotentWire})),r.d(t,"IWireCustomLoggingDimensions",(function(){return x.IWireCustomLoggingDimensions})),r.d(t,"IdempotentWireServerMetadata",(function(){return x.IdempotentWireServerMetadata})),r.d(t,"PropertyUpdateEntry",(function(){return x.PropertyUpdateEntry})),r.d(t,"CoreTransport_TransportBatchingMode",(function(){return x.TransportBatchingMode}));var N=r(21);r.d(t,"IBatchingScheduler",(function(){return N.IBatchingScheduler})),r.d(t,"WebAuthoringBatchingScheduler",(function(){return N.WebAuthoringBatchingScheduler}));var I=r(13);r.d(t,"KeyValuePairSurrogate",(function(){return I.a})),r.d(t,"NullableSurrogate",(function(){return I.b}))},function(e,t,r){"use strict";r.r(t);var n=r(0),o=r(4);Object(n.exportToNamespace)(["Core","Transport"],o);var i=r(11);Object(n.exportToNamespace)(["Core","Transport"],i);r(25);var a=r(14);Object(n.exportToNamespace)(["Core","Transport"],a);var s=r(15);Object(n.exportToNamespace)(["Core","Transport"],s);var u=r(8);Object(n.exportToNamespace)(["Core","Transport"],u);r(26);var c=r(16);Object(n.exportToNamespace)(["Core","Transport"],c);var l=r(17);Object(n.exportToNamespace)(["Core","Transport"],l);var d=r(18);Object(n.exportToNamespace)(["Core","Transport"],d);var h=r(6);Object(n.exportToNamespace)(["Core","Transport"],h);var f=r(22);Object(n.exportToNamespace)(["Core","Transport"],f);var p=r(19);Object(n.exportToNamespace)(["Core","Transport"],p);var v=r(3);Object(n.exportToNamespace)(["Core","Transport"],v);var m=r(10);Object(n.exportToNamespace)(["Core","Transport"],m);var _=r(9);Object(n.exportToNamespace)(["Core","Transport"],_);var C=r(1);Object(n.exportToNamespace)(["Core","Transport"],C);var g=r(12);Object(n.exportToNamespace)(["Core","Transport"],g);var y=r(23);Object(n.exportToNamespace)(["Core","Transport"],y);var b=r(20);Object(n.exportToNamespace)(["Core","Transport"],b);var S=r(2);Object(n.exportToNamespace)(["Core"],S),Object(n.exportToNamespace)(["AppMagic","Authoring"],S);var O=r(5);Object(n.exportToNamespace)(["Core","Transport"],O);var T=r(24);Object(n.exportToNamespace)(["Core","Transport"],T);r(7);var k=r(21);Object(n.exportToNamespace)(["AppMagic","Authoring"],k);var x=r(13);Core.exportToNamespace(["Microsoft","AppMagic","Transport"],{KeyValuePairSurrogate:x.a,NullableSurrogate:x.b})}]);
//# sourceMappingURL=D:/a/_work/1/s/obj/Assets/js/Core.Transport/Core.Transport.js.map