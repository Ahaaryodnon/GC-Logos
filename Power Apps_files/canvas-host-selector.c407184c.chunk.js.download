/*! For license information please see canvas-host-selector.c407184c.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[609],{28163:function(e,t,n){"use strict";n.r(t);var r=n(10926),a=n(28164),i=n(17321),o=n(12092),c=n(28169),s=n(28167);t.default=function(e){var t=r.useContext(o.b),n=Object(i.h)(t.canvasLoadPhase),u=t.canvasLoadPhase;return r.useEffect(()=>{t&&t.registerCallbacks(e)},[]),r.useMemo(()=>{var t=r.createElement(s.a,null,r.createElement(a.a,e));switch(u){case o.a.Preload:case o.a.Visible:return r.createElement(c.a,null);case o.a.NotInitialized:return void 0===n||n===o.a.NotInitialized||n===o.a.ClosedForMismatch||n===o.a.StudioVersionChanged?t:null;default:return t}},[u,n])}},28164:function(e,t,n){"use strict";var r=n(12219),a=n(11467),i=n(10926),o=n.n(i),c=n(11205),s=n(25011),u=n(17712),l=n(12394),v=n(28165),d=n(17321),b=n(11021),m=n(12094),f=n(28166),O=n(17322),p=n(28167),j=n(28168),h=n(12096),g=n(12065),w=n(11031),E=["onFileCloseMessage","onAppCreated"];function y(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function C(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?y(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):y(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(){return(P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function V(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var U=e=>{var t=Object(c.i)(),n=Object(c.j)(),f=o.a.useContext(g.a),{switchEnvironment:y}=Object(r.bb)(),{currentEnvironment:S,refetch:U}=Object(r.W)(),{onFileCloseMessage:N,onAppCreated:I}=e,D=V(e,E),A=new URLSearchParams(n.search),W=!!A.get(h.a.JoinToken.value)&&!!A.get(h.a.IsHosted.value)&&!!A.get(h.a.HostIsDesktop.value),k=A.get(h.a.EnvironmentName.value)||void 0,[L,H]=Object(i.useState)(),R=Object(i.useRef)(),F=Object(j.a)({action:A.get(h.a.Action.value),appId:A.get(h.a.AppId.value)});Object(i.useEffect)(()=>{F&&(Object(b.W)(m.n,{eventName:"".concat(m.m,"/studioUrlBeforeSwitchEnvironment")}),Object(d.e)(f.allowListFeatures,z,F,a.a.language).then(e=>{X(Object(w.a)(),e),Object(b.W)(m.n,{eventName:"".concat(m.m,"/switchingEnvironment"),eventData:{newEnvironmentId:F.name,search:t.location.search}}),y(F,"/e/".concat(F.name,"/canvas").concat(t.location.search))}).catch(e=>{Object(b.U)(m.n,{eventName:"".concat(m.m,"/studioUrlBeforeSwitchEnvironmentFailed")},e)}))},[F]),Object(i.useEffect)(()=>{var e;return Object(b.W)(m.n,{eventName:"".concat(m.m,"/CanvasHostMounted"),eventData:{environmentName:null!==(e=null==S?void 0:S.name)&&void 0!==e?e:""}}),Y()&&(Object(b.W)(m.n,{eventName:"".concat(m.m,"/CanvasHostRefreshingCurrentEnvironment")}),U()),()=>{"REPLACE"!==t.action&&(R.current&&R.current.completeWithWarning({result:l.b[l.b.Canceled],action:t.action,location:n}),H(void 0))}},[]),Object(i.useEffect)(()=>{R.current=L},[L]);var x=Object(i.useRef)(Object(w.a)()),[T,M]=Object(i.useState)(),[B,_]=Object(i.useState)(),{search:z}=n,J=null==S?void 0:S.name;return Object(i.useEffect)(()=>{k&&k!==J||Object(d.e)(f.allowListFeatures,z,S,a.a.language).then(e=>{(null==T?void 0:T.studioUrl)!==e.studioUrl&&X(Object(w.a)(),e)})},[z,S,k,J]),Object(i.useEffect)(()=>{if(!Y()&&null!=T&&T.studioUrl)if(L)L.progress();else{var e,t=Object(b.X)(m.n,"CanvasHost/StudioLoad",{studioURL:T.studioUrl,environmentName:null!==(e=null==S?void 0:S.name)&&void 0!==e?e:""});H(t)}},[null==T?void 0:T.studioUrl]),!Y()&&null!=T&&T.studioUrl&&S?o.a.createElement(p.a,null,o.a.createElement("div",{className:u.a.visibleContainer},o.a.createElement(s.default,P({onAuthoringHostVersionDetermined:function(e){var t={clientSessionId:x.current,studioURL:null==T?void 0:T.studioUrl,overrideStudioVersion:B,clientVersion:null==T?void 0:T.webAuthoringVersion,authoringHostVersion:e,environmentName:null==S?void 0:S.name};if(e===(null==T?void 0:T.webAuthoringVersion))return void Object(b.W)(m.n,{eventName:"".concat(m.m,"/CanvasHost.onAuthoringHostVersionDetermined.VersionMatches"),eventData:t});Object(d.e)(f.allowListFeatures,z,S,a.a.language,e).then(e=>{if((null==T?void 0:T.studioUrl)!==e.studioUrl){var n=Object(w.a)();Object(b.W)(m.n,{eventName:"".concat(m.m,"/CanvasHost.onAuthoringHostVersionDetermined.HandleVersionMismatch"),eventData:C(C({},t),{},{newClientSessionId:n,newStudioUrl:e.studioUrl,newClientVersion:e.webAuthoringVersion})}),X(n,e),_(e.webAuthoringVersion)}else Object(b.W)(m.n,{eventName:"".concat(m.m,"/CanvasHost.onAuthoringHostVersionDetermined.VersionMismatchButUrlsMatch"),eventData:t})})},onStudioMessageReceived:function(e){switch(e.data&&e.data.eventType){case l.a.FileClose:!function(){if(N)return void N();Object(O.a)(t,S)}(),q(e);break;case l.a.FileOpened:!function(e){Object(d.f)(t)||Object(O.d)(e,t)}(e),q(e);break;case l.a.DocumentClosed:q(e);break;case l.a.AppCreated:n=e,I&&I(n.data.appId,n.data.environmentName,n.data.solutionId),q(e);break;case l.a.FileSave:!function(e){Object(d.f)(t)||Object(O.e)(e,t)}(e),q(e);break;case l.a.SwitchStudioVersion:!function(e){var t,n=null==e||null===(t=e.data)||void 0===t?void 0:t.studioVersion;Object(d.e)(f.allowListFeatures,z,S,a.a.language,n).then(e=>{var t={clientSessionId:x.current,studioURL:null==T?void 0:T.studioUrl,newStudioURL:e.studioUrl,newStudioURLVersion:e.webAuthoringVersion,overrideStudioVersion:B,clientVersion:null==T?void 0:T.webAuthoringVersion,newClientVersion:n,environmentName:null==S?void 0:S.name};if((null==T?void 0:T.studioUrl)!==e.studioUrl){var r=Object(w.a)();Object(b.W)(m.n,{eventName:"".concat(m.m,"/CanvasHost._onStudioVersionChange.SwitchVersion"),eventData:C(C({},t),{},{newClientSessionId:r})}),X(r,e),_(n)}else Object(b.W)(m.n,{eventName:"".concat(m.m,"/CanvasHost._onStudioVersionChange.AlreadyOnTargetVersion"),eventData:t})})}(e),q(e);break;case l.a.LoadComplete:q(e);break;case l.a.NavigateToListUrl:q(e),function(e){Object(O.c)(e,S)}(e);break;case l.a.NavigateToPortalHomePage:Object(O.b)(S);break;case l.a.RefreshPage:Object(O.f)()}var n}},D,{currentEnvironment:S,studioURL:T.studioUrl,clientSessionId:x.current,skipNewInstance:W,studioVersion:B,history:t})))):o.a.createElement("div",{className:u.a.visibleContainer},o.a.createElement(v.a,null));function X(e,t){x.current=e,M(t)}function Y(){return k&&k!==(null==S?void 0:S.name)}function q(e){var t,n,r=e.data.scenarioResult;void 0===r&&(null===(t=e.data)||void 0===t?void 0:t.eventType)===l.a.FileOpened&&(r=l.b.Success);var a,i={action:null!==(n=e.data.action)&&void 0!==n?n:"",result:l.b[r],scenarioResult:r,error:e.data.error,studioURL:null==T?void 0:T.studioUrl,data:e.data};if(r===l.b.Failed)null===(a=R.current)||void 0===a||a.failure(i);else if(r===l.b.Success){var o;null===(o=R.current)||void 0===o||o.complete(i)}else{var c;null===(c=R.current)||void 0===c||c.completeWithWarning(i)}H(void 0)}},N=Object(f.a)(e=>{var{isSuccess:t}=Object(r.W)();return t?o.a.createElement(U,e):o.a.createElement(v.a,null)});t.a=N},28165:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(10926),a=n(16092),i=n(11465),o=Object(i.s)("CanvasHost")(e=>{var{t:t,tReady:n}=e;return r.createElement(a.a,{header:n?t("Designer.HeaderText",{defaultValue:""}):"",showToolbox:!1,showCommandBar:!1,styles:{canvas:{backgroundColor:"#eaeaea"}}})})},28166:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(10926),a=n(11205),i=n(11021),o=n(12094),c=n(11940),s=n(11942),u=n(12096),l=n(12219),v=e=>t=>{var{currentEnvironment:n,refetch:v}=Object(l.W)(),d=Object(a.j)(),b=new URLSearchParams(d.search).get(u.a.EnvironmentName.value);return r.useEffect(()=>{m()&&(Object(i.W)(o.n,{eventName:"".concat(o.m,"/CanvasHostRefreshingCurrentEnvironment")}),v())},[]),m()?r.createElement(c.a,{style:{width:"100%"},size:s.a.large}):r.createElement(e,t);function m(){return b&&b!==(null==n?void 0:n.name)}}},28167:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(10926),a=n(12056),i=n(11021),o=n(12094);function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){u(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class l extends r.Component{constructor(e){super(e),this.state={error:void 0}}_createErrorDataObject(e,t){var{isCritical:n=!1,description:r="",message:a,stack:i=""}=e;return s(s({},t),{},{isCritical:n,description:r,message:a,stack:i})}componentDidCatch(e,t){var n=Object(a.b)(e),r=this._createErrorDataObject(n,t);throw Object(i.U)(o.n,{eventName:"".concat(o.n,"/").concat("errorBoundary"),eventData:r}),this.setState({error:e}),e}render(){var{children:e}=this.props;return r.createElement(r.Fragment,null,this.state.error?null:e)}}},28168:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(13743),a=n(10926),i=n(12094),o=n(12219),c=n(11021),s=n(17321);function u(e){var t,{appId:n,action:u}=e,[l,v]=Object(a.useState)(!1),{currentEnvironment:d}=Object(o.W)(),{environments:b}=Object(o.Y)(),m=null,f=[i.c,i.d];m=n&&u&&-1!==f.indexOf(u)?n.toLowerCase().startsWith(i.p.toLowerCase())?n:"".concat(i.p).concat(n):"";var{canvasApp:O,isInitialLoading:p}=Object(r.b)({appId:m,skipEnvironmentFilter:!0,environmentName:null==d?void 0:d.name,skipPPAPI:!0},i.n,"",{enabled:!!d});if(m&&!p&&!Object(s.a)(null==O||null===(t=O.environment)||void 0===t?void 0:t.id,null==d?void 0:d.id)&&b.some(e=>{var t;return Object(s.a)(e.id,null==O||null===(t=O.environment)||void 0===t?void 0:t.id)})){var j,h=b.find(e=>{var t;return Object(s.a)(e.id,null==O||null===(t=O.environment)||void 0===t?void 0:t.id)});return Object(c.W)(i.n,{eventName:"".concat(i.m,"/useEditEnvironmentValidation"),eventData:{canvasAppEnvironmentId:null==O||null===(j=O.environment)||void 0===j?void 0:j.id,currentEnvironmentId:null==d?void 0:d.id,environmentToSwitchTo:null==h?void 0:h.id,appIdWithPrefix:m,action:u}}),h}if(!p&&m&&!l){var g,w,E;if(Object(s.a)(null==O||null===(g=O.environment)||void 0===g?void 0:g.id,null==d?void 0:d.id))Object(c.W)(i.n,{eventName:"".concat(i.m,"/useEditEnvironmentValidationEnvironmentsMatch"),eventData:{canvasAppId:null==O?void 0:O.id,appIdWithPrefix:m,canvasAppEnvironmentId:null==O||null===(w=O.environment)||void 0===w?void 0:w.id,currentEnvironmentId:null==d?void 0:d.id,action:u}});else Object(c.U)(i.n,{eventName:"".concat(i.m,"/useEditEnvironmentValidationNotSwitched"),eventData:{canvasAppId:null==O?void 0:O.id,appIdWithPrefix:m,canvasAppEnvironmentId:null==O||null===(E=O.environment)||void 0===E?void 0:E.id,currentEnvironmentId:null==d?void 0:d.id,numberOfEnvironments:b.length,first10EnvironmentIds:b.map(e=>e.id).slice(0,10),action:u}});v(!0)}return null}},28169:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(12219),a=n(10926),i=n(12092),o=n(11205),c=n(28166),s=n(12065),u=Object(c.a)(()=>{var e=a.useContext(i.b),{currentEnvironment:t}=Object(r.W)(),n=a.useContext(s.a),c=Object(o.j)();return a.useEffect(()=>(e.getStudioUrlAndWebAuthoringVersion(null==n?void 0:n.allowListFeatures,t,c.search).then(t=>{e.showCanvas(t.studioUrl,t.webAuthoringVersion)}),()=>{e.closeCanvas()}),[]),null})}}]);
//# sourceMappingURL=https://sourcemaps.powerapps.com/srcmaps/static/js/module/canvas-host-selector.c407184c.chunk.js.map