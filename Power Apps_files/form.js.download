"use strict";
/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */var AppMagic;!function(e){!function(t){!function(t){var o=function(t){function o(e){var o=t.call(this,e)||this;return o._handleContainerRef=o._handleContainerRef.bind(o),o}return __extends(o,t),o.prototype.render=function(){var o=t.prototype.getChildControls.call(this);return React.createElement("div",{ref:this._handleContainerRef,className:"appmagic-typed-card ".concat(aphrodite.css(e.Controls.FluidGrid.DataCardStyles.card))},o)},o.prototype._handleContainerRef=function(e){this._container=e?e.parentElement:null},o}(e.Controls.Container.ContainerViewBase);t.TypedDataCardView=o}(t.Form||(t.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(t){var o=function(e){function o(){return null!==e&&e.apply(this,arguments)||this}return __extends(o,e),o.prototype.renderCore=function(){var e=this.props,o=e.getControl,r=e.controlInstance,n=e.controlContext,i=e.textDirection;return n._requestRenderObservable(),React.createElement(t.TypedDataCardView,{controlContext:n,getControl:o,controlInstance:r,bindingContext:n.bindingContext,textDirection:i})},o}(e.ObservableComponent);t.TypedDataCardContainer=o}(e.Form||(e.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return __extends(o,t),o.isTypedDataCardControl=function(e){return e instanceof o},o.prototype.initControlContext=function(e){t.prototype.initControlContext.call(this,e),this._updateValidProperty(e)},o.prototype.onValidationFailure=function(e){this._updateValidProperty(e)},o.prototype.onChangeRequired=function(e,t){this._updateValidProperty(t)},o.prototype.onChangeUpdate=function(e,t){this._updateValidProperty(t)},o.prototype.onChangeDataField=function(e,t){this._updateValidProperty(t)},o.prototype.isUnsaved=function(t){if(Core.Utility.isUndefined(t.modelProperties.Default)||Core.Utility.isUndefined(t.modelProperties.Update))return!1;var o=t.modelProperties.Default.getValue(),r=t.modelProperties.Update.getValue();return!e.Utility.deepCompare(o,r)},o.prototype.reset=function(e){if(e._hasChildren()){for(var t=0,o=e._children;t<o.length;t++){var r=o[t];r.controlContext.controlWidget.reset(r.controlContext)}Core.Utility.isDefined(e.modelProperties.Error)&&e.modelProperties.Error.setValue(null)}},Object.defineProperty(o.prototype,"dataFieldPropertyName",{get:function(){return"DisplayName"},enumerable:!1,configurable:!0}),o.prototype._updateValidProperty=function(t){var o=this._getValidation(t);if(t.modelProperties.Valid.setValue(o.isValid),o.isValid)t.modelProperties.Error.setValue(null);else{var r=this._getParentControl(t).errorKind;Core.Utility.isValue(r)&&r!==e.Data.ErrorKind.None&&t.modelProperties.Error.setValue(o.errorMessage)}},o.prototype._getValidation=function(t){if(!t.modelProperties.Update)return this._createValidationResult(!0);var o=t.modelProperties.Update.getValue(),r=t.modelProperties.Required.getValue(),n=this._getParentControl(t).dataSource,i=t.modelProperties.DataField.getValue();if(!n||!i)return this._createValidationResult(!0);if(r&&(Core.Utility.isNullOrUndefined(o)||"string"==typeof o&&Core.Utility.isEmptyString(o)||Core.Utility.isArray(o)&&0===o.length)){var a=t.modelProperties.DisplayName.getValue()||i;return this._createValidationResult(!1,e.Utility.formatString(e.Strings.ValidationErrors_FieldRequired,a))}var l=e.Data.DataValue.errorValueToNull(e.Functions.validate("column",n,i,o));return Core.Utility.isNonEmptyString(l)?this._createValidationResult(!1,l):this._createValidationResult(!0)},o.prototype._getParentControl=function(e){var t=e.bindingContext.rcManager.getControlWidget(),o={dataSource:null,errorKind:null};if(t){var r=t.control;o.dataSource=r.dataSource,o.errorKind=r.errorKind}return o},o.prototype._createValidationResult=function(e,t){return void 0===t&&(t=null),{isValid:e,errorMessage:t}},o}(e.Controls.FluidGrid.DataCardControl);t.TypedDataCardControl=o,e.Controls.RegisterReactConvertedControl("AppMagic.Controls.Form.TypedDataCardControl",e.Controls.Form.TypedDataCardControl,e.Controls.Form.TypedDataCardContainer,(function(){return!0}))}(t.Form||(t.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o=e.Controls.ScrollContainer,r=function(e){function t(t){var o=e.call(this,t)||this;return o._clearLoadingMessageTimeoutId=-1,o._loadingMessageShown=!1,o._setLoadingMessageTimeoutId=-1,o._shouldUpdateScrollOffset=o._shouldUpdateScrollOffset.bind(o),o.state={loadStatusMessage:""},o}return __extends(t,e),t._getStyles=function(e){var o=t._getStyleKey(e),r=t._styleCache[o];if(r)return r;var n={height:"100%",width:"100%",visibility:e?"hidden":"inherit",":not(foo) .appmagic-auto-height":{position:"relative"}},i=aphrodite.StyleSheet.create({form:{height:"100%",width:"100%"},formItem:n,screenReaderOnly:{position:"absolute",width:1,height:1,margin:-1,overflow:"hidden",whiteSpace:"nowrap"},noItemPlaceholder:{position:"absolute",top:"0px",left:"0px",width:"100%",height:"100%",backgroundColor:"rgba(255, 255, 255, 0.25)",display:"flex",alignItems:"center",justifyContent:"center"},noItemPlaceholderText:{flex:"0 0 auto",color:"#737373",fontFamily:"Segoe UI",fontWeight:"lighter",fontSize:"24px"}});return t._styleCache[o]=i,i},t._getStyleKey=function(e){return e.toString()},t.prototype.render=function(){var r=e.prototype.getChildControls.call(this),n=this.props,i=n.hideChildren,a=n.scrollTopOffset,l=n.onScroll,s=n.tabIndex,u=t._getStyles(i),d=null;return i&&(d=React.createElement("div",{className:"".concat(this._noItemPlaceholderClassName," ").concat(aphrodite.css(u.noItemPlaceholder))},React.createElement("div",{className:"".concat(this._noItemPlaceholderTextClassName," ").concat(aphrodite.css(u.noItemPlaceholderText))},this.props.noItemToDisplayText))),React.createElement("div",{className:"".concat(this._formClassName," ").concat(aphrodite.css(u.form)," no-focus-outline ").concat(i?"hide-children":"")},React.createElement(o,{scrollTopOffset:a,shouldUpdateScrollOffset:this._shouldUpdateScrollOffset,onScroll:l,tabIndex:s},React.createElement("div",{className:"powerapps-form-item ".concat(aphrodite.css(u.formItem))},r)),d,React.createElement("div",{"aria-live":"polite",className:aphrodite.css(u.screenReaderOnly)},this.state.loadStatusMessage))},t.prototype.componentDidMount=function(){e.prototype.componentDidMount.call(this),this.props.dataSourceLoading&&this._showLoadingMessage()},t.prototype.componentDidUpdate=function(t,o,r){var n;null===(n=e.prototype.componentDidUpdate)||void 0===n||n.call(this,t,o,r),t.dataSourceLoading!==this.props.dataSourceLoading&&(this.props.dataSourceLoading?this._showLoadingMessage():!1===this.props.dataSourceLoading?this._showLoadedMessage():(this.setState({loadStatusMessage:""}),this._loadingMessageShown=!1))},t.prototype.componentWillUnmount=function(){e.prototype.componentWillUnmount.call(this),this._stopPendingMessages()},t.prototype._stopPendingMessages=function(){window.clearTimeout(this._clearLoadingMessageTimeoutId),window.clearTimeout(this._setLoadingMessageTimeoutId)},t.prototype._showLoadedMessage=function(){var e=this;this._stopPendingMessages(),this._loadingMessageShown&&(this._loadingMessageShown=!1,this.setState({loadStatusMessage:this.props.strings.loaded}),this._clearLoadingMessageTimeoutId=window.setTimeout((function(){e._clearLoadingMessageTimeoutId=-1,e.setState({loadStatusMessage:""})}),t._CLEAR_MESSAGE_DELAY))},t.prototype._showLoadingMessage=function(){var e=this;this._stopPendingMessages(),this._setLoadingMessageTimeoutId=window.setTimeout((function(){e._loadingMessageShown=!0,e._setLoadingMessageTimeoutId=-1,e.setState({loadStatusMessage:e.props.strings.loading})}),t._LOADING_MESSAGE_DELAY)},t.prototype._shouldUpdateScrollOffset=function(e,t){return this.props.shouldUpdateScrollOffset(e)},t._styleCache={},t._LOADING_MESSAGE_DELAY=2e3,t._CLEAR_MESSAGE_DELAY=5e3,t}(e.Controls.Container.ContainerViewBase);t.FormView=r}(t.Form||(t.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"_formClassName",{get:function(){return"powerapps-form-viewer"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_noItemPlaceholderClassName",{get:function(){return"form-viewer-no-item-placeholder"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_noItemPlaceholderTextClassName",{get:function(){return"form-viewer-no-item-placeholder-text"},enumerable:!1,configurable:!0}),t}(e.FormView);e.FormDisplayView=t}(e.Form||(e.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"_formClassName",{get:function(){return"powerapps-form"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_noItemPlaceholderClassName",{get:function(){return"form-no-item-placeholder"},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_noItemPlaceholderTextClassName",{get:function(){return"form-no-item-placeholder-text"},enumerable:!1,configurable:!0}),t}(e.FormView);e.FormEditView=t}(e.Form||(e.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(o){var r=function(r){function n(t){var o=r.call(this,t)||this,i=t.controlInstance.control.OpenAjax.uniqueId;return o._scenarioGuid=Core.Telemetry.Log.startScenario(Core.Telemetry.ScenarioName.FormContainerRenderTime,{controlUniqueId:i}),o._shouldUpdateInitialScrollOffset=!0,o._isAuthoringComputed=ko.pureComputed(n._isAuthoringMode),o._isAuthoringComputedSubscription=o._isAuthoringComputed.subscribe((function(e){return o._isAuthoringComputedValue=e})),o._isAuthoringComputedValue=o._isAuthoringComputed(),o._shouldUpdateScrollOffset=o._shouldUpdateScrollOffset.bind(o),o._handleScroll=o._handleScroll.bind(o),n._strings||(n._strings={loaded:e.Strings.FormLoadedMessage,loading:e.Strings.FormGettingYourDataMessage}),o}return __extends(n,r),n._isAuthoringMode=function(){var e=OpenAjax.widget.controlManager;return e.appModeObservable()===t.AppMode.Editable&&!e.authoringInteractionModeObservable()},n.prototype.componentDidMount=function(){r.prototype.componentDidMount.call(this),this._recordRenderTime(),this._shouldUpdateInitialScrollOffset=!1},n.prototype.componentWillUnmount=function(){this._isAuthoringComputedSubscription&&(this._isAuthoringComputedSubscription.dispose(),this._isAuthoringComputedSubscription=null),this._isAuthoringComputed&&(this._isAuthoringComputed.dispose(),this._isAuthoringComputed=null),r.prototype.componentWillUnmount.call(this)},n.prototype.renderCore=function(){var r=this.props,i=r.getControl,a=r.controlInstance,l=r.controlContext,s=r.textDirection,u=a.control,d=u.dataSourceLoadingForEndUser,p=u.hideChildren,c=u.noItemToDisplayText,h=this._isAuthoringComputed()?-1*l._scrollY:l._scrollTopOffset();l._requestRenderObservable();var g=l.controlWidget.replicatedContextManager.authoringAreaBindingContext,f=l.controlWidget.template.name,C=e.Utility.isDataFormEditTemplate(f)?o.FormEditView:o.FormDisplayView;return React.createElement(t.ContainerControlAccessibilityWrapper,{controlContext:l,isFocusable:!0},React.createElement(C,{controlContext:l,dataSourceLoading:d,getControl:i,controlInstance:a,bindingContext:g,textDirection:s,hideChildren:p,noItemToDisplayText:c,scrollTopOffset:h,onScroll:this._handleScroll,shouldUpdateScrollOffset:this._shouldUpdateScrollOffset,strings:n._strings}))},n.prototype._shouldUpdateScrollOffset=function(e){return 0===e||this._shouldUpdateInitialScrollOffset||this._isAuthoringComputedValue},n.prototype._handleScroll=function(e){var o=this.props.controlContext,r=o.controlWidget;r.controlManager.appModeObservable.peek()!==t.AppMode.Publish&&r.updateScrollY(e),o._scrollTopOffset(e)},n.prototype._recordRenderTime=function(){if(Core.Utility.isGuid(this._scenarioGuid)){var e=this.props.controlInstance;e.control.OpenAjax.controlManager.controlInstancesFlatTree;Core.Telemetry.Log.endScenario(this._scenarioGuid,{customScenarioData:{fieldCount:e.childIds.length,variantName:e.control.OpenAjax.variantName}})}},n}(t.ObservableComponent);o.FormContainer=r}(t.Form||(t.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(o){var r=e.Data.FormMode,n=e.AuthoringTool.OpenAjaxPropertyNames,i=function(i){function a(){var e=i.call(this)||this;return e.getAuthoringCanvasPlaceHolder=e.getAuthoringCanvasPlaceHolder.bind(e),e}return __extends(a,i),a.isConnectedTableOrRecord=function(t){if(!t)return!1;var o=e.Data.DataSourceValue.getAppDataSource(t);return!!o&&e.Data.TabularDataUtilities.isConnectedDataSource(o)},a.isCdsTableOrRecord=function(t){if(!t)return!1;if(t instanceof e.Data.QueriedTable||t instanceof e.Functions.ExpandQueriedTable)return e.Data.TabularDataUtilities.isCdsDataSource(t.dataSource);var o=e.Data.DataSourceValue.getAppDataSource(t);return!!o&&e.Data.TabularDataUtilities.isCdsDataSource(o)},a.hasValidDataSource=function(t){var o=!1;if(t){var r=t.modelProperties.DataSource.getValue();r&&!(o=a.isConnectedTableOrRecord(r)||a.isCdsTableOrRecord(r))&&Core.FeatureGates.authoring.supportCollectionInViewForm&&e.Utility.isDataFormViewTemplate(t.controlWidget.template.name)&&(o=!0)}return o},Object.defineProperty(a.prototype,"dataSourceLoadingForEndUser",{get:function(){return this._dataSourceLoadingForEndUser()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"hideChildren",{get:function(){return this._hideChildren()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"noItemToDisplayText",{get:function(){return this._noItemToDisplayText()},enumerable:!1,configurable:!0}),Object.defineProperty(a.prototype,"dataSource",{get:function(){return this._getDataSource(this._globalControlContext)},enumerable:!1,configurable:!0}),a.prototype._getDataSource=function(e){return e.controlWidget.getPropertyValue(n.DataSource,null)},Object.defineProperty(a.prototype,"isValid",{get:function(){return this._getIsValid(this._globalControlContext)},enumerable:!1,configurable:!0}),a.prototype._getIsValid=function(e){return e.controlWidget.getPropertyValue(n.Valid,null)},Object.defineProperty(a.prototype,"errorKind",{get:function(){return this._getErrorKind(this._globalControlContext)},enumerable:!1,configurable:!0}),a.prototype._getErrorKind=function(e){var t=e.controlWidget;return t.hasProperty(n.ErrorKind)?t.getPropertyValue(n.ErrorKind,null):null},Object.defineProperty(a.prototype,"rendersAddCardPlaceholder",{get:function(){return!1},enumerable:!1,configurable:!0}),a.prototype.skipChildConstraints=function(){return!0},a.prototype.onLoad=function(){this.OpenAjax.initReplicatedContextManager((function(){}),this._outputRowChanged.bind(this))},a.prototype.onUnload=function(){this.OpenAjax.disposeReplicatedContextManager()},Object.defineProperty(a.prototype,"_globalControlContext",{get:function(){return this.OpenAjax.globalControlContext},enumerable:!1,configurable:!0}),a.prototype.initControlContext=function(o){var n=this;if(i.prototype.initControlContext.call(this,o),o._childContexts=[],o.controlWidget.setSkipCompare("DataSource",!0),o._replicatedContext=o.controlWidget.replicatedContextManager.replicatedContextFor(o.bindingContext),this._validateDataSource(o,o.modelProperties.DataSource.getValue()),this._applyInputTable(o),o.modelProperties.ErrorKind&&o.modelProperties.ErrorKind.setValue(e.Data.ErrorKind.None),o.modelProperties.Mode){var a=o.modelProperties.DefaultMode.getValue()||r.Edit;o.modelProperties.Mode.setValue(a)}var l=Core.Environment.isAuthoringTool();this._hideChildren||(this._hideChildren=ko.pureComputed((function(){if(!o.initialized)return!0;var e=l&&n.OpenAjax.controlManager.appModeObservable()===t.AppMode.Preview,i=o.properties.DataSource(),a=o.properties.Item(),s=o.properties.Mode,u=s?s():null;return!(l&&!e)&&(!Core.Utility.isValue(i)||!Core.Utility.isValue(a)&&u!==r.New)}))),this._noItemToDisplayText||(this._noItemToDisplayText=ko.pureComputed((function(){return n._hideChildren()?o.initialized&&Core.Utility.isValue(o.properties.DataSource())?l?e.Strings.FormNoItemMessage:e.Strings.FormGettingYourDataMessage:e.Strings.FormNoDataSourceMessage:""}))),this._dataSourceLoadingForEndUser||(this._dataSourceLoadingForEndUser=ko.pureComputed((function(){return o.initialized&&Core.Utility.isValue(o.properties.DataSource())?l?null:n._hideChildren():null})))},a.prototype.disposeControlContext=function(e){e._replicatedContext.clearInputTable(),e._replicatedContext=null,i.prototype.disposeControlContext.call(this,e)},a.prototype.onChildContextAdded=function(e,t){i.prototype.onChildContextAdded.call(this,e,t),t.isTemplate&&e._childContexts.push(t),this._updatePlaceHolderIfNeeded()},a.prototype.onChildContextRemoved=function(e,t){i.prototype.onChildContextRemoved.call(this,e,t);var o=e._childContexts.indexOf(t);-1!==o&&e._childContexts.splice(o,1),this._updatePlaceHolderIfNeeded()},a.prototype.childControlsCanExpandForPrint=function(){return!0},a.prototype.onChangeError=function(t,o){if(!e.Data.ErrorValue.isErrorHandlingFeatureEnabled()){var r=t.newValue;r?Core.UI.Toast.ToastHandler.suspendOnClickToast({type:Core.UI.Toast.ToastType.error,message:r}):Core.UI.Toast.ToastHandler.clearAllToasts()}},a.prototype.onChangeDataSource=function(t,o){var n=t.oldValue,i=t.newValue;if(i!==n&&this._validateDataSource(o,i),this._getModePropertyValue(o)===r.New){var a=void 0;if(n&&i){var l=e.Data.DataSourceValue.getAppDataSource(n),s=e.Data.DataSourceValue.getAppDataSource(i);a=l&&s?l!==s:n!==i}else a=!!n||!!i;a&&this._applyInputTable(o)}},a.prototype.onChangeItem=function(t,o){this._getModePropertyValue(o)===r.New||e.Utility.deepCompare(t.oldValue,t.newValue)||(this._resetScrollOffset(o),this._applyInputTable(o))},a.prototype.onChangeMode=function(t,o){this._resetScrollOffset(o);var n=o.modelProperties.Mode.getValue();n===r.Edit||n===r.New?o.modelProperties.DisplayMode.setValue(e.Constants.DisplayMode.Edit):o.modelProperties.DisplayMode.setValue(e.Constants.DisplayMode.View),this._applyInputTable(o)},a.prototype.onChangeDefaultMode=function(e,t){t.modelProperties.Mode.setValue(e.newValue||r.Edit)},a.prototype.onChangeNumberOfColumns=function(e,t){t.modelProperties.SnapToColumns.getValue()&&t.controlWidget.controlManager.executeShellAction({id:"ResetFormLayout",entityName:t.controlWidget.getId(),numberOfColumns:e.newValue})},a.prototype.onChangeSnapToColumns=function(e,t){e.newValue&&t.controlWidget.controlManager.executeShellAction({id:"ResetFormLayout",entityName:t.controlWidget.getId(),numberOfColumns:t.modelProperties.NumberOfColumns.getValue()})},a.prototype.onBeforeGetCurrent=function(t,o){if(o.initialized){var r=o._replicatedContext.getOutputTable(),n=1===r.length?r[0]:e.Data.DataRecord.create();o.modelProperties.Current.setValue(n,!0)}},a.prototype.onBeforeGetUpdates=function(t,o){if(o.initialized)if(0!==o._childContexts.length){for(var r=e.Data.DataRecord.create(),n=0,i=o._childContexts;n<i.length;n++){var a=i[n].modelProperties;if(Core.Utility.isDefined(a.Update)&&Core.Utility.isDefined(a.DataField)){var l=a.DataField.getValue();if(!Core.Utility.isNonEmptyNonWhitespaceString(l))continue;r[l]=a.Update.getValue()}}o.modelProperties.Updates.setValue(r,!0)}else o.modelProperties.Updates.setValue(null,!0)},a.prototype.onBeforeGetValid=function(e,t){if(t.initialized)if(t._hasChildren()){for(var o=0,r=t._children;o<r.length;o++){if(!r[o].controlContext.modelProperties.Valid.getValue())return void t.modelProperties.Valid.setValue(!1,!0)}t.modelProperties.Valid.setValue(!0,!0)}else t.modelProperties.Valid.setValue(!0,!0)},a.prototype.onSubmitSuccess=function(e){this._onSubmitSuccess(this._globalControlContext,e)},a.prototype._onSubmitSuccess=function(e,t){this._setErrorAndErrorKind(e,null),e.controlWidget.setPropertyValue(n.LastSubmit,t),e.controlWidget.setPropertyValue(n.Mode,r.Edit),e.behaviors.OnSuccess()},a.prototype.onSubmitFailure=function(e){this._onSubmitFailure(this._globalControlContext,e)},a.prototype._onSubmitFailure=function(e,t){this._setErrorAndErrorKind(e,t[0]),e.controlWidget.setPropertyValue(n.LastSubmit,null),e.behaviors.OnFailure()},a.prototype.onValidationFailure=function(e){this._onValidationFailure(this._globalControlContext,e)},a.prototype._onValidationFailure=function(t,o){this._setErrorAndErrorKind(t,{Message:o,Error:e.Data.ErrorKind.Validation});for(var r=0,n=t._children;r<n.length;r++){var i=n[r];i.control.onValidationFailure(i.controlContext)}t.behaviors.OnFailure()},a.prototype.getUpdates=function(){return this._getUpdates(this._globalControlContext)},a.prototype._getUpdates=function(e){return e.controlWidget.getPropertyValue("Updates",null)},a.prototype.getThisItem=function(){return this._getThisItem(this._globalControlContext)},a.prototype._getThisItem=function(e){return e.controlWidget.getPropertyValue(n.Mode,null)===r.New?this._getNewItem(e):this._getItem(e)},a.prototype.getModePropertyValue=function(){return this._getModePropertyValue(this._globalControlContext)},a.prototype._getModePropertyValue=function(e){var t=e.modelProperties.Mode;return t?t.getValue():null},a.prototype.reset=function(){return this._reset(this._globalControlContext)},a.prototype._reset=function(e){this._resetScrollOffset(this._globalControlContext),this._setErrorAndErrorKind(e,null),e.controlWidget.setPropertyValue(n.LastSubmit,null);var t=e.modelProperties.DefaultMode.getValue(),o=r.Edit;return t!==r.New&&t!==r.View||(o=t),e.controlWidget.setPropertyValue(n.Mode,o),this._resetChildControls(e),e.behaviors.OnReset(),!0},a.prototype.editForm=function(){return this._editForm(this._globalControlContext)},a.prototype._editForm=function(e){var t=e.controlWidget;return t.setPropertyValue(n.LastSubmit,null),t.setPropertyValue(n.Mode,r.Edit),!0},a.prototype.viewForm=function(){return this._viewForm(this._globalControlContext)},a.prototype._viewForm=function(e){return e.controlWidget.setPropertyValue(n.Mode,r.View),!0},a.prototype.newFormAsync=function(){return this._newFormAsync(this._globalControlContext)},a.prototype._newFormAsync=function(e){var t=e.controlWidget;return t.setPropertyValue(n.LastSubmit,null),t.setPropertyValue(n.Mode,r.New),Promise.resolve(!0)},a.prototype.getAuthoringCanvasPlaceHolder=function(){var t=this.OpenAjax.getAuthoringControlContext();return a.hasValidDataSource(t)?e.Controls.doesControlHaveVisualChildren(this.OpenAjax)?null:o.FormPlaceHolder.createPlaceHolder(this.OpenAjax.uniqueId,1):o.FormPlaceHolder.createPlaceHolder(this.OpenAjax.uniqueId,0)},Object.defineProperty(a.prototype,"isAllowedInComponent",{get:function(){return!1},enumerable:!1,configurable:!0}),a.prototype._validateDataSource=function(e,t){t&&!a.hasValidDataSource(e)&&this._logOperationError("FormControlCore.validateDataSource","DataSource Value is not null and is not associated with a valid data source object")},a.prototype._logOperationError=function(e,t){Core.Telemetry.Log.trackEvent(e,{message:t})},a.prototype._getItem=function(e){return e.controlWidget.getPropertyValue(n.Item,null)},a.prototype._getNewItem=function(t){return e.Functions.defaults(this._getDataSource(t))},a.prototype._resetChildControls=function(e){if(e._hasChildren())for(var t=0,o=e._children;t<o.length;t++){var r=o[t];r.control.reset(r.controlContext)}},a.prototype._applyInputTable=function(e){var t=this._getModePropertyValue(e),o=null;isNaN(t)||Core.Utility.isNullOrUndefined(t)||t===r.Edit||t===r.View?o=e.modelProperties.Item.getValue():t===r.New&&(o=this._getNewItem(e)),this._resetChildControls(e),e._replicatedContext.applyInputTable(o?[o]:[]),e._layoutInvalidated(!0)},a.prototype._updateUnsaved=function(e){if(!Core.Utility.isUndefined(e.modelProperties.Unsaved))if(e._hasChildren()){for(var t=0,o=e._children;t<o.length;t++){var r=o[t];if(r.control.isUnsaved(r.controlContext))return void e.modelProperties.Unsaved.setValue(!0)}e.modelProperties.Unsaved.setValue(!1)}else e.modelProperties.Unsaved.setValue(!1)},a.prototype._outputRowChanged=function(e){var t=e.bindingContext,o=e.controlWidget;o.notifyOutputPropertyValueChanged("Valid",t),o.notifyOutputPropertyValueChanged("Updates",t),o.notifyOutputPropertyValueChanged("Current",t),this._updateUnsaved(e)},a.prototype._setErrorAndErrorKind=function(t,o){var r,i=t.controlWidget;if(null===o)return i.setPropertyValue(n.Error,o,null),void i.setPropertyValue(n.ErrorKind,e.Data.ErrorKind.None,null);r=Core.Utility.isNonEmptyString(o.ServerMessage)?Core.Utility.formatString(e.Strings.ErrorWithServerMessage,o.Message,o.ServerMessage):o.Message,i.setPropertyValue(n.Error,r,null),i.setPropertyValue(n.ErrorKind,o.Error,null)},a.prototype._updatePlaceHolderIfNeeded=function(){this.OpenAjax.controlManager.appModeObservable()!==t.AppMode.Publish&&this.OpenAjax.controlManager.executeShellAction({id:"UpdateAuthoringCanvasPlaceholder"})},a}(e.Controls.FluidGrid.FluidGridControl);o.FormControl=i,e.Controls.RegisterReactConvertedControl("AppMagic.Controls.Form.FormControl",e.Controls.Form.FormControl,e.Controls.Form.FormContainer,(function(){return!0}))}(t.Form||(t.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o=e.Controls.DataControlsDefaultPlaceHolder,r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getContainerStyles=function(){var e=o.getContainerStyles();return e.backgroundColor="rgba(255, 255, 255, 0.7)",e},t.getInnerContainerStyles=function(){var e=o.getInnerContainerStyles();return e.fontSize="23",e},t}(o);t.FormConnectToDataPlaceHolder=r;var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.getIconStyles=function(){return{flex:"0 0 auto",width:"56px",height:"56px"}},t}(o);t.FormAddFieldsPlaceHolder=n,function(e){e[e.NoDataSource=0]="NoDataSource",e[e.NoFields=1]="NoFields"}(t.FormPlaceHolderType||(t.FormPlaceHolderType={}));var i=function(t){function o(e){var o=t.call(this,e)||this;return o._handleSubTitleClick=o._handleSubTitleClick.bind(o),o}return __extends(o,t),o.createPlaceHolder=function(e,t){return React.createElement(o,{formId:e,type:t})},o.prototype.render=function(){return 0===this.props.type?React.createElement(r,{title:e.ControlStrings.FormNotConnected,subTitle:e.ControlStrings.FormConnectToData,src:Core.Utility.getAbsoluteUri("images/form-nodata-background.svg"),onSubtitleClick:this._handleSubTitleClick}):React.createElement(n,{title:e.ControlStrings.FormHasNoFields,subTitle:e.ControlStrings.FormAddFields,src:Core.Utility.getAbsoluteUri("images/form-nofields-background.svg"),onSubtitleClick:this._handleSubTitleClick})},o.prototype._handleSubTitleClick=function(){var e=OpenAjax.widget.controlManager,t=e.getControlInstance(this.props.formId);0===this.props.type?e.executeShellAction({id:"ShowFormDataSourcePane",controlName:t.name}):e.executeShellAction({id:"OpenPowerAppsFormCustomizationPane",controlName:t.name})},o}(React.Component);t.FormPlaceHolder=i}(t.Form||(t.Form={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={}));
//# sourceMappingURL=Form.js.map