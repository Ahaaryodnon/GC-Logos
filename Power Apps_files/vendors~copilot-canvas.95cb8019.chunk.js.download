/*! For license information please see vendors~copilot-canvas.95cb8019.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[116],{14619:function(e,t,s){"use strict";function o(e){if(this._capacity=i(e),this._length=0,this._front=0,n(e)){for(var t=e.length,s=0;s<t;++s)this[s]=e[s];this._length=t}}o.prototype.toArray=function(){for(var e=this._length,t=new Array(e),s=this._front,o=this._capacity,n=0;n<e;++n)t[n]=this[s+n&o-1];return t},o.prototype.push=function(e){var t=arguments.length,s=this._length;if(t>1){var o=this._capacity;if(s+t>o){for(var n=0;n<t;++n){this._checkCapacity(s+1),this[i=this._front+s&this._capacity-1]=arguments[n],s++,this._length=s}return s}for(var i=this._front,n=0;n<t;++n)this[i+s&o-1]=arguments[n],i++;return this._length=s+t,s+t}return 0===t?s:(this._checkCapacity(s+1),this[n=this._front+s&this._capacity-1]=e,this._length=s+1,s+1)},o.prototype.pop=function(){var e=this._length;if(0!==e){var t=this._front+e-1&this._capacity-1,s=this[t];return this[t]=void 0,this._length=e-1,s}},o.prototype.shift=function(){var e=this._length;if(0!==e){var t=this._front,s=this[t];return this[t]=void 0,this._front=t+1&this._capacity-1,this._length=e-1,s}},o.prototype.unshift=function(e){var t=this._length,s=arguments.length;if(s>1){if(t+s>(n=this._capacity)){for(var o=s-1;o>=0;o--){this._checkCapacity(t+1);var n=this._capacity;this[r=(this._front-1&n-1^n)-n]=arguments[o],t++,this._length=t,this._front=r}return t}var i=this._front;for(o=s-1;o>=0;o--){var r;this[r=(i-1&n-1^n)-n]=arguments[o],i=r}return this._front=i,this._length=t+s,t+s}if(0===s)return t;this._checkCapacity(t+1);n=this._capacity;return this[o=(this._front-1&n-1^n)-n]=e,this._length=t+1,this._front=o,t+1},o.prototype.peekBack=function(){var e=this._length;if(0!==e)return this[this._front+e-1&this._capacity-1]},o.prototype.peekFront=function(){if(0!==this._length)return this[this._front]},o.prototype.get=function(e){var t=e;if(t===(0|t)){var s=this._length;if(t<0&&(t+=s),!(t<0||t>=s))return this[this._front+t&this._capacity-1]}},o.prototype.isEmpty=function(){return 0===this._length},o.prototype.clear=function(){for(var e=this._length,t=this._front,s=this._capacity,o=0;o<e;++o)this[t+o&s-1]=void 0;this._length=0,this._front=0},o.prototype.toString=function(){return this.toArray().toString()},o.prototype.valueOf=o.prototype.toString,o.prototype.removeFront=o.prototype.shift,o.prototype.removeBack=o.prototype.pop,o.prototype.insertFront=o.prototype.unshift,o.prototype.insertBack=o.prototype.push,o.prototype.enqueue=o.prototype.push,o.prototype.dequeue=o.prototype.shift,o.prototype.toJSON=o.prototype.toArray,Object.defineProperty(o.prototype,"length",{get:function(){return this._length},set:function(){throw new RangeError("")}}),o.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(i(1.5*this._capacity+16))},o.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e;var s=this._front,o=this._length;s+o>t&&function(e,t,s,o,n){for(var i=0;i<n;++i)s[i+o]=e[i+t],e[i+t]=void 0}(this,0,this,t,s+o&t-1)};var n=Array.isArray;function i(e){if("number"!=typeof e){if(!n(e))return 16;e=e.length}return t=Math.min(Math.max(16,e),1073741824),t>>>=0,t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16);var t}e.exports=o},18321:function(e,t,s){"use strict";e.exports=s(18322)},18322:function(e,t,s){"use strict";var o,n,i,r,a;if(Object.defineProperty(t,"__esModule",{value:!0}),"undefined"==typeof window||"function"!=typeof MessageChannel){var c=null,l=null,u=function(){if(null!==c)try{var e=t.unstable_now();c(!0,e),c=null}catch(s){throw setTimeout(u,0),s}},d=Date.now();t.unstable_now=function(){return Date.now()-d},o=function(e){null!==c?setTimeout(o,0,e):(c=e,setTimeout(u,0))},n=function(e,t){l=setTimeout(e,t)},i=function(){clearTimeout(l)},r=function(){return!1},a=t.unstable_forceFrameRate=function(){}}else{var h=window.performance,p=window.Date,g=window.setTimeout,f=window.clearTimeout,m=window.requestAnimationFrame,y=window.cancelAnimationFrame;if("undefined"!=typeof console&&("function"!=typeof m&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!=typeof y&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")),"object"==typeof h&&"function"==typeof h.now)t.unstable_now=function(){return h.now()};else{var b=p.now();t.unstable_now=function(){return p.now()-b}}var T=!1,w=null,v=-1,k=5,S=0;r=function(){return t.unstable_now()>=S},a=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):k=0<e?Math.floor(1e3/e):33.33};var C=new MessageChannel,_=C.port2;C.port1.onmessage=function(){if(null!==w){var e=t.unstable_now();S=e+k;try{w(!0,e)?_.postMessage(null):(T=!1,w=null)}catch(s){throw _.postMessage(null),s}}else T=!1},o=function(e){w=e,T||(T=!0,_.postMessage(null))},n=function(e,s){v=g((function(){e(t.unstable_now())}),s)},i=function(){f(v),v=-1}}function I(e,t){var s=e.length;e.push(t);e:for(;;){var o=Math.floor((s-1)/2),n=e[o];if(!(void 0!==n&&0<x(n,t)))break e;e[o]=t,e[s]=n,s=o}}function A(e){return void 0===(e=e[0])?null:e}function M(e){var t=e[0];if(void 0!==t){var s=e.pop();if(s!==t){e[0]=s;e:for(var o=0,n=e.length;o<n;){var i=2*(o+1)-1,r=e[i],a=i+1,c=e[a];if(void 0!==r&&0>x(r,s))void 0!==c&&0>x(c,r)?(e[o]=c,e[a]=s,o=a):(e[o]=r,e[i]=s,o=i);else{if(!(void 0!==c&&0>x(c,s)))break e;e[o]=c,e[a]=s,o=a}}}return t}return null}function x(e,t){var s=e.sortIndex-t.sortIndex;return 0!==s?s:e.id-t.id}var E=[],D=[],N=1,B=null,P=3,O=!1,R=!1,W=!1;function L(e){for(var t=A(D);null!==t;){if(null===t.callback)M(D);else{if(!(t.startTime<=e))break;M(D),t.sortIndex=t.expirationTime,I(E,t)}t=A(D)}}function F(e){if(W=!1,L(e),!R)if(null!==A(E))R=!0,o(q);else{var t=A(D);null!==t&&n(F,t.startTime-e)}}function q(e,s){R=!1,W&&(W=!1,i()),O=!0;var o=P;try{for(L(s),B=A(E);null!==B&&(!(B.expirationTime>s)||e&&!r());){var a=B.callback;if(null!==a){B.callback=null,P=B.priorityLevel;var c=a(B.expirationTime<=s);s=t.unstable_now(),"function"==typeof c?B.callback=c:B===A(E)&&M(E),L(s)}else M(E);B=A(E)}if(null!==B)var l=!0;else{var u=A(D);null!==u&&n(F,u.startTime-s),l=!1}return l}finally{B=null,P=o,O=!1}}function U(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var j=a;t.unstable_ImmediatePriority=1,t.unstable_UserBlockingPriority=2,t.unstable_NormalPriority=3,t.unstable_IdlePriority=5,t.unstable_LowPriority=4,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var s=P;P=e;try{return t()}finally{P=s}},t.unstable_next=function(e){switch(P){case 1:case 2:case 3:var t=3;break;default:t=P}var s=P;P=t;try{return e()}finally{P=s}},t.unstable_scheduleCallback=function(e,s,r){var a=t.unstable_now();if("object"==typeof r&&null!==r){var c=r.delay;c="number"==typeof c&&0<c?a+c:a,r="number"==typeof r.timeout?r.timeout:U(e)}else r=U(e),c=a;return e={id:N++,callback:s,priorityLevel:e,startTime:c,expirationTime:r=c+r,sortIndex:-1},c>a?(e.sortIndex=c,I(D,e),null===A(E)&&e===A(D)&&(W?i():W=!0,n(F,c-a))):(e.sortIndex=r,I(E,e),R||O||(R=!0,o(q))),e},t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_wrapCallback=function(e){var t=P;return function(){var s=P;P=t;try{return e.apply(this,arguments)}finally{P=s}}},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_shouldYield=function(){var e=t.unstable_now();L(e);var s=A(E);return s!==B&&null!==B&&null!==s&&null!==s.callback&&s.startTime<=e&&s.expirationTime<B.expirationTime||r()},t.unstable_requestPaint=j,t.unstable_continueExecution=function(){R||O||(R=!0,o(q))},t.unstable_pauseExecution=function(){},t.unstable_getFirstCallbackNode=function(){return A(E)},t.unstable_Profiling=null},23715:function(e,t,s){!function(e,t){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var s={error:null,info:null},o=function(e){var o,n;function i(){for(var t,o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];return(t=e.call.apply(e,[this].concat(n))||this).state=s,t.resetErrorBoundary=function(){for(var e,o=arguments.length,n=new Array(o),i=0;i<o;i++)n[i]=arguments[i];null==t.props.onReset||(e=t.props).onReset.apply(e,n),t.setState(s)},t}n=e,(o=i).prototype=Object.create(n.prototype),o.prototype.constructor=o,o.__proto__=n;var r=i.prototype;return r.componentDidCatch=function(e,t){var s,o;null==(s=(o=this.props).onError)||s.call(o,e,null==t?void 0:t.componentStack),this.setState({error:e,info:t})},r.componentDidUpdate=function(e){var t,o,n,i,r=this.state.error,a=this.props.resetKeys;null!==r&&(void 0===(n=e.resetKeys)&&(n=[]),void 0===(i=a)&&(i=[]),n.length!==i.length||n.some((function(e,t){return!Object.is(e,i[t])})))&&(null==(t=(o=this.props).onResetKeysChange)||t.call(o,e.resetKeys,a),this.setState(s))},r.render=function(){var e=this.state,s=e.error,o=e.info,n=this.props,i=n.fallbackRender,r=n.FallbackComponent,a=n.fallback;if(null!==s){var c={componentStack:null==o?void 0:o.componentStack,error:s,resetErrorBoundary:this.resetErrorBoundary};if(t.isValidElement(a))return a;if("function"==typeof i)return i(c);if("function"==typeof r)return t.createElement(r,c);throw new Error("react-error-boundary requires either a fallback, fallbackRender, or FallbackComponent prop")}return this.props.children},i}(t.Component);e.ErrorBoundary=o,e.withErrorBoundary=function(e,s){function n(n){return t.createElement(o,s,t.createElement(e,n))}var i=e.displayName||e.name||"Unknown";return n.displayName="withErrorBoundary("+i+")",n},Object.defineProperty(e,"__esModule",{value:!0})}(t,s(10926))},39454:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(39455),n=s(39574),i=s(39575);const r=new class{constructor(){this._augLoopRuntimeManager=new o.a}getAugLoopRuntimeManager(){return this._augLoopRuntimeManager}createSingleItemWorkflow(e){return n.a.create(e)}createChatHelper(e){return this.getAugLoopRuntimeManager().getSession().then(t=>i.a.create(Object.assign({session:t},e)))}}},39455:function(e,t,s){"use strict";s.d(t,"a",(function(){return y}));var o=s(39474),n=s(39558),i=s(39460),r=s(39478),a=s(39479),c=s(39461),l=s(39470),u=s(39458),d=s(39459),h=s(39456),p=s(39572),g=s(39573);const f=(e,t)=>{const s=[];for(const n of Object.keys(e)){if(void 0===e[n]||null===e[n])continue;const i={name:t?`${t}.${n}`:n,dataType:(o=e[n],"string"==typeof o?0:"boolean"==typeof o?1:"number"==typeof o?2:void h.a.sendTraceTag(572838285,u.a.msoulscat_Wac_BrowserGeneral,d.a.Warning,"Unsupported data field type")),value:e[n],classification:4};s.push(i)}var o;return s},m=e=>Promise.resolve(!1);class y{constructor(){this._telemetryAggregationIntervalSec=30,this._eventHandlerDictionary={},this._bridge=null,this._bridgeInterceptor=null,this._sessionCloseReason=null,this._serverAuthenticationState=i.a.NotAuthenticated,this.initialize=e=>{if(this._runtimeInitPromise)return void h.a.sendTraceTag(572838286,u.a.msoulscat_Wac_BrowserGeneral,d.a.Info,"Runtime already initialized");h.a.sendTraceTag(572838287,u.a.msoulscat_Wac_BrowserGeneral,d.a.Info,"Start and initialize augloop runtime ..."),this.checkParametersAndThrow("initialize",e);const t=this.isFeatureEnabled("ModelDownloaderEbrake","None").then(t=>{t?h.a.sendTraceTag(556376070,u.a.msoulscat_Wac_BrowserGeneral,d.a.Info,"Resource downloader not created due to feature gate"):this.modelDownloaderFromCDN=e.appName&&e.downloadBaseUrl||e.downloadPolymerBaseUrl?new c.a(e.appName,e.downloadBaseUrl,e.downloadPolymerBaseUrl):void 0});this.inferenceServiceFactory=e.appName&&e.inferenceServiceVersion?l.a.createFactory(e.appName,e.inferenceServiceVersion):void 0,this.excelServerParameters=e.excelServer,this.powerpointParameters=e.powerpoint;const s={appName:e.appName,appPlatform:"Web",appVersion:e.appVersion,uiLanguage:e.uiLanguage,releaseAudienceGroup:e.releaseAudienceGroup,releaseChannel:e.releaseChannel,releaseCustomAudience:e.releaseCustomAudience,releaseFork:e.releaseFork,sessionId:e.sessionId,flights:e.flights,privateMode:e.privateMode,disabledServiceGroups:e.disabledServiceGroups},i={onResult:this.onResult.bind(this),onAnnotationResult:this.onAnnotationResult.bind(this),sendTelemetryEvent:this.sendTelemetryEvent.bind(this),sendDiagnosticTrace:this.sendDiagnosticTrace.bind(this),requestAuthToken:this.requestAuthToken.bind(this),isFeatureEnabled:this.isFeatureEnabled.bind(this),isChangeGateEnabled:this.isChangeGateEnabled.bind(this),setSessionData:this.setSessionData.bind(this),areLicenseFeaturesEnabled:m,onInitSession:this.onInitSession.bind(this),overrideSessionInitMessage:this.overrideSessionInitMessage.bind(this)},a=t.then(()=>o.b.init(e.serviceUrl,s,i,{telemetryAggregationIntervalSec:this._telemetryAggregationIntervalSec,modelDownloader:this.modelDownloaderFromCDN,inferenceServiceFactory:this.inferenceServiceFactory,isDeltaGeneratorEnabled:e.isDeltaGeneratorEnabled,disableSyncDeltaSending:e.disableSyncDeltaSending,syncDeltaTimeout:e.syncDeltaTimeout})).then(()=>n.a.init(e.serviceUrl,s,i));let p=e.sessionCreationOptions;p||(p={});const g=p.onServerAuthenticationStateChangeCallback;p.onServerAuthenticationStateChangeCallback=e=>{this._serverAuthenticationState=e,g&&g(e),this._bridge&&this.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new r.o({serverAuthenticationState:e})})};const f=p.onSessionClose;p.onSessionClose=e=>{this._sessionCloseReason=e.reason,f&&f(e),this._bridge&&this.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:e})};const y=p.onSessionConnect;p.onSessionConnect=(e,t,s,o)=>{y&&y(e,t,s,o),this._bridge&&this.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new r.r({isSeedingRequired:e,sessionUrl:t,origin:s,authToken:o})})};const b=p.onSessionReconnect;p.onSessionReconnect=()=>{b&&b(),this._bridge&&this.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new r.x})};const T=p.onSessionDisconnect;p.onSessionDisconnect=e=>{T&&T(e),this._bridge&&this.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new r.s({error:e})})},this.createSession=()=>{this._runtimeInitPromise=a.then(()=>{const t=p&&p.docSessionId||e.sessionId;return o.b.createSession(Object.assign(Object.assign({},p),{docSessionId:t}))})},this.createSession()},this.getSession=()=>this._runtimeInitPromise,this.setULSLogger=e=>{this.checkParametersAndThrow("setULSLogger",e&&e.ulsLogger),h.a.setLogger(e.ulsLogger)},this.setSendOTelEventCallback=e=>{this.checkParametersAndPropertyAndThrow("setSendOTelEventCallback",e&&e.sendOTelEvent,this._sendOTelEventCallback),this._sendOTelEventCallback=e.sendOTelEvent},this.setSendDiagnosticTraceCallback=e=>{this.checkParametersAndPropertyAndThrow("setSendDiagnosticTraceCallback",e&&e.sendDiagnosticTraceCallback,this._sendDiagnosticTraceCallback),this._sendDiagnosticTraceCallback=e.sendDiagnosticTraceCallback},this.setRequestAuthTokenCallback=e=>{this.checkParametersAndPropertyAndThrow("setRequestAuthTokenCallback",e&&e.requestAuthTokenCallback,this._requestAuthTokenCallback),this._requestAuthTokenCallback=e.requestAuthTokenCallback},this.setIsFeatureEnabledCallback=e=>{this.checkParametersAndPropertyAndThrow("setIsFeatureEnabledCallback",e&&e.featureEnabledCallback,this._featureEnabledCallback),this._featureEnabledCallback=e.featureEnabledCallback},this.setIsChangeGateEnabledCallback=e=>{this.checkParametersAndPropertyAndThrow("setIsChangeGateEnabledCallback",e&&e.changeGateEnabledCallback,this._changeGateEnabledCallback),this._changeGateEnabledCallback=e.changeGateEnabledCallback},this.registerLocalWorkflow=e=>{this.checkParametersAndThrow("registerLocalWorkflow",e&&e.workflow),this.checkRuntimeInitAndThrow("registerLocalWorkflow"),this._runtimeInitPromise.then(t=>{t.registerLocalWorkflow(e.workflow)})},this.activateAnnotation=e=>{const t=this.checkParameters("activateAnnotation",e&&e.annotationType)||this.checkRuntimeInit("activateAnnotation");return t?Promise.reject(t):this._runtimeInitPromise.then(t=>{let s;return(e.config||e.handler||e.stateUpdateHandler)&&(s={config:e.config,callback:e.handler,stateUpdateCallback:e.stateUpdateHandler,forceReturnCachedAnnotations:e.forceReturnCachedAnnotations}),t.activateAnnotation(e.annotationType,s)})},this.updateAnnotationConfig=e=>{const t=this.checkParameters("updateAnnotationConfig",e&&e.token&&e.config)||this.checkRuntimeInit("updateAnnotationConfig");return t?Promise.reject(t):this._runtimeInitPromise.then(t=>{t.updateAnnotationConfig(e.token,e.config)})},this.releaseAnnotation=e=>{const t=this.checkParameters("releaseAnnotation",e&&e.token)||this.checkRuntimeInit("releaseAnnotation");return t?Promise.reject(t):this._runtimeInitPromise.then(t=>t.releaseAnnotation(e.token))},this.submitOperation=e=>{this.checkParametersAndThrow("submitOperation",e&&e.operation),this.checkRuntimeInit("submitOperation"),this._runtimeInitPromise.then(t=>{t.submitOperation(e.operation)})},this.setSessionDataCallback=e=>{this.checkParametersAndPropertyAndThrow("setSessionDataCallback",e&&(e.sessionDataCallback||e.handler),this._setSessionDataCallback),e.sessionDataCallback?this._setSessionDataCallback=e.sessionDataCallback:e.handler&&(this._setSessionDataCallback=(t,s,o)=>e.handler(t,s))},this.setAnnotationResultCallback=e=>{if(this.checkParametersAndThrow("setAnnotationResultCallback",e&&e.handler),this._annotationResultCallback){const e="setAnnotationResultCallback already called";h.a.sendTraceTag(537401028,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,e)}this._annotationResultCallback=e.handler},this.setAnnotationState=e=>{this.checkParametersAndThrow("setAnnotationState",e&&e.parentPath&&e.id&&e.value),this.checkRuntimeInitAndThrow("setAnnotationState"),this._runtimeInitPromise.then(t=>{t.setAnnotationState(e.parentPath,e.id,e.value)})},this.setAnnotationMetadata=e=>{this.checkParametersAndThrow("setAnnotationMetadata",e&&e.parentPath&&e.id&&e.value),this.checkRuntimeInitAndThrow("setAnnotationMetadata"),this._runtimeInitPromise.then(t=>{t.setAnnotationMetadata(e.parentPath,e.id,e.value)})},this.setInitSessionCallback=e=>{this.checkParametersAndPropertyAndThrow("setInitSessionCallback",e&&e.initSessionCallback,this._initSessionCallback),this._initSessionCallback=e.initSessionCallback},this.setSessionInitOverrideCallback=e=>{this.checkParametersAndPropertyAndThrow("setSessionInitOverrideCallback",e&&e.handler,this._sessionInitOverrideCallback),this._sessionInitOverrideCallback=e.handler},this.setMessageBridge=e=>{this.checkParametersAndPropertyAndThrow("setMessageBridge",e&&e.bridge,this._bridge),this._bridge=e.bridge,this._bridge.registerMessageReceivedCallback(this.onBridgeMessage.bind(this))},this.setMessageBridgeToALInterceptor=e=>{this.checkParametersAndPropertyAndThrow("setMessageBridgeToALInterceptor",e&&e.bridge,this._bridgeInterceptor),this._bridgeInterceptor=e.bridge,this._bridgeInterceptor.registerMessageReceivedCallback(this.onBridgeMessageFromInterceptor.bind(this))},this.forceReconnectSession=e=>{const t=this.checkParameters("forceReconnectSession",e)||this.checkRuntimeInit("forceReconnectSession");return t?Promise.reject(t):this._runtimeInitPromise.then(t=>(e.excelServerParameters&&(this.excelServerParameters=e.excelServerParameters),t.forceReconnect()))},this.setSessionCloseCallback=e=>{const t=this.checkParameters("setSessionCloseCallback",e&&e.callback)||this.checkRuntimeInit("setSessionCloseCallback");return t?Promise.reject(t):this._runtimeInitPromise.then(t=>{t.setSessionCloseCallback(e.callback)})},this.submitCustomMessage=e=>{const t=this.checkParameters("submitCustomMessage",e&&e.message)||this.checkRuntimeInit("submitCustomMessage");return t?Promise.reject(t):this._runtimeInitPromise.then(t=>t.submitCustomMessage(e.message))},this.submitLargeBinaryDataMessage=e=>{const t="submitLargeBinaryDataMessage",s=this.checkParameters(t,e&&e.message)||this.checkRuntimeInit(t);return s?Promise.reject(s):r.m.typeGuard(e.message)?this._runtimeInitPromise.then(t=>t.submitLargeBinaryDataMessage(e.message)):Promise.reject(t+" only supports MicroSyncMessage")},this.requestBinaryDataForBlob=e=>{const t=this.checkParameters("requestBinaryDataForBlob",e&&e.blob)||this.checkRuntimeInit("requestBinaryDataForBlob");return t?Promise.reject(t):this._runtimeInitPromise.then(t=>t.requestBinaryDataForBlob(e.blob))},this.closeSession=()=>{const e=this.checkRuntimeInit("closeSession");return e?Promise.reject(e):this._runtimeInitPromise.then(e=>{e.close()})},this.startNewSession=()=>{if(!this.createSession){const e="startNewSession called before runtime init";throw h.a.sendTraceTag(537408074,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,e),new Error(e)}this.createSession(),this._sessionCloseReason=null},this.submit=e=>{this.checkParametersAndThrow("submit",e&&e.inputSchema&&e.input),this.checkRuntimeInitAndThrow("submit"),this._runtimeInitPromise.then(()=>{n.a.submit(e.inputSchema,e.input,e.correlationVector)})},this.addEventHandler=e=>{this.checkParametersAndThrow("addEventHandler",e&&e.schemaName&&e.handler);const t=this._eventHandlerDictionary[e.schemaName]||[];t.push(e.handler),this._eventHandlerDictionary[e.schemaName]=t},this.removeEventHandler=e=>{this.checkParametersAndThrow("removeEventHandler",e&&e.schemaName&&e.handler);const t=this._eventHandlerDictionary[e.schemaName];if(!Array.isArray(t))return;const s=t.indexOf(e.handler);s>=0&&t.splice(s,1)},this.registerSimpleRemoteWorkflow=e=>{const t=this.checkParameters("registerSimpleRemoteWorkflow",e&&e.name&&e.lambdaRemote)||this.checkRuntimeInit("registerSimpleRemoteWorkflow");return t?Promise.reject(t):this._runtimeInitPromise.then(()=>n.a.registerSimpleRemoteWorkflow(e.name,e.lambdaBefore,e.lambdaRemote,e.lambdaAfter))},this.registerSimpleLocalWorkflow=e=>{const t=this.checkParameters("registerSimpleLocalWorkflow",e&&e.name&&e.lambda)||this.checkRuntimeInit("registerSimpleLocalWorkflow");return t?Promise.reject(t):this._runtimeInitPromise.then(()=>n.a.registerSimpleLocalWorkflow(e.name,e.lambda))},this.registerReduceWorkflow=e=>Promise.resolve(),this.registerSchemas=e=>Promise.resolve(),this.onResult=(e,t,s,o)=>{const n=this._eventHandlerDictionary[s];if(n)for(const i of n)if(i){i({inputSchema:e,input:t,outputSchema:s,output:o})}},this.onAnnotationResult=e=>{this._annotationResultCallback&&this._annotationResultCallback(e)},this.requestAuthToken=e=>{if(!this._requestAuthTokenCallback)return Promise.resolve({Token:""});return(this._requestAuthTokenCallback(e)||Promise.resolve("")).then(e=>{const t=e||"";return Promise.resolve({Token:t})})},this.sendTelemetryEvent=(e,t,s,o,n,i,r,a)=>{this._sendOTelEventCallback&&this._sendOTelEventCallback(((e,t,s,o,n,i,r)=>{const a={telemetryProperties:{ariaTenantToken:e,nexusTenantToken:-1},eventName:t.split("_").join("."),dataFields:f(s),eventFlags:{dataCategories:i,diagnosticLevel:r,samplingPolicy:1}};return o&&(a.eventContract={name:o,dataFields:f(n,o.split(".").slice(-1)[0])}),a})(e,t,s,o,n,r,a))},this.sendDiagnosticTrace=(e,t,s)=>{this._sendDiagnosticTraceCallback&&this._sendDiagnosticTraceCallback(e,t,s)},this.isFeatureEnabled=(e,t)=>{if(!e)return Promise.resolve(!1);const s="Microsoft.Office.AugLoop.";if(0===e.indexOf(s)&&this._featureEnabledCallback){const t=e.slice(s.length);return Promise.resolve(this._featureEnabledCallback(t))}return Promise.resolve(!1)},this.isChangeGateEnabled=e=>e&&this._changeGateEnabledCallback?Promise.resolve(this._changeGateEnabledCallback("Microsoft.Office.AugLoop."+e)):Promise.resolve(!0),this.setSessionData=(e,t,s)=>{this._setSessionDataCallback&&this._setSessionDataCallback(e,t,s)},this.overrideSessionInitMessage=e=>this._sessionInitOverrideCallback?this._sessionInitOverrideCallback(e):0===e.clientMetadata.appName.indexOf("Excel")&&this.excelServerParameters?this.overrideExcelSessionInitMessage(e):0===e.clientMetadata.appName.indexOf("PowerPoint")&&this.powerpointParameters?this.overridePowerPointSessionInitMessage(e):e,this.overrideExcelSessionInitMessage=e=>{const t={cluster:this.excelServerParameters.wacCluster,restUrl:this.excelServerParameters.ecsRestUrl,ecsId:this.excelServerParameters.ecsSessionId,ecsOperationUrl:this.excelServerParameters.ecsOperationUrl,workbookMetadataVersion:this.excelServerParameters.metadataVersion,serverEventVersion:this.excelServerParameters.serverEventVersion,permissionFlags:this.excelServerParameters.permissionFlags,configurations:this.excelServerParameters.configurations,collabUserListVersion:this.excelServerParameters.userListVersion,collabStateId:this.excelServerParameters.collabStateId,accessToken:this.excelServerParameters.accessToken,accessTokenTTL:this.excelServerParameters.accessTokenTTL,supportCustomMessages:this.excelServerParameters.supportCustomMessages};for(const s of Object.keys(e))t[s]=e[s];return new p.a(t)},this.overridePowerPointSessionInitMessage=e=>{const t={downloadUrl:this.powerpointParameters.downloadUrl,getItemsEndPoint:this.powerpointParameters.getItemsEndPoint,documentOpenType:this.powerpointParameters.documentOpenType};for(const s of Object.keys(e))t[s]=e[s];return new g.a(t)},this.onInitSession=()=>this._initSessionCallback?this._initSessionCallback():Promise.resolve(),this.checkParameters=(e,t)=>{if(!t){const t=e+" called with invalid parameters";return h.a.sendTraceTag(537408075,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,t),new Error(t)}},this.checkParametersAndThrow=(e,t)=>{const s=this.checkParameters(e,t);if(s)throw s},this.checkParametersAndPropertyAndThrow=(e,t,s)=>{if(this.checkParametersAndThrow(e,t),s){const t=e+" already called";throw h.a.sendTraceTag(537408076,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,t),new Error(t)}},this.checkRuntimeInit=e=>{if(!this._runtimeInitPromise){const t=e+" called before runtime init";return h.a.sendTraceTag(537408077,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,t),new Error(t)}},this.checkRuntimeInitAndThrow=e=>{const t=this.checkRuntimeInit(e);if(t)throw t},this.sendBridgeMessage=e=>{this._bridge.sendMessage(JSON.stringify(new r.i(e)))},this.onBridgeMessage=e=>{null!=this._bridgeInterceptor?this._bridgeInterceptor.sendMessage(e):this.handleReceivedBridgeMessage(e)},this.handleReceivedBridgeMessage=e=>{try{const{bridgeId:t,docSessionId:s,message:o}=JSON.parse(e),n=a.a.getTypeNameFor(o);if(h.a.sendTraceTag(509092291,u.a.msoulscat_Wac_BrowserGeneral,d.a.Info,"Received "+n),null!=this._sessionCloseReason&&this.sendBridgeMessage({bridgeId:"*",docSessionId:"*",message:new r.p({reason:this._sessionCloseReason})}),r.a.typeGuard(o)){const e=this.activateAnnotation({annotationType:o.annotationType,config:o.config,handler:e=>{this.sendBridgeMessage({bridgeId:t,docSessionId:s,message:new r.g({annotationType:o.annotationType,ops:[e]})})},forceReturnCachedAnnotations:o.forceReturnCachedAnnotations}).then(e=>new r.b({messageId:o.messageId,token:e.token}));this.sendResponseAcrossBridge(e,o,t,s)}else if(r.z.typeGuard(o)){for(const e of o.ops)this.submitOperation({operation:e});this.sendBridgeMessage({bridgeId:t,docSessionId:s,response:new r.n({messageId:o.messageId})}),h.a.sendTraceTag(509092288,u.a.msoulscat_Wac_BrowserGeneral,d.a.Info,"Responded to "+n)}else if(r.d.typeGuard(o)){const e=this.releaseAnnotation({token:o.token}).then(e=>new r.e({messageId:o.messageId,lastRelease:e}));this.sendResponseAcrossBridge(e,o,t,s)}else r.y.typeGuard(o)?this.submitCustomMessage({message:o.customMessage}).then(e=>{r.n.typeGuard(e)?(e.messageId=o.messageId,h.a.sendTraceTag(508432467,u.a.msoulscat_Wac_BrowserGeneral,d.a.Info,"Responded to "+n)):h.a.sendTraceTag(508420946,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,"Unexpeced response type from SubmitCustomMessage"),this.sendBridgeMessage({bridgeId:t,docSessionId:s,response:e})}).catch(e=>{h.a.sendTraceTag(508436636,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,e.message),this.sendBridgeMessage({bridgeId:t,docSessionId:s,response:new r.k({messageId:o.messageId,error:e.message})})}):r.t.typeGuard(o)?this.sendBridgeMessage({bridgeId:t,docSessionId:s,message:new r.o({serverAuthenticationState:this._serverAuthenticationState})}):h.a.sendTraceTag(509092259,u.a.msoulscat_Wac_BrowserGeneral,d.a.Warning,`Did not respond to ${n} with Id ${o.messageId}`)}catch(t){h.a.sendTraceTag(509092363,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,t.message),this.sendBridgeMessage({bridgeId:"unknown",docSessionId:"unknown",response:new r.k({messageId:"unknown",error:t.message})})}},this.sendResponseAcrossBridge=(e,t,s,o)=>{e.catch(e=>new r.k({messageId:t.messageId,error:e.message})).then(e=>{this.sendBridgeMessage({bridgeId:s,docSessionId:o,response:e}),h.a.sendTraceTag(508937624,u.a.msoulscat_Wac_BrowserGeneral,d.a.Info,"Responded to "+a.a.getTypeNameFor(t))}).catch(e=>{h.a.sendTraceTag(508937623,u.a.msoulscat_Wac_BrowserGeneral,d.a.Error,e.message)})},this.onBridgeMessageFromInterceptor=e=>{this.handleReceivedBridgeMessage(e)}}}},39456:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39457),n=new(function(){function e(){this.externalLogger=new o.a}return e.prototype.setLogger=function(e){this.externalLogger=e},e.prototype.sendTraceTag=function(e,t,s,o){this.externalLogger.sendTraceTag(e,t,s,o)},e.prototype.debugAssertTag=function(e,t,s,o){this.externalLogger.debugAssertTag(e,t,s,o)},e.prototype.shipAssertTag=function(e,t,s,o){this.externalLogger.shipAssertTag(e,t,s,o)},e}())},39457:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var o=function(){function e(){}return e.prototype.sendTraceTag=function(){},e.prototype.shipAssertTag=function(){},e.prototype.debugAssertTag=function(){},e}()},39458:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.msoulscat_ES_EWAJS=0]="msoulscat_ES_EWAJS",e[e.msoulscat_ES_EWAJSGrid=1]="msoulscat_ES_EWAJSGrid",e[e.msoulscat_ES_EWAJSChart=6]="msoulscat_ES_EWAJSChart",e[e.msoulscat_MSOSP_FileMenuCommands=202]="msoulscat_MSOSP_FileMenuCommands",e[e.msoulscat_MSOSP_OTelJS=225]="msoulscat_MSOSP_OTelJS",e[e.msoulscat_MSOSP_OTelJSInWebWoker=227]="msoulscat_MSOSP_OTelJSInWebWoker",e[e.msoulscat_MSOSP_OTelJSWebWorkerPrototype=228]="msoulscat_MSOSP_OTelJSWebWorkerPrototype",e[e.msoulscat_Wac_WordViewer=301]="msoulscat_Wac_WordViewer",e[e.msoulscat_Wac_BrowserGeneral=306]="msoulscat_Wac_BrowserGeneral",e[e.msoulscat_Wac_TaskPane=320]="msoulscat_Wac_TaskPane",e[e.msoulscat_Wac_OneNoteGeneral=339]="msoulscat_Wac_OneNoteGeneral",e[e.msoulscat_Wac_Ribbon=340]="msoulscat_Wac_Ribbon",e[e.msoulscat_Wac_WopiPendingApplication=379]="msoulscat_Wac_WopiPendingApplication",e[e.msoulscat_Wac_Telemetry=383]="msoulscat_Wac_Telemetry",e[e.msoulscat_Wac_WacCatchUpActivities=391]="msoulscat_Wac_WacCatchUpActivities",e[e.msoulscat_Wac_Dictation=394]="msoulscat_Wac_Dictation",e[e.msoulscat_Wac_OneNoteSync=395]="msoulscat_Wac_OneNoteSync",e[e.msoulscat_Wac_VisioApp=700]="msoulscat_Wac_VisioApp",e[e.msoulscat_OneNoteOnline_EditableCache=1601]="msoulscat_OneNoteOnline_EditableCache",e[e.msoulscat_Wac_PptAnimation=800]="msoulscat_Wac_PptAnimation",e[e.msoulscat_Wac_PptLive=833]="msoulscat_Wac_PptLive",e[e.msoulscat_Wac_PptMWeb=834]="msoulscat_Wac_PptMWeb",e[e.msoulscat_Wac_PptShape=815]="msoulscat_Wac_PptShape",e[e.msoulscat_Wac_PptSession=817]="msoulscat_Wac_PptSession",e[e.msoulscat_Wac_PptSlideshow=830]="msoulscat_Wac_PptSlideshow",e[e.msoulscat_Wac_PptView=822]="msoulscat_Wac_PptView",e[e.msoulscat_Wac_VersionHistory=2300]="msoulscat_Wac_VersionHistory",e[e.msoulscat_Wac_WordPresence=302]="msoulscat_Wac_WordPresence",e[e.msoulscat_Wac_WordVersionHistory=3005]="msoulscat_Wac_WordVersionHistory",e[e.msoulscat_Wac_LivePersonaCard=3006]="msoulscat_Wac_LivePersonaCard",e[e.msoulscat_Wac_CatchUpFlyout=3012]="msoulscat_Wac_CatchUpFlyout",e[e.msoulscat_Wac_WordDesigner=3016]="msoulscat_Wac_WordDesigner",e[e.msoulscat_Wac_ModernFontPicker=3021]="msoulscat_Wac_ModernFontPicker",e[e.msoulscat_Wac_UnifiedUiHost=3027]="msoulscat_Wac_UnifiedUiHost",e[e.msoulscat_Wac_EquationTools=3033]="msoulscat_Wac_EquationTools"}(o||(o={}))},39459:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.Error=10]="Error",e[e.Warning=15]="Warning",e[e.Info=50]="Info",e[e.Verbose=100]="Verbose",e[e.Spam=200]="Spam"}(o||(o={}))},39460:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.NotAuthenticated=0]="NotAuthenticated",e[e.Pending=1]="Pending",e[e.Authenticated=2]="Authenticated",e[e.WacUserInfoAuthenticated=3]="WacUserInfoAuthenticated"}(o||(o={}))},39461:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var o=s(39464),n=s(39467),i=s(39462),r=s(21015);const a="undefined"!=typeof fetch?fetch:r;var c;!function(e){e.URL="URL",e.ArrayBuffer="ArrayBuffer"}(c||(c={}));class l{constructor(e,t,s,i){this.dbName="ALModels_db",this.osName="ALModels_os",this.dbVersion=2,this.isPolymerSupported=Boolean(s),this.baseURL=`https://${t}/web/${e}`,this.polymerBaseURL=this.isPolymerSupported?"https://"+s:"",this.checkIdbByFeatures=null==i?void 0:i.checkIdbByFeatures;const r=new o.a({operationName:"CreateModelDownloader",success:!0,resultDescription:""});r.start(),this.isBrowserIdbCompatible().then(e=>{if(e){let e,t=0,s=0,o=0;const n=new Promise((t,s)=>{e=setTimeout(()=>{s(new Error("Took longer than 10000 ms"))},1e4)}),i=this.accessDB().then(e=>{const n=e.transaction(this.osName,"readwrite");return n.objectStore(this.osName).openCursor().then((function e(i){if(o++,i){const o=i.value;let n;return o.timesSinceUsage||(o.timesSinceUsage=0),o.timesSinceUsage++,o.timesSinceUsage>5?(s++,n=i.delete()):(t++,n=i.update(o)),n.then(()=>i.continue()).then(e)}return n.done}))});this.initPromise=Promise.race([n,i]).catch(e=>{r.success=!1,r.resultDescription+=e.message+" "}).then(()=>{r.dimension0=""+o,r.dimension1=""+t,r.dimension2=""+s,clearTimeout(e),this.closeDBAndEndLog(r,"initializing idb storage")})}else r.resultDescription="Incompatible browser for IDB",n.a.info(538706242,n.b.CoreDefault,r.stop())}).catch(()=>{r.resultDescription="Issue determining idb compatibility",n.a.info(536966936,n.b.CoreDefault,r.stop())})}getResourceAsArrayBuffer(e,t,s){const n=new o.a({operationName:"GetResource",success:!0,resultDescription:"",dimension0:c.ArrayBuffer,dimension1:e,dimension2:t});n.start();const i={};return this.getResource(e,t,s,c.ArrayBuffer,n,e=>Promise.all(Array.from(e.keys()).map(t=>{const s=e.get(t);return s.arrayBuffer?s.arrayBuffer().then(e=>{i[t]=e}):new Promise((e,o)=>{const n=new FileReader;n.readAsArrayBuffer(s),n.onload=s=>{const n=s.target.result;n instanceof ArrayBuffer?(i[t]=n,e()):o(new Error("Unable to obtain ArrayBuffer"))}})}))).then(()=>i)}getResourceAsURL(e,t,s){const n=new o.a({operationName:"GetResource",success:!0,resultDescription:"",dimension0:c.URL,dimension1:e,dimension2:t});n.start();const i={};return this.getResource(e,t,s,c.URL,n,e=>Promise.all(Array.from(e.keys()).map(t=>{i[t]=URL.createObjectURL(e.get(t))}))).then(()=>i)}getResource(e,t,s,o,n,i){return this.getFiles(e,t,s,n).then(e=>i(e)).then(()=>{this.closeDBAndEndLog(n,"retrieving "+e)}).catch(t=>{throw n.resultDescription.indexOf(t.message)>=0&&(n.success=!1,n.resultDescription+=t.message+" "),n.resultSignature="Issue retrieving from CDN or translating to "+o,this.closeDBAndEndLog(n,"retrieving "+e),t})}checkFirefoxCompatibility(e){const t=globalThis.navigator.userAgent.substring(e+8,e+11);return t.replace(".",""),parseInt(t,10)<=70?new Promise((function(e,t){const s=globalThis.indexedDB.open(this.dbName,this.dbVersion);s.onsuccess=function(){e(!0)},s.onerror=function(e){return t(e),!0}})):Promise.resolve(!0)}isBrowserIdbCompatible(){var e,t;return"undefined"==typeof Array||void 0===Array.from||"undefined"==typeof Proxy||"undefined"==typeof URL||void 0===URL.createObjectURL?Promise.resolve(!1):"undefined"!=typeof globalThis&&(null===(e=globalThis.navigator)||void 0===e?void 0:e.userAgent)?globalThis.navigator.userAgent.toLowerCase().indexOf("firefox")>-1?globalThis.indexedDB?this.checkFirefoxCompatibility(globalThis.navigator.userAgent.toLowerCase().indexOf("firefox")):Promise.resolve(!1):globalThis.navigator.userAgent.toLowerCase().indexOf("safari")>-1&&globalThis.navigator.userAgent.toLowerCase().indexOf("chrome")<=-1?this.checkIdbByFeatures&&(null===(t=globalThis.document)||void 0===t?void 0:t.hasStorageAccess)?globalThis.document.hasStorageAccess().then(()=>!0).catch(()=>!1):Promise.resolve(!1):Promise.resolve(!0):Promise.resolve(!1)}accessDB(){return this.accessDBPromise?this.accessDBPromise.then(e=>e.transaction(this.osName).done).then(()=>this.accessDBPromise).catch(()=>this.callOpenDB()):this.callOpenDB()}callOpenDB(){return this.accessDBPromise=Object(i.a)(this.dbName,this.dbVersion,{upgrade:e=>{e.objectStoreNames.contains(this.osName)&&e.deleteObjectStore(this.osName),e.createObjectStore(this.osName,{keyPath:"id",autoIncrement:!0})}})}endLog(e,t){e.success?(e.resultDescription="Success "+t,n.a.info(573329487,n.b.CoreDefault,e.stop())):(e.resultDescription+="error "+t,n.a.error(573329488,n.b.CoreDefault,e.stop()))}closeDBAndEndLog(e,t){this.accessDBPromise?this.accessDBPromise.then(e=>{e.close()}).catch(t=>{e.resultDescription.indexOf(t.message)>=0&&(e.success=!1,e.resultDescription+=(t.message?t.message:"Error closing db")+" ",e.resultSignature="Issue closing db")}).then(()=>{this.accessDBPromise=void 0,this.endLog(e,t)}):this.endLog(e,t)}getFiles(e,t,s,o){return this.isBrowserIdbCompatible().catch(e=>(o.success=!1,o.resultDescription+=e.message+" ",o.resultSignature="Issue determining idb compatibility",!1)).then(n=>{const i=()=>{if(s){if(this.isPolymerSupported)return this.downloadFiles1CDN(e,t,s,o,n);throw new Error("Missing polymerBaseURL provided at host level for queries with modelFilters")}return this.downloadFiles(e,t,o,n)};return n?this.getFilesFromIDB(e,t,s,o).catch(e=>(e&&(o.resultDescription.indexOf(e.message)>=0&&(o.success=!1,o.resultDescription+=e.message+" "),o.resultSignature="Issue retrieving from DB"),i())):i()})}getFilesFromIDB(e,t,s,o){return this.initPromise.catch(e=>{o.success=!1,o.resultDescription+=e.message+" ",o.resultSignature="Issue initializing"}).then(()=>this.getModelOptions(e)).then(n=>{for(const i of n)if(i&&i.model&&i.version==t){if(!this.checkModelFiltersPass(s,i.filters))continue;return this.putModel(e,i.model,t,i.filters,o,i.id),Promise.resolve(i.model)}return Promise.reject()})}checkModelFiltersPass(e,t){var s;for(const o of e){const e=null===(s=t.get(o[0]))||void 0===s?void 0:s.map(e=>e.toLocaleLowerCase());if(!e)throw new Error(`Expected filter ${o[0]} to exist in metadata file`);if(e.indexOf(o[1].toLocaleLowerCase())<0)return!1}return!0}downloadFiles1CDN(e,t,s,o,n){let i;return o.dimension3="Polymer",s||(s=new Map),a(`${this.polymerBaseURL}/${e}/${t}/metadata.json`).then(e=>{if(e.ok)return e.text();throw new Error("CDN download response status: "+e.status)}).then(n=>{var r,a;const c=JSON.parse(n);if(c.name!==e||c.version!==t)throw new Error(`Expected: ${e} version ${t}, received: ${c.name} version ${c.version}`);for(const e of c.variants)if(i=new Map(Object.entries(e)),this.checkModelFiltersPass(s,i))return(c.catalog?s.size+2:s.size+1!==i.size)&&(o.success=!1,o.resultDescription+=`Expected ${null===(r=i.keys)||void 0===r?void 0:r.length} # of filters, received ${null===(a=s.keys)||void 0===a?void 0:a.length}`),e.model_files;throw new Error("No model found with given filters")}).then(s=>Promise.all(s.map(s=>a(`${this.polymerBaseURL}/${e}/${t}/${s}`).then(e=>{if(e.ok)return e.blob();throw new Error("CDN download response status: "+e.status)}).then(e=>[s,e])))).then(s=>{const r=new Map(s);return n?this.putModel(e,r,t,i,o):r})}downloadFiles(e,t,s,o){return s.dimension3="FS",a(`${this.baseURL}/catalog_${e}_${t}.json`).then(e=>{if(e.ok)return e.text();throw new Error("CDN download response status: "+e.status)}).then(s=>{const o=JSON.parse(s),n=`${o.MajorVersion}.${o.MinorVersion}/ModelResources`,i=`${e}/${t}/`;return Promise.all(o.Resources.map(e=>(e.Name.length>i.length&&e.Name.substring(0,i.length)===i&&(e.Name=e.Name.substring(i.length)),a(`${this.baseURL}/${n}/${i}${e.Name}.${e.Type}`).then(e=>{if(e.ok)return e.blob();throw new Error("CDN download response status: "+e.status)}).then(t=>[`${e.Name}.${e.Type}`,t]))))}).then(n=>{const i=new Map(n);return o?this.putModel(e,i,t,new Map,s):i})}getModelOptions(e){return this.accessDB().then(t=>{const s=[],o=t.transaction(this.osName,"readonly");return o.objectStore(this.osName).openCursor().then((function t(n){if(n){const o=n.value;return o.modelId==e&&s.push(o),n.continue().then(t)}return o.done})).then(()=>s)})}putModel(e,t,s,o,n,i){return o||(o=new Map),this.accessDB().then(n=>n.put(this.osName,{modelId:e,model:t,version:s,filters:o,timesSinceUsage:0},i)).catch(e=>{n.resultDescription.indexOf(e.message)>=0&&(n.success=!1,n.resultDescription+=e.message+" "),n.resultSignature="Issue adding to DB"}).then(()=>t)}}},39462:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39463);function n(e,t,{blocked:s,upgrade:n,blocking:i,terminated:r}={}){const a=indexedDB.open(e,t),c=Object(o.b)(a);return n&&a.addEventListener("upgradeneeded",e=>{n(Object(o.b)(a.result),e.oldVersion,e.newVersion,Object(o.b)(a.transaction))}),s&&a.addEventListener("blocked",()=>s()),c.then(e=>{r&&e.addEventListener("close",()=>r()),i&&e.addEventListener("versionchange",()=>i())}).catch(()=>{}),c}const i=["get","getKey","getAll","getAllKeys","count"],r=["put","add","delete","clear"],a=new Map;function c(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(a.get(t))return a.get(t);const s=t.replace(/FromIndex$/,""),o=t!==s,n=r.includes(s);if(!(s in(o?IDBIndex:IDBObjectStore).prototype)||!n&&!i.includes(s))return;const c=async function(e,...t){const i=this.transaction(e,n?"readwrite":"readonly");let r=i.store;return o&&(r=r.index(t.shift())),(await Promise.all([r[s](...t),n&&i.done]))[0]};return a.set(t,c),c}Object(o.a)(e=>({...e,get:(t,s,o)=>c(t,s)||e.get(t,s,o),has:(t,s)=>!!c(t,s)||e.has(t,s)}))},39463:function(e,t,s){"use strict";s.d(t,"a",(function(){return d})),s.d(t,"b",(function(){return g}));let o,n;const i=new WeakMap,r=new WeakMap,a=new WeakMap,c=new WeakMap,l=new WeakMap;let u={get(e,t,s){if(e instanceof IDBTransaction){if("done"===t)return r.get(e);if("objectStoreNames"===t)return e.objectStoreNames||a.get(e);if("store"===t)return s.objectStoreNames[1]?void 0:s.objectStore(s.objectStoreNames[0])}return g(e[t])},set:(e,t,s)=>(e[t]=s,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function d(e){u=e(u)}function h(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(f(this),t),g(i.get(this))}:function(...t){return g(e.apply(f(this),t))}:function(t,...s){const o=e.call(f(this),t,...s);return a.set(o,t.sort?t.sort():[t]),g(o)}}function p(e){return"function"==typeof e?h(e):(e instanceof IDBTransaction&&function(e){if(r.has(e))return;const t=new Promise((t,s)=>{const o=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),o()},i=()=>{s(e.error||new DOMException("AbortError","AbortError")),o()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)});r.set(e,t)}(e),t=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,u):e);var t}function g(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,s)=>{const o=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(g(e.result)),o()},i=()=>{s(e.error),o()};e.addEventListener("success",n),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&i.set(t,e)}).catch(()=>{}),l.set(t,e),t}(e);if(c.has(e))return c.get(e);const t=p(e);return t!==e&&(c.set(e,t),l.set(t,e)),t}const f=e=>l.get(e)},39464:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(39465),n=s(39466);class i extends o.a{constructor(e,t){super(e),this.eventName="Operation",this.options=t,this.durationMs=null==e?void 0:e.durationMs,e&&null!=e.count||(this.count=1)}setClientMetadata(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDocSessionId=e.docSessionId,this.clientDeviceId=e.deviceId,this.clientUserAgent=e.userAgent),this}setUserContext(e){return e&&(this.userId=e.puid||e.oid,this.userType=e.userType&&e.userType.toString(),this.userTenantId=e.tid),this}setMetricCustomDimensions(e,t){if(!this.options)throw new Error(`Attempting to set custom dimensions ${e} to operation ${this.operationName} without activating MetricCount or MetricDuration`);this.options.metricCustomDimensions=this.options.metricCustomDimensions||{},this.options.metricCustomDimensions[e]=t}setDataField(e,t){const s=this.dataFields?JSON.parse(this.dataFields):{};s[e]=t,this.dataFields=JSON.stringify(s)}setDataFields(e){this.dataFields?this.dataFields=JSON.stringify(Object.assign(Object.assign({},JSON.parse(this.dataFields)),e)):this.dataFields=JSON.stringify(e)}start(){return this.startTime=Object(n.a)(),this}stop(){const e=Object(n.a)();return this.durationMs=Math.round(e-this.startTime),this}getMetrics(e){var t,s;const o={};if(this.operationName)switch(this.operationName){case"SessionHealthOrphanedEventsWithoutProperSessionKey":case"SessionHealthOrphanedSessions":case"WorkflowActivationState":o[this.operationName+".CountV2"]={dimensionNames:i.getOrphanedSessionHealthDimensionNames.bind(i),dimensionValues:this.getOrphanedSessionHealthDimensionValues(),value:this.count};break;case"MarkUnhealthySession":case"MarkHealthWarningSession":o[this.operationName+".Reason"]={dimensionNames:i.getSessionHealthDimensionNames.bind(i),dimensionValues:this.getSessionHealthDimensionValues(),value:1};break;default:if("matchmaker_timer"===this.operationName&&(o["Workflow.DurationMs"]={dimensionNames:i.getWorkflowDimensionNames.bind(i),dimensionValues:this.getWorkflowDimensionValues(),value:this.durationMs||0},o["Workflow.Count"]={dimensionNames:i.getWorkflowDimensionNames.bind(i),dimensionValues:this.getWorkflowDimensionValues(),value:1}),void 0!==this.durationMs){const s=this.operationName+".DurationMsV2";((null===(t=this.options)||void 0===t?void 0:t.metricDuration)||e.indexOf(s)>=0)&&(o[s]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues(),value:this.durationMs})}{const t=this.operationName+".CountV2";((null===(s=this.options)||void 0===s?void 0:s.metricCount)||e.indexOf(t)>=0)&&(o[t]={dimensionNames:this.getDimensionNames.bind(this),dimensionValues:this.getDimensionValues(),value:this.count})}}return o}getDimensionNames(){var e,t;let s=i.dimensionNames;if(null===(e=this.options)||void 0===e?void 0:e.metricCustomDimensions){s=s.slice();for(const e in null===(t=this.options)||void 0===t?void 0:t.metricCustomDimensions)s.push(e)}return s}getDimensionValues(){var e,t;const s=[this.success,this.clientAppName,this.clientAppPlatform,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3];if(null===(e=this.options)||void 0===e?void 0:e.metricCustomDimensions)for(const o in null===(t=this.options)||void 0===t?void 0:t.metricCustomDimensions)s.push(this.options.metricCustomDimensions[o]);return s}static getOrphanedSessionHealthDimensionNames(){return this.orphanedSessionHealthDimensionNames}getOrphanedSessionHealthDimensionValues(){return[this.success,this.clientAppName,this.clientAppPlatform,this.clientReleaseAudienceGroup,this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}static getSessionHealthDimensionNames(){return this.sessionHealthDimensionNames}getSessionHealthDimensionValues(){return[this.resultSignature,this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}static getWorkflowDimensionNames(){return this.workflowDimensionNames}getWorkflowDimensionValues(){return[this.resultSignature,this.resourceId,this.resourceId,this.success]}}i.dimensionNames=["Success","ClientAppName","ClientAppPlatform","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],i.orphanedSessionHealthDimensionNames=["Success","ClientAppName","ClientAppPlatform","ClientReleaseAudienceGroup","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"],i.sessionHealthDimensionNames=["Reason","ClientAppName","ClientAppPlatform","ClientAppVersion","Dimension0","Dimension1","Dimension2","Dimension3"],i.workflowDimensionNames=["ResultSignature","WorkflowId","ResourceId","Success"]},39465:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o={util:{},roots:{default:{}}},n=(o.util,o.roots.default||(o.roots.default={}),function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.count=0,e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.durationMs=0,e.prototype.success=!1,e.prototype.resultDescription="",e.prototype.resultJSON="",e.prototype.resultSignature="",e.prototype.operationName="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.userTenantId="",e.prototype.joinContextId="",e.prototype.ariaTenant="",e.prototype.ariaNamespace="",e.prototype.dataFields="",e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/OperationEvent"},e}())},39466:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return o}));const o=void 0!==e&&e.hrtime?()=>{const t=e.hrtime();return 1e3*t[0]+t[1]/1e6}:"undefined"!=typeof performance&&performance.now?()=>performance.now():()=>Date.now()}).call(this,s(11430))},39467:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return y})),s.d(t,"c",(function(){return S})),s.d(t,"b",(function(){return N}));var o=s(39468),n=s(39469);const i=void 0!==e&&Object({NODE_ENV:"production",PUBLIC_URL:"",CI:!0,APP:"make-powerapps-com",LOCALES_HASH:"xUBqWtfoMr22",AAD_INSTANCE:{high:"https://login.microsoftonline.us/",dod:"https://login.microsoftonline.us/",mooncake:"https://login.chinacloudapi.cn/",ex:"https://login.microsoftonline.eaglex.ic.gov/",rx:"https://login.microsoftonline.microsoft.scloud/"},SETTINGS_FALLBACK_REGION:{},BUILD_COMMIT_ID:"26302342ac53296adc1702d2dc6c534b4d8e1dc8",BUILD_NAME:"0.0.20240301.1-2402.4-prod",BUILD_BRANCH:"2402.4",BUILD_DATE_TIME:"Fri, 01 Mar 2024 19:45:44 GMT",BUILD_SHELL_VERSION:"1.0.0",_UNSAFE_DONT_USE_BUILD_MODULE_TYPE:"module"})?Object({NODE_ENV:"production",PUBLIC_URL:"",CI:!0,APP:"make-powerapps-com",LOCALES_HASH:"xUBqWtfoMr22",AAD_INSTANCE:{high:"https://login.microsoftonline.us/",dod:"https://login.microsoftonline.us/",mooncake:"https://login.chinacloudapi.cn/",ex:"https://login.microsoftonline.eaglex.ic.gov/",rx:"https://login.microsoftonline.microsoft.scloud/"},SETTINGS_FALLBACK_REGION:{},BUILD_COMMIT_ID:"26302342ac53296adc1702d2dc6c534b4d8e1dc8",BUILD_NAME:"0.0.20240301.1-2402.4-prod",BUILD_BRANCH:"2402.4",BUILD_DATE_TIME:"Fri, 01 Mar 2024 19:45:44 GMT",BUILD_SHELL_VERSION:"1.0.0",_UNSAFE_DONT_USE_BUILD_MODULE_TYPE:"module"}).SERVICE_NAME:"client",r="abcdefghijklmnopqrstuvwxyz0123456789",a={97:0,98:1,99:2,100:3,101:4,102:5,103:6,104:7,105:8,106:9,107:10,108:11,109:12,110:13,111:14,112:15,113:16,114:17,115:18,116:19,117:20,118:21,119:22,120:23,121:24,122:25,48:26,49:27,50:28,51:29,52:30,53:31,54:32,55:33,56:34,57:35};let c,l=[],u=[],d=e=>null,h=e=>{};const p=new Map,g=new Map,f=new Map,m=new Map;var y;!function(e){e.defineCoreLogCategory=e=>({root:"Core",name:e}),e.defineWorkflowLogCategory=e=>({root:"Workflow",name:e}),e.clearLoggers=()=>{l=[],u=[],g.clear(),f.clear()},e.clearAggregators=()=>{p.clear()},e.addLogger=e=>{-1===l.indexOf(e)&&(l.push(e),b(g,e))},e.addDecidingLogger=e=>{-1===u.indexOf(e)&&(u.push(e),b(f,e))},e.setCorrelationContextCallback=e=>{c=e},e.setStartPerformanceEventCallback=e=>{d=e},e.setStopPerformanceEventCallback=e=>{h=e},e.addAggregator=e=>{e.init((e,t)=>{A(e,t)}),p.has(e.eventName)?p.get(e.eventName).push(e):p.set(e.eventName,[e])},e.flushAggregators=e=>{p.forEach(t=>{t.forEach(t=>t.flush(e))})},e.setTagLevelOverride=(e,t)=>{const s=D(e);m.set(s,t)},e.resetTagLevelOverrides=()=>{m.clear()},e.error=(e,t,s,n,i,r,a,c,l,u)=>{I(e,t,o.a.error,s,n,i,r,a,c,l,u)},e.warn=(e,t,s,n,i,r,a,c,l,u)=>{I(e,t,o.a.warn,s,n,i,r,a,c,l,u)},e.info=(e,t,s,n,i,r,a,c,l,u)=>{I(e,t,o.a.info,s,n,i,r,a,c,l,u)},e.verbose=(e,t,s,n,i,r,a,c,l,u)=>{I(e,t,o.a.verbose,s,n,i,r,a,c,l,u)},e.debug=(e,t,s,n,i,r,a,c,l,u)=>{I(e,t,o.a.debug,s,n,i,r,a,c,l,u)},e.metric=(e,t,s,n,i,r,a,c,l,u)=>{I(e,t,o.a.metric,s,n,i,r,a,c,l,u)},e.formatMetric=(e,t,s,o)=>{const n={};return n[e]={dimensionNames:s,dimensionValues:o,value:t},n},e.dynamic=e=>{A(e)}}(y||(y={}));const b=(e,t)=>{const s=t.level;Object.keys(o.a).map(e=>o.a[e]).filter(e=>"string"!=typeof e).filter(e=>e<=s).forEach(s=>{e.has(s)?e.get(s).push(t):e.set(s,[t])})},T=e=>{if("string"==typeof e)return e;let t="";for(let s=0;s<e.length;s++){s>0&&(t+=" ");const o=e[s];o instanceof Error?t+=JSON.stringify({message:o.message,name:o.name,stack:o.stack}):t+="object"==typeof o?JSON.stringify(o):o}return t},w=[],v=["Level","Tag"],k=["Level","Tag","Workflow"],S=e=>C(e).length,C=e=>void 0!==e?g.get(e)||w:l,_=(e,t)=>(void 0!==e?f.get(e)||[]:u).filter(e=>e.shouldLog(t)),I=(e,t,s,o,i,r,a,l,u,g,f)=>{s=m.get(e)||s;const y=C(s),b=_(s,o);if(0==y.length&&0==b.length)return;const w=d(n.a.Log),S=E(e),I=((e,t,s,o,n,i,r,a)=>{if(void 0===t&&("string"==typeof e||"object"==typeof e))return e;if(void 0===t&&"function"==typeof e)return e();const c=[];for(const l of[e,t,s,o,n,i,r,a])void 0!==l&&c.push("function"==typeof l?l():l);return c})(o,i,r,a,l,u,g,f);if(M(t))x(I)&&A({eventName:"Metrics",tagId:S,category:`${t.root}.${t.name}`,traceLevel:s,message:"",getMetrics:()=>I},!1,y,b);else if(x(I)){const e=I;e.tagId=S,e.category=`${t.root}.${t.name}`,"Operation"===e.eventName&&"Workflow"===t.root&&(e.eventName="WorkflowOperation",c&&(e.joinContextId=c().joinContextId)),e.traceLevel=s;const o=p.get(e.eventName);if(o)for(let t=0;t<o.length;++t){const s=o[t];if(s&&s.add(e,t===o.length-1))break}else A(e,!1,y,b)}else{const e=()=>{var e;return"Core"===t.root?{TraceEventV2:{dimensionNames:()=>v,dimensionValues:[String(s),S],value:1}}:{WorkflowTraceEvent:{dimensionNames:()=>k,dimensionValues:[String(s),S,c?null===(e=c())||void 0===e?void 0:e.workflow:""],value:1}}};A({eventName:"Log",tagId:S,category:`${t.root}.${t.name}`,traceLevel:s,message:T(I),getMetrics:e},!1,y,b)}h(w)},A=(e,t=!1,s,o)=>{var n,r,a,l,u;if(null==s&&(s=C(e.traceLevel)),o=o||w,s.length>0||o.length>0){if(e.serviceName=i,!t&&c){const t=c();if(t){e.cv=e.cv?e.cv:t.cv.toString(),e.sessionKey=e.sessionKey?e.sessionKey:t.sessionKey,e.workflow=e.workflow?e.workflow:t.workflow;const s=null===(n=t.clientMetadata)||void 0===n?void 0:n.appName;e.clientAppName=e.clientAppName?e.clientAppName:s;const o=null===(r=t.clientMetadata)||void 0===r?void 0:r.appPlatform;e.clientAppPlatform=e.clientAppPlatform?e.clientAppPlatform:o;const i=null===(a=t.clientMetadata)||void 0===a?void 0:a.releaseAudienceGroup;e.clientReleaseAudienceGroup=e.clientReleaseAudienceGroup?e.clientReleaseAudienceGroup:i;const c=null===(l=t.clientMetadata)||void 0===l?void 0:l.flights;null!==(u=e.clientFlights)&&void 0!==u||(e.clientFlights=c)}}for(const t of s)t.log(e);for(const t of o)t.log(e)}},M=e=>e.name===N.WorkflowMetricsOnly.name&&e.root===N.WorkflowMetricsOnly.root,x=e=>!Array.isArray(e)&&"object"==typeof e,E=e=>r[e>>24&63]+r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[e>>0&63],D=e=>e&&5===e.length?a[e.charCodeAt(0)]<<24|a[e.charCodeAt(1)]<<18|a[e.charCodeAt(2)]<<12|a[e.charCodeAt(3)]<<6|a[e.charCodeAt(4)]:-1;class N{}N.CoreDefault=y.defineCoreLogCategory("Default"),N.CoreSystem=y.defineCoreLogCategory("System"),N.WorkflowDefault=y.defineWorkflowLogCategory("Default"),N.WorkflowUnsampled=y.defineWorkflowLogCategory("Unsampled"),N.WorkflowMetricsOnly=y.defineWorkflowLogCategory("MetricsOnly"),N.PrivacyGuardEvent=y.defineCoreLogCategory("PrivacyGuardEvent")}).call(this,s(11430))},39468:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.error=0]="error",e[e.warn=1]="warn",e[e.info=3]="info",e[e.metric=4]="metric",e[e.verbose=5]="verbose",e[e.debug=6]="debug",e[e.disabled=7]="disabled"}(o||(o={}))},39469:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e.Log="Log"}(o||(o={}))},39470:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39471);class n{constructor(e){this.getCache=null,this.getCache=e}static createFactory(e,t,s,i,r){return a=>{var c;const l=i||o.c;return!n.onnxRetrievalPromise||a?e&&t?((null===(c=l())||void 0===c?void 0:c.ort)&&!a?Promise.resolve():Object(o.d)(this.createCdnUrl(e,t),l,"ort",s,r)).then(()=>{n.onnxRetrievalPromise=Promise.resolve(new n(l))}).catch(e=>{n.onnxRetrievalPromise=Promise.reject(e)}).then(()=>n.onnxRetrievalPromise):Promise.reject(new Error("Error: appName and/or version not provided")):n.onnxRetrievalPromise}}static createCdnUrl(e,t){return`https://${e}${t}`}createModel(e,t){var s;const n=null===(s=this.getCache())||void 0===s?void 0:s.ort;return Object(o.b)(e,t||"",n)}createInputs(){return Object(o.a)()}}},39471:function(e,t,s){"use strict";s.d(t,"c",(function(){return r})),s.d(t,"d",(function(){return c})),s.d(t,"b",(function(){return l})),s.d(t,"a",(function(){return u}));var o=s(39464),n=s(39467),i=s(39472);function r(){return globalThis&&!globalThis.top&&(globalThis.top={}),null===globalThis||void 0===globalThis?void 0:globalThis.top}function a(e,t){e.src=t}function c(e,t,s,r,c){const l=new o.a({operationName:"CreateOnnxInferenceService",success:!0,resultDescription:""});if(l.start(),Object(i.c)(l)){const e="Browser lacks necessary support for inference service";return l.success=!1,l.resultDescription=e,n.a.info(540406803,n.b.CoreDefault,l.stop()),Promise.reject(new Error(e))}return new Promise((o,n)=>{if("undefined"!=typeof document){const i=document.createElement("script");(c||a)(i,e),i.onload=()=>{d(t,s)?(r&&(t()[s].env.wasm.wasmPaths=r),o()):(i.remove(),n(new Error("ort.Tensor and/or ort.InferenceSession are undefined")))},i.onerror=n,document.body.appendChild(i)}else globalThis.importScripts?(globalThis.importScripts(e),globalThis[s]=self[s],d(t,s)?(r&&(t()[s].env.wasm.wasmPaths=r),o()):n(new Error("ort.Tensor and/or ort.InferenceSession are undefined"))):n(new Error("Unexpected lack of document and importScripts"))}).then(()=>{n.a.info(540406804,n.b.CoreDefault,l.stop())}).catch(e=>{throw l.success=!1,l.resultDescription=e.message,n.a.info(509871835,n.b.CoreDefault,l.stop()),e})}function l(e,t,s){return i.b.create(e,t,s)}function u(){return i.a.create()}function d(e,t){const s=globalThis[t];if(s&&s.InferenceSession&&s.Tensor){const o=e();return o&&!o[t]&&(o[t]=s),!0}return!1}},39472:function(e,t,s){"use strict";s.d(t,"c",(function(){return a})),s.d(t,"b",(function(){return c})),s.d(t,"a",(function(){return l}));var o=s(39473),n=s(39467),i=s(39464),r=function(e,t,s,o){return new(s||(s=Promise))((function(n,i){function r(e){try{c(o.next(e))}catch(t){i(t)}}function a(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};function a(e){let t="";if("undefined"!=typeof navigator&&navigator.userAgent){const e=navigator.userAgent;!e.indexOf||e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0?t="Error: IE lacks necessary support":"undefined"==typeof Promise?t="Error: Promise is not supported":"undefined"==typeof WebAssembly&&(t="Error: WASM is not supported")}else t="Error: No window userAgent";return""!=t&&(e.resultDescription=t,n.a.info(540406806,n.b.CoreDefault,e.stop()),!0)}class c{constructor(e,t,s){this.session=e,this.onnxObject=s,this.modelName=t}static create(e,t,s){return r(this,void 0,void 0,(function*(){const o=new i.a({operationName:"CreateModelForInferencing",success:!0,resourceId:t});return o.start(),s[e]?(o.resultDescription="Model already existed",n.a.info(509699716,n.b.CoreDefault,o.stop()),s[e]):s[e]=this.getInferenceSession(s).create(e).then(e=>(n.a.info(540406807,n.b.CoreDefault,o.stop()),new c(e,t,s))).catch(e=>{throw o.resultDescription="Error: "+e,n.a.info(540406808,n.b.CoreDefault,o.stop()),e})}))}static getInferenceSession(e){if(null==e?void 0:e.InferenceSession)return e.InferenceSession;throw new Error("InferenceSession is not defined")}run(e){var t;return r(this,void 0,void 0,(function*(){const s=new i.a({operationName:"RunModelForInferencing",success:!0,resourceId:this.modelName});if(s.start(),null===(t=this.onnxObject)||void 0===t?void 0:t.Tensor){const t=e.getInputs(),o={};return Object.keys(t).forEach(e=>{const s=t[e];if(Array.isArray(s.values)&&s.values.length>0&&"boolean"==typeof s.values[0]){const t=new Uint8Array(s.values);o[e]=new this.onnxObject.Tensor(t,s.dimensions)}else o[e]=new this.onnxObject.Tensor(s.values,s.dimensions)}),this.session.run(o).then(e=>(n.a.info(540406809,n.b.CoreDefault,s.stop()),new u(e))).catch(e=>{s.resultDescription="Problem running model. "+e.message,n.a.info(540406810,n.b.CoreDefault,s.stop())})}throw s.resultDescription="Unable to run model. Tensor not defined",n.a.info(540406811,n.b.CoreDefault,s.stop()),new Error("Tensor is not defined")}))}}class l{constructor(){this.map={}}static create(){return new l}getInputs(){return this.map}add(e,t,s){return this.map[e]={dimensions:t,values:s},this}}class u{constructor(e){for(const t of Object.keys(e))this[t]=new d(t,e[t])}}class d{constructor(e,t){this.resultName=e,this.result=t}name(){return this.resultName}outputType(){switch(this.result.type){case"string":return o.a.Strings;case"int8":return o.a.Int8s;case"int16":return o.a.Int16s;case"int32":return o.a.Int32s;case"bool":return o.a.Booleans;case"uint8":return o.a.UnsignedInt8s;case"uint16":return o.a.UnsignedInt16s;case"uint32":return o.a.UnsignedInt32s;case"float32":return o.a.Float32s;case"float64":return o.a.Float64s;default:throw new Error(`The output type ${this.result.type} is not supported.`)}}dimensions(){return this.result.dims}asBooleans(){if(this.outputType()===o.a.Booleans)return this.result.data.map(e=>!!e);throw new Error(`asBooleans() was called; however, outputType() is ${this.outputType()}, not Type.Booleans.`)}asFloat32s(){if(this.outputType()===o.a.Float32s)return this.result.data;throw new Error(`asFloat32s() was called; however, outputType() is ${this.outputType()}, not Type.Float32s.`)}asFloat64s(){if(this.outputType()===o.a.Float64s)return this.result.data;throw new Error(`asFloat64s() was called; however, outputType() is ${this.outputType()}, not Type.Float64s.`)}asInt8s(){if(this.outputType()===o.a.Int8s)return this.result.data;throw new Error(`asInt8s() was called; however, outputType() is ${this.outputType()}, not Type.Int8s.`)}asInt16s(){if(this.outputType()===o.a.Int16s)return this.result.data;throw new Error(`asInt16s() was called; however, outputType() is ${this.outputType()}, not Type.Int16s.`)}asInt32s(){if(this.outputType()===o.a.Int32s)return this.result.data;throw new Error(`asInt32s() was called; however, outputType() is ${this.outputType()}, not Type.Int32s.`)}asStrings(){if(this.outputType()===o.a.Strings)return this.result.data;throw new Error(`asStrings() was called; however, outputType() is ${this.outputType()}, not Type.Strings.`)}asUnsignedInt8s(){if(this.outputType()===o.a.UnsignedInt8s)return this.result.data;throw new Error(`asUnsignedInt8s() was called; however, outputType() is ${this.outputType()}, not Type.UnsignedInt8s.`)}asUnsignedInt16s(){if(this.outputType()===o.a.UnsignedInt16s)return this.result.data;throw new Error(`asUnsignedInt16s() was called; however, outputType() is ${this.outputType()}, not Type.UnsignedInt16s.`)}asUnsignedInt32s(){if(this.outputType()===o.a.UnsignedInt32s)return this.result.data;throw new Error(`asUnsignedInt32s() was called; however, outputType() is ${this.outputType()}, not Type.UnsignedInt32s.`)}}},39473:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.None=0]="None",e[e.Booleans=1]="Booleans",e[e.Float32s=2]="Float32s",e[e.Float64s=3]="Float64s",e[e.Int8s=4]="Int8s",e[e.Int16s=5]="Int16s",e[e.Int32s=6]="Int32s",e[e.Strings=7]="Strings",e[e.UnsignedInt8s=8]="UnsignedInt8s",e[e.UnsignedInt16s=9]="UnsignedInt16s",e[e.UnsignedInt32s=10]="UnsignedInt32s"}(o||(o={}))},39474:function(e,t,s){"use strict";s.d(t,"a",(function(){return k})),s.d(t,"b",(function(){return C}));var o=s(39468),n=s(39464),i=s(39467),r=s(39492),a=s(39521),c=s(39488),l=s(39546),u=s(39490),d=s(39482),h=s(39544),p=s(39545),g=s(39543),f=s(39530),m=s(39524),y=s(39541),b=s(39476),T=s(39515),w=s(39535),v=s(39477);const k=()=>s(39475).version;class S{constructor(e,t,s){this.sessionsByDocSessionId=new Map,this.isDeltaGeneratorEnabled=!1,this.disableSyncDeltaSending=!1,this.hasBeenInitialized=!1,this.settings={dropOnlySequencedSyncsOnReseedEnabled:!0,closeWSBlockedSessionEnabled:!0,sessionOfflineModeEnabled:!0,annotationsOrderingEnabled:!0,deltaOperationsEnabled:!1,checkIdbByFeatures:!1,improvedWebSocketEnabled:!0,defaultBatchingEnabled:!0,batchingWith20msIntervalEnabled:!0,onAnnotationsSubmittedEnabled:!1,httpFallbackEnabled:!1,closeWorkerOnReliabilityFailureEnabled:!0,sendCloseCallbackOnClientRequestedClose:!0,reduceBatchOperationsEnabled:!1,batchMessagesEnabled:!1,reduceBatchedMessageOperationsEnabled:!1,jsond2ContentTypeEnabled:!0,ingressAfterCloseEnabled:!0},this.isDownloaderCompatible=()=>{if(this.settings.checkIdbByFeatures)return"undefined"!=typeof Array&&void 0!==Array.from&&"undefined"!=typeof URL&&void 0!==URL.createObjectURL;if("undefined"!=typeof navigator&&navigator.userAgent){const e=navigator.userAgent;return!(!e.indexOf||e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0)}return!1},this.workerFactory=e||(e=>e&&e===b.a.HttpFallback?new v.a:new c.a);const o=this.createDefaultSessionManagerFactory();this.sessionManagerFactory=(...e)=>(null==t?void 0:t(...e))||o(...e),this.sessionFactory=s||(e=>new u.c(e))}init(e,t,s,r){var c,l,u,h,p,g,T,v,C,_,I,A,M,x;const E=new n.a({operationName:"InitRuntime",resourceId:e,dimension1:this.hasBeenInitialized.toString()});E.start(),this.hasBeenInitialized=!0,this.hostCallbacks=s,this.shouldAddLogger(E)?(i.a.addLogger(new a.a(this.hostCallbacks)),this.addLoggingAggregator(r)):(i.a.clearLoggers(),i.a.addLogger(new a.a(this.hostCallbacks))),S.haveCalledInit=!0,this.annotationResultsProcessor=new m.a(()=>this.settings.annotationsOrderingEnabled),this.inferenceServiceFactory=r.inferenceServiceFactory,this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=k()),this.networkRateSettings=r.networkRateSettings,E.dimension2=Object(i.c)(o.a.info).toString();const D=[];e&&(this.defaultServiceUrl=d.b.convertServiceUrlToWebSocket(e),this.serviceProtocol=this.defaultServiceUrl.split(":")[0].toLowerCase()),D.push(this.isFeatureEnabled("CheckIdbByFeatures",!1).then(e=>{this.settings.checkIdbByFeatures=e})),D.push(this.isFeatureEnabled("DropOnlySequencedSyncsOnReseedDisabled").then(e=>{this.settings.dropOnlySequencedSyncsOnReseedEnabled=!e})),D.push(this.isFeatureEnabled("CloseWSBlockedSessionDisabled").then(e=>{this.settings.closeWSBlockedSessionEnabled=!e})),D.push(this.isFeatureEnabled("SessionOfflineModeDisabled").then(e=>{this.settings.sessionOfflineModeEnabled=!e})),D.push(this.isFeatureEnabled("AnnotationsOrderingEnabled",!0).then(e=>{this.settings.annotationsOrderingEnabled=e})),D.push(this.isFeatureEnabled("ImprovedWebsocketDisabled").then(e=>{var t;(t=this.settings).improvedWebSocketEnabled&&(t.improvedWebSocketEnabled=!e)})),D.push(this.isFeatureEnabled("DefaultBatchingDisabled").then(e=>{var t;(t=this.settings).defaultBatchingEnabled&&(t.defaultBatchingEnabled=!e)})),D.push(this.isFeatureEnabled("HttpFallbackEnabled").then(e=>{var t;(t=this.settings).httpFallbackEnabled||(t.httpFallbackEnabled=e)})),D.push(this.isFeatureEnabled("JSOND2ContentTypeDisabled").then(e=>{var t;(t=this.settings).jsond2ContentTypeEnabled&&(t.jsond2ContentTypeEnabled=!e)})),D.push(this.isFeatureEnabled("CloseWorkerOnReliabilityFailureDisabled").then(e=>{var t;(t=this.settings).closeWorkerOnReliabilityFailureEnabled&&(t.closeWorkerOnReliabilityFailureEnabled=!e)})),D.push(this.isFeatureEnabled("BatchingWith20msIntervalDisabled").then(e=>{var t;(t=this.settings).batchingWith20msIntervalEnabled&&(t.batchingWith20msIntervalEnabled=!e)})),D.push(this.isFeatureEnabled("OnAnnotationsSubmittedDisabled").then(e=>{var t;(t=this.settings).onAnnotationsSubmittedEnabled&&(t.onAnnotationsSubmittedEnabled=!e)})),D.push(this.isFeatureEnabled("SendCallbackOnHostRequestedSessionCloseDisabled").then(e=>{var t;(t=this.settings).sendCloseCallbackOnClientRequestedClose&&(t.sendCloseCallbackOnClientRequestedClose=!e)})),D.push(this.isFeatureEnabled("ReduceBatchOperationsEnabled").then(e=>{var t;(t=this.settings).reduceBatchOperationsEnabled||(t.reduceBatchOperationsEnabled=e)})),D.push(this.isFeatureEnabled("BatchMessagesEnabled ").then(e=>{var t;(t=this.settings).batchMessagesEnabled||(t.batchMessagesEnabled=e)})),D.push(this.isFeatureEnabled("ReduceBatchedMessageOperationsEnabled").then(e=>{var t;(t=this.settings).reduceBatchedMessageOperationsEnabled||(t.reduceBatchedMessageOperationsEnabled=e)})),D.push(this.isFeatureEnabled("IngressAfterCloseDisabled").then(e=>{var t;(t=this.settings).ingressAfterCloseEnabled&&(t.ingressAfterCloseEnabled=!e)}));const N={enableDeltas:!1,enableEarlyJoin:!1};D.push(Promise.all([this.isFeatureEnabled("DeltaOperationsEnabled").then(e=>N.enableDeltas=e).catch(()=>N.enableDeltas=!1),this.isFeatureEnabled("EarlyJoinCompletionEnabled").then(e=>N.enableEarlyJoin=e).catch(()=>N.enableEarlyJoin=!1)]).then(()=>{this.localWorkflowManager=new f.a(r.modelDownloader&&this.isDownloaderCompatible()?r.modelDownloader:void 0,this.inferenceServiceFactory,N)}));const B=Object(w.a)(null!==(c=t.flights)&&void 0!==c?c:"");return this.isDeltaGeneratorEnabled=B.getBooleanValue("Microsoft.Office.WordOnline.AugloopDeltas",null!==(l=r.isDeltaGeneratorEnabled)&&void 0!==l&&l),this.disableSyncDeltaSending=B.getBooleanValue("Microsoft.Office.WordOnline.DisableSyncDeltaSending",null!==(u=r.disableSyncDeltaSending)&&void 0!==u&&u),this.syncDeltaTimeout=B.getIntValue("Microsoft.Office.WordOnline.SyncDeltaTimeout",r.syncDeltaTimeout),(h=this.settings).improvedWebSocketEnabled&&(h.improvedWebSocketEnabled=!B.getBooleanValue("ImprovedWebsocketDisabled",!1)),(p=this.settings).httpFallbackEnabled||(p.httpFallbackEnabled=B.getBooleanValue("Microsoft.Office.WordOnline.Augloop.HttpFallbackEnabled",!1)),(g=this.settings).jsond2ContentTypeEnabled&&(g.jsond2ContentTypeEnabled=!B.getBooleanValue("Microsoft.Office.WordOnline.Augloop.JSOND2ContentTypeDisabled",!1)),(T=this.settings).closeWorkerOnReliabilityFailureEnabled&&(T.closeWorkerOnReliabilityFailureEnabled=!B.getBooleanValue("Microsoft.Office.WordOnline.Augloop.CloseWorkerOnReliabilityFailureDisabled",!1)),(v=this.settings).defaultBatchingEnabled&&(v.defaultBatchingEnabled=!B.getBooleanValue("DefaultBatchingDisabled",!1)),(C=this.settings).batchingWith20msIntervalEnabled&&(C.batchingWith20msIntervalEnabled=!B.getBooleanValue("BatchingWith20msIntervalDisabled",!1)),(_=this.settings).sendCloseCallbackOnClientRequestedClose&&(_.sendCloseCallbackOnClientRequestedClose=!B.getBooleanValue("SendCallbackOnHostRequestedSessionCloseDisabled",!1)),(I=this.settings).reduceBatchOperationsEnabled||(I.reduceBatchOperationsEnabled=B.getBooleanValue("ReduceBatchOperationsEnabled",!1)),(A=this.settings).batchMessagesEnabled||(A.batchMessagesEnabled=B.getBooleanValue("BatchMessagesEnabled ",!1)),(M=this.settings).reduceBatchedMessageOperationsEnabled||(M.reduceBatchedMessageOperationsEnabled=B.getBooleanValue("ReduceBatchedMessageOperationsEnabled",!1)),(x=this.settings).ingressAfterCloseEnabled&&(x.ingressAfterCloseEnabled=!B.getBooleanValue("Microsoft.Office.WordOnline.Augloop.IngressAfterCloseDisabled",!1)),r&&r.networkMode&&(r.networkMode===b.a.HttpFallback&&(r.networkMode=this.settings.httpFallbackEnabled&&this.settings.improvedWebSocketEnabled?b.a.HttpFallback:b.a.JSWebSockets),this.networkMode=r.networkMode,r.networkMode===b.a.LocalWorkflowsOnly&&(this.sessionManagerFactory=()=>new y.a)),Promise.all(D).then(()=>{this.batchOptions=r.batchOptions,!this.batchOptions&&this.settings.defaultBatchingEnabled&&(this.batchOptions={delayMs:1,maxInputSize:1e6,delayMsMax:50},this.settings.batchingWith20msIntervalEnabled&&(this.batchOptions.delayMs=20)),this.batchOptions&&!this.batchOptions.delayMsMax&&(this.batchOptions.delayMsMax=50),E.dimension0=JSON.stringify(this.batchOptions),this.logOperation(E,!0)}).catch(e=>{this.logOperation(E,!1,"Error",e?e.message:"(no error)")})}getServiceProtocol(){return this.serviceProtocol}registerLocalWorkflow(e){this.localWorkflowManager.registerLocalWorkflow(e)}flushTelemetry(e){i.a.flushAggregators(e)}createSession(e){var t;const s=e&&e.docSessionId?e.docSessionId:Object(T.a)(),o=e&&e.documentId?e.documentId:void 0,n=this.sessionsByDocSessionId.get(s);if(n&&!1===n.isClosed)throw new Error("docSessionId already exists");let i=e&&null!==(t=e.serviceUrl)&&void 0!==t?t:this.defaultServiceUrl;i=d.b.convertServiceUrlToWebSocket(i),i||((e=e||{}).networkMode=b.a.LocalWorkflowsOnly),!this.networkMode||e&&e.networkMode||((e=e||{}).networkMode=this.networkMode),e&&e.networkMode===b.a.HttpFallback&&(e.networkMode=this.settings.httpFallbackEnabled&&this.settings.improvedWebSocketEnabled?b.a.HttpFallback:b.a.JSWebSockets);const r=Object.assign({},this.clientMetadata);r.docSessionId=s,o&&(r.documentId=o),e&&e.flights&&(r.flights=r.flights?r.flights+";"+e.flights:e.flights);const a=this.sessionFactory({hostCallbacks:this.hostCallbacks,sessionManager:this.sessionManagerFactory(r,i,e,this.networkRateSettings),batchOptions:this.batchOptions,extensionConfigs:(null==e?void 0:e.extensionConfigs)||[],clientMetadata:r,userContext:e?e.userContext:void 0,localWorkflowManager:e&&e.enableComplexLocalWorkflows?void 0:this.localWorkflowManager,annotationResultsProcessor:this.annotationResultsProcessor,localRegisteredWorkflows:(null==e?void 0:e.localRegisteredWorkflows)||[],enableRemoteExecutionNotification:(null==e?void 0:e.enableRemoteExecutionNotification)||!1,networkMode:null==e?void 0:e.networkMode,egress:e?e.egress:void 0,isDeltaGeneratorEnabled:this.isDeltaGeneratorEnabled,onAnnotationsSubmittedEnabled:this.settings.onAnnotationsSubmittedEnabled,disableSyncDeltaSending:this.disableSyncDeltaSending,syncDeltaTimeout:this.syncDeltaTimeout,reduceBatchOperationsEnabled:this.settings.reduceBatchOperationsEnabled,batchMessagesEnabled:this.settings.batchMessagesEnabled,reduceBatchedMessageOperationsEnabled:this.settings.reduceBatchedMessageOperationsEnabled});return this.sessionsByDocSessionId.set(s,a),e&&e.onSessionConnect&&a.setConnectCallback(e.onSessionConnect),e&&e.onSessionDisconnect&&a.setDisconnectCallback(e.onSessionDisconnect),e&&e.onSessionReconnect&&a.setReconnectCallback(e.onSessionReconnect),e&&e.onSessionClose&&a.setSessionCloseCallback(e.onSessionClose),e&&e.onServerAuthenticationStateChangeCallback&&a.setServerAuthenticationStateChangeCallback(e.onServerAuthenticationStateChangeCallback),a.initialize?a.initialize():Promise.resolve(a)}getSessionManagerFactory(){return this.sessionManagerFactory}shouldAddLogger(e){if(S.haveCalledInit){const t=new Error("Runtime already initialized");return e.dimension3=t.stack,e.dimension2=Object(i.c)(o.a.info).toString(),this.logOperation(e,!1,"Error",t.message),!1}return!0}createDefaultSessionManagerFactory(){return(e,t,s)=>{if(s&&s.enableComplexLocalWorkflows)throw new Error("NYI");if(s&&s.networkMode==b.a.LocalWorkflowsOnly)return new y.a;const o=new g.a,n=new h.a;let r=()=>{i.a.error(573321615,i.b.CoreDefault,"Unexpectedly not set sendMessage")};const a=new p.a(()=>n,e,o,(e,t,s)=>{r(e,t,s)},{getAuthToken:this.getAuthToken.bind(this,e.docSessionId),overrideSessionInitMessage:this.hostCallbacks.overrideSessionInitMessage,enableRemoteExecutionNotification:(null==s?void 0:s.enableRemoteExecutionNotification)||!1}),c=new l.a(d.b.convertServiceUrlToWebSocket(t),n,this.workerFactory,a,e,o,this.settings,null==s?void 0:s.networkMode,this.networkRateSettings);return r=c.sendMessage.bind(c),c.on("disconnect",()=>o.clearRefreshTimeouts()),c.on("connect",(e,t,s,o)=>{e&&this.hostCallbacks.setSessionData&&this.hostCallbacks.setSessionData(t,s,o)}),c}}getAuthToken(e){const t={Tickets:[],TokenType:r.a.Augloop};return e&&(t.DocSessionId=e),this.hostCallbacks.requestAuthToken(t).then(e=>{if(e)return e.Token}).catch(()=>{})}isFeatureEnabled(e,t=!1,s="None"){return d.b.isFeatureEnabled(this.hostCallbacks,e,t,s)}logOperation(e,t,s,o){e.stop(),e.success=t,e.resultSignature=s,e.resultDescription=o,i.a.info(573321622,i.b.CoreDefault,e)}addLoggingAggregator(e){var t,s,o,n;i.a.addAggregator(Object(a.b)("Operation","operationName",["ExecuteBatch","ReduceBatchOperations","ReduceBatchedMessageOperations","ProcessResponse","LocalDeltaUpdate","ApplyFormattedTextTileDeltaForLocalWorkflows","ApplyTextTileDeltaForLocalWorkflows","FindRangeForDelta","RunModelForInferencing","GetResource","CreateTextTileDeltaFromItem","NetworkEgressControl","HttpEgress","NetworkRateControllerIngress","NetworkRateControllerEgress","NetworkRateControllerFlush","LongPollNoOp","NetworkRateControllerAbandonedSyncMessage","DynamicNetworkRateControllerAbandonedSyncMessage"],null!==(t=e.telemetryAggregationIntervalSec)&&void 0!==t?t:30)),i.a.addAggregator(Object(a.b)("Operation","operationName",["ExecuteWorkflow","ExecuteLambda","EarlyJoinCompletion","OnLongPollMessage","OnAnnotationResultsEgress"],null!==(s=e.telemetryAggregationIntervalSec)&&void 0!==s?s:60)),i.a.addAggregator(Object(a.b)("Operation","operationName",["LocalScopeExecutionNotification","RunLocalWorkflows","EarlyJoinCompletion","SetAnnotations","WIS.addItemOnContextIdList","WIS.setScopeItem"],null!==(o=e.telemetryAggregationIntervalSec)&&void 0!==o?o:120)),i.a.addAggregator(Object(a.b)("SessionHealth","sessionHealthEventName",["SendMessage","ProcessMessage"],null!==(n=e.telemetryAggregationIntervalSec)&&void 0!==n?n:60))}uninitialize(){this.flushTelemetry(!0),this.hostCallbacks=null,this.hasBeenInitialized=!1,S.haveCalledInit=!1,i.a.clearAggregators(),i.a.clearLoggers()}}const C=new S},39475:function(e){e.exports=JSON.parse('{"version":"2.35.454"}')},39476:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var o;!function(e){e[e.JSWebSockets=0]="JSWebSockets",e[e.LocalWorkflowsOnly=1]="LocalWorkflowsOnly",e[e.HostWebSockets=2]="HostWebSockets",e[e.HttpFallback=3]="HttpFallback"}(o||(o={}))},39477:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var o=s(39478),n=s(39482),i=s(39480),r=s(21015),a=s(39464),c=s(39467);const l=JSON.stringify(new o.w({error:i.c}));class u{constructor(){this.isClosing=!1,this.pendingEgress=[]}init(e,t,s,o,i,r){const l=new a.a({operationName:"HttpWorkerInit",success:!0}).start();this.url=n.b.convertWebSocketUrlToHttp(e),this.ingress=t,this.onOpen=s,this.onClose=o,this.jsond2ContentTypeEnabled=null==r||r,c.a.info(507839180,c.b.CoreDefault,l.stop())}egress(e){const t=new a.a({operationName:"HttpEgress",success:!0}).start();if(!this.isConnectedToSession()&&!e.isHttpSessionInitMessage)return this.pendingEgress.push(e),t.success=!1,t.resultDescription="NotConnected, pendingQueueSize:  "+this.pendingEgress.length.toString(),void c.a.info(508163394,c.b.CoreDefault,t.stop());const s=this.getRequestInfo(e,t);if(!s.url)return t.success=!1,t.resultDescription="Could not generate HTTP request",void c.a.error(508163393,c.b.CoreDefault,t.stop());e.isHttpSessionLongPollMessage?this.egressLongPoll(s,t):Object(i.b)(s.url,s.request,(e,s)=>{e?this.onEgressError(t,"OnEgressError:"+(null==e?void 0:e.message)):s&&s.ok?s.text().then(e=>{t.success=!0,c.a.info(508163362,c.b.CoreDefault,t.stop()),this.ingressInternal(e)}).catch(e=>{this.onEgressError(t,"OnEgressParseError: "+(null==e?void 0:e.message))}):this.onEgressError(t,"OnEgressResponseError: "+(null==e?void 0:e.message)+`, Status ${null==s?void 0:s.status}: ${null==s?void 0:s.statusText}`)})}close(){const e=new a.a({operationName:"HttpWorkerClose",success:!0}).start();if(this.isClosing)return e.resultDescription="AlreadyClosing",void c.a.info(508163360,c.b.CoreDefault,e.stop());c.a.info(508163359,c.b.CoreDefault,e.stop()),this.isClosing=!0,this.sessionSettings=void 0,this.onClose&&(this.onClose(void 0),this.onClose=void 0),this.isClosing=!1}onEgressError(e,t){e.success=!1,e.resultDescription=t,c.a.error(508163358,c.b.CoreDefault,e.stop()),this.close()}ingressInternal(e,t){let s=e;t||(s=this.formatServerInput(e));const n=e=>{o.u.typeGuard(e)&&this.onSessionInitResponse(e)};s&&(this.logIngressCount(s),this.ingress(s,n))}onSessionInitResponse(e){const t=new a.a({operationName:"HttpWorkerOpen",success:!0}).start();if(!(e.sessionKey&&e.origin&&e.anonymousToken&&e.sessionUrlBase))return t.success=!1,t.resultDescription="SessionInitResponse missing information",void c.a.error(507809949,c.b.CoreDefault,t.stop());c.a.info(508163357,c.b.CoreDefault,t.stop()),this.setSessionSettings(e.sessionKey,e.origin,e.anonymousToken,e.sessionUrlBase),this.onOpen(),this.pendingEgress.forEach(e=>{this.egress(e)}),this.pendingEgress=[]}egressLongPoll(e,t){Object(i.a)(e.url,2e4,e.request).then(e=>{e&&e.ok?e.text().then(e=>{t.success=!0,t.resourceId="LongPoll",c.a.info(508163355,c.b.CoreDefault,t.stop()),this.ingressInternal(e)}).catch(e=>{this.onEgressError(t,"LongPollFetchParseError: "+(null==e?void 0:e.message))}):this.onEgressError(t,"LongPollFetchStatusFailure: "+(null==e?void 0:e.statusText))}).catch(e=>{e.message===i.c?(t.success=!1,t.resultDescription="LongPollFetchResponseTimeout:"+(null==e?void 0:e.message),c.a.error(508163353,c.b.CoreDefault,t.stop()),this.ingressInternal(l,!0)):this.onEgressError(t,"LongPollFetchResponseError: "+(null==e?void 0:e.message))})}getRequestInfo(e,t){const s=this.getUrl(null==e?void 0:e.isHttpSessionInitMessage),o=this.getHeader(e,t);return t.resultSignature=s,{url:s,request:{method:"POST",headers:o,body:e.obj}}}getUrl(e){const t=this.sessionSettings&&this.sessionSettings.sliceUrl?this.sessionSettings.sliceUrl:this.url;return e?t+"/sessioninit":this.isConnectedToSession()?t+"/session/"+this.sessionSettings.sessionKey:""}getHeader(e,t){if(null==e?void 0:e.isHttpSessionInitMessage)return new r.Headers({"Content-Type":"application/json"});if(this.isConnectedToSession()){let s;return this.jsond2ContentTypeEnabled&&(e.obj instanceof Uint8Array||e.obj instanceof ArrayBuffer)?(s=new r.Headers({"Content-Type":"application/jsond2"}),t.dimension0=e.obj.byteLength.toString().length.toString()):s=new r.Headers({"Content-Type":"application/json"}),s.append("Authorization","Bearer "+this.sessionSettings.anonymousToken),s.set("x-origin",this.sessionSettings.origin),s}return new r.Headers}setSessionSettings(e,t,s,o){const n=o.replace("/session","");this.sessionSettings={sessionKey:e,origin:t,anonymousToken:s,sliceUrl:n}}isConnectedToSession(){return this.sessionSettings&&this.sessionSettings.sessionKey.length>0&&this.sessionSettings.anonymousToken.length>0&&this.sessionSettings.origin.length>0&&this.sessionSettings.sliceUrl.length>0}formatServerInput(e){return e.length>1?e.substring(1,e.length-1):""}logIngressCount(e){const t=e.length;if(t>1e5){const e=new a.a({operationName:"HttpIngressByteOrderOfMagnitude",success:!0}).start();e.dimension2=t.toString().length.toString(),c.a.info(508409622,c.b.CoreDefault,e.stop())}}}},39478:function(e,t,s){"use strict";s.d(t,"n",(function(){return i})),s.d(t,"k",(function(){return r})),s.d(t,"B",(function(){return a})),s.d(t,"t",(function(){return l})),s.d(t,"u",(function(){return u})),s.d(t,"v",(function(){return d})),s.d(t,"w",(function(){return h})),s.d(t,"q",(function(){return p})),s.d(t,"p",(function(){return f})),s.d(t,"j",(function(){return m})),s.d(t,"a",(function(){return b})),s.d(t,"b",(function(){return T})),s.d(t,"f",(function(){return w})),s.d(t,"d",(function(){return v})),s.d(t,"e",(function(){return k})),s.d(t,"c",(function(){return S})),s.d(t,"h",(function(){return _})),s.d(t,"z",(function(){return I})),s.d(t,"m",(function(){return A})),s.d(t,"A",(function(){return M})),s.d(t,"g",(function(){return E})),s.d(t,"C",(function(){return D})),s.d(t,"l",(function(){return B})),s.d(t,"E",(function(){return P})),s.d(t,"D",(function(){return R})),s.d(t,"i",(function(){return j})),s.d(t,"r",(function(){return G})),s.d(t,"s",(function(){return H})),s.d(t,"x",(function(){return $})),s.d(t,"y",(function(){return z})),s.d(t,"o",(function(){return V}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Message"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Response"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(e){o.a.assign(r,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_ErrorResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[r.getTypeName()])}}r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()};class a{constructor(e){o.a.assign(a,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_TimeoutErrorResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class c{constructor(e){o.a.assign(c,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_RateLimitErrorResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_ErrorResponse","AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[c.getTypeName()])}}c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};class l{constructor(e){o.a.assign(l,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionInitMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[l.getTypeName()])}}l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};class u{constructor(e){o.a.assign(u,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionInitResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[u.getTypeName()])}}u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};class d{constructor(e){o.a.assign(d,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionLongPollMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[d.getTypeName()])}}d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};class h{constructor(e){o.a.assign(h,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionLongPollResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[h.getTypeName()])}}h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};class p{constructor(e){o.a.assign(p,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionCloseReason"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[p.getTypeName()])}}p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};class g{constructor(e){o.a.assign(g,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionSwapOnClose"}static getBaseTypes(){return["AugLoop_Session_Protocol_SessionCloseReason"]}static typeGuard(e){return o.a.matchesTypesFor(e,[g.getTypeName()])}}g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};class f{constructor(e){o.a.assign(f,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionCloseMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[f.getTypeName()])}}f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};class m{constructor(e){o.a.assign(m,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_CacheDumpRequestMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[m.getTypeName()])}}m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};class y{constructor(e){o.a.assign(y,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_CacheDumpRequestResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[y.getTypeName()])}}y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};class b{constructor(e){o.a.assign(b,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationActivationMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[b.getTypeName()])}}b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()};class T{constructor(e){o.a.assign(T,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationActivationResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[T.getTypeName()])}}T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()};class w{constructor(e){o.a.assign(w,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationResultStateMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[w.getTypeName()])}}w.H_={T_:w.getTypeName(),B_:w.getBaseTypes()};class v{constructor(e){o.a.assign(v,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationReleaseMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[v.getTypeName()])}}v.H_={T_:v.getTypeName(),B_:v.getBaseTypes()};class k{constructor(e){o.a.assign(k,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationReleaseResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[k.getTypeName()])}}k.H_={T_:k.getTypeName(),B_:k.getBaseTypes()};class S{constructor(e){o.a.assign(S,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[S.getTypeName()])}}S.H_={T_:S.getTypeName(),B_:S.getBaseTypes()};class C{constructor(e){o.a.assign(C,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationConfigUpdateResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[C.getTypeName()])}}C.H_={T_:C.getTypeName(),B_:C.getBaseTypes()};class _{constructor(e){o.a.assign(_,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_BatchedMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[_.getTypeName()])}}_.H_={T_:_.getTypeName(),B_:_.getBaseTypes()};class I{constructor(e){o.a.assign(I,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SyncMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[I.getTypeName()])}}I.H_={T_:I.getTypeName(),B_:I.getBaseTypes()};class A{constructor(e){o.a.assign(A,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_MicroSyncMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[A.getTypeName()])}}A.H_={T_:A.getTypeName(),B_:A.getBaseTypes()};class M{constructor(e){o.a.assign(M,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SyncResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[M.getTypeName()])}}M.H_={T_:M.getTypeName(),B_:M.getBaseTypes()};class x{constructor(e){o.a.assign(x,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionDeleteMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[x.getTypeName()])}}x.H_={T_:x.getTypeName(),B_:x.getBaseTypes()};class E{constructor(e){o.a.assign(E,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_AnnotationResultsMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[E.getTypeName()])}}E.H_={T_:E.getTypeName(),B_:E.getBaseTypes()};class D{constructor(e){o.a.assign(D,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_TokenProvisionMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[D.getTypeName()])}}D.H_={T_:D.getTypeName(),B_:D.getBaseTypes()};class N{constructor(e){o.a.assign(N,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_TokenProvisionResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[N.getTypeName()])}}N.H_={T_:N.getTypeName(),B_:N.getBaseTypes()};class B{constructor(e){o.a.assign(B,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_KeepAlive"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[B.getTypeName()])}}B.H_={T_:B.getTypeName(),B_:B.getBaseTypes()};class P{constructor(e){o.a.assign(P,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_WorkflowGraphInitMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[P.getTypeName()])}}P.H_={T_:P.getTypeName(),B_:P.getBaseTypes()};class O{constructor(e){o.a.assign(O,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_WorkflowGraphInitResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[O.getTypeName()])}}O.H_={T_:O.getTypeName(),B_:O.getBaseTypes()};class R{constructor(e){o.a.assign(R,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_WorkflowExecutionCompleteMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_SyncMessage","AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[R.getTypeName()])}}R.H_={T_:R.getTypeName(),B_:R.getBaseTypes()};class W{constructor(e){o.a.assign(W,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_OAuth2InitV2Message"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[W.getTypeName()])}}W.H_={T_:W.getTypeName(),B_:W.getBaseTypes()};class L{constructor(e){o.a.assign(L,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_OAuth2InitV2Response"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[L.getTypeName()])}}L.H_={T_:L.getTypeName(),B_:L.getBaseTypes()};class F{constructor(e){o.a.assign(F,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_OAuth2InitMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[F.getTypeName()])}}F.H_={T_:F.getTypeName(),B_:F.getBaseTypes()};class q{constructor(e){o.a.assign(q,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_OAuth2InitResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[q.getTypeName()])}}q.H_={T_:q.getTypeName(),B_:q.getBaseTypes()};class U{constructor(e){o.a.assign(U,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_OAuth2CallbackMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[U.getTypeName()])}}U.H_={T_:U.getTypeName(),B_:U.getBaseTypes()};class j{constructor(e){o.a.assign(j,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_BridgeMessage"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[j.getTypeName()])}}j.H_={T_:j.getTypeName(),B_:j.getBaseTypes()};class G{constructor(e){o.a.assign(G,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionConnectMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[G.getTypeName()])}}G.H_={T_:G.getTypeName(),B_:G.getBaseTypes()};class H{constructor(e){o.a.assign(H,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionDisconnectMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[H.getTypeName()])}}H.H_={T_:H.getTypeName(),B_:H.getBaseTypes()};class ${constructor(e){o.a.assign($,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SessionReconnectMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[$.getTypeName()])}}$.H_={T_:$.getTypeName(),B_:$.getBaseTypes()};class z{constructor(e){o.a.assign(z,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_SubmittedCustomMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[z.getTypeName()])}}z.H_={T_:z.getTypeName(),B_:z.getBaseTypes()};class V{constructor(e){o.a.assign(V,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_ServerAuthenticationStateChangeMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[V.getTypeName()])}}V.H_={T_:V.getTypeName(),B_:V.getBaseTypes()}},39479:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{constructor(e){o.assign(o,this,e)}static getTypeName(){return"AugLoop_Core_SchemaObject"}static getBaseTypes(){return[]}static getTypeNameFor(e){return e&&e.H_?e.H_.T_:void 0}static getBaseTypesFor(e){return e&&e.H_&&e.H_.B_?e.H_.B_:[]}static getAllTypesFor(e){const t=o.getTypeNameFor(e);return t?[t,...o.getBaseTypesFor(e)]:[]}static matchesTypesFor(e,t){if(!Array.isArray(t)||0===t.length)return!0;const s=o.getTypeNameFor(e),n=o.getBaseTypesFor(e);for(const o of t){if(o===s)return!0;if(n.indexOf(o)>=0)return!0}return!1}static assign(e,t,s){if(s)for(const o of Object.keys(s))t[o]=s[o];return t.H_=e.H_,t}}o.H_={T_:o.getTypeName(),B_:o.getBaseTypes()}},39480:function(e,t,s){"use strict";s.d(t,"c",(function(){return i})),s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return c}));var o=s(39481),n=s(21015);const i="Request timed out";function r(e,t,s){const o=new n.Request(e,t);return a.add(o,s)}const a=new o.a(n.fetch,2e4,12e4);function c(e,t,s){return new Promise((o,r)=>{const a=setTimeout(()=>{r(new Error(i))},t);Object(n.fetch)(e,s||{}).then(e=>{clearTimeout(a),o(e)}).catch(e=>{clearTimeout(a),r(e)})})}},39481:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{constructor(e,t,s){if(this.requestInProgress=!1,this.queuedRequests=[],null==e)throw new Error("No request.");this.fetch=e,this.fetchTimeout=t,this.queueTimeout=s}tryProcessNextRequest(){if(this.requestInProgress=!1,this.queuedRequests.length>0){const[e,t,s]=this.queuedRequests.shift();clearTimeout(s),this.add(e,t)}}add(e,t){if(this.requestInProgress){const s=setTimeout(()=>{t(new Error("Timed out waiting in queue"),null),this.queuedRequests.shift()},this.queueTimeout);this.queuedRequests.push([e,t,s])}else{this.requestInProgress=!0;new Promise((t,s)=>{let o=!1;const n=setTimeout(()=>{o=!0,s(new Error("Fetch timed out"))},this.fetchTimeout);this.fetch(e).then(e=>{o||(clearTimeout(n),t(e))}).catch(e=>{o||(clearTimeout(n),s(e))})}).then(e=>{t(null,e),this.tryProcessNextRequest()}).catch(e=>{t(e,null),this.tryProcessNextRequest()})}}}},39482:function(e,t,s){"use strict";s.d(t,"b",(function(){return h})),s.d(t,"a",(function(){return p})),s.d(t,"c",(function(){return f})),s.d(t,"d",(function(){return m})),s.d(t,"e",(function(){return y}));var o=s(39467),n=s(39464),i=s(39484),r=s(39479),a=s(39485),c=s(39486),l=s(39487),u=s(39483),d=s.n(u);class h{static createHealthCheckRequest(e){return{payload:{},payloadSchema:{category:i.a.Schema,schema:{name:"HealthCheckRequest"}},requestedSchema:{category:i.a.Schema,schema:{name:"HealthCheckResponse"}},clientMetadata:e}}static isFeatureEnabled(e,t,s=!1,o="None"){return e&&e.isFeatureEnabled?e.isFeatureEnabled("Microsoft.Office.AugLoop."+t,o).catch(()=>Promise.resolve(s)):Promise.resolve(s)}static isChangeGateEnabled(e,t){return e&&e.isChangeGateEnabled?e.isChangeGateEnabled(t):Promise.resolve(!0)}static convertWebSocketUrlToHttp(e){return this.convertUrl(e,!1)}static convertServiceUrlToWebSocket(e){return this.convertUrl(e,!0)}static convertUrl(e,t){if(!e)return e;const s=e.split(":");let o=s[0].toLowerCase();return 0==o.indexOf(t?"http":"ws")?(o=t?o.replace("http","ws"):o.replace("ws","http"),s[0]=o,s.join(":")):e}static deepEquals(e,t){return d()(e,t)}static collectTelemetry(e,t,s,n,i,r){var a,c,l,u;e.start(),e.resultSignature=null!=n?n:"",e.resultDescription=null!=i?i:"",e.success=s,r?(e.dimension0=null!==(a=r[0])&&void 0!==a?a:"",e.dimension1=null!==(c=r[1])&&void 0!==c?c:"",e.dimension2=null!==(l=r[2])&&void 0!==l?l:"",e.dimension3=null!==(u=r[3])&&void 0!==u?u:""):(e.dimension0="",e.dimension1="",e.dimension2="",e.dimension3=""),t.log(()=>o.a.info(508367457,o.b.CoreDefault,e.stop()))}}h.getCurrentTimeMs=()=>Date.now?Date.now():(new Date).getTime();class p{constructor(e){this.maxNumberOfLogs=40,this.numberOfLogs=0,this.id=e}log(e){if(this.numberOfLogs<this.maxNumberOfLogs&&(this.numberOfLogs++,e(),this.numberOfLogs===this.maxNumberOfLogs)){const e=new n.a({operationName:"OnLastLog",success:!0,resourceId:this.id,resultDescription:`Limit for number of logs for id: ${this.id} reached - all next logs will be dropped`});o.a.warn(572838107,o.b.CoreDefault,e)}}}const g=[r.a.getTypeName(),a.a.getTypeName(),c.a.getTypeName()],f=e=>{const t=new Set;for(const s of e)if("string"==typeof s)-1===g.indexOf(s)&&t.add(s);else for(const e of[s.getTypeName(),...s.getBaseTypes()])-1===g.indexOf(e)&&t.add(e);return Array.from(t)},m=(e,t=0)=>Number.isFinite(e)?e:t,y=(e,t)=>{if(!Array.isArray(t)||0===t.length)return!0;if(l.c.typeGuard(e)||l.f.typeGuard(e))return!0;for(const s of e.items)if(!s.body||r.a.matchesTypesFor(s.body,t))return!0;return!1}},39483:function(e,t,s){"use strict";e.exports=function e(t,s){if(t===s)return!0;if(t&&s&&"object"==typeof t&&"object"==typeof s){if(t.constructor!==s.constructor)return!1;var o,n,i;if(Array.isArray(t)){if((o=t.length)!=s.length)return!1;for(n=o;0!=n--;)if(!e(t[n],s[n]))return!1;return!0}if(t.constructor===RegExp)return t.source===s.source&&t.flags===s.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===s.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===s.toString();if((o=(i=Object.keys(t)).length)!==Object.keys(s).length)return!1;for(n=o;0!=n--;)if(!Object.prototype.hasOwnProperty.call(s,i[n]))return!1;for(n=o;0!=n--;){var r=i[n];if(!e(t[r],s[r]))return!1}return!0}return t!=t&&s!=s}},39484:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.Undefined=0]="Undefined",e[e.Schema=1]="Schema",e[e.Boolean=2]="Boolean",e[e.Number=3]="Number",e[e.String=4]="String",e[e.Buffer=5]="Buffer",e[e.Function=6]="Function"}(o||(o={}))},39485:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_Core_Annotation"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_Core_BinaryClassificationAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()}},39486:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Signals_Signal"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Core_DirtyAreaSignal"}static getBaseTypes(){return["AugLoop_Signals_Signal"]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()}},39487:function(e,t,s){"use strict";s.d(t,"d",(function(){return r})),s.d(t,"a",(function(){return c})),s.d(t,"f",(function(){return u})),s.d(t,"g",(function(){return d})),s.d(t,"b",(function(){return h})),s.d(t,"c",(function(){return y})),s.d(t,"e",(function(){return T}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Core_ItemDelta"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Core_ItemChangesDelta"}static getBaseTypes(){return["AugLoop_Core_ItemDelta"]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(e){o.a.assign(r,this,e)}static getTypeName(){return"AugLoop_Core_Operation"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[r.getTypeName()])}}r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()};class a{constructor(e){o.a.assign(a,this,e)}static getTypeName(){return"AugLoop_Core_OperationWithSiblingContext"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class c{constructor(e){o.a.assign(c,this,e)}static getTypeName(){return"AugLoop_Core_AddOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[c.getTypeName()])}}c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};class l{constructor(e){o.a.assign(l,this,e)}static getTypeName(){return"AugLoop_Core_MoveOperation"}static getBaseTypes(){return["AugLoop_Core_OperationWithSiblingContext","AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[l.getTypeName()])}}l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};class u{constructor(e){o.a.assign(u,this,e)}static getTypeName(){return"AugLoop_Core_UpdateAnnotationMetaDataOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[u.getTypeName()])}}u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};class d{constructor(e){o.a.assign(d,this,e)}static getTypeName(){return"AugLoop_Core_UpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[d.getTypeName()])}}d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};class h{constructor(e){o.a.assign(h,this,e)}static getTypeName(){return"AugLoop_Core_DeleteOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[h.getTypeName()])}}h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};class p{constructor(e){o.a.assign(p,this,e)}static getTypeName(){return"AugLoop_Core_PurgeOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[p.getTypeName()])}}p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};class g{constructor(e){o.a.assign(g,this,e)}static getTypeName(){return"AugLoop_Core_PurgeSubtreeOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[g.getTypeName()])}}g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};class f{constructor(e){o.a.assign(f,this,e)}static getTypeName(){return"AugLoop_Core_FocusOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[f.getTypeName()])}}f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};class m{constructor(e){o.a.assign(m,this,e)}static getTypeName(){return"AugLoop_Core_VisibilityOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[m.getTypeName()])}}m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};class y{constructor(e){o.a.assign(y,this,e)}static getTypeName(){return"AugLoop_Core_DeltaUpdateOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[y.getTypeName()])}}y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};class b{constructor(e){o.a.assign(b,this,e)}static getTypeName(){return"AugLoop_Core_MicroSyncOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[b.getTypeName()])}}b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()};class T{constructor(e){o.a.assign(T,this,e)}static getTypeName(){return"AugLoop_Signals_SignalOperation"}static getBaseTypes(){return["AugLoop_Core_Operation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[T.getTypeName()])}}T.H_={T_:T.getTypeName(),B_:T.getBaseTypes()}},39488:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var o=s(39489),n=s.n(o),i=s(39464),r=s(39467),a=s(39482);class c{constructor(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.egressMessageCount=0,this.egressByteCount=0,this.isClosing=!1,this.pendingEgress=[]}init(e,t,s,o,a){this.ws=new n.a(e),this.logOp=new i.a({operationName:c.className,success:!0}).start(),this.egressTimer=Date.now(),this.egressMessageCountOp=new i.a({operationName:"WSEgressMessageCount",success:!0}),this.egressByteCountOp=new i.a({operationName:"WSEgressByteOrderOfMagnitude",success:!0}),this.ingressByteCountOp=new i.a({operationName:"WSIngressByteOrderOfMagnitude",success:!0}),this.improvedWebSocketEnabled=a;const l=e=>{this.logPingLatencyOp&&(this.logPingLatencyOp.success=e,r.a.info(508843802,r.b.CoreDefault,this.logPingLatencyOp.stop()),this.logPingLatencyOp=void 0)};this.ws.addEventListener("open",e=>{s(),c.logCountLimiter.log(()=>{this.logOp.resourceId="OnOpen",this.logOp.resultDescription="",this.logOp.success=!0,this.logOp.dimension0=this.pendingEgress.length.toString(),r.a.info(508843801,r.b.CoreDefault,this.logOp.stop())}),this.improvedWebSocketEnabled||(this.hasBeenOpened=!0,this.pendingEgress.forEach(e=>{this.egress({obj:e})}),this.pendingEgress=[],this.pingInterval=setInterval(()=>{this.logPingLatencyOp&&(--this.remainingPingFailures,l(!1)),this.remainingPingFailures>0&&this.hasBeenOpened&&this.lastPongTime<this.lastEgressTime&&(this.logPingLatencyOp=new i.a({operationName:"Ping",success:!0,dimension0:this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString().length.toString():void 0}).start(),this.ws.send(c.pingPongMessage,e=>{e&&(--this.remainingPingFailures,l(!1))}))},3e4))}),this.ws.addEventListener("message",e=>{!this.improvedWebSocketEnabled&&this.logPingLatencyOp&&"string"==typeof e.data&&1===e.data.length&&e.data[0]===c.pingPongMessage?(l(!0),this.lastPongTime=Date.now()):(this.logIngressCount(e.data),t(e.data))}),this.ws.addEventListener("error",e=>{this.errorMessage=e.message,c.logCountLimiter.log(()=>{this.logOp.resourceId="OnError",this.logOp.resultDescription=this.errorMessage,this.logOp.success=!1,r.a.info(508843800,r.b.CoreDefault,this.logOp.stop())}),this.ws.close()}),this.ws.addEventListener("close",e=>{c.logCountLimiter.log(()=>{this.logOp.resourceId="OnClose",this.logOp.resultDescription=e?`code: ${e.code}. reason: ${e.reason}`:"",this.logOp.success=!0,r.a.info(508843799,r.b.CoreDefault,this.logOp.stop())}),!this.improvedWebSocketEnabled&&this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),o(this.errorMessage),this.isClosing=!1})}egress(e){const t=e.obj;this.improvedWebSocketEnabled?this.ws.send(t,e=>{e&&!this.hadEgressError&&(this.hadEgressError=!0,c.logCountLimiter.log(()=>{this.logOp.resourceId="OnEgressError",this.logOp.resultDescription=e.message,this.logOp.success=!1,r.a.info(508843797,r.b.CoreDefault,this.logOp.stop())}))}):(this.logEgressCount(t instanceof ArrayBuffer||t instanceof Uint8Array?t.byteLength:t.length),this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,e=>{e&&!this.hadEgressError&&(this.hadEgressError=!0,c.logCountLimiter.log(()=>{this.logOp.resourceId="OnFirstEgressError",this.logOp.resultDescription=e.message,this.logOp.success=!1,r.a.info(508843798,r.b.CoreDefault,this.logOp.stop())}))}):this.pendingEgress.push(t))}close(){this.isClosing||(this.isClosing=!0,!this.improvedWebSocketEnabled&&this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close())}logEgressCount(e){const t=Date.now(),s=t-this.egressTimer;s>1e3&&(this.egressMessageCount>50&&(this.egressMessageCountOp.start(),this.egressMessageCountOp.resultDescription="Egress message count: "+this.egressMessageCount.toString()+", Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+s.toString(),r.a.info(508843796,r.b.CoreDefault,this.egressMessageCountOp.stop())),this.egressByteCount>1e5&&(this.egressByteCountOp.start(),this.egressByteCountOp.dimension2=this.egressByteCount.toString().length.toString(),this.egressMessageCountOp.resultDescription="Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+s.toString(),r.a.info(508843795,r.b.CoreDefault,this.egressByteCountOp.stop())),this.egressTimer=t,this.egressMessageCount=0,this.egressByteCount=0),this.egressMessageCount++,this.egressByteCount+=null!=e?e:0}logIngressCount(e){const t=e.length;t>1e5&&(this.ingressByteCountOp.start(),this.ingressByteCountOp.dimension2=t.toString().length.toString(),r.a.info(508843794,r.b.CoreDefault,this.ingressByteCountOp.stop()))}}c.className="WebSocketWorker",c.logCountLimiter=new a.a(c.className),c.pingPongMessage="~"},39489:function(e,t,s){(function(t){var s=null;"undefined"!=typeof WebSocket?s=WebSocket:"undefined"!=typeof MozWebSocket?s=MozWebSocket:void 0!==t?s=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?s=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(s=self.WebSocket||self.MozWebSocket),e.exports=s}).call(this,s(10702))},39490:function(e,t,s){"use strict";s.d(t,"a",(function(){return W})),s.d(t,"b",(function(){return L})),s.d(t,"c",(function(){return U}));var o=s(39460),n=s(39478),i=s(39503),r=s(39500),a=s(39476),c=s(39487),l=s(39502),u=s(39479),d=s(39485),h=s(39492),p=s(21015),g=s(39501),f=s(39504),m=s(39491),y=s(39494),b=s(39482),T=s(39517),w=s(39467),v=s(39464),k=s(39520),S=s(39507),C=s(39506),_=s(39493),I=s(39495),A=s(39497),M=s(39499),x=s(39496),E=s(39498),D=s(39508),N=s(39513),B=s(39509),P=s(39514),O=s(39515),R=s(39516);var W,L;!function(e){e[e.LocalWorkflow=0]="LocalWorkflow",e[e.ServerWorkflow=1]="ServerWorkflow",e[e.Submitted=2]="Submitted"}(W||(W={})),function(e){e[e.Internal=0]="Internal",e[e.External=1]="External"}(L||(L={}));const F=(e,t)=>{t?(e.resultDescription=t,e.success=!1,w.a.error(509203144,w.b.CoreDefault,e.stop())):w.a.info(509203143,w.b.CoreDefault,e.stop())},q=e=>!e.items.some(e=>e.source&&0===e.source.indexOf("ThirdParty"));class U{constructor(e){var t;this.annotationActivationTrackers=new Map,this.annotationCallbacks=new Map,this.annotationResultStates=new Map,this.tokensByAnnotationType=new Map,this.registeredContextTypes=new Set,this.availableContexts=new Map,this.nextSyncSequenceId=1,this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.batchedSeedMessageGroupSize=0,this.hasSessionConnected=!1,this.isSessionClosed=!1,this.serverAuthenticationState=o.a.NotAuthenticated,this.sessionCloseCallbacks=new Map,this.connectCallbacks=new Map,this.reconnectCallbacks=new Map,this.disconnectCallbacks=new Map,this.sessionStateCallbackToken=0,this.workflowGraph=new _.b,this.workflowDefinitionManager=new I.a,this.contextIdManager=new A.a(E.a.JsClient,this.workflowGraph),this.workflowItemStorage=new M.a(this.workflowDefinitionManager),this.pendingConnectCallbacks=[],this.onAnnotationsSubmittedEnabled=!1,this.reduceBatchOperationsEnabled=!1,this.batchMessagesEnabled=!1,this.reduceBatchedMessageOperationsEnabled=!1,this.hostCallbacks=e.hostCallbacks,this.sessionManager=e.sessionManager,this.batchMessagesEnabled=e.batchMessagesEnabled||!1,this.reduceBatchedMessageOperationsEnabled=e.reduceBatchedMessageOperationsEnabled||!1,this.operationBatchConfig=e.batchOptions?this.getOperationBatchConfig(e.batchOptions):void 0,this.extensionConfigs=e.extensionConfigs,this.clientMetadata=e.clientMetadata,this.userContext=e.userContext,this.localWorkflowManager=e.localWorkflowManager,this.annotationResultsProcessor=e.annotationResultsProcessor,e.workflowRuntimeFactory&&(this.workflowRuntime=e.workflowRuntimeFactory(this.sessionManager)),this.localRegisteredWorkflows=e.localRegisteredWorkflows||[],this.enableRemoteExecutionNotification=e.enableRemoteExecutionNotification||!1,this.networkMode=e.networkMode,this.egress=e.egress,this.serverAuthenticationStateChangeCallback=[],this.onAnnotationsSubmittedEnabled=e.onAnnotationsSubmittedEnabled||!1,this.reduceBatchOperationsEnabled=e.reduceBatchOperationsEnabled||!1,this.sessionManager.on("sessionClose",this.onSessionClose.bind(this)),this.sessionManager.on("reconnect",this.onReconnect.bind(this)),this.sessionManager.on("connect",this.onConnect.bind(this)),this.sessionManager.on("disconnect",this.onDisconnect.bind(this)),this.sessionManager.on("resetNextSyncSequenceId",this.resetNextSyncSequenceId.bind(this)),this.sessionManager.on("serverAuthenticationStateChange",this.onServerAuthenticationStateChange.bind(this)),this.sessionManager.onMessage(n.g.getTypeName(),this.workflowRuntime?this.onAnnotationResultsFromLocal.bind(this):this.onAnnotationResultsFromServer.bind(this)),this.sessionManager.onMessage(n.f.getTypeName(),this.onAnnotationResultStateMessage.bind(this)),this.sessionManager.onMessage(n.D.getTypeName(),this.onWorkflowExecutionCompleteMessage.bind(this)),e.isDeltaGeneratorEnabled&&(this.enableSyncDeltaSending=!e.disableSyncDeltaSending,this.syncDeltaTimeout=null!==(t=e.syncDeltaTimeout)&&void 0!==t?t:700,this.enableDeltaGenerator()),this.setServerAuthenticationStateChangeCallback(this.updateGraphOnAuthStateChange.bind(this))}tryGetDocSessionId(){if(this.clientMetadata&&this.clientMetadata.docSessionId)return this.clientMetadata.docSessionId}getSessionStateCallbackToken(e){var t;return e+"-callback-"+(null!==(t=this.tryGetDocSessionId())&&void 0!==t?t:"unknown")+"-"+this.sessionStateCallbackToken++}updateGraphOnAuthStateChange(e){this.tryActivateWorkflows()}tryActivateWorkflows(){if(this.enableRemoteExecutionNotification){const e=new v.a({operationName:"GraphServerWorkflowActivation",success:!0}).setClientMetadata(this.clientMetadata).start(),t=[];this.workflowGraph.getWorkflowNodes().filter(e=>e.location===_.a.External).forEach(e=>{this.localWorkflowManager.canActivateWorkflow(e,this)?e.isActivated=!0:(this.localWorkflowManager.deactivateServerWorkflow(e,this),t.push(e.workflow.id))}),e.resultDescription=`deactivated workflows: [${t.join()}]`,w.a.info(508879493,w.b.CoreDefault,e.stop())}}initialize(){return this.localWorkflowManager&&this.localWorkflowManager.addSession(this),this.registerLocalWorkflowsWithoutGraphInit(this.localRegisteredWorkflows),this.sessionManager.init(this.extensionConfigs,this.hostCallbacks.onInitSession?this.hostCallbacks.onInitSession:void 0,this.egress).then(()=>(this.localWorkflowManager&&this.localWorkflowManager.setTokenCallback(this.getAuthToken.bind(this)),this))}isLocalWorkflowRegistered(e){return this.getLocalRegisteredWorkflows().some(t=>e===t.id)}get isConnected(){return!!this.connectParams}get hasConnected(){return this.hasSessionConnected}get isClosed(){return this.isSessionClosed}getServerAuthenticationState(){return this.serverAuthenticationState}getContextIdManager(){return this.contextIdManager}getWorkflowItemStorage(){return this.workflowItemStorage}getWorkflowDefinition(e,t){return this.workflowDefinitionManager.getWorkflowDefinition(e,t)}registerLocalWorkflows(e){this.registerLocalWorkflowsWithoutGraphInit(e),this.trySendWorkflowGraphInitMessage()}registerLocalWorkflowsWithoutGraphInit(e){if(e.length){if(this.workflowRuntime)for(const t of e)this.workflowRuntime.registerWorkflow(t),this.sendMessageToSession(new r.b({workflowDefinition:t}));if(this.localWorkflowManager)for(const t of e)this.localWorkflowManager.registerLocalWorkflow(t,this)}}registerLocalWorkflow(e){this.registerLocalWorkflows([e]);const t=new v.a({operationName:"SessionRegisterLocalWorkflow",resourceId:e.id,success:!0}).setClientMetadata(this.clientMetadata).start();F(t)}activateAnnotation(e,t,s){var o;const n=new g.a(this.sendMessageToSession.bind(this),e,t);if(t&&t.callback){let s=this.annotationCallbacks.get(e);s||(s=new Map,this.annotationCallbacks.set(e,s)),s.set(n.token,t.callback)}const i=null!==(o=this.tokensByAnnotationType.get(e))&&void 0!==o?o:[];return-1===i.indexOf(n.token)&&i.push(n.token),this.tokensByAnnotationType.set(e,i),this.annotationActivationTrackers.set(n.token,n),this.activateAnnotationForTracker(n,{ignoreExistingAnnotations:!1,sendOnlyIfConnected:!1})}activateAnnotationForTracker(e,t){const s=new v.a({operationName:"ActivateAnnotation",resourceId:e.annotationType,success:!0}).setClientMetadata(this.clientMetadata).start();return e.activate(t.ignoreExistingAnnotations,t.sendOnlyIfConnected).then(o=>(s.resultSignature="Ok",s.resultDescription=`Activated annotation ${e.annotationType} with token ${e.token}; sendOnlyIfConnected: ${t.sendOnlyIfConnected}`,F(s),o)).catch(o=>{throw F(s,`error on activate annotation type ${e.annotationType}: ${o}; sendOnlyIfConnected: ${t.sendOnlyIfConnected}`),o})}updateAnnotationConfig(e,t){const s=new n.c({token:e,config:t});this.sendMessageToSession(s);const o=this.annotationActivationTrackers.get(e);o&&o.options&&(o.options.config=t)}releaseAnnotation(e){const t=this.annotationActivationTrackers.get(e);if(t){this.annotationActivationTrackers.delete(e);const s=this.annotationCallbacks.get(t.annotationType);return s&&(s.delete(e),0==s.size&&this.annotationCallbacks.delete(t.annotationType)),t.release()}return Promise.resolve(!1)}setAnnotationState(e,t,s){const o={state:s};this.submitOperation(new c.f({parentPath:e,items:[{id:t}],M_:o}))}setAnnotationMetadata(e,t,s){this.submitOperation(new c.f({parentPath:e,items:[{id:t}],M_:s}))}submitOperation(e,t){this.submitOperations([e],t)}submitOperations(e,t){if(this.contextIdManager.applyContextIdOnOperations(e),this.updateWorkflowExecutionStates(e),!this.onAnnotationsSubmittedEnabled){const[t,s]=this.partitionAnnotationOperations(e);this.executeCallbacksOnAnnotationSubmitted(t)}const s=e.filter(this.filterOperationsForSession.bind(this)).filter(q);if(this.workflowRuntime){if(this.onAnnotationsSubmittedEnabled){const[e,o]=this.partitionAnnotationOperations(s);this.onAnnotationsSubmitted(e,t),this.submitOperationsToSession(o,t)}else this.submitOperationsToSession(s,t);return}const o=[];if(this.deltaGenerator){const e=new v.a({operationName:"ExecuteDeltaGenerator",success:!0}).setClientMetadata(this.clientMetadata).start();for(const t of s)if(c.g.typeGuard(t))o.push(...this.createDeltasFromUpdateOperation(t));else{const e=t;for(const s of e.items)c.a.typeGuard(t)?this.deltaGenerator.addItemToLocalMap(s,e.parentPath):c.b.typeGuard(t)&&this.deltaGenerator.deleteItemFromLocalMap(s,e.parentPath);o.push(t)}F(e)}if(this.onAnnotationsSubmittedEnabled){const[e,n]=this.partitionAnnotationOperations(o.length?o:s);this.onAnnotationsSubmitted(e,t),this.submitOperationsToSession(n,t)}else this.submitOperationsToSession(o.length?o:s,t);this.localWorkflowManager&&this.localWorkflowManager.runLocalWorkflows(e,this,!0)}submitSeedOperations(e,t){if(!this.allowSeed)throw new Error("Cannot submit seed operations more than once per session");if(this.networkMode===a.a.LocalWorkflowsOnly&&this.localWorkflowManager)return void this.localWorkflowManager.runLocalWorkflows(e,this);this.allowSeed=!1,this.allowGroupSeed=!1;const[s,o]=this.partitionAnnotationOperations(e);this.onAnnotationsSubmittedEnabled?this.onAnnotationsSubmitted(s,t):this.executeCallbacksOnAnnotationSubmitted(s),this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(this.onAnnotationsSubmittedEnabled?o:e,!0,t):this.sendMessageToSession(new n.z({cv:t,seq:0,ops:this.onAnnotationsSubmittedEnabled?o:e}))}submitSeedGroupOperations(e,t,s){if(!this.allowGroupSeed)throw new Error("Seed operations are not allowed for this session");if(this.networkMode===a.a.LocalWorkflowsOnly&&this.localWorkflowManager)return void this.localWorkflowManager.runLocalWorkflows(e,this);t&&(this.allowGroupSeed=!1),this.allowSeed=!1;const[o,i]=this.partitionAnnotationOperations(e);this.executeCallbacksOnAnnotationSubmitted(o),this.onAnnotationsSubmittedEnabled?this.onAnnotationsSubmitted(o,s):this.executeCallbacksOnAnnotationSubmitted(o),this.operationBatchConfig?this.sendSeedMessagesViaBatchManager(this.onAnnotationsSubmittedEnabled?i:e,!!t,s):(this.seedGroupSize++,this.sendMessageToSession(new n.z({cv:s,seq:0,ops:this.onAnnotationsSubmittedEnabled?i:e,groupId:"Seed",groupSize:t?this.seedGroupSize:void 0,groupComplete:t||void 0})))}submitCustomMessage(e){return new Promise((t,s)=>{this.sendMessageToSession(e,(e,o)=>{e?s(new Error(e.error)):t(o)})})}submitLargeBinaryDataMessage(e){return new Promise((t,s)=>{this.sendMessageToSessionPostEndpoint(e,(e,o)=>{e?s(new Error(e.error)):t(o)})})}requestBinaryDataForBlob(e){return e.data?Promise.resolve(e.data):e.dataPointer&&e.dataPointer.refType!==l.a.None?new Promise((t,s)=>{this.requestBinaryDataFromSessionBlobEndpoint(e.dataPointer,(e,o)=>{e?s(e):t(o)})}):Promise.reject(new Error("Blob does not have a data pointer"))}requestCacheDump(e){if(e)throw new Error("NYI");return this.submitCustomMessage(new n.j)}forceReconnect(e){return this.extensionConfigs=e,this.sessionManager.forceReconnect(e)}close(e){this.isSessionClosed=!0,this.sessionManager.closeSession(e),this.workflowRuntime&&this.workflowRuntime.close(),this.localWorkflowManager&&this.localWorkflowManager.closeSession(this),this.graphInitMessageTimer&&(clearTimeout(this.graphInitMessageTimer),this.graphInitMessageTimer=void 0)}getClientMetadata(){return this.clientMetadata}getUserContext(){return this.userContext}setSessionCloseCallback(e){const t=this.getSessionStateCallbackToken("close");return e&&this.sessionCloseCallbacks.set(t,e),t}setConnectCallback(e){const t=this.getSessionStateCallbackToken("connect");return e&&this.connectCallbacks.set(t,e),t}setDisconnectCallback(e){const t=this.getSessionStateCallbackToken("disconnect");return e&&this.disconnectCallbacks.set(t,e),t}setReconnectCallback(e){const t=this.getSessionStateCallbackToken("reconnect");return e&&this.reconnectCallbacks.set(t,e),t}removeSessionStateCallback(e){function t(t){return!!t.has(e)&&(t.delete(e),!0)}return t(this.sessionCloseCallbacks)||t(this.reconnectCallbacks)||t(this.disconnectCallbacks)||t(this.connectCallbacks)}setServerAuthenticationStateChangeCallback(e){this.serverAuthenticationStateChangeCallback.push(e),e(this.serverAuthenticationState)}onAnnotationResults(e,t,s){w.a.info(508916486,w.b.CoreDefault,new v.a({operationName:"OnAnnotationResultsEgress",dimension0:null==e?void 0:e.annotationType,success:!0})),s(void 0,new n.n),t===W.LocalWorkflow&&this.contextIdManager.applyContextIdOnOperations(e.ops),this.updateWorkflowExecutionStates(e.ops),this.egress&&this.egress(e,()=>{}),this.annotationResultsProcessor.process(e,(e,s)=>{this.applyOperationForContext(e,s,t)},t=>{this.triggerRegisteredAnnotationCallbacks(t,e.annotationType)},e=>{if(t!==W.ServerWorkflow){const t=e.ops.filter(this.filterOperationsForSession.bind(this)).filter(q);this.submitOperationsToSession(t,e.cv)}this.localWorkflowManager&&this.localWorkflowManager.runLocalWorkflows(e.ops,this)})}onAnnotationResultStateMessage(e,t){var s;t(void 0,new n.n);for(const o of e.updates){const{annotationType:e,state:t}=o;if(!this.tokensByAnnotationType.has(e))continue;let n;n=this.annotationResultStates.has(e)?this.annotationResultStates.get(e):t===i.a.Idle?i.a.Pending:i.a.Idle;for(const o of this.tokensByAnnotationType.get(e)){const e=this.annotationActivationTrackers.get(o);(null===(s=e.options)||void 0===s?void 0:s.stateUpdateCallback)&&e.options.stateUpdateCallback(n,t)}}}submitOperationsToSession(e,t){const s=e.filter(e=>c.e.typeGuard(e)),o=e.filter(e=>!c.e.typeGuard(e));if(s.length>0&&this.sendMessageToSession(new n.z({cv:t,ops:s})),o.length>0)if(this.operationBatchConfig){if(!this.batchedOperationsManager){let e=void 0;e=this.batchMessagesEnabled?(e,t)=>{if(e.length){const s=new n.h;s.messages=[],e.forEach(e=>{s.messages.push(new n.z({cv:e.cv,seq:this.nextSyncSequenceId++,ops:e.input}))}),this.sendMessageToSession(s,e=>{t(e?new Error(e.error):void 0)})}}:(e,t,s)=>{this.sendMessageToSession(new n.z({cv:t.cv,seq:this.nextSyncSequenceId++,ops:e}),e=>{s(e?new Error(e.error):void 0)})},this.batchedOperationsManager=new f.a(e,this.reduceBatchOperationsEnabled,this.batchMessagesEnabled,this.reduceBatchedMessageOperationsEnabled)}this.batchedOperationsManager.addBatchItem(o,this.operationBatchConfig,{name:"SubmitOperations"},t)}else this.sendMessageToSession(new n.z({cv:t,seq:this.nextSyncSequenceId++,ops:o}))}sendMessageToSession(e,t){this.sessionManager.sendMessage(e,t),n.p.typeGuard(e)&&this.close()}sendMessageToSessionPostEndpoint(e,t){if(this.connectParams)this.sendLargeBinaryDataMessage(this.connectParams,e,t);else{const s=(s=>this.sendLargeBinaryDataMessage(s,e,t)).bind(this);this.pendingConnectCallbacks.push(s)}}requestBinaryDataFromSessionBlobEndpoint(e,t){if(this.connectParams)this.requestBinaryData(this.connectParams,e,t);else{const s=(s=>this.requestBinaryData(s,e,t)).bind(this);this.pendingConnectCallbacks.push(s)}}registerContextTypes(e){for(const t of e)this.activateAnnotation(t),this.registeredContextTypes.add(t)}applyOperationForContext(e,t,s){let o=u.a.getTypeNameFor(e);if(o!=c.a.getTypeName()&&o!=c.d.getTypeName()&&o!=c.g.getTypeName()&&o!=c.b.getTypeName())return;o==c.d.getTypeName()&&(o=c.a.getTypeName());const n=Object(C.b)(this.resolvePlaceholdersInOperationParentPath(e.parentPath),t),i=Object(C.a)(n.parentPath);if(o==c.a.getTypeName()||o==c.g.getTypeName()){if(!n.body)return;const e=u.a.getTypeNameFor(n.body);if(!this.registeredContextTypes.has(e))return;let t=this.availableContexts.get(e);t||(t=new Map,this.availableContexts.set(e,t));let r=t.get(s);if(r||(r=[],t.set(s,r)),!n.id){if(this.workflowRuntime)throw new Error("Expected item to have id already");this.localWorkflowManager&&(n.id=this.localWorkflowManager.getNextClientAnnotationId())}if(o==c.a.getTypeName())0==r.filter(e=>Object(C.a)(e.parentPath)==i&&e.id==n.id).length?r.push(n):w.a.info(540848911,w.b.CoreDefault,`AddOperation for (${s}, ${n.id}, ${n.source}) can't be applied as the context item with matching path and ID already exists. Use UpdateOperation instead.`);else for(let o=0;o<r.length;o++)if(r[o].id==n.id&&Object(C.a)(r[o].parentPath)==i){if(r[o].source==n.source){r[o]=n;break}w.a.warn(540848912,w.b.CoreDefault,`UpdateOperation for (${s}, ${n.id}, ${n.source}) can't be applied as the context item with provided path and ID has different source: ${r[o].source}`)}else w.a.warn(540848913,w.b.CoreDefault,`UpdateOperation for (${s}, ${n.id}, ${n.source}) can't be applied as the context item with matching path and ID was not found. AddOperation should be used instead`)}else if(o==c.b.getTypeName()){if(!n.id)return;this.availableContexts.forEach((e,t)=>{let o=e.get(s);o&&(o=o.filter(e=>!(Object(C.a)(e.parentPath)==i&&e.id==n.id)),0==o.length?e.delete(s):e.set(s,o),0==e.size?this.availableContexts.delete(t):this.availableContexts.set(t,e))})}}updateWorkflowExecutionStates(e){if(this.localWorkflowManager){const t=this.enableRemoteExecutionNotification?this.workflowGraph.getWorkflowNodes().map(e=>e.workflow):this.localWorkflowManager.getAllRegisteredWorkflowsFromSession(this);for(const s of e)if(A.c.has(u.a.getTypeNameFor(s)))for(const e of s.items)for(const s of t||[])this.localWorkflowManager.preProcessItemToWorkflow(s,e,this)}}resolveRequestedContexts(e){const t=[];for(const[s,o,n]of Object(S.a)(e.requestedContextTypesRules)){if(!this.availableContexts.has(s)){if(o==y.b.Required)return[!1,[]];continue}const e=Array.from(this.availableContexts.get(s).values()).reduce((e,t)=>e.concat(t),[]);if(0==e.length)throw new Error(`Assert: availableContexts have the entry for ${s} which does not contain any context annotation.`);t.push(...e)}return[!0,this.removeDuplicatedContextItems(t)]}removeDuplicatedContextItems(e){return e.filter((e,t,s)=>s.findIndex(t=>b.b.deepEquals(t,e))===t)}getContextAnnotations(e,t,s,o){var n,i;const r=s?Object(C.a)(s):void 0;return null===(i=null===(n=this.availableContexts.get(e))||void 0===n?void 0:n.get(t))||void 0===i?void 0:i.filter(e=>!(r&&Object(C.a)(e.parentPath)!=r||o&&e.source!=o))}onWorkflowDefinitionOverrideMessage(e){const t=new v.a({operationName:"WorkflowDefinitionOverride",success:!0}).setClientMetadata(this.clientMetadata).start(),s=e=>{throw F(t,e),Error("WorkflowDefinitionOverride: "+e)};if(!this.localWorkflowManager)return void s("Not supported by this local SessionProxy instance.");const o=this.localWorkflowManager.getWorkflowDefinitionsByName(this),n=o.get(e.sourceWorkflowId);if(!n)return void s(`Workflow registration for source workflow '${e.targetWorkflowId}' was not found.`);t.resourceId=n.id;const i=o.get(e.targetWorkflowId);i&&(i.allowDefinitionOverride?n.definitionOverrideTargetWorkflows&&-1!==n.definitionOverrideTargetWorkflows.indexOf(i.id)?(this.workflowDefinitionManager.mergeWorkflowDefinition(i,e.definition,e.contextId),t.resultDescription=`Updated config for workflow: ${e.targetWorkflowId}, context id: ${e.contextId}`,F(t)):s(`Workflow '${n.id}' does not allow workflow definition for workflow '${i.id}'.`):s(`Workflow '${i.id}' does not allow workflow definition override.`))}applyContextIdOnOperations(e){this.contextIdManager.applyContextIdOnOperations(e)}attachToWorkflowGraph(e){this.addToWorkflowGraph(e),this.attachExecutionTrackerToEachWorkflow()}triggerRegisteredAnnotationCallbacks(e,t){if(this.callAnnotationCallbacks(e,t),this.hostCallbacks.onAnnotationResult)try{this.hostCallbacks.onAnnotationResult(e)}catch(s){w.a.error(540301151,w.b.CoreDefault,new v.a({operationName:"HostCallbackOnAnnotationResultError",dimension0:t,resultDescription:"onAnnotationResult error: "+s}))}}attachExecutionTrackerToEachWorkflow(){this.localWorkflowManager&&this.localWorkflowManager.attachExecutionTrackerToEachWorkflow(this.workflowGraph,this,this.onWorkflowExecutionComplete.bind(this))}onWorkflowExecutionCompleteMessage(e,t){t(void 0,new n.n),this.localWorkflowManager&&this.localWorkflowManager.onExternalWorkflowExecuted(e.contextId,e.workflowId,this)}onWorkflowExecutionComplete(e,t){}enableDeltaGenerator(){var e,t;this.deltaGenerator=null!==(e=this.deltaGenerator)&&void 0!==e?e:new D.a,this.syncDeltaTimers=null!==(t=this.syncDeltaTimers)&&void 0!==t?t:new Map}createDeltasFromUpdateOperation(e){var t,s;const o=[];w.a.info(523776396,w.b.CoreDefault,`Calling delta create for UpdateOperation under parent path [${e.parentPath}] (${null===(t=e.items)||void 0===t?void 0:t.length} item(s), first item id: ${(null===(s=e.items)||void 0===s?void 0:s.length)>0?e.items[0].id:"(no items)"})`);let n=[...e.parentPath];for(const i of e.items){const t=[],s=this.deltaGenerator.createTextTileDeltasFromItem(i,e.parentPath);if(null==s?void 0:s.length){for(const o of s){const s=Object(O.a)();n=[...e.parentPath,i.id];const r={id:s,revId:i.revId,body:o,contextId:i.contextId,source:i.source};t.push(r)}t.length>0&&(o.push(new c.c({parentPath:n,items:t})),this.enableSyncDeltaSending&&this.setupSyncDeltaAfterDelay(i,n,t))}else w.a.info(523329632,w.b.CoreDefault,"Failed to create delta on item "+i.id)}return o}setupSyncDeltaAfterDelay(e,t,s){var o,n,i;const r=this.syncDeltaTimers.get(e.id);r&&(clearTimeout(r),this.syncDeltaTimers.delete(e.id));const a=s.find(e=>{var t;return(null===(t=e.body)||void 0===t?void 0:t.unit)===N.b.Chars});if(a){const s=a.body,r={content:"",deltaType:N.a.Update,length:0,position:(null!==(o=null==s?void 0:s.position)&&void 0!==o?o:0)+(null!==(i=null===(n=null==s?void 0:s.content)||void 0===n?void 0:n.length)&&void 0!==i?i:0),unit:N.b.Sentence},l=B.a.typeGuard(e.body)?new P.a(r):new P.b(r),u={id:Object(O.a)(),revId:e.revId,body:l,contextId:e.contextId,source:e.source},d=new c.c({parentPath:t,items:[u]}),h=setTimeout((e,t)=>{this.submitOperation(e),this.syncDeltaTimers.delete(t)},this.syncDeltaTimeout,d,e.id);this.syncDeltaTimers.set(e.id,h)}}addToWorkflowGraph(e){this.workflowGraph.addWorkflow(Object(x.b)(e))}getAuthToken(e,t){const s={Tickets:[]};this.clientMetadata.docSessionId&&(s.DocSessionId=this.clientMetadata.docSessionId);const o=(e=>{if(e===m.a.Substrate)return h.a.Substrate})(e);o&&(s.TokenType=o),this.hostCallbacks.requestAuthToken(s).then(s=>{var o;s?t(void 0,s.Token,{returnedTokenType:e,timeToLiveSec:null===(o=s.TokenProperties)||void 0===o?void 0:o.timeToLiveSec}):t(new Error("Missing AuthTokenResponse from requestAuthToken"))}).catch(e=>t(e))}resetNextSyncSequenceId(){this.nextSyncSequenceId=1}onReconnect(){if(this.annotationActivationTrackers.forEach(e=>{this.activateAnnotationForTracker(e,{ignoreExistingAnnotations:!0,sendOnlyIfConnected:!0}).catch(()=>{})}),this.reconnectCallbacks.forEach((e,t)=>{e()}),!this.connectParams)throw new Error("Expected onConnect before onReconnect")}onSessionClose(e){this.isSessionClosed=!0,this.connectParams=void 0,this.sessionCloseCallbacks.forEach((t,s)=>{t(e)})}onConnect(e,t,s,o,n,i){this.hasSessionConnected?e&&(this.allowSeed=!0,this.allowGroupSeed=!0,this.seedGroupSize=0,this.batchedSeedMessageGroupSize=0,this.seedBatchedOperationsManager&&(this.seedBatchedOperationsManager.removeAllBatchedItems(),this.seedBatchedOperationsManager=void 0),this.batchedOperationsManager&&(this.batchedOperationsManager.removeAllBatchedItems(),this.batchedOperationsManager=void 0)):this.enableRemoteExecutionNotification&&this.addDownstreamWorkflowsIntoClientGraph(i),this.connectParams={isSeedingRequired:e,sessionUrl:t,origin:s,authToken:o},this.hasSessionConnected=!0,this.tryActivateWorkflows();for(const r of this.pendingConnectCallbacks)r(this.connectParams);this.connectCallbacks.forEach((n,i)=>{n(e,t,s,o)}),this.serverInputTypes=n}onDisconnect(e){this.connectParams=void 0,this.disconnectCallbacks.forEach((t,s)=>{t(e)})}onServerAuthenticationStateChange(e){if(e!=this.serverAuthenticationState){if(this.serverAuthenticationState==o.a.Authenticated&&e==o.a.Pending)return;this.serverAuthenticationState=e;for(const e of this.serverAuthenticationStateChangeCallback)e(this.serverAuthenticationState)}}callAnnotationCallbacks(e,t){if(0===this.annotationCallbacks.size)return;const s=this.annotationCallbacks.get(t);s&&s.forEach(t=>{t(e)})}getOperationBatchConfig(e){let t=void 0;t=this.batchMessagesEnabled?e=>({input:e,demultiplex:()=>[[]]}):e=>({input:e.filter(e=>e.length).reduce((e,t)=>e.concat(t),[]),demultiplex:()=>[[]]});return{delayMs:e.delayMs,delayMsMax:e.delayMsMax,maxInputSize:e.maxInputSize,estimateSize:R.a,groupingKeyExtractor:()=>"operations",multiplex:t,split:e=>{if(!(e.length<=1))return{inputs:e.reduce((e,t)=>(e.push([t]),e),[]),join:()=>[]}}}}sendSeedMessagesViaBatchManager(e,t,s){if(!this.seedBatchedOperationsManager){let e=void 0;e=this.batchMessagesEnabled?(e,t,s)=>{if(this.batchedSeedMessageGroupSize+=e.length,e.length){const o=new n.h;o.messages=[],e.forEach(e=>{o.messages.push(new n.z({cv:e.cv,seq:0,ops:e.input,groupId:"Seed",groupSize:t.groupComplete?this.batchedSeedMessageGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}))}),this.sendMessageToSession(o,e=>{s(e?new Error(e.error):void 0)})}}:(e,t,s)=>{this.seedGroupSize++,this.sendMessageToSession(new n.z({cv:t.cv,seq:0,ops:e,groupId:"Seed",groupSize:t.groupComplete?this.seedGroupSize:void 0,groupComplete:t.groupComplete?t.groupComplete:void 0}),e=>{s(e?new Error(e.error):void 0)})},this.seedBatchedOperationsManager=new f.a(e,this.reduceBatchOperationsEnabled,this.batchMessagesEnabled,this.reduceBatchedMessageOperationsEnabled)}this.seedBatchedOperationsManager.addBatchItem(e,this.operationBatchConfig,{name:"SubmitSeedOperations"},s,t)}onAnnotationResultsFromServer(e,t){this.onAnnotationResults(e,W.ServerWorkflow,t)}onAnnotationResultsFromLocal(e,t){this.onAnnotationResults(e,W.LocalWorkflow,t)}getLocalRegisteredWorkflows(){return this.workflowRuntime?this.workflowRuntime.getRegisteredWorkflows():this.localWorkflowManager?this.localWorkflowManager.getAllRegisteredWorkflowsFromSession(this).map(e=>Object(x.b)(e)):[]}sendWorkflowGraphInitMessage(){const e=this.getLocalRegisteredWorkflows(),t=new v.a({operationName:"WorkflowGraphInit",success:!0}).setClientMetadata(this.clientMetadata).start(),s=new n.E({upstreamRuntimeWorkflows:e});this.sendMessageToSession(s,(s,o)=>{s?F(t,s.error):(t.resultDescription=`local workflows: ${e.map(e=>e.id)}, remote workflows: ${o.downstreamRuntimeWorkflows.map(e=>e.id)}`,F(t),this.onWorkflowGraphInitResponse(o))})}trySendWorkflowGraphInitMessage(){!this.graphInitMessageTimer&&this.enableRemoteExecutionNotification&&(this.graphInitMessageTimer=setTimeout(()=>{this.graphInitMessageTimer=void 0,this.sendWorkflowGraphInitMessage()},10))}onWorkflowGraphInitResponse(e){this.addDownstreamWorkflowsIntoClientGraph(e.downstreamRuntimeWorkflows),this.tryActivateWorkflows()}addDownstreamWorkflowsIntoClientGraph(e){this.workflowGraph.removeWorkflows(!0);for(const t of e||[])this.workflowGraph.addWorkflow(t,!0);this.workflowRuntime||this.attachExecutionTrackerToEachWorkflow()}resolvePlaceholdersInOperationParentPath(e){let t=e;return 3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("user_")&&(w.a.info(540848914,w.b.CoreDefault,`Replacing user context placeholder for: ${Object(C.a)(e)}.`),t=["session","#userContext#"]),3==t.length&&"session"==t[0]&&"user"==t[1]&&t[2].startsWith("tenant_")&&(w.a.info(540848915,w.b.CoreDefault,`Replacing tenant context placeholder for: ${Object(C.a)(e)}.`),t=["session","#tenantContext#"]),t}filterOperationsForSession(e){return!!this.workflowRuntime||Object(b.e)(e,this.serverInputTypes)}makeRequestForConnectParams(e,t){const{authToken:s,origin:o,sessionUrl:n}=e,{body:i,cv:r,method:a,requestUrl:c}=t;return Object(p.fetch)(c||n,{method:a,headers:Object.assign({Authorization:"Bearer "+s,"x-origin":o,"x-correlationid":r},t.headers),body:i}).then(e=>{if(200!==e.status)throw new Error("Unexpected status code: "+e.status);return e})}sendLargeBinaryDataMessage(e,t,s){const o=new v.a({operationName:"SendLargeBinaryDataMessage",success:!0,cv:t.cv}).setClientMetadata(this.clientMetadata).start();let i;this.makeRequestForConnectParams(e,{headers:{"Content-Type":"application/jsond"},body:T.a.serialize(t),cv:o.cv,method:"POST"}).then(e=>e.json()).catch(e=>{i=new n.k({messageId:t.messageId,error:e.message})}).then(e=>{F(o,i?i.error:void 0),s(i,e)})}requestBinaryData(e,t,s){const o=new v.a({operationName:"RequestBinaryData",success:!0,cv:(new k.a).toString()}).setClientMetadata(this.clientMetadata).start(),{sessionUrl:n}=e;let i;this.makeRequestForConnectParams(e,{cv:o.cv,method:"GET",requestUrl:t.refType===l.a.AlCodedLocation?`${n}/blob/${t.value}`:t.value}).then(e=>e.arrayBuffer()).then(e=>new Uint8Array(e)).catch(e=>{i=e}).then(e=>{F(o,i?i.message:void 0),s(i,e)})}executeCallbacksOnAnnotationSubmitted(e){this.getAnnotationOperationsByType(e).forEach((e,t)=>{Array.from(e).forEach(e=>this.triggerRegisteredAnnotationCallbacks(e,t))})}partitionAnnotationOperations(e){return e.reduce(([e,t],s)=>s.items.some(e=>e.body&&d.a.typeGuard(e.body))?[[...e,s],t]:[e,[...t,s]],[[],[]])}onAnnotationsSubmitted(e,t){this.getAnnotationOperationsByType(e).forEach((e,s)=>{const o=Array.from(e);this.onAnnotationResults(new n.g({annotationType:s,ops:o,cv:t}),W.Submitted,()=>{})})}getAnnotationOperationsByType(e){const t=new Map;for(const s of e)for(const e of s.items)if(e.body&&d.a.typeGuard(e.body)){const o=u.a.getTypeNameFor(e.body),n=t.get(o)||new Set;n.add(s),t.set(o,n)}return t}}},39491:function(e,t,s){"use strict";var o,n,i,r;s.d(t,"a",(function(){return o})),function(e){e[e.EditorLowPrivilege=0]="EditorLowPrivilege",e[e.AugLoopLowPrivilege=1]="AugLoopLowPrivilege",e[e.Anonymous=2]="Anonymous",e[e.ClientAssertion=3]="ClientAssertion",e[e.ClientAssertionV2=4]="ClientAssertionV2",e[e.AutoClpLowPrivilege=5]="AutoClpLowPrivilege",e[e.AutoClpAppOnlyLowPrivilege=6]="AutoClpAppOnlyLowPrivilege",e[e.Substrate=7]="Substrate",e[e.WacUserInfo=8]="WacUserInfo",e[e.OwaExchange=9]="OwaExchange",e[e.SmartCompose=10]="SmartCompose",e[e.WritingAnalyticsLowPrivilege=11]="WritingAnalyticsLowPrivilege",e[e.DWEngineLowPrivilege=12]="DWEngineLowPrivilege",e[e.SubstrateApp=13]="SubstrateApp",e[e.CortanaAppPop=14]="CortanaAppPop",e[e.OfficeAppsAppOnly=15]="OfficeAppsAppOnly",e[e.PPTFrontdoorAppPop=16]="PPTFrontdoorAppPop",e[e.EditorAppOnlyLowPrivilege=17]="EditorAppOnlyLowPrivilege",e[e.AugLoopApp=18]="AugLoopApp",e[e.MeetingIntelligenceApp=19]="MeetingIntelligenceApp",e[e.GraphApp=20]="GraphApp",e[e.IceServicesApp=21]="IceServicesApp",e[e.AzureMapsApp=22]="AzureMapsApp",e[e.SpoApp=23]="SpoApp",e[e.OneDrive=24]="OneDrive",e[e.GoogleDrive=25]="GoogleDrive",e[e.GettyApp=26]="GettyApp",e[e.Dropbox=27]="Dropbox",e[e.GooglePhotos=28]="GooglePhotos",e[e.EditorApp=29]="EditorApp",e[e.AmazonKindle=30]="AmazonKindle",e[e.ShredderApp=31]="ShredderApp",e[e.FormsLowPrivilege=32]="FormsLowPrivilege",e[e.VivaSalesLowPrivilege=33]="VivaSalesLowPrivilege",e[e.IntentSvcApp=34]="IntentSvcApp",e[e.DcgLowPrivilege=35]="DcgLowPrivilege",e[e.CSALowPrivilege=36]="CSALowPrivilege",e[e.ConsumerSydneyLowPrivilege=37]="ConsumerSydneyLowPrivilege",e[e.CompliantSydneyApp=38]="CompliantSydneyApp",e[e.M365AdminApp=39]="M365AdminApp",e[e.MeetingArtifactsServiceLowPrivilege=40]="MeetingArtifactsServiceLowPrivilege",e[e.AlchemyApp=41]="AlchemyApp",e[e.M365Admin=42]="M365Admin",e[e.ConsumerShellApp=43]="ConsumerShellApp",e[e.PowerQueryLowPrivilege=44]="PowerQueryLowPrivilege",e[e.CIIApp=45]="CIIApp",e[e.ConsumerShell=46]="ConsumerShell",e[e.AssistCopilotLowPrivilege=47]="AssistCopilotLowPrivilege",e[e.Pva=48]="Pva",e[e.TeamsCopilotServiceLowPrivilege=49]="TeamsCopilotServiceLowPrivilege",e[e.CallAnalytics=50]="CallAnalytics",e[e.IncomingPFT=51]="IncomingPFT",e[e.GraphExchange=52]="GraphExchange",e[e.EXOAdmin=53]="EXOAdmin",e[e.InsightsServicesLowPrivilege=54]="InsightsServicesLowPrivilege",e[e.VivaServicesLowPrivilege=55]="VivaServicesLowPrivilege",e[e.EcsAppOnly=56]="EcsAppOnly",e[e.ShredderLowPrivilege=57]="ShredderLowPrivilege",e[e.SpoLowPrivilege=58]="SpoLowPrivilege",e[e.PromptValidationApp=59]="PromptValidationApp",e[e.CompliantSydneyLowPrivilege=60]="CompliantSydneyLowPrivilege",e[e.SubstrateTenantFeedbackApp=61]="SubstrateTenantFeedbackApp",e[e.MonitoringPlatform=62]="MonitoringPlatform",e[e.YammerLowPrivilege=63]="YammerLowPrivilege",e[e.VivaLearningLowPrivilege=64]="VivaLearningLowPrivilege",e[e.VivaInsightsLowPrivilege=65]="VivaInsightsLowPrivilege",e[e.ClientAugLoopApp=66]="ClientAugLoopApp"}(o||(o={})),function(e){e[e.Unknown=0]="Unknown",e[e.Consumer=1]="Consumer",e[e.Enterprise=2]="Enterprise"}(n||(n={})),function(e){e.AuthorizationCode="authorization_code",e.ClientCredentials="client_credentials",e.RefreshToken="refresh_token"}(i||(i={})),function(e){e[e.LoggedIn=0]="LoggedIn",e[e.LoggedOut=1]="LoggedOut"}(r||(r={}))},39492:function(e,t,s){"use strict";var o,n;s.d(t,"a",(function(){return n})),function(e){e[e.Unknown=0]="Unknown",e[e.LiveId=1]="LiveId",e[e.OrgId=2]="OrgId",e[e.ActiveDirectory=3]="ActiveDirectory",e[e.ADAL=4]="ADAL",e[e.SSPI=5]="SSPI",e[e.OAuth2=6]="OAuth2",e[e.Badger=7]="Badger"}(o||(o={})),function(e){e[e.Augloop=0]="Augloop",e[e.Substrate=1]="Substrate"}(n||(n={}))},39493:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return a}));var o,n=s(39494),i=s(39464),r=s(39467);!function(e){e[e.Local=0]="Local",e[e.External=1]="External"}(o||(o={}));class a{constructor(){this.graphNodeByLocationAndWorkflowId=new Map}getWorkflow(e,t){var s;const o=this.getLocation(t);return null===(s=this.graphNodeByLocationAndWorkflowId.get(o))||void 0===s?void 0:s.get(e)}addWorkflow(e,t=!1){if(this.getWorkflow(e.id,t)){const s=new i.a({operationName:"AddWorkflowToGraphFailure",success:!1,resourceId:e.id,resultDescription:"Adding a new with workflow with a duplicated workflowId: "+t}).start();return void r.a.error(524300630,r.b.CoreDefault,s.stop())}const s=this.getLocation(t),o=new c(e,s);this.addWorkflowAsDependency(o);let n=this.graphNodeByLocationAndWorkflowId.get(s);n||(n=new Map,this.graphNodeByLocationAndWorkflowId.set(s,n)),n.set(e.id,o)}getUpstreamRuntimeVisibleWorkflows(){const e=[];for(const t of this.graphNodeByLocationAndWorkflowId.values()||[])for(const s of t.values()||[]){const t=this.createWorkflowDefinition(s.workflow);s.workflow.visibility===n.e.LocalOnly?this.compressDownstreamWorkflows(t,s):t.outputTypes.push(...s.workflow.outputTypes),0!==t.inputTypes.length&&e.push(t)}return e}removeWorkflows(e){const t=this.getLocation(e),s=this.graphNodeByLocationAndWorkflowId.get(t),o=Array.from((null==s?void 0:s.values())||[]);for(const n of o){for(const e of n.upstreamWorkflows.values())e.downstreamWorkflows.delete(n);for(const e of n.downstreamWorkflows.values())e.upstreamWorkflows.delete(n);s.delete(n.workflow.id)}}getWorkflowsDefinitions(){const e=[];for(const t of this.graphNodeByLocationAndWorkflowId.values()||[])for(const s of t.values()||[])e.push(s.workflow);return e}getWorkflowNodes(e){const t=[];for(const s of this.graphNodeByLocationAndWorkflowId.values())for(const e of s.values())t.push(e);return t}getLocation(e){return e?o.External:o.Local}createWorkflowDefinition(e){return Object.assign(Object.assign({},e),{outputTypes:[]})}compressDownstreamWorkflows(e,t){for(const s of t.downstreamWorkflows)if(s.workflow.visibility!==n.e.LocalOnly){if(s.workflow.kind!==n.d.Join||-1!==e.inputTypes.indexOf(s.workflow.collectionScopeType))for(const t of s.workflow.outputTypes)-1===e.outputTypes.indexOf(t)&&e.outputTypes.push(t)}else this.compressDownstreamWorkflows(e,s)}addWorkflowAsDependency(e){for(const t of this.graphNodeByLocationAndWorkflowId.values())for(const s of t.values()){for(const t of s.workflow.inputTypes)-1!==e.workflow.outputTypes.indexOf(t)&&this.addWorkflowChain(e,s);for(const t of s.workflow.outputTypes)-1!==e.workflow.inputTypes.indexOf(t)&&this.addWorkflowChain(s,e)}}addWorkflowChain(e,t){e.downstreamWorkflows.add(t),t.upstreamWorkflows.add(e)}}class c{constructor(e,t){this.isActivated=!0,this.upstreamWorkflows=new Set,this.downstreamWorkflows=new Set,this.location=t,this.workflow=Object.assign(Object.assign({},e),{inputTypes:Array.isArray(e.inputTypes)?e.inputTypes:[],outputTypes:Array.isArray(e.outputTypes)?e.outputTypes:[]})}}},39494:function(e,t,s){"use strict";var o,n,i,r,a,c,l,u,d,h,p;s.d(t,"d",(function(){return o})),s.d(t,"e",(function(){return i})),s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return c})),s.d(t,"c",(function(){return u})),function(e){e[e.SingleItem=0]="SingleItem",e[e.Reduce=1]="Reduce",e[e.Grid=2]="Grid",e[e.DynamicText=3]="DynamicText",e[e.Join=4]="Join",e[e.Generic=5]="Generic"}(o||(o={})),function(e){e.Default="Default",e.Copilot="Copilot"}(n||(n={})),function(e){e[e.Default=0]="Default",e[e.LocalOnly=1]="LocalOnly",e[e.Exclusive=2]="Exclusive"}(i||(i={})),function(e){e[e.PreActivate=0]="PreActivate",e[e.Default=1]="Default",e[e.DelayActivate=1]="DelayActivate",e[e.NeverActivate=2]="NeverActivate"}(r||(r={})),function(e){e[e.Required=-3]="Required",e[e.Optional=-1]="Optional"}(a||(a={})),function(e){e[e.Never=0]="Never",e[e.Always=1]="Always"}(c||(c={})),function(e){e[e.PreSeed=1]="PreSeed",e[e.OnSeed=2]="OnSeed",e[e.PostSeed=4]="PostSeed",e[e.All=5]="All"}(l||(l={})),function(e){e[e.UpstreamWorkflowsReady=0]="UpstreamWorkflowsReady",e[e.AnnotationMetadataUpdated=1]="AnnotationMetadataUpdated",e[e.DeltaUpdate=2]="DeltaUpdate",e[e.NonExclusiveTriggerSignals=3]="NonExclusiveTriggerSignals"}(u||(u={})),function(e){e[e.Character=1]="Character",e[e.Paragraph=2]="Paragraph"}(d||(d={})),function(e){e.Input="Input",e.Delta="Delta",e.UILanguage="UILanguage",e.MaxInputCount="MaxInputCount"}(h||(h={})),function(e){e.SetPredefinedAnnotation="SetPredefinedAnnotation",e.ClearAnnotations="ClearAnnotations"}(p||(p={}))},39495:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39496);class n{constructor(){this.workflowDefByWorkflowAndContextId=new Map,this.workflowDefByWorkflow=new Map}static mergeDefinitions(e,t,s){return Object.assign(Object.assign(Object.assign({},e),t),s)}mergeWorkflowDefinition(e,t,s){if(s){const i=Object(o.a)(this.workflowDefByWorkflowAndContextId,e.id,()=>new Map);i.set(s,n.mergeDefinitions(e,i.get(s),t))}else this.workflowDefByWorkflow.set(e.id,n.mergeDefinitions(e,this.workflowDefByWorkflow.get(e.id),t))}getWorkflowDefinition(e,t){var s;let o;return t&&(o=null===(s=this.workflowDefByWorkflowAndContextId.get(e.id))||void 0===s?void 0:s.get(t)),o||(o=this.workflowDefByWorkflow.get(e.id)),o||(o=e),o}deleteWorkflowDefinition(e,t){const s=this.workflowDefByWorkflowAndContextId.get(e.id);s&&(s.delete(t),0===s.size&&this.workflowDefByWorkflowAndContextId.delete(e.id))}}},39496:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return i}));s(39494);const o=(e,t,s)=>{let o=e.get(t);return o||(o=s(),e.set(t,o)),o},n=e=>({id:e.id,kind:e.kind,visibility:e.visibility,collectionScopeType:e.collectionScopeType,inputTypes:e.inputTypes,outputTypes:e.outputTypes,correlatedSignals:e.correlatedSignals}),i=(e,t)=>null!=e&&(null!=t&&(e.length>0&&(e===t||0===t.indexOf(e)&&"."===t.charAt(e.length))))},39497:function(e,t,s){"use strict";s.d(t,"c",(function(){return c})),s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return u}));var o=s(39487),n=s(39479),i=s(39464),r=s(39467),a=s(39496);const c=new Set([o.a.getTypeName(),o.g.getTypeName(),o.e.getTypeName(),o.c.getTypeName()]);class l{constructor(e,t){this.nextId=1,this.runtimeKind=e,this.workflowGraph=t}static isParentContextId(e,t){return Object(a.c)(e,t)}applyContextIdOnOperations(e){for(const t of e){const e=n.a.getTypeNameFor(t);if(this.isSupportedOperation(e))for(const s of t.items)s.contextId?s.source&&this.workflowGraph.getWorkflow(s.source,!1)?s.contextId=this.addNewContextId(s.contextId):this.tryLogMessage(new i.a({operationName:"ApplyContextIdOnOperations",success:!0}).start(),"Item with a contextId but without a workflow source atribute"):s.contextId=this.addNewContextId()}}addNewContextId(e){const t=`${this.runtimeKind}${this.nextId++}`;return e?`${e}.${t}`:t}isSupportedOperation(e){return c.has(e)}tryLogMessage(e,t,s=!0){e&&(e.success=s,e.resultDescription=t,r.a.verbose(527308633,r.b.CoreDefault,e.stop()))}}var u;!function(e){e[e.Idle=1]="Idle",e[e.Pending=2]="Pending",e[e.Running=3]="Running",e[e.Executed=4]="Executed"}(u||(u={}))},39498:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e.JsClient="C",e.Server="S"}(o||(o={}))},39499:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(39464),n=s(39467),i=s(39496);class r{constructor(e){this.scopeItemsByContextId=new Map,this.itemsByWorkflowAndContextId=new Map,this.workflowDefinitionManager=e}setScopeItem(e,t){var s;const i=e.contextId;if(i)if(this.itemsByWorkflowAndContextId.has(t.id)||this.itemsByWorkflowAndContextId.set(t.id,new Map),this.itemsByWorkflowAndContextId.get(t.id).set(i,[]),this.scopeItemsByContextId.has(i)){if(null===(s=this.itemsByWorkflowAndContextId.get(t.id))||void 0===s?void 0:s.has(i)){const s=new o.a({resultDescription:`Trying to set new scope item: ${e.id} with already existing contextId ${i} for workflow ${t.id}`,operationName:"WIS.setScopeItem",resourceId:t.id,success:!0}).start();n.a.verbose(527291288,n.b.CoreDefault,s.stop())}}else this.scopeItemsByContextId.set(i,e)}getScopeItem(e,t){var s;for(const o of(null===(s=this.itemsByWorkflowAndContextId.get(t.id))||void 0===s?void 0:s.keys())||[])if(Object(i.c)(o,e))return this.scopeItemsByContextId.get(o)}addItemToWorkflowList(e,t){const s=e.contextId;if(!s)return;const r=this.itemsByWorkflowAndContextId.get(t.id);if(r)for(const[a,c]of r)if(Object(i.c)(a,s)){c.push(e);const s=new o.a({resultDescription:`Items for contextId ${a}: [${c.map(e=>e.id).join(",")}]`,operationName:"WIS.addItemOnContextIdList",resourceId:t.id,success:!0}).start();n.a.info(526403808,n.b.CoreDefault,s.stop())}}isWorkflowReady(e,t){const s=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.getGeneratedItems(e,t).length>=s}getItemsToExecute(e,t){const s=this.getGeneratedItems(e,t);return this.itemsByWorkflowAndContextId.get(t.id).delete(e),s}onWorkflowExecuted(e,t){const s=e.contextId,o=this.itemsByWorkflowAndContextId.get(t.id);o&&(o.delete(s),0===o.size&&this.itemsByWorkflowAndContextId.delete(t.id)),this.hasWorkflowsAwaitingExecution(s)||this.scopeItemsByContextId.delete(s)}getGeneratedItems(e,t){var s;if(!(null===(s=this.itemsByWorkflowAndContextId.get(t.id))||void 0===s?void 0:s.get(e)))return[];const o=this.workflowDefinitionManager.getWorkflowDefinition(t,e).maxAnnotations;return this.itemsByWorkflowAndContextId.get(t.id).get(e).slice(0,o)}hasWorkflowsAwaitingExecution(e){for(const t of this.itemsByWorkflowAndContextId.values())for(const s of t.keys())if(s===e)return!0;return!1}}},39500:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return h}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_WorkflowRegistrationMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_WorkflowExecutionRequest"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(e){o.a.assign(r,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_WorkflowExecutionResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[r.getTypeName()])}}r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()};class a{constructor(e){o.a.assign(a,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_RuntimeInitMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class c{constructor(e){o.a.assign(c,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_DiagnosticTraceMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[c.getTypeName()])}}c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};class l{constructor(e){o.a.assign(l,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_TelemetryMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[l.getTypeName()])}}l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};class u{constructor(e){o.a.assign(u,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_TelemetryFlushMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[u.getTypeName()])}}u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};class d{constructor(e){o.a.assign(d,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_SessionCloseResponse"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[d.getTypeName()])}}d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};class h{constructor(e){o.a.assign(h,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_WorkflowDefinitionOverrideMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[h.getTypeName()])}}h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};class p{constructor(e){o.a.assign(p,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_GetAnnotationsRequestMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[p.getTypeName()])}}p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};class g{constructor(e){o.a.assign(g,this,e)}static getTypeName(){return"AugLoop_Session_Protocol_Internal_GetAnnotationsResponseMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_Response"]}static typeGuard(e){return o.a.matchesTypesFor(e,[g.getTypeName()])}}g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()}},39501:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39478);class n{constructor(e,t,s){this.sendMessage=e,this.annotationType=t,this.options=s,this.token=`${t}-${n.nextActivationResultBatchId++}`}activate(e,t){return new Promise((s,n)=>{this.sendMessage(new o.a({annotationType:this.annotationType,token:this.token,config:this.options?this.options.config:void 0,ignoreExistingAnnotations:e,sendStateUpdates:this.options?!!this.options.stateUpdateCallback:void 0,forceReturnCachedAnnotations:this.options?this.options.forceReturnCachedAnnotations:void 0}),(e,t)=>{e?n(new Error(e.error)):s({token:this.token})},t)})}release(){return new Promise((e,t)=>{this.sendMessage(new o.d({token:this.token}),(s,o)=>{s?t(new Error(s.error)):e(o.lastRelease)})})}}n.nextActivationResultBatchId=1},39502:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var o,n;!function(e){e[e.None=0]="None",e[e.HttpsGetDownloadUrl=1]="HttpsGetDownloadUrl",e[e.AlCodedLocation=2]="AlCodedLocation",e[e.Token=3]="Token"}(o||(o={})),function(e){e[e.NewDocument=0]="NewDocument",e[e.EditDocument=1]="EditDocument",e[e.ViewOnlyDocument=2]="ViewOnlyDocument"}(n||(n={}));class i{}i.lowerIndexBound=1,i.maxNumberOfRows=1048576,i.maxNumberOfColumns=16384,i.firstColumnName="A",i.lastColumnName="XFD"},39503:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return i}));const o=2;var n,i;!function(e){e[e.IdentityChange=0]="IdentityChange"}(n||(n={})),function(e){e[e.Idle=0]="Idle",e[e.Pending=1]="Pending"}(i||(i={}))},39504:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var o,n=s(39467),i=s(39464),r=s(39487),a=s(39505);!function(e){e[e.ExceedingMaxSize=0]="ExceedingMaxSize",e[e.GroupComplete=1]="GroupComplete",e[e.BatchIntervalElapsed=2]="BatchIntervalElapsed"}(o||(o={}));class c{constructor(e,t,s,o,n){this.batchesByGroupingKey=new Map,this.getOrderOfMagnitudeDimension=e=>e<0?"Negative":0===e?"0":1===e?"1":"Magnitude "+e.toString().length,this.submit=e,this.onSummary=n,this.reduceBatchOperationsEnabled=t,this.batchMessagesEnabled=s,this.reduceBatchedMessageOperationsEnabled=o}addBatchItem(e,t,s,i,r,a){const{delayMs:c,delayMsMax:l,maxInputSize:u,estimateSize:d,groupingKeyExtractor:h}=t,p=d(e),g=h(e);if(t.split&&p>u){let o;try{o=t.split(e)}catch(m){const e=new Error("Split error: "+m.message);return void(a?a(e):n.a.error(573366352,n.b.CoreDefault,e))}if(o&&Array.isArray(o.inputs)&&o.inputs.length>1){let e;const n=[],c=a?(t,s)=>{if(e=e||t,n.push(s),n.length===o.inputs.length){let s;try{s=o.join(n)}catch(t){return void a(new Error("Join error: "+t.message))}a(e,s)}}:void 0;for(let a=0;a<o.inputs.length;a++){const e=o.inputs[a];this.addBatchItem(e,t,s,i,r&&a===o.inputs.length-1,c)}return}}let f=this.batchesByGroupingKey.get(g);if(f&&f.size+p>u&&(this.executeBatch(g,f,t,o.ExceedingMaxSize),f=void 0),f||(f={items:[],size:0,hasItemsWithCallbacks:!1,context:s,creationTime:Date.now()},this.batchesByGroupingKey.set(g,f)),this.batchMessagesEnabled){const t=f.items[f.items.length-1];t&&t.cv===i&&t.callback===a?(t.input=[...t.input,...e],t.size+=p):f.items.push({input:e,size:p,cv:i,callback:a})}else f.items.push({input:e,size:p,callback:a});f.size+=p,f.hasItemsWithCallbacks=f.hasItemsWithCallbacks||!!a,this.batchMessagesEnabled||(f.cv=i),f.groupComplete=r,f.groupComplete?this.executeBatch(g,f,t,o.GroupComplete):(Date.now()-f.creationTime+c<l&&(clearTimeout(f.timeout),f.timeout=void 0),f.timeout||(f.timeout=setTimeout(()=>{this.executeBatch(g,f,t,o.BatchIntervalElapsed)},c)))}removeAllBatchedItems(){this.batchesByGroupingKey.forEach(e=>{e.timeout&&clearTimeout(e.timeout)}),this.batchesByGroupingKey.clear()}reduceBatchOperations(e,t){const s=new i.a({operationName:"ReduceBatchOperations",cv:e.cv}).start();let o=0,a=0,c=0;const l=new Set,u=[],d=(e,t)=>e.parentPath.toString()+"/"+e.parentRevId+"/"+t.id;for(const n of t.input.reverse())if(r.g.typeGuard(n)){const e=[];for(const t of n.items){c++;const s=d(n,t);l.has(s)?a++:(e.push(t),l.add(s),o++)}0!=e.length&&(n.items=e,u.push(n))}else if(r.a.typeGuard(n)){for(const e of n.items){const t=d(n,e);l.delete(t)}u.push(n)}else u.push(n);t.input=u.reverse(),0!=c&&(s.dimension0=""+this.getOrderOfMagnitudeDimension(a),s.dimension1="noOp: "+(0===a)),s.success=c-a==o,n.a.info(508039169,n.b.CoreDefault,s.stop())}reduceBatchedMessageOperations(e){const t=new i.a({operationName:"ReduceBatchedMessageOperations"}).start();let s=0,o=0,a=0;const c=new Set,l=[],u=(e,t)=>e.parentPath.toString()+"/"+e.parentRevId+"/"+t.id;for(const n of e.input.reverse()){const e=[];for(const t of n.input.reverse())if(r.g.typeGuard(t)){const n=[];for(const e of t.items){a++;const i=u(t,e);c.has(i)?o++:(n.push(e),c.add(i),s++)}0!==n.length&&(t.items=n,e.push(t))}else if(r.a.typeGuard(t)){for(const e of t.items){const s=u(t,e);c.delete(s)}e.push(t)}else e.push(t);0!==e.length&&l.push({input:e.reverse(),size:n.size,cv:n.cv,callback:n.callback})}e.input=l.reverse(),0!=a&&(t.dimension0=""+this.getOrderOfMagnitudeDimension(o),t.dimension1="noOp: "+(0===o)),t.success=a-o==s,n.a.info(507839488,n.b.CoreDefault,t.stop())}executeBatch(e,t,s,o){clearTimeout(t.timeout),t.timeout=void 0,this.batchesByGroupingKey.delete(e);const r=t.items,c=new i.a({operationName:"ExecuteBatch",cv:this.batchMessagesEnabled?"":t.cv,resourceId:t.context.name,resultDescription:`batching duration: ${Date.now()-t.creationTime}ms`,dimension0:`${this.batchMessagesEnabled?"Batched items count":"Batched ops count:"} ${this.getOrderOfMagnitudeDimension(r.length)}`,dimension1:"Size "+this.getOrderOfMagnitudeDimension(t.size),dimension2:o.toString()}).start(),l=(e,s,o)=>{let i;if(s&&s.exceptionType===a.a.NoOutput)c.success=!0,n.a.info(573366353,n.b.CoreDefault,c.stop());else{const o=`${e} error: ${s?s.message||s:"Unknown error"}`;i=s||new Error(o),c.success=!1,c.resultDescription=`Batch of ${r.length} items of size ${t.size} with ${o}`,c.resultSignature=e+" Error",n.a.error(573366354,n.b.CoreDefault,c.stop())}if(t.hasItemsWithCallbacks)for(const t of r)t.callback&&t.callback(i,o)};let u;try{u=s.multiplex(this.batchMessagesEnabled?r:r.map(e=>e.input))}catch(d){return void l("Multiplex",d)}this.reduceBatchOperationsEnabled&&!this.batchMessagesEnabled?"operations"==e&&this.reduceBatchOperations(t,u):this.reduceBatchedMessageOperationsEnabled&&this.batchMessagesEnabled&&"operations"==e&&this.reduceBatchedMessageOperations(u),this.submit(u.input,t,(e,o)=>{if(e||o&&("exceptionType"in o||o instanceof Error))l("Submit",e||o,o);else if(t.hasItemsWithCallbacks||s.summaryExtractor){let i,a,d;if(t.hasItemsWithCallbacks)try{if(i=u.demultiplex(o),i.length!==r.length)throw new Error("Mismatched output length")}catch(e){return void l("Demultiplex",e)}if(s.summaryExtractor)try{[d,a]=s.summaryExtractor(o)}catch(e){return void l("SummaryExtractor",e)}if(c.success=!0,n.a.info(573366342,n.b.CoreDefault,c.stop()),t.hasItemsWithCallbacks)for(let e=0;e<r.length;e++)r[e].callback&&r[e].callback(void 0,i[e]);a&&this.onSummary(d,a,t.context)}else c.success=!0,n.a.info(573366343,n.b.CoreDefault,c.stop())})}}},39505:function(e,t,s){"use strict";var o,n;s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return n})),function(e){e[e.Input=0]="Input",e[e.Exception=1]="Exception",e[e.WaitOn=2]="WaitOn",e[e.StopAndFilterWorkflow=3]="StopAndFilterWorkflow"}(o||(o={})),function(e){e[e.Unknown=0]="Unknown",e[e.NoOutput=1]="NoOutput",e[e.Authentication=2]="Authentication",e[e.JoinTimedOut=3]="JoinTimedOut",e[e.LambdaThrow=4]="LambdaThrow",e[e.LambdaErrorCallback=5]="LambdaErrorCallback"}(n||(n={}))},39506:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return n}));const o=(e,t)=>Object.assign(Object.assign({},t),{parentPath:e}),n=e=>Array.isArray(e)?5===e.length?`${e[0]}\\${e[1]}\\${e[2]}\\${e[3]}\\${e[4]}`:4===e.length?`${e[0]}\\${e[1]}\\${e[2]}\\${e[3]}`:3===e.length?`${e[0]}\\${e[1]}\\${e[2]}`:2===e.length?`${e[0]}\\${e[1]}`:1===e.length?e[0]:e.join("\\"):"(malformed path)"},39507:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));s(39494);const o=(e,t)=>{const s=[];for(const o of null!=e?e:[])if(void 0===t||t===o.cardinality)for(const e of o.contextTypes)s.push([e,o.cardinality,o.producerWaitPolicy]);return s}},39508:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var o=s(39479),n=s(39464),i=s(39467),r=s(39509),a=s(39510);const c=(e,t)=>t?`${t.join("\\")}-${e}`:e;class l{constructor(){this.createTextTileDeltasFromItem=(e,t)=>{var s;const a=new n.a({operationName:"CreateTextTileDeltaFromItem",success:!0}).start();try{if(!e)return a.success=!1,a.resultDescription="Unable to create text tile delta, parent item is undefined",void i.a.info(524883085,i.b.CoreDefault,a.stop());if(!e.body)return a.success=!1,a.resultDescription="Unable to create text tile delta, parent item has undefined body",void i.a.info(524883086,i.b.CoreDefault,a.stop());const n=e.body;if(!r.b.typeGuard(n))return a.success=!1,void(a.resultDescription=`Unable to create text tile delta, parent item body is not proper type: expected ${r.b.getTypeName()}, received ${o.a.getTypeNameFor(n)}`);const l=c(e.id,t),u=null!==(s=this.lastSeenTileByTileId.get(l))&&void 0!==s?s:new r.b({content:""}),d=this.createDeltas(u,n);return d&&0!==d.length?(a.dimension0=d.length.toString(),this.lastSeenTileByTileId.set(l,n)):(a.dimension0="0",a.resultDescription="No delta differences found"),i.a.info(524883087,i.b.CoreDefault,a.stop()),d}catch(l){return a.success=!1,a.resultDescription="Error creating text tile delta: "+l,void i.a.info(524883088,i.b.CoreDefault,a.stop())}},this.lastSeenTileByTileId=new Map,this.deltaBuilder=new a.a}addItemToLocalMap(e,t){const s=c(e.id,t),o=e.body;r.b.typeGuard(o)&&!this.lastSeenTileByTileId.has(s)&&this.lastSeenTileByTileId.set(s,o)}deleteItemFromLocalMap(e,t){const s=c(e.id,t);this.lastSeenTileByTileId.has(s)&&this.lastSeenTileByTileId.delete(s)}createDeltas(e,t){return this.deltaBuilder.executeDeltaBuilderHandler(o.a.getTypeNameFor(t),e,t)}}},39509:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return i}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Text_TextTile"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Text_FormattedTextTile"}static getBaseTypes(){return["AugLoop_Text_TextTile"]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(e){o.a.assign(r,this,e)}static getTypeName(){return"AugLoop_Text_DynamicTextContext"}static getBaseTypes(){return["AugLoop_Core_DynamicContext"]}static typeGuard(e){return o.a.matchesTypesFor(e,[r.getTypeName()])}}r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()};class a{constructor(e){o.a.assign(a,this,e)}static getTypeName(){return"AugLoop_Text_TaskTile"}static getBaseTypes(){return["AugLoop_Text_FormattedTextTile","AugLoop_Text_TextTile"]}static typeGuard(e){return o.a.matchesTypesFor(e,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class c{constructor(e){o.a.assign(c,this,e)}static getTypeName(){return"AugLoop_Text_PersonTile"}static getBaseTypes(){return["AugLoop_Text_TextTile"]}static typeGuard(e){return o.a.matchesTypesFor(e,[c.getTypeName()])}}c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};class l{constructor(e){o.a.assign(l,this,e)}static getTypeName(){return"AugLoop_Text_DateTile"}static getBaseTypes(){return["AugLoop_Text_TextTile"]}static typeGuard(e){return o.a.matchesTypesFor(e,[l.getTypeName()])}}l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};class u{constructor(e){o.a.assign(u,this,e)}static getTypeName(){return"AugLoop_Text_LinkTile"}static getBaseTypes(){return["AugLoop_Text_TextTile"]}static typeGuard(e){return o.a.matchesTypesFor(e,[u.getTypeName()])}}u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()}},39510:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(39509),n=s(39511);class i{constructor(){this.deltaBuilderHandlers=new Map,this.registerDeltaBuilderHandler(o.b.getTypeName(),n.b),this.registerDeltaBuilderHandler(o.a.getTypeName(),n.a)}registerDeltaBuilderHandler(e,t){this.deltaBuilderHandlers.set(e,t)}executeDeltaBuilderHandler(e,t,s){const o=this.deltaBuilderHandlers.get(e);return o?o(t,s):[]}}},39511:function(e,t,s){"use strict";s.d(t,"b",(function(){return u})),s.d(t,"a",(function(){return d}));var o=s(39513),n=s(39514),i=s(39512),r=s(39483),a=s.n(r);const c=/[ \u00a0\u2000-\u200a\u202f\u205f\u3000\t]/g,l=/[.!?]/g;function u(e,t){const s=[],o=h(e,t);return o&&s.push(o),s}function d(e,t){const s=[],i=h(e,t);i&&s.push(i);const r=function(e,t,s){var i,r,a,c,l,u;const d=e,h=t;if((null==d?void 0:d.ipPosition)===(null==h?void 0:h.ipPosition)&&(null==d?void 0:d.isColdIp)===(null==h?void 0:h.isColdIp))return;if((null==d?void 0:d.isColdIp)===(null==h?void 0:h.isColdIp)&&s)if(s.deltaType===o.a.Add){if((null==h?void 0:h.ipPosition)===(null!==(i=s.position)&&void 0!==i?i:0)+(null!==(r=s.length)&&void 0!==r?r:0))return}else if(s.deltaType===o.a.Update){if((null==h?void 0:h.ipPosition)===(null!==(a=s.position)&&void 0!==a?a:0)+(null!==(l=null===(c=s.content)||void 0===c?void 0:c.length)&&void 0!==l?l:0))return}else if(s.deltaType===o.a.Delete&&(null==h?void 0:h.ipPosition)===(null!==(u=s.position)&&void 0!==u?u:0))return;return new n.a({deltaType:o.a.CursorUpdate,cursorData:{ipPosition:null==h?void 0:h.ipPosition,isColdIp:null==h?void 0:h.isColdIp}})}(e,t,i);r&&s.push(r);const c=function(e,t,s){var i,r,c,l,u,d,h;const p=e,g=t;if((null===(i=g.formattedRanges)||void 0===i?void 0:i.length)<=(null===(r=p.formattedRanges)||void 0===r?void 0:r.length))if(s){let e=p.formattedRanges?[...p.formattedRanges]:[];const t=function(e,t,s){if(!e)return;if(t.deltaType===o.a.Add){const t=e.find(e=>e.start===s&&0===e.length);if(t)return t;s=Math.max(s-1,0)}return e.find(e=>0===e.length?e.start===s:e.start<=s&&s<e.start+e.length)}(p.formattedRanges,s,s.position),n=t?e.indexOf(t):-1;if(-1!==n&&(s.position+(s.length||0)>t.start+t.length?t.length=s.position+(null!==(c=s.content)&&void 0!==c?c:"").length-t.start:t.length+=(null!==(l=s.content)&&void 0!==l?l:"").length-(s.length||0),e[n]=t),e.length>0){for(const t of e.slice(n+1))t.start<s.position||(s.position+(s.length||0)>t.start?(t.length=t.start+t.length-(s.position+(s.length||0)),t.start=s.position+(null!==(u=s.content)&&void 0!==u?u:"").length):t.start+=(null!==(d=s.content)&&void 0!==d?d:"").length-(s.length||0));e=e.filter(e=>e.length>0)}const i=null!==(h=null==g?void 0:g.formattedRanges)&&void 0!==h?h:[];if(a()(e,i)||0===e.length&&0===i.length)return}else if(a()(null==p?void 0:p.formattedRanges,null==g?void 0:g.formattedRanges))return;return new n.a({deltaType:o.a.FormattingUpdate,formattedRanges:null==g?void 0:g.formattedRanges})}(e,t,i);c&&s.push(c);const l=function(e,t){const s=e,i=t;let r;const c={};let l=!1;for(r in i)-1===["ipPosition","isColdIp","content","formattedRanges"].indexOf(r)&&(a()(i[r],s[r])||(l=!0,c[r]=i[r]));if(l)return new n.a({deltaType:o.a.OtherNonContentUpdate,otherNonContentData:c});return}(e,t);return l&&s.push(l),s}function h(e,t){const s=e.content,r=t.content,a=Object(i.a)(s,r),u=a.firstDiffLeft,d=s.length-a.firstDiffRight,h=r.length-a.firstDiffRight;let p=o.a.Update,g=void 0;if(s.length!==r.length)d===u?(p=o.a.Add,g=s[s.length-1]):h===u&&(p=o.a.Delete,g=r[r.length-1]);else if(s===r)return;let f,m=0;switch(p){case o.a.Update:m=d-u,f=r.substring(u,h);break;case o.a.Add:f=r.substring(u,h);break;case o.a.Delete:m=d-u,f=s.substring(u,d)}const y=function(e,t){const s=Array.from(e.matchAll(c));if(c.lastIndex=0,0===s.length)return o.b.Chars;if(1===s.length){if(0===s[0].index)return t&&l.test(t)?o.b.Sentence:t&&!c.test(t)?o.b.Word:o.b.Chars;if(s[0].index+1===e.length)return l.test(e[s[0].index-1])?o.b.Sentence:c.test(e[s[0].index-1])?o.b.Chars:o.b.Word;if(e[s[0].index-1]){const t=e[s[0].index-1];if(l.test(t))return o.b.Sentence;if(c.test(t))return o.b.Chars}return o.b.Word}const n=Array.from(e.matchAll(l));if(l.lastIndex=0,0===n.length)return o.b.PartialSentence;if(n.length>1)return o.b.Paragraph;if(n[0].index+1<=e.length)return c.test(e[n[0].index+1])?o.b.Sentence:o.b.Paragraph;return}(f,g);if(void 0!==y)return new n.a({content:p!==o.a.Delete?f:void 0,deltaType:p,unit:y,position:u,length:p!==o.a.Add?m:0})}},39512:function(e,t,s){"use strict";function o(e,t,s=!1){let o,r,a={firstDiffLeft:0,firstDiffRight:t.length};return e.length<t.length?(o=e,r=t):(o=t,r=e),0===r.indexOf(o)?(a.firstDiffLeft=o.length,a.firstDiffRight=0):r.endsWith(o)?(a.firstDiffLeft=0,a.firstDiffRight=o.length):(a=function(e,t,s=!1){const o={firstDiffLeft:0,firstDiffRight:t.length};let i;for(i=0;i<e.length&&i<t.length;i+=1){const o=e.charCodeAt(i),r=t.charCodeAt(i);if(!(o===r||n(o,s)&&n(r,s)))break}for(o.firstDiffLeft=i,i=0;i<e.length&&i<t.length;i+=1){const o=e.charCodeAt(e.length-i-1),r=t.charCodeAt(t.length-i-1);if(!(o===r||n(o,s)&&n(r,s)))break}return o.firstDiffRight=i,o}(e,t,s),a.firstDiffLeft+a.firstDiffRight>o.length&&(a.firstDiffRight=o.length-a.firstDiffLeft)),function(e,t,s){if(e.firstDiffLeft>0){const o=e.firstDiffLeft<t.length&&i(t,e.firstDiffLeft),n=e.firstDiffLeft<s.length&&i(s,e.firstDiffLeft);(o||n)&&(e.firstDiffLeft-=1)}if(e.firstDiffRight>1){const o=e.firstDiffRight<t.length&&i(t,t.length-e.firstDiffRight),n=e.firstDiffRight<s.length&&i(s,s.length-e.firstDiffRight);(o||n)&&(e.firstDiffRight-=1)}}(a,e,t),a}function n(e,t=!1){switch(e){case 12288:case 8197:case 32:case 11:case 9:case 160:return!0;case 13:case 10:case 65532:return!t}return!1}function i(e,t){return e.charCodeAt(t)>=56320&&e.charCodeAt(t)<=57343}s.d(t,"a",(function(){return o}))},39513:function(e,t,s){"use strict";var o,n,i;s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return n})),function(e){e[e.Add=0]="Add",e[e.Delete=1]="Delete",e[e.Update=2]="Update",e[e.CursorUpdate=3]="CursorUpdate",e[e.FormattingUpdate=4]="FormattingUpdate",e[e.OtherNonContentUpdate=5]="OtherNonContentUpdate"}(o||(o={})),function(e){e[e.Chars=0]="Chars",e[e.Word=1]="Word",e[e.PartialSentence=2]="PartialSentence",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(n||(n={})),function(e){e[e.SessionUser=0]="SessionUser",e[e.Programmatic=1]="Programmatic",e[e.Collaborator=2]="Collaborator"}(i||(i={}))},39514:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return i}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Text_TextTileDelta"}static getBaseTypes(){return["AugLoop_Core_ItemDelta"]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Text_FormattedTextTileDelta"}static getBaseTypes(){return["AugLoop_Text_TextTileDelta","AugLoop_Core_ItemDelta"]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()}},39515:function(e,t,s){"use strict";function o(){return"xxxxxxxx-xxxx-xxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}s.d(t,"a",(function(){return o}))},39516:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));const o=e=>n(e,Number.POSITIVE_INFINITY),n=(e,t)=>{let s=0;const o=[],n=[e];for(;n.length>0;){const e=n.pop(),i=typeof e;if("boolean"===i)s+=4;else if("string"===i)s+=2*e.length;else if("number"===i)s+=8;else if("object"===i&&e&&-1===o.indexOf(e))if(e instanceof Uint8Array)s+=e.length;else{o.push(e);for(const t in e)n.push(e[t])}if(s>t)return s}return s}},39517:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return n}));var o=s(39518);class n{static deserialize(t,s=(e=>e)){if(t[0]!==n.IDENTIFIERBYTE)throw new Error("Invalid Binary: Incorrect Identifier");let o=1;const i=[],r=new DataView(t.buffer,t.byteOffset,t.byteLength);for(;o<t.byteLength;){if(o+4>t.byteLength)throw new Error("Invalid Binary: Error reading fragment length");const s=r.getUint32(o);if(o+s+4>t.byteLength)throw new Error("Invalid Binary: Fragment out of range");void 0!==e&&e.from?i.push(e.from(t.buffer,t.byteOffset+o+4,s)):i.push(new Uint8Array(t.buffer,t.byteOffset+o+4,s)),o+=4+s}if(i.length<1)throw new Error("Invalid Binary: No fragments found");const a=n.textDecoder.decode(i[0]);return JSON.parse(a,(e,t)=>{if("string"==typeof t){if(t.substring(0,n.BINARYKEYWORD.length)===n.BINARYKEYWORD){const e=parseInt(t.substring(n.BINARYKEYWORD.length),10);if("number"!=typeof e||e>=i.length-1)throw new Error("Invalid Binary: Binary index out of range");return s(i[e+1])}if(t.substring(0,n.ESCAPEKEYWORD.length)===n.ESCAPEKEYWORD)return t.substring(n.ESCAPEKEYWORD.length)}return t})}static serialize(e){const t=[void 0],s=JSON.stringify(e,(e,s)=>ArrayBuffer.isView(s)?(t.push(s),`${n.BINARYKEYWORD}${t.length-2}`):s&&"Buffer"===s.type&&Array.isArray(s.data)?(t.push(new Uint8Array(s.data)),`${n.BINARYKEYWORD}${t.length-2}`):"string"==typeof s&&s.substring(0,n.ESCAPEKEYWORD.length)===n.ESCAPEKEYWORD?n.ESCAPEKEYWORD+s:s);t[0]=n.textEncoder.encode(s);const o=t.reduce((e,t)=>e+4+t.byteLength,0),i=new Uint8Array(o+1);i[0]=n.IDENTIFIERBYTE;let r=1;const a=new DataView(i.buffer,i.byteOffset,i.byteLength);for(const n of t)a.setUint32(r,n.byteLength),i.set(n,r+4),r+=4+n.byteLength;return i}}n.IDENTIFIERBYTE=3,n.BINARYKEYWORD=":b",n.ESCAPEKEYWORD=":",n.textDecoder=new o.a,n.textEncoder=new o.b}).call(this,s(12458).Buffer)},39518:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return n}));const{AugLoopTextEncoder:o,AugLoopTextDecoder:n}=(()=>{if("undefined"==typeof TextEncoder){s(39519);const e={AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder};return TextEncoder=void 0,TextDecoder=void 0,e}return{AugLoopTextEncoder:TextEncoder,AugLoopTextDecoder:TextDecoder}})()},39519:function(e,t,s){(function(e,t){!function(e){"use strict";function s(e){for(var t=0,s=Math.min(65536,e.length+1),o=new Uint16Array(s),n=[],i=0;;){var r=t<e.length;if(!r||i>=s-1){var a=o.subarray(0,i);if(n.push(String.fromCharCode.apply(null,a)),!r)return n.join("");e=e.subarray(t),t=0,i=0}var c=e[t++];if(0==(128&c))o[i++]=c;else if(192==(224&c)){var l=63&e[t++];o[i++]=(31&c)<<6|l}else if(224==(240&c)){l=63&e[t++];var u=63&e[t++];o[i++]=(31&c)<<12|l<<6|u}else if(240==(248&c)){var d=(7&c)<<18|(l=63&e[t++])<<12|(u=63&e[t++])<<6|63&e[t++];d>65535&&(d-=65536,o[i++]=d>>>10&1023|55296,d=56320|1023&d),o[i++]=d}}}var o="Failed to ",n=function(e,t,s){if(e)throw new Error("".concat(o).concat(t,": the '").concat(s,"' option is unsupported."))},i="function"==typeof t&&t.from,r=i?function(e){return t.from(e)}:function(e){for(var t=0,s=e.length,o=0,n=Math.max(32,s+(s>>>1)+7),i=new Uint8Array(n>>>3<<3);t<s;){var r=e.charCodeAt(t++);if(r>=55296&&r<=56319){if(t<s){var a=e.charCodeAt(t);56320==(64512&a)&&(++t,r=((1023&r)<<10)+(1023&a)+65536)}if(r>=55296&&r<=56319)continue}if(o+4>i.length){n+=8,n=(n*=1+t/e.length*2)>>>3<<3;var c=new Uint8Array(n);c.set(i),i=c}if(0!=(4294967168&r)){if(0==(4294965248&r))i[o++]=r>>>6&31|192;else if(0==(4294901760&r))i[o++]=r>>>12&15|224,i[o++]=r>>>6&63|128;else{if(0!=(4292870144&r))continue;i[o++]=r>>>18&7|240,i[o++]=r>>>12&63|128,i[o++]=r>>>6&63|128}i[o++]=63&r|128}else i[o++]=r}return i.slice?i.slice(0,o):i.subarray(0,o)};function a(){this.encoding="utf-8"}a.prototype.encode=function(e,t){return n(t&&t.stream,"encode","stream"),r(e)};var c=!i&&"function"==typeof Blob&&"function"==typeof URL&&"function"==typeof URL.createObjectURL,l=["utf-8","utf8","unicode-1-1-utf-8"],u=s;i?u=function(e,s){return(e instanceof t?e:t.from(e.buffer,e.byteOffset,e.byteLength)).toString(s)}:c&&(u=function(e){try{return function(e){var t;try{var s=new Blob([e],{type:"text/plain;charset=UTF-8"});t=URL.createObjectURL(s);var o=new XMLHttpRequest;return o.open("GET",t,!1),o.send(),o.responseText}finally{t&&URL.revokeObjectURL(t)}}(e)}catch(t){return s(e)}});var d="construct 'TextDecoder'",h="".concat(o," ").concat(d,": the ");function p(e,s){if(n(s&&s.fatal,d,"fatal"),e=e||"utf-8",!(i?t.isEncoding(e):-1!==l.indexOf(e.toLowerCase())))throw new RangeError("".concat(h," encoding label provided ('").concat(e,"') is invalid."));this.encoding=e,this.fatal=!1,this.ignoreBOM=!1}p.prototype.decode=function(e,t){var s;return n(t&&t.stream,"decode","stream"),s=e instanceof Uint8Array?e:e.buffer instanceof ArrayBuffer?new Uint8Array(e.buffer):new Uint8Array(e),u(s,this.encoding)},e.TextEncoder=e.TextEncoder||a,e.TextDecoder=e.TextDecoder||p}("undefined"!=typeof window?window:void 0!==e?e:this)}).call(this,s(10702),s(12458).Buffer)},39520:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{constructor(e){this.childCount=0,this.id=e||function(){for(let e=0;e<22;e++)i[e]=n[Math.floor(Math.random()*n.length)];return i.join("")}()}static fromString(e,t){if(!e)throw new Error("Received invalid correlation vector string");let s;return s=e.endsWith(".0")?new o(e.substring(0,e.length-2)):new o(e),t&&(s.childCount=t),s}newChild(){return++this.childCount,new o(this.id+"."+this.childCount.toString())}toString(){return this.id.length>127?this.id.substring(0,127)+"!":this.id}}const n=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],i=new Array(22)},39521:function(e,t,s){"use strict";s.d(t,"b",(function(){return r})),s.d(t,"a",(function(){return a}));var o=s(39468),n=s(39523),i=s(39522);const r=(e,t,s,o)=>new i.a(e,e=>e.success&&s.indexOf(e[t])>=0,[t,"resourceId","success","resultSignature","clientDocSessionId","dimension0","dimension1","dimension2","dimension3"],["durationMs"],o);class a{constructor(e){this.level=o.a.info,this.hostCallbacks=e}log(e){if(null==this.hostCallbacks||null==this.hostCallbacks.sendTelemetryEvent)return;const t=(e,t,s,o,i)=>{let r=t.charAt(0).toUpperCase()+t.slice(1),c={DocSessionId:e.clientDocSessionId,ResourceId:e.resourceId,ResultDescription:e.resultDescription,ResultSignature:e.resultSignature,Dimension0:e.dimension0,Dimension1:e.dimension1,Dimension2:e.dimension2,Dimension3:e.dimension3,JoinContextId:e.joinContextId};s&&(c=Object.assign(Object.assign({},c),JSON.parse(s)));const l=o||a.augLoopAriaTenantToken,u=i||l!=a.augLoopAriaTenantToken?i:a.augLoopAriaNamespace;r=r||a.operationNamePlaceholder;const d={CV:e.cv,Duration:1e3*(e.durationMs||0),Count:e.count,AggMode:2,Success:e.success};this.hostCallbacks.sendTelemetryEvent(l,u?`${u}_${r}`:r,c,"Office.System.Activity",d,!1,n.a.ProductServiceUsage|n.a.ProductServicePerformance,n.b.RequiredServiceDataEvent)},s=(e,t,s)=>{this.hostCallbacks.sendDiagnosticTrace&&this.hostCallbacks.sendDiagnosticTrace(e,t,s)};if("Workflow.MetricsOnly"==e.category);else if("Operation"===e.eventName){const s=e;t(s,s.operationName,s.dataFields)}else if("SessionHealth"===e.eventName){t(e,e.sessionHealthEventName)}else if("WorkflowOperation"===e.eventName){const s=e;t(s,s.operationName,s.dataFields,s.ariaTenant,s.ariaNamespace)}else"Log"===e.eventName&&s(e.tagId,e.traceLevel,e.message)}}a.augLoopAriaTenantToken="3de4087d4de34817b1c376e3d1e6e293-983c4292-5ba9-485a-ab10-9797863c788b-6770",a.augLoopAriaNamespace="Office_AugLoop_Client",a.operationNamePlaceholder="OperationNameNotProvided"},39522:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const o=/\|\~/g;class n{constructor(){this.count=0,this.measureSums=new Map}}class i{constructor(e,t,s,i,r){this.buckets=new Map,this.init=e=>{this.log=e},this.add=(e,t=!0)=>{if(!this.condition||!this.condition(e))return!0===t&&this.log(e,!1),!1;const s=[];for(const n of this.dimensions)if(void 0===e[n]||null===e[n])s.push(null);else{let t="";"boolean"==typeof e[n]?t="b~":"number"==typeof e[n]&&(t="n~"),s.push(`${t}${e[n].toString().replace(o,"_")}`)}const i=s.join("|");let r=this.buckets.get(i);if(!r){r=new n,r.traceLevel=e.traceLevel;for(const e of this.avgMeasures)r.measureSums.set(e,0);this.buckets.set(i,r)}r.count++;for(const o of this.avgMeasures)e[o]&&r.measureSums.set(o,r.measureSums.get(o)+e[o]);return!0},this.flush=(e=!1)=>{this.buckets.forEach((e,t)=>{const s={traceLevel:e.traceLevel,eventName:this.eventName,count:e.count},o=t.split("|");for(let n=0;n<this.dimensions.length;n++){const e=this.dimensions[n],t=o[n];0===t.indexOf("b~")?s[e]="b~true"===t:0===t.indexOf("n~")?s[e]=parseInt(t.slice("n~".length),10):s[e]=t}for(const n of this.avgMeasures)s[n]=Math.round(e.measureSums.get(n)/e.count);this.log(s,!0)}),this.buckets.clear(),e&&(this.condition=null,clearInterval(this.interval))},this.eventName=e,this.condition=t,this.dimensions=s,this.avgMeasures=i,r>0&&(this.interval=setInterval(this.flush,1e3*r))}}},39523:function(e,t,s){"use strict";var o,n;s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return n})),function(e){e[e.ProductServiceUsage=2]="ProductServiceUsage",e[e.ProductServicePerformance=4]="ProductServicePerformance"}(o||(o={})),function(e){e[e.BasicEvent=10]="BasicEvent",e[e.FullEvent=100]="FullEvent",e[e.RequiredServiceDataEvent=110]="RequiredServiceDataEvent"}(n||(n={}))},39524:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(39525),n=s(39529);class i{constructor(e,t,s){this.isOrderingEnabled=e,this.orderedAnnotationResultsProcessor=null!=t?t:new o.a,this.unorderedAnnotationResultsProcessor=null!=s?s:new n.a}process(e,t,s,o){this.isOrderingEnabled()?this.orderedAnnotationResultsProcessor.process(e,t,s,o):this.unorderedAnnotationResultsProcessor.process(e,t,s,o)}}},39525:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39526);class n{constructor(e){this.annotationSequencer=null!=e?e:new o.a}process(e,t,s,o){const n=[];for(const i of e.ops){const e=[];if(null==i?void 0:i.items)for(const s of i.items){const o=this.annotationSequencer.sequence(s.body).then(()=>{t(i,s)});e.push(o)}n.push(Promise.all(e).then(()=>{s(i)}))}Promise.all(n).then(()=>o(e))}}},39526:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(39527),n=function(e,t,s,o){return new(s||(s=Promise))((function(n,i){function r(e){try{c(o.next(e))}catch(t){i(t)}}function a(e){try{c(o.throw(e))}catch(t){i(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,a)}c((o=o.apply(e,t||[])).next())}))};class i{constructor(e=500,t){this.sequencerFactory=null!=t?t:new o.a(e)}sequence(e){var t;return n(this,void 0,void 0,(function*(){const s=null===(t=null==e?void 0:e.M_)||void 0===t?void 0:t.seq;if(null==s)return;const o=this.sequencerFactory.create(e);o&&(yield o.sequence(e.M_.seq))}))}}},39527:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39528);class n{constructor(e=500){this.bufferingTimeMs=500,this.workflowIdToSequencersMap=new Map,this.bufferingTimeMs=e}create(e){if(!e.ownerId)return null;let t=this.workflowIdToSequencersMap.get(e.ownerId);return t||(t=new o.a(this.bufferingTimeMs),this.workflowIdToSequencersMap.set(e.ownerId,t)),t}}},39528:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39467);class n{constructor(e=500,t=!1){this.prevSeq=-1,this.bufferingTimeMs=e,this.rejectOutdatedSequenceNumbers=t}sequence(e){return new Promise((t,s)=>{if(e<this.prevSeq){if(this.rejectOutdatedSequenceNumbers){const t=new Error(`BufferingSequencer: Item out of order. Expecting seqId > ${this.prevSeq}. Actual seqId ${e}`);return t.name=n.Rejected,void s(t)}this.prevSeq=-1}e!=this.prevSeq+1&&o.a.warn(542712385,o.b.CoreDefault,`BufferingSequencer: got out of order sequence number. Got ${e}, expected ${this.prevSeq+1}`);const i={seq:e,resolve:t};this.insertItem(i),this.runInOrder(i,!0,!1)})}insertItem(e){if(!this.firstQueueItem)return this.firstQueueItem=e,void(this.lastQueueItem=e);let t=this.lastQueueItem,s=null;do{if(e.seq>t.seq)return e.prev=t,t.next=e,void(s?s.prev=e:this.lastQueueItem=e);s=t,t=t.prev}while(t);s&&(s.prev=e),e.next=s,this.firstQueueItem=e}runInOrder(e,t,s){let o=this.prevSeq,n=!1;const i=[];for(;this.firstQueueItem;){const t=this.firstQueueItem;if(o+1!=t.seq&&(!s||t.seq>e.seq))break;o=t.seq,t.timeout&&clearTimeout(t.timeout),i.push(t),e==t&&(n=!0),this.firstQueueItem=this.firstQueueItem.next,this.firstQueueItem&&(this.firstQueueItem.prev=null)}i.length>0&&setTimeout(()=>{for(const e of i)e.resolve(e.seq)},0),this.prevSeq=o,!n&&t&&(e.timeout=setTimeout(()=>{this.runInOrder(e,!1,!0)},this.bufferingTimeMs))}}n.Rejected="SequenceItemRejected"},39529:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{process(e,t,s,o){for(const n of e.ops){if(null==n?void 0:n.items)for(const e of n.items)t(n,e);s(n)}o(e)}}},39530:function(e,t,s){"use strict";s.d(t,"a",(function(){return x}));var o=s(39479),n=s(39533),i=s(39487),r=s(39538),a=s(39485),c=s(39486),l=s(39494),u=s(39539),d=s(39464),h=s(39467),p=s(39536),g=s(39460),f=s(39478),m=s(39500),y=s(39490),b=s(39540),T=s(39482),w=s(39531),v=s(39497),k=s(39493),S=s(39534),C=s(39507),_=s(39514),I=s(39506),A=s(39532);var M;!function(e){e.Unknown="",e.InputReceived="input",e.JoinMaxAnnnotation="maxAnnotation",e.JoinMaxTimeout="maxTimeout",e.JoinEarlyCompletion="earlyCompletion"}(M||(M={}));class x{constructor(e,t,s){this.executionTrackersByWorkflowNameBySession=new Map,this.workflowsWithSessionAffinity=new Map,this.workflowDefinitionsWithSessionAffinity=[],this.workflowsWithoutSessionAffinity=[],this.pendingScopeExecutionNotificationsByWorkflow=new Map,this.sweepIntervalMs=200,this.sweepTimers=new Map,this.getResourceAsArrayBuffer=(e,t,s)=>this.modelDownloader?this.modelDownloader.getResourceAsArrayBuffer(e,t,s):Promise.reject(new Error("Resource Downloader never created")),this.getResourceAsURL=(e,t,s)=>this.modelDownloader?this.modelDownloader.getResourceAsURL(e,t,s):Promise.reject(new Error("Resource Downloader never created")),this.createModel=e=>(!this.inferenceService&&this.inferenceServiceFactory&&(this.inferenceService=this.inferenceServiceFactory()),this.inferenceService?this.inferenceService.then(t=>t.createModel(e)):Promise.reject(new Error("Inference Service never created"))),this.createModelInputs=()=>{if(!this.inferenceService&&this.inferenceServiceFactory&&(this.inferenceService=this.inferenceServiceFactory()),this.inferenceService)return this.inferenceService.then(e=>e.createInputs());throw new Error("Inference Service never created")},this.nextAnnotationId=1,this.nextSignalId=1,this.modelDownloader=e,this.inferenceServiceFactory=t,s.enableDeltas&&(this.deltaHandlers=(new Map).set(o.a.getTypeNameFor(_.b),w.b).set(o.a.getTypeNameFor(_.a),w.a),this.itemsForDelta=new Map),this.enableEarlyJoin=s.enableEarlyJoin||!1,this.site={getResourceAsArrayBuffer:this.getResourceAsArrayBuffer,getResourceAsURL:this.getResourceAsURL,createModel:this.createModel,createModelInputs:this.createModelInputs}}getNextClientAnnotationId(){return"#AC"+this.nextAnnotationId++}getNextClientSignalId(){return"#SC"+this.nextSignalId++}registerLocalWorkflow(e,t){const s=new d.a({operationName:"WorkflowRegistration",resourceId:e.id}).start();if(0===e.inputTypes.length)throw new Error("Invalid workflow params");t?(this.workflowsWithSessionAffinity.get(t).push(this.createWorkflowImplementation(e,t)),t.registerContextTypes(Object(C.a)(e.requestedContextTypesRules).map(([e,t])=>e)),t.attachToWorkflowGraph(e),s.setClientMetadata(t.getClientMetadata())):(e.isStateful?(this.workflowDefinitionsWithSessionAffinity.push(e),this.workflowsWithSessionAffinity.forEach((t,s)=>{t.push(this.createWorkflowImplementation(e,s))})):this.workflowsWithoutSessionAffinity.push(this.createWorkflowImplementation(e)),this.workflowsWithSessionAffinity.forEach((t,s)=>{s.registerContextTypes(Object(C.a)(e.requestedContextTypesRules).map(([e,t])=>e)),s.attachToWorkflowGraph(e)})),s.success=!0,h.a.info(572838110,h.b.CoreDefault,s.stop())}getAllRegisteredWorkflowsFromSession(e){const t=[];return t.push(...this.workflowsWithoutSessionAffinity||[]),t.push(...this.workflowsWithSessionAffinity.get(e)||[]),t.map(e=>e.workflow)}getWorkflowDefinitionsByName(e){var t;const s=new Map;return null===(t=this.workflowsWithSessionAffinity.get(e))||void 0===t||t.forEach(e=>s.set(e.workflow.id,e.workflow)),s}getWorkflowDefinitionsWithSessionAffinity(){return this.workflowDefinitionsWithSessionAffinity}attachExecutionTrackerToEachWorkflow(e,t,s){const o=e.getWorkflowNodes(),n=this.executionTrackersByWorkflowNameBySession.get(t),i=(e,o)=>{if(s&&s(e,o),this.enableEarlyJoin){(()=>{for(const e of this.executionTrackersByWorkflowNameBySession.get(t).values())if(e.graphNode.workflow.kind===l.d.Join)for(const t of e.getExecutionState().keys())if(v.a.isParentContextId(t,o))return!0;return!1})()&&(this.cancelSweepTimer(t),this.ensureSweepTimer(t),this.sweepScopeExecutionNotifications())}};for(const r of o){const e=n.get(r.workflow.id),t=new A.a(r,i.bind(this),e);n.set(r.workflow.id,t)}for(const r of n.values())this.setDownstreamWorkflowExecutionTrackers(r,n),this.setUpstreamWorkflowExecutionTrackers(r,n)}canActivateWorkflow(e,t){var s;return e.location===k.a.Local||!!t.hasConnected&&!((null===(s=e.workflow.requiredTokenTypes)||void 0===s?void 0:s.length)>0&&t.getServerAuthenticationState()===g.a.NotAuthenticated)}setDownstreamWorkflowExecutionTrackers(e,t){if(void 0!==e.downstreamWorkflowExecutionTrackers)return;e.downstreamWorkflowExecutionTrackers=new Set;const{graphNode:s}=e;for(const o of s.downstreamWorkflows||[]){const s=t.get(o.workflow.id);this.setDownstreamWorkflowExecutionTrackers(s,t),e.downstreamWorkflowExecutionTrackers.add(s)}}setUpstreamWorkflowExecutionTrackers(e,t){if(void 0!==e.upstreamWorkflowExecutionTrackers)return;e.upstreamWorkflowExecutionTrackers=new Set;const{graphNode:s}=e;for(const o of s.upstreamWorkflows||[]){const s=t.get(o.workflow.id);this.setUpstreamWorkflowExecutionTrackers(s,t),e.upstreamWorkflowExecutionTrackers.add(s)}}deactivateServerWorkflow(e,t){var s;e.location!==k.a.Local&&(null===(s=this.executionTrackersByWorkflowNameBySession.get(t))||void 0===s||s.get(e.workflow.id).clearWorkflowExecutions(),e.isActivated=!1)}addSession(e){this.executionTrackersByWorkflowNameBySession.set(e,new Map);const t=[];for(const s of this.workflowDefinitionsWithSessionAffinity)t.push(this.createWorkflowImplementation(s)),e.attachToWorkflowGraph(s);this.workflowsWithSessionAffinity.set(e,t);for(const s of this.workflowsWithoutSessionAffinity)e.attachToWorkflowGraph(s.workflow)}closeSession(e){this.cancelSweepTimer(e);for(const t of this.workflowsWithSessionAffinity.get(e)||[])t.workflowLambda.dispose();this.workflowsWithSessionAffinity.delete(e)}setTokenCallback(e){this.getAuthTokenCallback=e}preProcessItemToWorkflow(e,t,s){const n=this.executionTrackersByWorkflowNameBySession.get(s).get(e.id);e.kind===l.d.Join&&o.a.matchesTypesFor(t.body,e.inputTypes)&&n.addInputItemToProcess(t.contextId),(e.kind===l.d.SingleItem&&o.a.matchesTypesFor(t.body,e.inputTypes)||e.kind===l.d.Join&&o.a.matchesTypesFor(t.body,[e.collectionScopeType]))&&n.beforeWorkflowExecution(t.contextId)}isReadyToEarlyJoin(e,t,s){const o=o=>{var n;const i=Array.from(null!==(n=o.states)&&void 0!==n?n:[]).map(e=>`${e[0]}: ${e[1].map(e=>e.join())}`).join(),r=new d.a({operationName:"EarlyJoinCompletion",resourceId:e.graphNode.workflow.id,joinContextId:t,success:!0}).start();r.setClientMetadata(s),r.resultDescription=`isReadyToEarlyJoin (${this.enableEarlyJoin}) -> hasProcessedAllInputItems: ${o.hasProcessedAllInputItems}, allUpstreamComplete: ${o.allUpstreamComplete}, states: ${i}`,h.a.info(512550800,h.b.CoreDefault,r.stop())},n=0===e.countItemsToProcess(t);if(!n)return this.enableEarlyJoin||o({hasProcessedAllInputItems:n}),!1;const{allUpstreamComplete:i,states:r}=this.areAllUpstreamWorkflowComplete(e,t);return this.enableEarlyJoin?i:(o({hasProcessedAllInputItems:n,allUpstreamComplete:i,states:r}),!1)}areAllUpstreamWorkflowComplete(e,t){const s=new Map;for(const o of e.upstreamWorkflowExecutionTrackers){const e=[];for(const[n,i]of o.getExecutionState())if(e.push([n,i]),v.a.isParentContextId(t,n))return s.set(o.graphNode.workflow.id,e),{allUpstreamComplete:!1,states:s};e.length>0&&s.set(o.graphNode.workflow.id,e)}return{allUpstreamComplete:!0,states:s}}runLocalWorkflows(e,t,s=!1){var r,a,c;const u=(e,s,i)=>{var r,a;const c=t.getWorkflowItemStorage(),{workflow:u}=e,p=null===(r=this.executionTrackersByWorkflowNameBySession.get(t))||void 0===r?void 0:r.get(u.id),g=u.inputTypes.concat(u.kind===l.d.Join?u.collectionScopeType:[]),f=new d.a({operationName:"RunLocalWorkflows",success:!0,resourceId:u.id,joinContextId:s.contextId}).start();if(f.setClientMetadata(t.getClientMetadata()),o.a.matchesTypesFor(s.body,g)){const r=Object(I.b)(i.parentPath,s);if(u.kind===l.d.Join){if(o.a.matchesTypesFor(r.body,[u.collectionScopeType]))return c.setScopeItem(r,u),f.resultDescription=`Scope item: ${s.id} (${o.a.getTypeNameFor(s.body)})`,h.a.info(524126153,h.b.CoreDefault,f.stop()),void this.setScopeExecutionNotification(t,e,r,y.b.Internal);{p.removeProcessedInputItem(r.contextId);const e=c.getScopeItem(r.contextId,u);if(!e)return f.resultDescription=`Filtered out join invalidation: out of scope type (${u.collectionScopeType}), item id: ${r.id}`,void h.a.info(541173894,h.b.CoreDefault,f.stop());c.addItemToWorkflowList(r,u),f.joinContextId=e.contextId,f.resultDescription=`Input item: ${s.id} (${o.a.getTypeNameFor(s.body)})`}}if(o.a.getBaseTypesFor(r.body).indexOf(n.a.getTypeName())>=0){const e=[...r.parentPath,r.id];let s=!0;for(const o of null!==(a=u.outputTypes)&&void 0!==a?a:[])if(!t.getContextAnnotations(o,y.a.LocalWorkflow,e,u.id)){s=!1;break}if(s)return}const d=()=>{var o;const[n,i]=t.resolveRequestedContexts(u);if(!n)return f.resultDescription=`Required contexts are not ready for ${u.id}. Retrying execution in 500 milliseconds...`,h.a.info(545837259,h.b.CoreDefault,f.stop()),void setTimeout(d,500);if(u.kind===l.d.SingleItem)this.queueWorkflow({workflowInfo:e,scopeItem:r,inputItems:[r],requestedContexts:i,session:t,orchestrationMode:y.b.Internal,triggerReason:M.InputReceived,onCompleteCallback:this.onWorkflowExecuted.bind(this,r,u,t)}).then(()=>{h.a.info(509154263,h.b.WorkflowDefault,f.stop())}).catch(e=>{f.resultDescription=e,h.a.error(572838111,h.b.CoreDefault,f.stop())});else if(u.kind===l.d.Join){const n=s.contextId,r=c.getScopeItem(n,e.workflow);if(!r)return f.resultDescription=`No scope item for ${u.id} workflow from contextId ${n}`,void h.a.info(526758475,h.b.CoreDefault,f.stop());const a=this.isReadyToEarlyJoin(p,r.contextId,t.getClientMetadata()),l=a?M.JoinEarlyCompletion:M.JoinMaxAnnnotation;if(c.isWorkflowReady(r.contextId,u)||a){if(!(null===(o=this.pendingScopeExecutionNotificationsByWorkflow.get(u.id))||void 0===o?void 0:o.get(r.contextId)))return f.resultDescription=`Workflow ${u.id}, contextId ${r.contextId}, already queued, skipping new scope execution`,void h.a.info(528048977,h.b.CoreDefault,f.stop());const s=c.getItemsToExecute(r.contextId,u);this.queueWorkflow({workflowInfo:e,scopeItem:r,inputItems:s,requestedContexts:i,session:t,orchestrationMode:y.b.Internal,triggerReason:l,onCompleteCallback:this.onWorkflowExecuted.bind(this,r,u,t)}).then(()=>{h.a.info(509154262,h.b.WorkflowDefault,f.stop())}).catch(e=>{f.resultDescription=e,h.a.error(541173895,h.b.CoreDefault,f.stop())}),this.pendingScopeExecutionNotificationsByWorkflow.get(u.id).delete(r.contextId),0===this.pendingScopeExecutionNotificationsByWorkflow.get(u.id).size&&this.pendingScopeExecutionNotificationsByWorkflow.delete(u.id)}}};d()}};let p=e;s&&(p=[new i.a({parentPath:["session"],items:[{id:"#userContext#",body:new n.e}]}),new i.a({parentPath:["session"],items:[{id:"#tenantContext#",body:new n.d}]})],t.getContextIdManager().applyContextIdOnOperations(p),p=p.concat(e));for(const n of p){const e=o.a.getTypeNameFor(n);for(const s of n.items)if(t.applyOperationForContext(n,s,y.a.Submitted),e!==i.b.getTypeName()){if(s.body)if(e===i.c.getTypeName()&&this.deltaHandlers&&this.itemsForDelta)this.handleLocalDeltaUpdate(s,n,t);else{null===(a=this.itemsForDelta)||void 0===a||a.set(n.parentPath.concat(s.id).toString(),s);for(const e of this.workflowsWithoutSessionAffinity)u(e,s,n);for(const e of null!==(c=this.workflowsWithSessionAffinity.get(t))&&void 0!==c?c:[])u(e,s,n)}}else null===(r=this.itemsForDelta)||void 0===r||r.delete(n.parentPath.concat(s.id).toString())}}handleLocalDeltaUpdate(e,t,s){const n=new d.a({operationName:"LocalDeltaUpdate",dimension0:o.a.getTypeNameFor(e.body),success:!0});n.start();try{const r=this.deltaHandlers.get(o.a.getTypeNameFor(e.body)),a=this.itemsForDelta.get(t.parentPath.toString());if(r&&a){const o=t.parentPath.length>0?t.parentPath.slice(0,t.parentPath.length-1):t.parentPath,c=r(e.body,a.body);if(c){const t={id:a.id,revId:e.revId,body:c,parentPath:o,delta:e.body,contextId:e.contextId},r=new i.d({parentPath:t.parentPath,items:[t]});h.a.info(539637591,h.b.CoreDefault,n.stop()),this.runLocalWorkflows([r],s)}else n.success=!1,n.resultDescription="Failed because the handler did not produce valid updated item",h.a.info(539637592,h.b.CoreDefault,n.stop())}else n.success=!1,n.resultDescription="Failed due to lack of handler or parent item",h.a.info(539637593,h.b.CoreDefault,n.stop())}catch(r){n.success=!1,n.resultDescription="Failed to apply delta, error: "+r,h.a.info(539637594,h.b.CoreDefault,n.stop())}}createWorkflowImplementation(e,t){const s=e.factory();return{workflow:e,workflowLambda:s,initPromise:this.initWorkflow(e.kind,s,t)}}initWorkflow(e,t,s){var o;const n=new S.a({model:void 0,clientMetadata:s?s.getClientMetadata():void 0,userContext:s?s.getUserContext():void 0,site:this.site,getTokenCallback:null===(o=this.getAuthTokenCallback)||void 0===o?void 0:o.bind(this)});return e===l.d.SingleItem||e===l.d.Join?t.init(this.site,n):Promise.resolve()}queueWorkflow(e){return this.executionTrackersByWorkflowNameBySession.get(e.session).get(e.workflowInfo.workflow.id).setExecutionState(e.scopeItem.contextId,v.b.Running),this.executeLocalWorkflow(e.workflowInfo,e.scopeItem,e.inputItems,e.session,e.requestedContexts,e.orchestrationMode,e.triggerReason).then(t=>{this.processAnnotationResults(t,e.session),e.onCompleteCallback()}).catch(t=>{throw e.onCompleteCallback(),t})}processAnnotationResults(e,t){for(const s of e)t.onAnnotationResults(s,y.a.LocalWorkflow,()=>{})}executeLocalWorkflow(e,t,s,g,T,w,v){return new Promise((k,C)=>{var _,I,A;const M=[],E=e.workflow,D=new d.a({operationName:"ExecuteWorkflow",resourceId:E.id,joinContextId:null!==(_=null==t?void 0:t.contextId)&&void 0!==_?_:"",resultDescription:null!=v?v:"",success:!0}).setClientMetadata(g.getClientMetadata());D.start();const N=null!==(I=null==t?void 0:t.contextId)&&void 0!==I?I:s[0].contextId,B=null!==(A=null==t?void 0:t.revId)&&void 0!==A?A:s[0].revId,P=(()=>{const e=new Map;if(t&&(t.parentPath||h.a.error(525382231,h.b.CoreDefault,`Missing scope item parent. Workflow: ${E.id}. Type: ${o.a.getTypeNameFor(t.body)}`),e.set(t.body,t)),Array.isArray(s))for(const t of s)t&&t.body&&(t.parentPath||h.a.error(525382232,h.b.CoreDefault,`Missing parent. Workflow: ${E.id}. Type: ${o.a.getTypeNameFor(t.body)}`),e.set(t.body,t));return e})(),O=(e,t=D)=>{if(e)return t.success=!1,t.resultDescription+="string"==typeof e?e:e.message,t.resultSignature="Exception",h.a.error(572838112,h.b.CoreDefault,t.stop()),"string"==typeof e?new Error(e):e;h.a.info(572838113,h.b.CoreDefault,t.stop())},R=new S.a({model:new b.a(s[0],T),clientMetadata:g.getClientMetadata(),userContext:g.getUserContext(),site:this.site,getTokenCallback:this.getAuthTokenCallback.bind(this)}),W=e=>{O(e?e.message:void 0),e?C(e):k(M)},L={setAnnotations:(c,u,m,b)=>{var T;const v=new d.a({operationName:"SetAnnotations",resourceId:u,joinContextId:null!==(T=null==t?void 0:t.contextId)&&void 0!==T?T:"",success:!0}).setClientMetadata(g.getClientMetadata());v.start();const k=t=>{h.a.info(555866112,h.b.CoreDefault,new p.a({annotationType:u,annotationState:t,workflowId:e.workflow.id}))};for(const e of m)e.metadata=Object.assign(Object.assign({},e.metadata),{state:r.a.Created}),k(r.a.Created);const S=P.get(c),_=o.a.getTypeNameFor(S.body),I=(()=>{var e;if(E.kind===l.d.SingleItem&&s[0].body!==c){const e=`Expected obj to be ${s[0].body} but instead it was ${c}`;return O(e,v),void C(O(e))}let t,n;if(Array.isArray(m))if(!E.outputTypes||E.outputTypes.indexOf(u)<0)t=`Workflow said it would output one of [${E.outputTypes}] but instead output ${u}`;else if(S)for(const s of m)o.a.matchesTypesFor(s,[a.a.getTypeName()])?o.a.getTypeNameFor(s)!==u&&(t=`Workflow produced inconsistent annotation types in setAnnotations call (${o.a.getTypeNameFor(s)} did not match expected ${u})`):t="Workflow produced an output that is not an annotation "+o.a.getTypeNameFor(s);else t="No item provided";else t="Workflow produced an invalid annotation array";if(t)return O(t,v),void C(O(t));if(n=b&&b.isSessionAnnotation?["session"]:b&&b.ancestorType?S.parentPath:S.parentPath.concat(S.id),w===y.b.External)return;const d=[],p=[];for(const s of m){s.metadata=Object.assign(Object.assign({},s.metadata),{state:r.a.Sent}),k(r.a.Sent);const t=s.id,o=t?null===(e=g.getContextAnnotations(u,y.a.LocalWorkflow,n,E.id))||void 0===e?void 0:e.filter(e=>{var s;return(null===(s=e.body)||void 0===s?void 0:s.id)==t}):void 0;1==(null==o?void 0:o.length)?1==o.length?p.push({id:o[0].id,source:E.id,revId:B,body:s,contextId:N}):h.a.error(545837260,h.b.CoreDefault,`Assert: Multiple existing context annotations with body id ${t} found for ${u} and local workflow ${E.id}).`):d.push({id:this.getNextClientAnnotationId(),source:E.id,revId:B,body:s,contextId:N})}const T=[];return d.length>0&&T.push(new i.a({parentPath:n,items:d,parentRevId:B})),p.length>0&&T.push(new i.g({parentPath:n,items:p,parentRevId:B})),new f.g({annotationType:u,ops:T})})();I?(b&&b.immediate?g.onAnnotationResults(I,y.a.LocalWorkflow,()=>{}):M.push(I),(_==n.e.getTypeName()||_==n.d.getTypeName()||o.a.matchesTypesFor(S.body,[n.b.getTypeName(),n.c.getTypeName()]))&&g.submitOperationsToSession(I.ops),h.a.info(509644822,h.b.CoreDefault,v.stop())):h.a.info(509644823,h.b.CoreDefault,v.stop())},submitSignals:e=>{if(w===y.b.External)return void C(O("NYI"));const t=new d.a({operationName:"submitSignalsAction",resourceId:E.id,success:!0}).setClientMetadata(g.getClientMetadata());for(const i of e){const e=o.a.getTypeNameFor(i);o.a.matchesTypesFor(i,[c.a.getTypeName()])||(t.resultDescription=`Workflow produced an output that is not an signal (${o.a.getTypeNameFor(i)})`,h.a.info(521413954,h.b.CoreDefault,t)),E.outputTypes&&-1!==E.outputTypes.indexOf(e)||(t.resultDescription=`Workflow said it would output one of [${E.outputTypes}] but instead output ${e}`,h.a.info(521413953,h.b.CoreDefault,t)),i.timestamp&&(x.logTimestampUsageByWorkflowId.has(E.id)||(x.logTimestampUsageByWorkflowId.add(E.id),t.resultDescription=`Workflow "${E.id}" sets signal.timeStamp`,h.a.info(509212803,h.b.CoreDefault,t)))}const s=e.map(e=>({id:this.getNextClientSignalId(),source:E.id,revId:B,body:e,contextId:N})),n=new i.e({parentPath:["session"],parentRevId:B,items:s});g.submitOperations([n])},done:W,overrideWorkflowDefinition:(e,s,o)=>{let n;switch(o){case u.a.JoinContext:if(!t.contextId){const e="ContextId is not defined for this scope item.";throw h.a.error(527472289,h.b.CoreDefault,e),new Error(e)}n=t.contextId;break;case u.a.Session:n=void 0;break;default:{const e="Defined scope is not supported. "+o;throw h.a.error(527472290,h.b.CoreDefault,e),new Error(e)}}const i=new m.a({definition:s,contextId:n,sourceWorkflowId:E.id,targetWorkflowId:e});g.onWorkflowDefinitionOverrideMessage(i)},getDynamicAnnotations:void 0,setBillingDomain:void 0},F=e.workflowLambda;if(E.kind===l.d.SingleItem){1!==s.length&&W(new Error("Single item workflows expect a single input")),R.delta=s[0].delta,R.deltas=s[0].deltas;try{const t=F;e.initPromise||(e.initPromise=t.init(this.site,R)),e.initPromise.then(()=>{t.execute(s[0].body,R,L)}).catch(e=>{O(e)})}catch(q){O(q)}}else if(E.kind===l.d.Join){0===s.length&&W(new Error("Join workflows expect an inputs array")),R.delta=t.delta,R.deltas=t.deltas;try{const o=F;e.initPromise||(e.initPromise=o.init(this.site,R)),e.initPromise.then(()=>{o.execute(t.body,s.map(e=>e.body),R,L)}).catch(e=>{O(e)})}catch(q){O(q)}}else O(`Workflow kind ${E.kind} not supported`)})}ensureSweepTimer(e){if(!this.sweepTimers.get(e)){const t=setInterval(this.onSweep.bind(this),this.sweepIntervalMs);this.sweepTimers.set(e,t)}}cancelSweepTimer(e){const t=this.sweepTimers.get(e);this.sweepTimers.get(e)&&(clearInterval(t),this.sweepTimers.delete(e))}onSweep(){this.sweepScopeExecutionNotifications()}setScopeExecutionNotification(e,t,s,o){var n,i;const r=Date.now(),a={session:e,workflowImplementation:t,scopeItem:s,startTime:r,minTime:r+Object(T.d)(t.workflow.minDelayMs,1e3),maxTime:r+Object(T.d)(t.workflow.maxDelayMs,5e3),orchestrationMode:o},c=t.workflow.kind===l.d.Join?s.contextId:a.scopeItem.parentPath.concat(s.id).join("\\");this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id)||this.pendingScopeExecutionNotificationsByWorkflow.set(t.workflow.id,new Map);if(this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).get(c)){const o=new d.a({resultDescription:`Duplicated pending scope execution for ${t.workflow.id} at ${c}`,operationName:"LocalScopeExecutionNotification",resourceId:t.workflow.id,joinContextId:null!==(i=null==s?void 0:s.contextId)&&void 0!==i?i:"",success:!0}).setClientMetadata(e.getClientMetadata()).start();h.a.info(509727899,h.b.CoreDefault,o.stop())}else{const o=new d.a({resultDescription:`New pending scope execution for ${t.workflow.id} at ${c}`,operationName:"LocalScopeExecutionNotification",resourceId:t.workflow.id,joinContextId:null!==(n=null==s?void 0:s.contextId)&&void 0!==n?n:"",success:!0}).setClientMetadata(e.getClientMetadata()).start();h.a.info(539883075,h.b.CoreDefault,o.stop()),this.pendingScopeExecutionNotificationsByWorkflow.get(t.workflow.id).set(c,a)}this.ensureSweepTimer(e)}sweepScopeExecutionNotifications(){var e,t;const s=new Set(Array.from(this.sweepTimers.keys()));for(const[o,n]of Array.from(this.pendingScopeExecutionNotificationsByWorkflow.entries()))for(const[i,r]of Array.from(n.entries())){const{session:n,workflowImplementation:{workflow:a},orchestrationMode:c}=r,u=n.getWorkflowItemStorage(),p=new d.a({operationName:"LocalScopeExecutionNotification",resourceId:a.id,joinContextId:null!==(t=null===(e=r.scopeItem)||void 0===e?void 0:e.contextId)&&void 0!==t?t:"",success:!0}).setClientMetadata(n.getClientMetadata()).start(),g=()=>{if(a.kind===l.d.Join){const e=Date.now(),{workflow:t}=r.workflowImplementation,s=r.scopeItem.contextId,o=n.getWorkflowDefinition(t,s).maxDelayMs;return u.isWorkflowReady(s,t)?(p.resultDescription=`Join Workflow: ${t.id} queuing by maxAnnotation, contextId: ${s}`,h.a.info(528048978,h.b.CoreDefault,p.stop()),{isValid:!0,triggerReason:M.JoinMaxAnnnotation}):r.startTime+o<e?(p.resultDescription=`Join Workflow: ${t.id} queuing by maxTimeout, contextId: ${s}`,h.a.info(528048979,h.b.CoreDefault,p.stop()),{isValid:!0,triggerReason:M.JoinMaxTimeout}):this.isReadyToEarlyJoin(this.executionTrackersByWorkflowNameBySession.get(n).get(t.id),s,n.getClientMetadata())?(h.a.info(512550856,h.b.CoreDefault,`Workflow: ${t.id} queuing by early completion, contextId: ${s}, timeout: ${o}`),{isValid:!0,triggerReason:M.JoinEarlyCompletion}):{isValid:!1,triggerReason:M.Unknown}}return{isValid:!0,triggerReason:M.Unknown}};(()=>{const{isValid:e,triggerReason:t}=g();if(!e)return!1;const[s,o]=n.resolveRequestedContexts(a);if(!s)return!1;try{if(a.kind===l.d.Join){const e=r.scopeItem.contextId,s=u.getScopeItem(e,a);if(s){const i=u.getItemsToExecute(s.contextId,a);if(0===i.length)return p.resultDescription=`Failed to retrieve items for workflow: ${a.id}, contextId: ${e}, skipping execution`,h.a.info(527472291,h.b.CoreDefault,p.stop()),this.onWorkflowExecuted(s,a,n),!0;this.queueWorkflow({workflowInfo:r.workflowImplementation,scopeItem:s,inputItems:i,requestedContexts:o,session:n,orchestrationMode:c,triggerReason:t,onCompleteCallback:this.onWorkflowExecuted.bind(this,s,a,n)}).catch(e=>{p.success=!1,p.resultDescription=e.message,h.a.error(509092189,h.b.CoreDefault,p.stop())})}else p.resultDescription="ContextId no longer exists, skipping workflow execution",h.a.info(539883076,h.b.CoreDefault,p.stop())}else p.resultDescription=`Workflow in type ${a.kind} is not supported`,h.a.error(539883077,h.b.CoreDefault,p.stop())}catch(i){p.resultDescription=`Trying to execute ${a.id} caused an exception: ${i}`,h.a.warn(539883078,h.b.CoreDefault,p.stop())}return!0})()?(this.pendingScopeExecutionNotificationsByWorkflow.get(o).delete(i),0===this.pendingScopeExecutionNotificationsByWorkflow.get(o).size&&this.pendingScopeExecutionNotificationsByWorkflow.delete(o)):s.delete(n)}if(0!==s.size)for(const o of Array.from(s)){const e=new d.a({resultDescription:"No pending scope notifications left, cancelling sweep timer",operationName:"LocalScopeExecutionNotification",success:!0}).start();h.a.debug(539883079,h.b.CoreDefault,e.stop()),this.cancelSweepTimer(o)}}onExternalWorkflowExecuted(e,t,s){const o={id:"",parentPath:[],contextId:e},n={id:t};this.onWorkflowExecuted(o,n,s,!1)}onWorkflowExecuted(e,t,s,o=!0){var n;null===(n=this.executionTrackersByWorkflowNameBySession.get(s).get(t.id))||void 0===n||n.afterWorkflowExecution(e.contextId),o&&t.kind===l.d.Join&&s.getWorkflowItemStorage().onWorkflowExecuted(e,t)}}},39531:function(e,t,s){"use strict";s.d(t,"b",(function(){return u})),s.d(t,"a",(function(){return d}));var o=s(39479),n=s(39464),i=s(39467),r=s(39513),a=s(39509),c=s(39514);const l=[r.a.CursorUpdate,r.a.FormattingUpdate,r.a.OtherNonContentUpdate];function u(e,t,s){const l=new n.a({operationName:"ApplyTextTileDeltaForLocalWorkflows",dimension0:"0",success:!0}).start();try{if(!t)return l.success=!1,l.resultDescription="Unable to apply text tile delta, parent tile is undefined",void i.a.info(538798173,i.b.CoreDefault,l.stop());if(o.a.getTypeNameFor(t)!==a.b.getTypeName())return l.success=!1,l.resultDescription=`Unable to apply text tile delta, parent tile is not proper type: expected ${c.b.getTypeName()}, received ${o.a.getTypeNameFor(t)}`,void i.a.info(538798174,i.b.CoreDefault,l.stop());const s=e,n=t.content;let u="";if(void 0===s.position||s.position<0)return l.success=!1,l.resultDescription="Unable to apply text tile delta, invalid text tile position",void i.a.info(538798175,i.b.CoreDefault,l.stop());switch(s.deltaType){case r.a.Add:u=s.position<n.length?`${n.slice(0,s.position)}${s.content}${n.slice(s.position,n.length)}`:n+s.content;break;case r.a.Update:s.content||s.unit!==r.b.Sentence||(l.dimension0="1"),u=`${n.slice(0,s.position)}${s.content}${n.slice(s.position+(s.length||0),n.length)}`;break;case r.a.Delete:u=`${n.slice(0,s.position)}${n.slice(s.position+(s.length||0),n.length)}`}return i.a.info(538837071,i.b.CoreDefault,l.stop()),new a.b({content:u})}catch(u){return l.success=!1,l.resultDescription="Error applying text tile delta: "+u,void i.a.info(538798176,i.b.CoreDefault,l.stop())}}function d(e,t,s){var c,l,u,d,g,f,m,y;const b=new n.a({operationName:"ApplyFormattedTextTileDeltaForLocalWorkflows",dimension0:"0",success:!0}).start();b.clientFlights=s;try{if(!t)return b.success=!1,b.resultDescription="Unable to apply formatted text tile delta, parent tile is undefined",void i.a.info(538798177,i.b.CoreDefault,b.stop());if(o.a.getTypeNameFor(t)!==a.a.getTypeName())return b.success=!1,b.resultDescription=`Unable to apply formatted text tile delta, parent tile is not proper type: expected ${a.a.getTypeName()}, received ${o.a.getTypeNameFor(t)}`,void i.a.info(538798178,i.b.CoreDefault,b.stop());const s=t,T=e,w=s.content;let v="";if((void 0===T.position||T.position<0)&&!p(T.deltaType))return b.success=!1,b.resultDescription="Unable to apply formatted text tile delta, invalid text tile position",void i.a.info(538798179,i.b.CoreDefault,b.stop());if(void 0===T.content&&!p(T.deltaType))return b.success=!1,b.resultDescription="Unable to apply formatted text tile delta, non-delete, non-formatting, non-other-non-content-update and non-cursor-update operation without content defined",void i.a.info(538798208,i.b.CoreDefault,b.stop());if(T.deltaType===r.a.Add&&0!==T.length?i.a.info(538798209,i.b.CoreDefault,new n.a({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta add operation with delta length, expected length 0",success:!0})):p(T.deltaType)&&void 0!==T.content&&i.a.info(538798210,i.b.CoreDefault,new n.a({operationName:"ApplyDeltaChecks",resultDescription:"Received formatted text tile delta delete or non-content related operation with content defined, expected undefined",success:!0})),!h(T.deltaType)){const e=function(e,t,s){const o=new n.a({operationName:"FindRangeForDelta",success:!0});if(o.start(),!e)return o.resultDescription="No formatted ranges found within the tile, skipping.",void i.a.info(538798212,i.b.CoreDefault,o.stop());if(t===r.a.Add){const t=e.find(e=>e.start===s&&0===e.length);if(t)return o.resultDescription=`Found a zero-length formatted range for add operation with start ${t.start}.`,i.a.info(538798213,i.b.CoreDefault,o.stop()),t;s=Math.max(s-1,0)}const a=e.find(e=>0===e.length?e.start===s:e.start<=s&&s<e.start+e.length);a?(o.resultDescription=`Updating formatted range for operation with start: ${a.start} and length: ${a.length}`,i.a.info(538798214,i.b.CoreDefault,o.stop())):(o.resultDescription=`Unable to find formatted range for operation at position ${s}, skipping.`,i.a.info(538798215,i.b.CoreDefault,o.stop()));return a}(s.formattedRanges,T.deltaType,T.position);let t=s.formattedRanges?[...s.formattedRanges]:[];const o=e?t.indexOf(e):-1;-1!==o&&(T.position+(T.length||0)>e.start+e.length?e.length=T.position+(null!==(c=T.content)&&void 0!==c?c:"").length-e.start:e.length+=(null!==(l=T.content)&&void 0!==l?l:"").length-(T.length||0),t[o]=e);let h=s.ipPosition;switch(T.deltaType){case r.a.Add:v=T.position<w.length?`${w.slice(0,T.position)}${T.content}${w.slice(T.position,w.length)}`:w+T.content,h=T.position+T.length;break;case r.a.Update:T.content||T.unit!==r.b.Sentence||(b.dimension0="1"),v=`${w.slice(0,T.position)}${T.content}${w.slice(T.position+(null!==(u=T.length)&&void 0!==u?u:0),w.length)}`,h=T.position+T.content.length;break;case r.a.Delete:v=`${w.slice(0,T.position)}${w.slice(T.position+(null!==(d=T.length)&&void 0!==d?d:0),w.length)}`,h=T.position}for(const s of t.slice(o+1))s.start<T.position||(T.position+(T.length||0)>s.start?(s.length=s.start+s.length-(T.position+(T.length||0)),s.start=T.position+(null!==(g=T.content)&&void 0!==g?g:"").length):s.start+=(null!==(f=T.content)&&void 0!==f?f:"").length-(T.length||0));t=t.filter(e=>e.length>0);const p=new a.a(Object.assign(Object.assign({},s),{ipPosition:h,content:v,formattedRanges:t,queryRange:T.queryRange}));return i.a.info(538837073,i.b.CoreDefault,b.stop()),p}if(T.deltaType===r.a.CursorUpdate)return new a.a(Object.assign(Object.assign({},s),{ipPosition:null===(m=T.cursorData)||void 0===m?void 0:m.ipPosition,isColdIp:null===(y=T.cursorData)||void 0===y?void 0:y.isColdIp}));if(T.deltaType===r.a.FormattingUpdate)return new a.a(Object.assign(Object.assign({},s),{formattedRanges:T.formattedRanges}));if(T.deltaType===r.a.OtherNonContentUpdate){let e;const t={};for(e in T.otherNonContentData)t[e]=T.otherNonContentData[e];return new a.a(Object.assign(Object.assign({},s),t))}return}catch(T){return b.success=!1,b.resultDescription="Error applying formatted text tile delta: "+T,void i.a.info(538798211,i.b.CoreDefault,b.stop())}}function h(e){return-1!==l.indexOf(e)}function p(e){return h(e)||r.a.Delete===e}},39532:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(39467),n=s(39464),i=s(39497);class r{constructor(e,t,s){this.itemsContextId=new Set,this.executionState=new Map,this.graphNode=e,this.onContextIdWorkflowExecutionComplete=t,s&&(this.itemsContextId=s.itemsContextId,this.executionState=s.executionState)}addInputItemToProcess(e){this.itemsContextId.add(e)}removeProcessedInputItem(e){this.itemsContextId.delete(e)}countItemsToProcess(e){let t=0;for(const s of this.itemsContextId)0===s.indexOf(e)&&(t+=1);return t}getExecutionState(){return this.executionState}setExecutionState(e,t){return this.graphNode.isActivated?e?(this.executionState.set(e,t),!0):(o.a.info(520217546,o.b.CoreDefault,new n.a({operationName:"WorkflowExecutionTracker",resourceId:this.graphNode.workflow.id,joinContextId:e,resultDescription:`Trying to set state ${t} for a undefined contextId (setExecutionState)`})),!1):(o.a.info(508883415,o.b.CoreDefault,new n.a({operationName:"WorkflowExecutionTracker",resourceId:this.graphNode.workflow.id,joinContextId:e,resultDescription:`Trying to set state ${t} for a not activated workflow`})),!1)}beforeWorkflowExecution(e){this.setExecutionState(e,i.b.Pending)}afterWorkflowExecution(e){this.setExecutionState(e,i.b.Executed)&&this.tryToCompleteWorkflowExecution(e)}clearWorkflowExecutions(){this.executionState.forEach((e,t)=>this.afterWorkflowExecution(t))}tryToCompleteWorkflowExecution(e){if(this.executionState.get(e)===i.b.Executed&&this.canCompleteExecution(e)){this.executionState.delete(e),this.onContextIdWorkflowExecutionComplete&&this.onContextIdWorkflowExecutionComplete(this.graphNode.workflow.id,e);for(const t of this.downstreamWorkflowExecutionTrackers)for(const[s,o]of t.getExecutionState())o===i.b.Executed&&i.a.isParentContextId(e,s)&&t.tryToCompleteWorkflowExecution(s)}}canCompleteExecution(e){for(const t of this.upstreamWorkflowExecutionTrackers)for(const s of t.getExecutionState().keys())if(i.a.isParentContextId(s,e))return!1;return!0}}},39533:function(e,t,s){"use strict";s.d(t,"b",(function(){return c})),s.d(t,"c",(function(){return l})),s.d(t,"a",(function(){return g})),s.d(t,"e",(function(){return f})),s.d(t,"d",(function(){return m}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Core_Blob"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Core_Binary"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(e){o.a.assign(r,this,e)}static getTypeName(){return"AugLoop_Core_TileGroup"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[r.getTypeName()])}}r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()};class a{constructor(e){o.a.assign(a,this,e)}static getTypeName(){return"AugLoop_Core_Session"}static getBaseTypes(){return["AugLoop_Core_TileGroup"]}static typeGuard(e){return o.a.matchesTypesFor(e,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class c{constructor(e){o.a.assign(c,this,e)}static getTypeName(){return"AugLoop_Core_Document"}static getBaseTypes(){return["AugLoop_Core_TileGroup"]}static typeGuard(e){return o.a.matchesTypesFor(e,[c.getTypeName()])}}c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};class l{constructor(e){o.a.assign(l,this,e)}static getTypeName(){return"AugLoop_Core_SubDocument"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[l.getTypeName()])}}l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};class u{constructor(e){o.a.assign(u,this,e)}static getTypeName(){return"AugLoop_Core_GridCell"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[u.getTypeName()])}}u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};class d{constructor(e){o.a.assign(d,this,e)}static getTypeName(){return"AugLoop_Core_GridNeighborhoodContext"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[d.getTypeName()])}}d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()};class h{constructor(e){o.a.assign(h,this,e)}static getTypeName(){return"AugLoop_Core_ItemFilter"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[h.getTypeName()])}}h.H_={T_:h.getTypeName(),B_:h.getBaseTypes()};class p{constructor(e){o.a.assign(p,this,e)}static getTypeName(){return"AugLoop_Core_DynamicContext"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[p.getTypeName()])}}p.H_={T_:p.getTypeName(),B_:p.getBaseTypes()};class g{constructor(e){o.a.assign(g,this,e)}static getTypeName(){return"AugLoop_Core_ContextHolder"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[g.getTypeName()])}}g.H_={T_:g.getTypeName(),B_:g.getBaseTypes()};class f{constructor(e){o.a.assign(f,this,e)}static getTypeName(){return"AugLoop_Core_UserContextHolder"}static getBaseTypes(){return["AugLoop_Core_ContextHolder"]}static typeGuard(e){return o.a.matchesTypesFor(e,[f.getTypeName()])}}f.H_={T_:f.getTypeName(),B_:f.getBaseTypes()};class m{constructor(e){o.a.assign(m,this,e)}static getTypeName(){return"AugLoop_Core_TenantContextHolder"}static getBaseTypes(){return["AugLoop_Core_ContextHolder"]}static typeGuard(e){return o.a.matchesTypesFor(e,[m.getTypeName()])}}m.H_={T_:m.getTypeName(),B_:m.getBaseTypes()};class y{constructor(e){o.a.assign(y,this,e)}static getTypeName(){return"AugLoop_Core_EventsHolder"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[y.getTypeName()])}}y.H_={T_:y.getTypeName(),B_:y.getBaseTypes()};class b{constructor(e){o.a.assign(b,this,e)}static getTypeName(){return"AugLoop_Core_UserCommandsHolder"}static getBaseTypes(){return["AugLoop_Core_EventsHolder"]}static typeGuard(e){return o.a.matchesTypesFor(e,[b.getTypeName()])}}b.H_={T_:b.getTypeName(),B_:b.getBaseTypes()}},39534:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39535);class n{constructor(e){this.model=e.model,this.clientMetadata=e.clientMetadata,this.userContext=e.userContext,this.site=e.site,this.getToken=e.getTokenCallback}get flights(){var e;return null!==(e=this._flights)&&void 0!==e||(this._flights=Object(o.a)(this.clientMetadata.flights)),this._flights}getToken(e,t){return this.getToken(e,t)}}},39535:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));function o(e){if(!e)return new n([],new Set,new Map,new Map);const t=e.split(";"),s=new Set,o=new Map,i=new Map;for(const r of t){const e=r.trim();if(""===e)continue;s.add(n.normalizeName(e));const[t,a]=e.split(":"),c=n.normalizeName(t);if(c){o.set(c,a);const e=n.parseName(c);e&&e!==c&&i.set(e,c)}}return new n(t,s,o,i)}class n{constructor(e,t,s,o){this.originalFlights=e,this.normalizedFlights=t,this.keyValueFlightsMap=s,this.parsedFlightsMap=o}static normalizeName(e){return null==e?void 0:e.toLowerCase()}static parseName(e){const t=null==e?void 0:e.split(".");return t?t[t.length-1]:void 0}hasFlight(e){const t=n.normalizeName(e),s=this.normalizedFlights.has(t),o=this.keyValueFlightsMap.has(t),i=this.parsedFlightsMap.has(t);return s||o||i}getBooleanValue(e,t){var s,o;const n=null===(s=this.getStringValue(e))||void 0===s?void 0:s.toLowerCase(),i=null===(o=this.getStringValue(this.parsedFlightsMap.get(e)))||void 0===o?void 0:o.toLowerCase();return"true"===n||"true"===i||"false"!==n&&"false"!==i&&t}getIntValue(e,t){const s=this.getStringValue(e),o=Number.parseInt(s,10);return Number.isNaN(o)?t:o}getStringValue(e,t){var s;return null!==(s=this.keyValueFlightsMap.get(n.normalizeName(e)))&&void 0!==s?s:t}getAll(){return this.originalFlights}getAllParsed(){const e=[];return this.keyValueFlightsMap.forEach((t,s)=>{const o=null==t?void 0:t.toLowerCase();switch(o){case"true":e.push({name:s,value:!0});break;case"false":e.push({name:s,value:!1});break;default:{const n=Number.parseInt(o,10);Number.isNaN(n)?e.push({name:s,value:t}):e.push({name:s,value:n})}}}),e}}},39536:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39537);class n extends o.a{constructor(e){super(e),this.eventName="AnnotationMetaDataChange"}}},39537:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o={util:{},roots:{default:{}}},n=(o.util,o.roots.default||(o.roots.default={}),function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.sessionKey="",e.prototype.annotationType="",e.prototype.annotationState=0,e.prototype.workflowId="",e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/AnnotationMetaDataChangeEvent"},e}())},39538:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.Undefined=0]="Undefined",e[e.Created=10]="Created",e[e.Sent=20]="Sent",e[e.Duplicated=30]="Duplicated",e[e.Seen=40]="Seen",e[e.Tried=50]="Tried",e[e.Kept=60]="Kept",e[e.Rejected=70]="Rejected"}(o||(o={}))},39539:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.JoinContext=0]="JoinContext",e[e.Session=1]="Session"}(o||(o={}));Error},39540:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(39506),n=s(39479);class i{constructor(e){this.item=e,this.operation=e.op,this.delta=e.delta,this.deltas=e.deltas,this.id=Object(o.a)(this.itemPath),this.revId=e.revId}get itemPath(){return[...this.item.parentPath,this.item.id]}getModelIterator(){throw new Error("Method not implemented.")}getBody(){return this.item.body}getItemReference(){throw new Error("Method not implemented.")}getParentItem(e){throw new Error("Method not implemented.")}getParentItemBody(e){throw new Error("Method not implemented.")}getPrevItem(e,t){throw new Error("Method not implemented.")}getPrevItemBody(e,t){throw new Error("Method not implemented.")}getNextItem(e,t){throw new Error("Method not implemented.")}getNextItemBody(e,t){throw new Error("Method not implemented.")}getChildItem(e){throw new Error("Method not implemented.")}getChildItemBody(e){throw new Error("Method not implemented.")}getChildItems(e){throw new Error("Method not implemented.")}getChildItemBodies(e){throw new Error("Method not implemented.")}getSubtreeItem(e){throw new Error("Method not implemented.")}getSubtreeItemBody(e){throw new Error("Method not implemented.")}getSubtreeItems(e){throw new Error("Method not implemented.")}getSubtreeItemBodies(e){throw new Error("Method not implemented.")}getContextItem(e){throw new Error("Method not implemented.")}getContextItemBody(e){throw new Error("Method not implemented.")}getContextItems(e){throw new Error("Method not implemented.")}getContextItemBodies(e){throw new Error("Method not implemented.")}addAnnotation(e,t){throw new Error("Method not implemented.")}updateAnnotation(e,t){throw new Error("Method not implemented.")}deleteAnnotation(e){throw new Error("Method not implemented.")}loadSubtree(e){throw new Error("Method not implemented.")}getSourceTimestamp(){return this.item.sourceTimestamp}getContextId(){return this.item.contextId}}class r{constructor(e,t=[]){this.scopeItem=void 0,this.rootItem=void 0,this.normalizeFilter=e=>{if(!e)return e=>void 0!==e;if("function"==typeof e)throw new Error("Not implemented yet");if((e.id?1:0)+(e.ids?1:0)+(e.itemType?1:0)+(e.itemTypes?1:0)!=1)throw new Error("Exactly one condition expected on IItemFilter");if(e.itemType)return t=>t&&n.a.matchesTypesFor(t.body,[e.itemType]);if(e.itemTypes)return t=>t&&n.a.matchesTypesFor(t.body,e.itemTypes);throw new Error("Not implemented yet")},this.items=[...t,e],this.scopeItem=new i(e)}getItem(e){throw new Error("Method not implemented.")}getItems(e){throw new Error("Method not implemented.")}getItemBody(e){return this.getItemBodies(e)[0]}getItemBodies(e){const t=this.normalizeFilter(e);return this.items.filter(t).map(e=>e.body)}getItemByReference(e){throw new Error("Method not implemented.")}getItemBodyByReference(e){throw new Error("Method not implemented.")}}},39541:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(39520),n=s(39542);class i extends n.EventEmitter{init(){return Promise.resolve()}sendMessage(e,t,s){}onMessage(e,t){}forceReconnect(){return Promise.resolve()}closeSession(){}sendBytes(e){}getCorrelationVector(){return new o.a}setState(e){}}},39542:function(e,t,s){"use strict";var o=Object.prototype.hasOwnProperty,n="~";function i(){}function r(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function a(e,t,s,o,i){if("function"!=typeof s)throw new TypeError("The listener must be a function");var a=new r(s,o||e,i),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function c(e,t){0==--e._eventsCount?e._events=new i:delete e._events[t]}function l(){this._events=new i,this._eventsCount=0}Object.create&&(i.prototype=Object.create(null),(new i).__proto__||(n=!1)),l.prototype.eventNames=function(){var e,t,s=[];if(0===this._eventsCount)return s;for(t in e=this._events)o.call(e,t)&&s.push(n?t.slice(1):t);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},l.prototype.listeners=function(e){var t=n?n+e:e,s=this._events[t];if(!s)return[];if(s.fn)return[s.fn];for(var o=0,i=s.length,r=new Array(i);o<i;o++)r[o]=s[o].fn;return r},l.prototype.listenerCount=function(e){var t=n?n+e:e,s=this._events[t];return s?s.fn?1:s.length:0},l.prototype.emit=function(e,t,s,o,i,r){var a=n?n+e:e;if(!this._events[a])return!1;var c,l,u=this._events[a],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,s),!0;case 4:return u.fn.call(u.context,t,s,o),!0;case 5:return u.fn.call(u.context,t,s,o,i),!0;case 6:return u.fn.call(u.context,t,s,o,i,r),!0}for(l=1,c=new Array(d-1);l<d;l++)c[l-1]=arguments[l];u.fn.apply(u.context,c)}else{var h,p=u.length;for(l=0;l<p;l++)switch(u[l].once&&this.removeListener(e,u[l].fn,void 0,!0),d){case 1:u[l].fn.call(u[l].context);break;case 2:u[l].fn.call(u[l].context,t);break;case 3:u[l].fn.call(u[l].context,t,s);break;case 4:u[l].fn.call(u[l].context,t,s,o);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];u[l].fn.apply(u[l].context,c)}}return!0},l.prototype.on=function(e,t,s){return a(this,e,t,s,!1)},l.prototype.once=function(e,t,s){return a(this,e,t,s,!0)},l.prototype.removeListener=function(e,t,s,o){var i=n?n+e:e;if(!this._events[i])return this;if(!t)return c(this,i),this;var r=this._events[i];if(r.fn)r.fn!==t||o&&!r.once||s&&r.context!==s||c(this,i);else{for(var a=0,l=[],u=r.length;a<u;a++)(r[a].fn!==t||o&&!r[a].once||s&&r[a].context!==s)&&l.push(r[a]);l.length?this._events[i]=1===l.length?l[0]:l:c(this,i)}return this},l.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&c(this,t)):(this._events=new i,this._eventsCount=0),this},l.prototype.off=l.prototype.removeListener,l.prototype.addListener=l.prototype.on,l.prefixed=n,l.EventEmitter=l,e.exports=l},39543:function(e,t,s){"use strict";var o;s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return n})),function(e){e[e.Anonymous=0]="Anonymous",e[e.Host=1]="Host"}(o||(o={}));class n{constructor(){this.timers=new Map}scheduleRefresh(e,t,s,o){let i=this.timers.get(e);i||(i={numberOfAttempts:0},this.timers.set(e,i)),i.refreshTimeoutId&&(clearTimeout(i.refreshTimeoutId),i.refreshTimeoutId=void 0),i.expiredTimeoutId&&(clearTimeout(i.expiredTimeoutId),i.expiredTimeoutId=void 0);let r=1e3*t-n.tokenRefreshBufferMs,a=1e3*t-n.tokenExpirationBufferMs;r>0?i.numberOfAttempts=0:(++i.numberOfAttempts,r=n.tokenRefreshBackoffIntervalMs,a=n.tokenExpirationBufferMs),i.numberOfAttempts<=n.tokenRefreshMaximumAttempts&&(i.refreshTimeoutId=setTimeout(()=>{s()},r)),o&&(i.expiredTimeoutId=setTimeout(()=>{o()},a))}clearRefreshTimeouts(){this.clearTimeouts(!1)}clearAllTimeouts(){this.clearTimeouts(!0)}clearTimeouts(e){this.timers.forEach((t,s)=>{t.refreshTimeoutId&&(clearTimeout(t.refreshTimeoutId),t.refreshTimeoutId=void 0),e&&t.expiredTimeoutId&&(clearTimeout(t.expiredTimeoutId),t.expiredTimeoutId=void 0),t.expiredTimeoutId||this.timers.delete(s)})}}n.tokenRefreshBufferMs=24e4,n.tokenExpirationBufferMs=12e4,n.tokenRefreshBackoffIntervalMs=3e4,n.tokenRefreshMaximumAttempts=3},39544:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{}},39545:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var o=s(39464),n=s(39467),i=s(39478),r=s(39503),a=s(39460),c=s(39491),l=s(39482),u=s(39543),d=s(39542);class h extends d.EventEmitter{constructor(e,t,s,o,n){if(super(),this.getSessionStats=e,this.clientMetadata=t,this.tokenRefreshManager=s,this.sendMessage=o,this.options=n||{},this.options.overrideSessionInitMessage=this.options.overrideSessionInitMessage||(e=>e),this.clientMetadata&&!this.clientMetadata.userSystemTimezone)try{this.clientMetadata.userSystemTimezone=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(i){}}initSession(e){e.onResponse=e.onResponse||(()=>{});const t=l.b.getCurrentTimeMs(),s=this.getSessionStats().lastConnectionClose&&t-this.getSessionStats().lastConnectionClose,c=this.getSessionStats().lastSyncMessage&&t-this.getSessionStats().lastSyncMessage,u=new o.a({operationName:"SessionInit"}).start(),d={sessionKey:this.sessionKey,sessionId:this.clientMetadata.sessionId,timeSinceLastConnectionClose:s,timeSinceLastSyncMessage:c,isTokenRefresh:e.isTokenRefresh,enableRemoteExecutionNotification:this.options.enableRemoteExecutionNotification,error:void 0},h=this.options.overrideSessionInitMessage(new i.t({protocolVersion:r.b,clientMetadata:this.clientMetadata,sessionKey:this.sessionKey,origin:this.origin,authToken:this.anonymousToken,extensionConfigs:e.extensionConfigs,returnWorkflowInputTypes:!0,enableRemoteExecutionNotification:this.options.enableRemoteExecutionNotification}));this.sendMessage(h,(t,s)=>{if(u.success=!t,u.resultSignature=this.getSessionStats().lastConnectionClose?"Reconnect":"FirstConnect",u.resourceId=null==s?void 0:s.sliceUrl,u.setClientMetadata(this.clientMetadata),(null==s?void 0:s.sessionKey)&&d.sessionKey!==s.sessionKey&&(d.sessionKey=s.sessionKey),t&&(d.error=t.error),u.resultDescription=JSON.stringify(d),n.a.info(508843779,n.b.CoreDefault,u.stop()),e.onResponse(t,s),t)this.emit("serverAuthenticationStateChange",a.a.NotAuthenticated);else if(e.isReconnectOnSameSlice&&s.forceReconnect)this.emit("serverAuthenticationStateChange",a.a.NotAuthenticated);else{if(!s.anonymousToken||!s.tokenExpirationSeconds)return this.emit("serverAuthenticationStateChange",a.a.NotAuthenticated),void n.a.error(508843778,n.b.CoreDefault,"AL Anonymous token was not generated for the session");this.anonymousToken=s.anonymousToken,this.onSuccessfulSessionInitOnServerSide(s)}})}onSuccessfulSessionInitOnServerSide(e){this.tokenRefreshManager.scheduleRefresh(u.b.Anonymous,e.tokenExpirationSeconds,this.initSession.bind(this,{isTokenRefresh:!0}),()=>{this.anonymousToken=void 0}),this.initHostAuthToken();const t=!!this.sessionKey,s=this.sessionKey!==e.sessionKey;this.sessionKey=e.sessionKey,this.origin=e.origin,this.emit("connect",s,t,`${e.sessionUrlBase}/${e.sessionKey}`,e.origin,this.anonymousToken,e.workflowInputTypes,e.downstreamRuntimeWorkflows),t&&this.emit("reconnect")}initHostAuthToken(){if(this.options.getAuthToken){const e=new o.a({operationName:"RefreshAuthToken",success:!0}).setClientMetadata(this.clientMetadata).start();this.options.getAuthToken().then(t=>{if(!t)return this.emit("serverAuthenticationStateChange",a.a.NotAuthenticated),e.success=!1,e.resultDescription="Host auth token provision failed",void n.a.info(508843777,n.b.CoreDefault,e.stop());n.a.info(508843776,n.b.CoreDefault,e.stop()),this.sendTokenProvisionMessage(t)}).catch(t=>{this.emit("serverAuthenticationStateChange",a.a.NotAuthenticated),e.success=!1,e.resultDescription="Error happened while attempting to fetch host token: "+t,n.a.error(508843747,n.b.CoreDefault,e.stop())})}}sendTokenProvisionMessage(e){const t=new i.C({authToken:e});this.emit("serverAuthenticationStateChange",a.a.Pending),this.sendMessage(t,this.onTokenProvisionResponse.bind(this),!0)}onTokenProvisionResponse(e,t){if(e||!t||!t.tokenExpirationSeconds)return void this.emit("serverAuthenticationStateChange",a.a.NotAuthenticated);const s=t.tokenType&&t.tokenType==c.a.WacUserInfo?a.a.WacUserInfoAuthenticated:a.a.Authenticated;this.emit("serverAuthenticationStateChange",s),this.tokenRefreshManager.scheduleRefresh(u.b.Host,t.tokenExpirationSeconds,this.initHostAuthToken.bind(this))}}},39546:function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var o=s(39520),n=s(39464),i=s(39467),r=s(39551),a=s(39549),c=s(39478),l=s(39479),u=s(39542),d=s(39482),h=s(39548),p=s(39547),g=s(39553),f=s(39476);class m extends u.EventEmitter{constructor(e,t,s,i,r,l,u,f,m){super(),this.cvParent=new o.a,this.logOp=new n.a({operationName:"SessionState",success:!0}).start(),this.sessionStateChangeLogCountLimiter=new d.a("SessionState"),this.stats=t,this.allStates={[p.e.Initing]:new p.c(this),[p.e.Running]:new p.d(this),[p.e.Disconnected]:new p.b(this),[p.e.Closed]:new p.a(this)},this.setState(p.e.Initing),this.improvedWebSocketEnabled=u.improvedWebSocketEnabled,this.sendCloseCallbackOnClientRequestedClose=u.sendCloseCallbackOnClientRequestedClose,this.messageEndpoint=new a.a({messageIdPrefix:"c",responseTimeoutMs:3e4,resendPendingMessagesOnReconnect:!1}),this.messageEndpoint.setClientMetadata(r),this.messageEndpoint.setEgress(this.egress.bind(this)),this.messageEndpoint.onMessage(c.p.getTypeName(),(e,t)=>{this.onSessionCloseMessage(e,t)}),this.networkWorkerManager=new g.a(e,r,s,i,this.ingress.bind(this),this.messageEndpoint.queryEgressCacheSize.bind(this.messageEndpoint),this.onConnectionClose.bind(this),()=>{this.onSessionClose(void 0,"WSNotSupported")},u,f,m),this.messageQueue=new h.b({sendMessage:(e,t,s,o)=>this.state.sendMessage(e,t,s,o),sendBytes:this.sendBytes.bind(this),canSendMessage:()=>this.state.canSendMessage(),dropOnlySequencedSyncsOnReseed:u.dropOnlySequencedSyncsOnReseedEnabled}),i.on("connect",(e,t,s,o,n,i,r)=>{this.setState(p.e.Running,"",{isSessionReseedingStarted:e&&t}),this.emit("connect",e,s,o,n,i,r)}),i.on("reconnect",()=>this.emit("reconnect")),i.on("serverAuthenticationStateChange",e=>this.emit("serverAuthenticationStateChange",e)),this.resetNextSyncSequenceId=()=>this.emit("resetNextSyncSequenceId"),this.tokenRefreshManager=l}setState(e,t,s){if(this.state&&e===this.state.stateName)return;const o=this.state?p.e[this.state.stateName]:"undefined",n=this.state?this.state.possibleNextStates.indexOf(e)>=0:e===p.e.Initing;this.sessionStateChangeLogCountLimiter.log(()=>{this.logOp.stop(),this.logOp.resourceId="New state: "+(n?p.e[e]:o),this.logOp.resultDescription="Previous state: "+o,this.logOp.dimension0="Attempted state: "+(p.e[e]||"undefined"),this.logOp.resultSignature=t+(this.state&&!n?"Unexpected state change":""),this.logOp.success=n,i.a.info(508843791,i.b.CoreDefault,this.logOp)}),n&&(this.state=this.allStates[e],this.logOp.start(),this.state.onEnter(s))}init(e,t){return this.extensionConfigs=e,this.customInitPromise=t,this.networkWorkerManager.init(this.extensionConfigs,this.customInitPromise,!0)}sendMessage(e,t,s){this.retrySendMessage(e,t,m.maxRetries,s)}sendBytes(e){this.state.sendBytes(e)}onMessage(e,t){this.messageEndpoint.onMessage(e,t)}getCorrelationVector(){return this.cvParent}forceReconnect(e){return this.extensionConfigs=e||this.extensionConfigs,this.networkWorkerManager.close(!1),new Promise(e=>setTimeout(()=>{e(this.networkWorkerManager.init(this.extensionConfigs))},100))}closeSession(e){if(this.sendMessage(new c.p),this.networkWorkerManager.close(!0),this.sendCloseCallbackOnClientRequestedClose){const t=e||new c.q({reasonDescription:"ClientRequested"});this.onSessionClose(new c.p({reconnectAllowed:!1,reason:t}),"ClientRequested")}else this.onSessionClose(void 0,"ClientRequested")}ingress(e,t){let s;try{s=JSON.parse(e)}catch(o){i.a.error(508843790,i.b.CoreDefault,new r.a({sessionHealthEventName:"ProcessMessage",resourceId:"Unknown",success:!1,resultSignature:"ParseError",resultDescription:o.message,durationMs:0,source:r.d.ClientRuntime,reason:r.c.Client,impact:r.b.MissingOutput,affectedWorkflows:["All"],message:""}))}if(s){if(this.improvedWebSocketEnabled&&t&&c.n.typeGuard(s)&&t(s),this.networkWorkerManager.getNetworkMode()===f.a.HttpFallback&&c.w.typeGuard(s)){const e=s;if(e.batch)for(const t of e.batch)this.messageEndpoint.ingress(t,(e,t)=>this.egress(e||t,()=>{}));return}this.messageEndpoint.ingress(s,(e,t)=>this.egress(e||t,()=>{}))}}egress(e,t){e&&this.networkWorkerManager.egress(e).then(()=>t()).catch(e=>t(e))}onSessionCloseMessage(e,t){e.reconnectAllowed?this.networkWorkerManager.close():this.onSessionClose(e,"CloseMessageReceived"),t()}onSessionClose(e,t){this.setState(p.e.Closed,t),this.tokenRefreshManager.clearAllTimeouts(),this.onConnectionClose(void 0),e&&this.emit("sessionClose",e)}onConnectionClose(e){this.state.onConnectionClose(),this.stats.lastConnectionClose=d.b.getCurrentTimeMs(),this.emit("disconnect",e)}retrySendMessage(e,t,s,o){const n=m.maxRetries-s;this.state.sendMessage(e,(n,i)=>{n&&s>0&&this.canBeRetried(e)&&this.isTransientError(n)?this.retrySendMessage(e,t,s-1,o):t&&t(n,i)},n,o)}canBeRetried(e){return!l.a.matchesTypesFor(e,[c.t.getTypeName(),c.m.getTypeName()])}isTransientError(e){const t=e.error;return t!==a.b.SyncMessageUnsupportedBatch&&t!==a.b.UnexpectedSeedMessage&&t!==a.b.UnsupportedSyncMessage&&t!==a.b.AnnotationTokenNotFound&&t!==h.a.ArrivedBeforeReseeding&&t!==h.a.DroppedAsOldestInQueue&&t!==h.a.DroppedBecauseClientDisconnected}}m.maxRetries=2},39547:function(e,t,s){"use strict";s.d(t,"e",(function(){return o})),s.d(t,"c",(function(){return p})),s.d(t,"d",(function(){return g})),s.d(t,"b",(function(){return f})),s.d(t,"a",(function(){return m}));var o,n=s(39478),i=s(39464),r=s(39467),a=s(39479),c=s(39548);!function(e){e[e.Initing=0]="Initing",e[e.Running=1]="Running",e[e.Disconnected=2]="Disconnected",e[e.Closed=3]="Closed"}(o||(o={}));const l=(e,t,s,o)=>{t&&(t.cv||(t.cv=e.cvParent.newChild().toString()),e.messageEndpoint.sendMessage(t,(t,o)=>{t||a.a.getTypeNameFor(o)!==n.A.getTypeName()||(e.stats.lastSyncMessage=Date.now()),s&&s(t,o)},void 0,o))},u=(e,t,s,o)=>{t&&(e.messageQueue.push(t,s,o),e.networkWorkerManager.init(void 0,e.customInitPromise).catch(e=>{const t=new i.a({operationName:"WorkerManagerInit",success:!1,resultDescription:""+e});r.a.error(508843789,r.b.CoreDefault,t)}))},d=(e,t)=>{t&&(e.messageQueue.push(t),e.networkWorkerManager.init(void 0,e.customInitPromise).catch(e=>{r.a.error(508843788,r.b.CoreDefault,"Init failed: "+e)}))};class h{constructor(e){this.context=e}onEnter(e){}sendMessage(e,t,s,o){}sendBytes(e){}canSendMessage(){return!1}onConnectionClose(){}}class p extends h{constructor(){super(...arguments),this.stateName=o.Initing,this.possibleNextStates=[o.Running,o.Disconnected,o.Closed]}sendMessage(e,t,s){a.a.matchesTypesFor(e,[n.t.getTypeName()])?l(this.context,e,t,s):u(this.context,e,t)}sendBytes(e){d(this.context,e)}onConnectionClose(){this.context.setState(o.Disconnected)}}class g extends h{constructor(){super(...arguments),this.stateName=o.Running,this.possibleNextStates=[o.Disconnected,o.Closed]}onEnter(e){e&&e.isSessionReseedingStarted&&this.context.resetNextSyncSequenceId(),this.context.messageQueue.sendOnSessionInitialized(e&&e.isSessionReseedingStarted)}sendMessage(e,t,s,o){l(this.context,e,t,s)}sendBytes(e){e&&this.context.networkWorkerManager.egressBytes(e)}canSendMessage(){return!0}onConnectionClose(){this.context.setState(o.Disconnected)}}class f extends h{constructor(){super(...arguments),this.stateName=o.Disconnected,this.possibleNextStates=[o.Initing,o.Closed]}onEnter(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()}sendMessage(e,t,s,i){if(a.a.matchesTypesFor(e,[n.t.getTypeName()]))this.context.setState(o.Initing),l(this.context,e,t,s);else if(a.a.matchesTypesFor(e,[n.p.getTypeName()]))this.context.setState(o.Closed);else{if(!i)return void u(this.context,e,t,s);t&&t(new n.k({messageId:e.messageId,error:c.a.DroppedBecauseClientDisconnected}))}}sendBytes(e){d(this.context,e)}}class m extends h{constructor(){super(...arguments),this.stateName=o.Closed,this.possibleNextStates=[]}onEnter(e){this.context.messageEndpoint.cancelPendingResponseCallbacks()}}},39548:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return d}));var o,n=s(39478),i=s(39479),r=s(14619),a=s.n(r),c=s(39482),l=s(39464),u=s(39467);!function(e){e.ArrivedBeforeReseeding="Message is dropped from queue since it arrived before reseeding is started",e.DroppedAsOldestInQueue="Message is dropped as oldest in full queue",e.DroppedBecauseClientDisconnected="Message is dropped because client is disconnected from server"}(o||(o={}));class d{constructor(e){this.logOp=new l.a({operationName:"MessageQueue",success:!0}),this.messageQueueLogCountLimiter=new c.a("MessageQueue"),this.queue=new a.a(1e3),this.callbacks=e}clear(){this.queue.clear()}size(){return this.queue.length}push(e,t,s){const i=this.queue;if(1e3===i.length){this.messageQueueLogCountLimiter.log(()=>{this.logOp.resourceId="QueueFull",this.logOp.durationMs=0,u.a.warn(508843746,u.b.CoreDefault,this.logOp)});const e=i.shift();e.onResponse&&e.onResponse(new n.k({error:o.DroppedAsOldestInQueue}))}i.push({message:e,onResponse:t,timeQueued:c.b.getCurrentTimeMs(),attemptNumber:s})}sendOnSessionInitialized(e){const t=this.queue.length;let s=0;if(t>0){const r=c.b.getCurrentTimeMs()-this.queue.get(0).timeQueued;for(;this.queue.length>0&&this.callbacks.canSendMessage();){const t=this.queue.shift();e&&t.message instanceof n.z&&i.a.matchesTypesFor(t.message,[n.z.getTypeName()])&&(!this.callbacks.dropOnlySequencedSyncsOnReseed||t.message.seq>=0)?(s++,t.onResponse&&t.onResponse(new n.k({error:o.ArrivedBeforeReseeding}))):t.message instanceof Uint8Array?this.callbacks.sendBytes(t.message):this.callbacks.sendMessage(t.message,t.onResponse,t.attemptNumber)}this.messageQueueLogCountLimiter.log(()=>{this.logOp.resourceId="SendOnSessionInitialized",this.logOp.resultDescription=`Queue size before: ${t}, after: ${this.queue.length}. droppedSyncMessages: ${s}`,this.logOp.durationMs=r,u.a.warn(508843745,u.b.CoreDefault,this.logOp)})}}}},39549:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return h}));var o,n,i=s(39551),r=s(39467),a=s(39464),c=s(39479),l=s(39478),u=s(39550);function d(e){const t=["AugLoop_Excel_Session_Protocol_","AugLoop_Powerpoint_Session_Protocol_","AugLoop_Session_Protocol_"];let s;for(const n of t)if(0===e.indexOf(n)){s=n;break}if(!s)return"MalformedMessageName";const o=e.indexOf("Message",e.length-"Message".length)===e.length-"Message".length;return e.slice(s.length,o?-"Message".length:void 0)}!function(e){e.ClientDisconnected="Client disconnected.",e.UnsupportedSyncMessage="SyncMessages with seq = -1 are not supported anymore.",e.UnexpectedSeedMessage="Unexpected seed message",e.SyncMessageUnsupportedBatch="SyncMessage with unsupported batching.",e.AnnotationTokenNotFound="Token not found"}(o||(o={})),function(e){e.ProvisionTokenValidationError="Token provision message didn't pass token validation.",e.ProvisionTokenDecryptAndTransformError="Token provision message didn't pass token decrypt and transform."}(n||(n={}));class h{constructor(e){this.config=e,this.nextMessageId=1,this.pendingResponseCallbacks=new u.a({sweepInterval:5e3}),this.pendingMessageCallbacks=new u.a({sweepInterval:5e3}),this.messageCallbacks=new Map,this.messageIdPrefix=e.messageIdPrefix,this.source="c"===e.messageIdPrefix?i.d.ClientRuntime:i.d.Core,this.stats={sendMessageCount:0,sendMessageClientDisconnectedErrors:0,sendMessageErrors:0,sendMessageDurationMsMax:0,processMessageCount:0,processMessageProvisionTokenErrors:0,processMessageErrors:0,processMessageDurationMsMax:0}}setClientMetadata(e){this.clientMetadata=e}setEgress(e){this.egress=e,this.config.resendPendingMessagesOnReconnect&&this.egress&&this.pendingResponseCallbacks.forEach((e,t)=>{e.logOp.dimension1=(e.sendCount++).toString(),this.egress(e.message,t=>this.onEgressError(t,e))})}ingress(e,t){l.n.typeGuard(e)?(this.processResponse(e),t()):this.processMessage(e,t),l.p.typeGuard(e)&&!e.reconnectAllowed&&this.clearAllPendingResponses()}sendMessage(e,t,s,o=0){const n=new i.a({sessionHealthEventName:"SendMessage",source:this.source,reason:i.c.Client,impact:this.source===i.d.ClientRuntime?i.b.MissingInput:i.b.MissingOutput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv,resourceId:d(c.a.getTypeNameFor(e)),dimension0:o.toString()}).start(),a=()=>{if(n.setClientMetadata(this.clientMetadata),n.success)r.a.info(572836e3,r.b.CoreDefault,n.stop());else{const e="ErrorWithoutPendingResponse"===n.resultSignature||"ResponseCallbackException"===n.resultSignature||"We called into done callback"!==n.message;n.message=JSON.stringify({errorNotPropagatedToDoneCallback:e}),r.a.error(572836001,r.b.CoreDefault,n.stop())}};e.messageId=`${this.messageIdPrefix}${this.nextMessageId++}`,l.h.typeGuard(e)&&e.messages.forEach((t,s)=>t.messageId=e.messageId+"."+s);const u=c.a.getTypeNameFor(e)===l.p.getTypeName(),h={message:e,logOp:n,logEvent:a,callback:void 0,sendCount:1};if(!s&&!u){h.callback=(s,o)=>{var i;if(s?(n.success=!1,n.resultSignature=s.error,n.resultDescription=`Error for ${c.a.getTypeNameFor(e)} message ${e.messageId}${l.z.typeGuard(e)?", seq "+e.seq:""}: ${s.error}`):n.resultSignature="Success",t)try{n.message="We called into done callback",t(s,o)}catch(r){n.success=!1,n.resultSignature="ResponseCallbackException",n.resultDescription="Web"===(null===(i=this.clientMetadata)||void 0===i?void 0:i.appPlatform)?JSON.stringify({message:r.message,stack:r.stack}):JSON.stringify({message:r.message})}this.pendingMessageCallbacks.del(e.messageId),a(),this.updateSendMessageStats(n.success,n.durationMs,s?new Error(s.error):void 0)};const s=()=>{h.callback(new l.B({error:"Timeout waiting for response"}),void 0)};let o=this.config.responseTimeoutMs;if(l.v.typeGuard(e)){const t=e;o=t.longPollTimeoutHint>=15e3&&t.longPollTimeoutHint<=3e5?t.longPollTimeoutHint+5e3:12e4}this.pendingResponseCallbacks.put(e.messageId,h,o,s)}this.egress&&this.egress(e,e=>this.onEgressError(e,h))}onEgressError(e,t){var s,o;if(e){const n=t.message,i=this.pendingResponseCallbacks.get(t.message.messageId);i?(this.pendingResponseCallbacks.del(n.messageId),i.callback(new l.k({messageId:n.messageId,error:e.message}))):l.p.typeGuard(n)?(t.logOp.success=null!==(o=null===(s=e.message)||void 0===s?void 0:s.endsWith("Client disconnected."))&&void 0!==o&&o,t.logOp.resultSignature="ErrorSendingSessionCloseMessage",t.logOp.resultDescription=`Error for ${c.a.getTypeNameFor(n)} message ${n.messageId}: ${e.message}`,t.logEvent()):(t.logOp.success=!1,t.logOp.resultSignature="ErrorWithoutPendingResponse",t.logOp.resultDescription=`Error for ${c.a.getTypeNameFor(n)} message ${n.messageId}: ${e.message}`,t.logEvent())}}queryEgressCacheSize(){return this.pendingResponseCallbacks.size()}onMessage(e,t){this.messageCallbacks.set(e,t)}getStats(){return this.stats}hasMessageCallback(e){return this.messageCallbacks.has(e)}cancelPendingResponseCallbacks(){this.pendingResponseCallbacks.forEach((e,t)=>{e&&(this.pendingResponseCallbacks.del(t),e.callback(new l.k({messageId:t,error:"Cancelled"})))})}clearAllPendingResponses(){if(0==this.pendingResponseCallbacks.size())return;const e=new a.a({operationName:"PurgePendingResponses",resultDescription:this.pendingResponseCallbacks.size().toString(),success:!0});r.a.info(572836002,r.b.CoreDefault,e),this.pendingResponseCallbacks.clear()}processMessage(e,t){const s=new i.a({sessionHealthEventName:"ProcessMessage",source:this.source,reason:i.c.Client,impact:this.source===i.d.ClientRuntime?i.b.MissingOutput:i.b.MissingInput,success:!0,message:"",affectedWorkflows:["All"],cv:e.cv}).start(),o=()=>{if(s.setClientMetadata(this.clientMetadata),s.success)r.a.info(572836003,r.b.CoreDefault,s.stop());else{const e="UnsupportedMessage"===s.resourceId||"Timeout"===s.resultSignature||"OnResponseInvokedMoreThanOnce"===s.resultSignature||"MessageCallbackException"===s.resultSignature||"We called into messageCallback"!==s.message;s.message=JSON.stringify({errorHappenedOutsideRegisteredMessageCallback:e}),r.a.error(572836032,r.b.CoreDefault,s.stop())}};let n=this.messageCallbacks.get(c.a.getTypeNameFor(e));n?s.resourceId=d(c.a.getTypeNameFor(e)):n=(e,t)=>{s.resourceId=d(c.a.getTypeNameFor(e)),"MalformedMessageName"!==s.resourceId&&(s.resourceId="UnsupportedMessage"),t(new l.k({messageId:e.messageId,error:`Message type ${c.a.getTypeNameFor(e)} is not supported`}))};let a=1e4;if(l.v.typeGuard(e)){const t=e;a=t.longPollTimeoutHint>=15e3&&t.longPollTimeoutHint<=3e5?t.longPollTimeoutHint+5e3:12e4}this.pendingMessageCallbacks.put(e.messageId,void 0,a,()=>{s.success=!1,s.resultSignature="Timeout",s.resultDescription="Timeout processing message callback",o(),r.a.error(572836033,r.b.CoreDefault,"Timeout processing "+s.resourceId),this.updateProcessMessageStats(!1,s.durationMs,new Error("timeout"))});let u=!1;const h=(n,i)=>{this.pendingMessageCallbacks.del(e.messageId),u?(s.success=!1,s.resultSignature="OnResponseInvokedMoreThanOnce",s.resultDescription=`Invoked onResponse for ${c.a.getTypeNameFor(e)} message ${e.messageId} more than once`):n?(s.success=!1,s.resultSignature=n.error,s.resultDescription=`Error for ${c.a.getTypeNameFor(e)} message ${e.messageId}: ${n.error}`):s.resultSignature="Success",u=!0,o(),n&&!c.a.matchesTypesFor(n,[l.k.getTypeName()])&&(n=new l.k({error:"Internal Server Error"})),this.updateProcessMessageStats(s.success,s.durationMs,n?new Error(n.error):void 0),n?(n.messageId=e.messageId,t(n)):i?(i.messageId=e.messageId,t(void 0,i)):t()};try{s.message="We called into messageCallback",n(e,h)}catch(p){this.pendingMessageCallbacks.del(e.messageId),s.success=!1,s.resultSignature="MessageCallbackException",s.resultDescription=JSON.stringify({message:p.message,stack:p.stack}),o(),this.updateProcessMessageStats(!1,s.durationMs,p),t()}}processResponse(e){var t,s;const o=new a.a({operationName:"ProcessResponse"});if(o.success=!0,o.setClientMetadata(this.clientMetadata),o.start(),e.messageId){const s=null===(t=this.pendingResponseCallbacks.get(e.messageId))||void 0===t?void 0:t.callback;s?(this.pendingResponseCallbacks.del(e.messageId),c.a.matchesTypesFor(e,[l.k.getTypeName()])?s(e):s(void 0,e)):(o.resultSignature="NoPendingMessage",o.resultDescription=""+e.messageId,o.success=!1)}else o.resultSignature="NoMessageIdSetInResponse",l.k.typeGuard(e)?o.resultDescription=e.error:o.resultDescription="MessageId is not available",o.success=!1;"Production"!==(null===(s=this.clientMetadata)||void 0===s?void 0:s.releaseAudienceGroup)&&(o.resourceId=d(c.a.getTypeNameFor(e)),r.a.info(572836034,r.b.CoreDefault,o.stop()))}updateSendMessageStats(e,t,s){this.stats.sendMessageCount++,this.stats.sendMessageDurationMsMax=Math.max(t,this.stats.sendMessageDurationMsMax),e||s?e&&s&&r.a.warn(572836036,r.b.CoreDefault,"Succeeded send message provided error object."):r.a.warn(572836035,r.b.CoreDefault,"Failed send message did not provide error object."),e||(s&&s.message===o.ClientDisconnected?this.stats.sendMessageClientDisconnectedErrors++:this.stats.sendMessageErrors++)}updateProcessMessageStats(e,t,s){this.stats.processMessageCount++,this.stats.processMessageDurationMsMax=Math.max(t,this.stats.processMessageDurationMsMax),e||s?e&&s&&r.a.warn(572836038,r.b.CoreDefault,"Succeeded process message provided error object."):r.a.warn(572836037,r.b.CoreDefault,"Failed process message did not provide error object."),e||(s&&s.message===n.ProvisionTokenValidationError?this.stats.processMessageProvisionTokenErrors++:this.stats.processMessageErrors++)}}},39550:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{constructor(e){if(this.cache=new Map,this.options=e||{sweepInterval:100},null!=this.options.idleDurationMs&&this.options.idleDurationMs<=0)throw new Error("Idle duration must be positive");if(this.interval=this.options.sweepInterval||100,this.interval<=0)throw new Error("Sweep interval must be a positive number")}put(e,t,s,o,n,i,r){if(null==s||s<=0)throw new Error("Cache timeout must be a positive number");(null==n||n<=0)&&(n=this.options.idleDurationMs);const a={value:t,lastUsed:n?Date.now():void 0,expire:s+Date.now(),idleDurationMs:n,expireCallback:o,expiringTriggerTime:i+Date.now(),expiringCallback:r};return this.cache.set(e,a),this.timeout||(this.timeout=setInterval(this.onInterval.bind(this),this.interval),this.timeout.unref&&this.timeout.unref()),t}del(e){if(this.options.delCallback){const t=this.cache.get(e);t&&this.options.delCallback(e,t.value)}const t=this.cache.delete(e);return 0===this.size()&&this.clear(),t}clear(){this.timeout&&(clearInterval(this.timeout),this.timeout=void 0),this.cache.clear()}get(e){const t=this.cache.get(e);if(t)return this.options.idleDurationMs&&(t.lastUsed=Date.now()),t.value}keys(){return this.cache.keys()}forEach(e){this.cache.forEach((t,s)=>{e(t.value,s)})}size(){return this.cache.size}updateExpireTime(e,t){return!!(this.cache.has(e)&&t>=0)&&(this.cache.get(e).expire=t+Date.now(),!0)}onInterval(){const e=Date.now();this.cache.forEach((t,s)=>{if(t.idleDurationMs&&t.lastUsed<e-t.idleDurationMs)return this.del(s),void(this.options.idleCallback&&this.options.idleCallback(s,t.value));t.expire<e&&(this.del(s),t.expireCallback&&t.expireCallback(s,t.value)),t.expiringTriggerTime<e&&t.expiringCallback&&(t.expiringCallback(s,t.value),t.expiringCallback=void 0)})}}},39551:function(e,t,s){"use strict";s.d(t,"d",(function(){return o})),s.d(t,"c",(function(){return n})),s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return c}));var o,n,i,r=s(39552),a=s(39466);!function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.ClientRuntime=5]="ClientRuntime"}(o||(o={})),function(e){e[e.Unknown=0]="Unknown",e[e.Core=1]="Core",e[e.Workflow=2]="Workflow",e[e.SessionExtension=3]="SessionExtension",e[e.Client=4]="Client",e[e.Network=5]="Network",e[e.AugLoopDependency=6]="AugLoopDependency",e[e.WorkflowDependency=7]="WorkflowDependency",e[e.ClientRuntime=8]="ClientRuntime"}(n||(n={})),function(e){e[e.Unknown=0]="Unknown",e[e.None=1]="None",e[e.MissingInput=2]="MissingInput",e[e.MissingOutput=3]="MissingOutput"}(i||(i={}));class c extends r.a{constructor(e,t){var s,r;super({source:o[e.source],reason:n[e.reason],reasonDependency:e.reasonDependency,subReason:e.subReason,sessionHealthEventName:e.sessionHealthEventName,impact:i[e.impact],success:e.success,durationMs:null!==(s=e.durationMs)&&void 0!==s?s:0,count:"number"==typeof e.count?e.count:1,message:e.message,affectedWorkflows:(null!==(r=e.affectedWorkflows)&&void 0!==r?r:[]).join(","),resourceId:e.resourceId,dimension0:e.dimension0,dimension1:e.dimension1,dimension2:e.dimension2,dimension3:e.dimension3,cv:e.cv,resultSignature:e.resultSignature,resultDescription:e.resultDescription,joinContextId:e.joinContextId}),this.eventName="SessionHealth",t&&this.setClientMetadata(t),this.metricCount=e.metricCount,this.metricDuration=e.metricDuration}getMetrics(){const e={};return(void 0===this.metricCount||this.metricCount)&&(e[this.sessionHealthEventName+".CountV2"]={dimensionNames:()=>c.dimensionNames,dimensionValues:this.getDimensionValues(),value:this.count}),(void 0===this.metricDuration||this.metricDuration)&&(e[this.sessionHealthEventName+".DurationMsV2"]={dimensionNames:()=>c.dimensionNames,dimensionValues:this.getDimensionValues(),value:this.durationMs}),e}setClientMetadata(e){return e&&(this.clientAppName=e.appName,this.clientAppPlatform=e.appPlatform,this.clientAppVersion=e.appVersion,this.clientFlights=e.flights,this.clientReleaseAudienceGroup=e.releaseAudienceGroup,this.clientReleaseChannel=e.releaseChannel,this.clientReleaseFork=e.releaseFork,this.clientRuntimeVersion=e.runtimeVersion,this.clientSessionId=e.sessionId,this.clientDocSessionId=e.docSessionId,this.clientUserAgent=e.userAgent,this.clientDeviceId=e.deviceId),this}setReason(e){return this.reason=n[e],this}setSource(e){return this.source=o[e],this}setImpact(e){return this.impact=i[e],this}setAffectedWorkflows(e){return this.affectedWorkflows=(null!=e?e:[]).join(","),this}getAffectedWorkflows(){return this.affectedWorkflows.split(",")}start(){return this.startTime=Object(a.a)(),this}stop(){const e=Object(a.a)();return this.durationMs=Math.round(e-this.startTime),this}getDimensionValues(){var e;return[this.clientAppName,this.clientAppPlatform,this.clientAppVersion,this.success?"1":"0",`${this.reason}_${this.reasonDependency}`,this.impact,null!==(e=this.getAffectedWorkflows()[0])&&void 0!==e?e:"",this.resourceId,this.dimension0,this.dimension1,this.dimension2,this.dimension3]}}c.dimensionNames=["ClientAppName","ClientAppPlatform","ClientAppVersion","Success","Reason","Impact","FirstAffectedWorkflow","ResourceId","Dimension0","Dimension1","Dimension2","Dimension3"]},39552:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o={util:{},roots:{default:{}}},n=(o.util,o.roots.default||(o.roots.default={}),function(){function e(e){if(e)for(var t in e)null!=e[t]&&(this[t]=e[t])}return e.prototype.cv="",e.prototype.serviceName="",e.prototype.sessionKey="",e.prototype.clientAppName="",e.prototype.clientAppPlatform="",e.prototype.clientRuntimeVersion="",e.prototype.clientAppVersion="",e.prototype.clientReleaseAudienceGroup="",e.prototype.clientReleaseChannel="",e.prototype.clientReleaseFork="",e.prototype.clientSessionId="",e.prototype.clientFlights="",e.prototype.clientIPRange="",e.prototype.clientDocSessionId="",e.prototype.clientDeviceId="",e.prototype.clientUserAgent="",e.prototype.userType="",e.prototype.userId="",e.prototype.sessionHealthEventName="",e.prototype.source="",e.prototype.reason="",e.prototype.reasonDependency="",e.prototype.subReason="",e.prototype.impact="",e.prototype.success=!1,e.prototype.durationMs=0,e.prototype.count=0,e.prototype.message="",e.prototype.affectedWorkflows="",e.prototype.resourceId="",e.prototype.dimension0="",e.prototype.dimension1="",e.prototype.dimension2="",e.prototype.dimension3="",e.prototype.resultDescription="",e.prototype.resultSignature="",e.prototype.joinContextId="",e.getTypeUrl=function(e){return void 0===e&&(e="type.googleapis.com"),e+"/SessionHealthEvent"},e}())},39553:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var o=s(39479),n=s(39478),i=s(39464),r=s(39467),a=s(39482),c=s(39517),l=s(39480),u=s(39554),d=s(39476);class h{constructor(e,t,s,o,n,c,u,p,g,f,m){this.logCountLimiter=new a.a(h.className),this.isWorkerReady=!1,this.permanentlyClosed=!1,this.currentReconnectAttempt=0,this.lastInitializationAttemptTimeMs=0,this.offlineInterval=void 0,this.alreadyLoggedReconnectAttempt=!1,this.httpTestsLeft=5,this.httpTestsSuccessCount=0,this.workerOpenCount=0,this.testHttpConnection=e=>{const t=a.b.convertWebSocketUrlToHttp(this.globalUrl),s=!e,o=null!=e?e:new i.a({operationName:"HttpsTest",resourceId:t,success:!1,resultDescription:"",resultSignature:"HttpResponse:"}).start(),n={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":o.cv},body:JSON.stringify(a.b.createHealthCheckRequest(this.clientMetadata))};Object(l.b)(t,n,(e,t)=>{e?(o.dimension1="HttpErr",o.resultDescription+="HttpErr: "+e.message):t&&t.ok?(o.dimension1="HttpOK",this.leaveOfflineMode(),this.httpTestsSuccessCount++,s&&(o.success=!0)):(o.dimension1="HttpNoResp",o.resultDescription+="HttpStatus: "+(null==t?void 0:t.status)),s&&o.stop(),this.logCountLimiter.log(()=>{r.a.info(508843780,r.b.CoreDefault,o)})})},this.globalUrl=e,this.clientMetadata=t,this.workerFactory=s,this.sessionInitializer=o,this.ingress=n,this.queryEgressCacheSize=c,this.onConnectionClose=u,this.onDetectedWSBlock=p,this.closeWSBlockedSession=g.closeWSBlockedSessionEnabled,this.sessionOfflineModeEnabled=g.sessionOfflineModeEnabled,this.improvedWebSocketEnabled=g.improvedWebSocketEnabled,this.httpFallbackEnabled=g.httpFallbackEnabled,this.jsond2ContentTypeEnabled=g.jsond2ContentTypeEnabled,this.closeWorkerOnReliabilityFailureEnabled=g.closeWorkerOnReliabilityFailureEnabled,this.ingressAfterCloseEnabled=g.ingressAfterCloseEnabled,this.networkWorkerLogOp=new i.a({operationName:"CreateNetworkWorker",success:!0}),this.networkMode=f||d.a.JSWebSockets,this.improvedWebSocketEnabled&&(this.networkRateSettings=m)}init(e,t,s=!1){if(this.permanentlyClosed)return Promise.reject(new Error("permanentlyClosed"));if(this.isWorkerReady||this.pendingInitPromise)return this.pendingInitPromise?this.pendingInitPromise:Promise.resolve();this.extensionConfigs=e||this.extensionConfigs;const o=()=>{if(s||!this.alreadyLoggedReconnectAttempt){const e=s?h.initialAttemptTimeout:h.reconnectAttemptTimeout;this.connTimeout=setTimeout(()=>{const t=new i.a({operationName:"ConnectionFailingOrSlow",dimension0:s?"Initial":"Reconnect",dimension1:e.toString(),dimension2:this.currentReconnectAttempt.toString()});r.a.info(508843787,r.b.CoreDefault,t),this.alreadyLoggedReconnectAttempt=!s,this.connTimeout=void 0},e)}};return t?this.pendingInitPromise=t().catch(e=>{const t=new i.a({operationName:"WorkerManagerCustomInit",success:!1,resultDescription:""+e});r.a.error(508843786,r.b.CoreDefault,t)}).then(()=>{o(),this.initInternal()}):(this.pendingInitPromise=Promise.resolve(),o(),this.initInternal()),this.pendingInitPromise}egress(e){return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then(()=>{this.egressInternal(e)}):(this.egressInternal(e),Promise.resolve())}egressBytes(e){return!this.isWorkerReady&&this.pendingInitPromise?this.pendingInitPromise.then(()=>{this.egressBytesInternal(e)}):(this.egressBytesInternal(e),Promise.resolve())}getNetworkMode(){return this.networkMode}close(e){this.isWorkerReady=!1,this.worker&&(this.worker.close(),this.worker=null),this.improvedWebSocketEnabled&&(this.networkRateController&&this.getNetworkRateController().close(),this.networkRateController=null),this.permanentlyClosed=e||this.permanentlyClosed,this.permanentlyClosed&&(this.leaveOfflineMode(),clearTimeout(this.connTimeout))}initInternal(){if(this.isWorkerReady=!1,this.permanentlyClosed||this.isOffline()){const e=new i.a({operationName:"WorkerManagerInitOffline",success:!0,resultSignature:this.permanentlyClosed?"PermanentlyClosed":"Offline"});r.a.info(508843785,r.b.CoreDefault,e)}else this.currentReconnectAttempt>0?setTimeout(()=>{this.tryToConnectAndInitializeSession()},((e,t,s)=>{let o=0;const n=a.b.getCurrentTimeMs()?a.b.getCurrentTimeMs()-t:0,i=[1e3,2e3,5e3,1e4,6e4];return o=i[Math.max(0,Math.min(i.length-1,e-1))],o=Math.max(o-n,1e3),o=s&&s>0?Math.min(5e3,o):o,o})(this.currentReconnectAttempt,this.lastInitializationAttemptTimeMs,this.httpFallbackEnabled?this.httpTestsSuccessCount:void 0)):this.tryToConnectAndInitializeSession()}egressInternal(e){if(!this.isWorkerReady&&!o.a.matchesTypesFor(e,[n.t.getTypeName()]))return void(o.a.matchesTypesFor(e,[n.n.getTypeName()])||r.a.error(508843784,r.b.CoreDefault,new i.a({operationName:"UnexpectedEgressCall",resultDescription:"isWorkerReady: "+this.isWorkerReady})));let t;if(o.a.matchesTypesFor(e,[n.m.getTypeName()])?(this.castBinaryData(e),t=c.a.serialize(e)):t=JSON.stringify(e),this.improvedWebSocketEnabled){let s;if(n.z.typeGuard(e)&&(s=e.seq),this.bypassRateController(e))return void this.worker.egress({obj:t});const o=n.t.typeGuard(e)&&this.getNetworkMode()===d.a.HttpFallback;this.getNetworkRateController().egress({obj:t,isHttpSessionInitMessage:o,messageId:e.messageId,seqId:s})}else this.worker.egress({obj:t})}bypassRateController(e){return n.p.typeGuard(e)}egressBytesInternal(e){this.isWorkerReady?this.improvedWebSocketEnabled?this.getNetworkRateController().egress({obj:e}):this.worker.egress({obj:e}):r.a.error(508843783,r.b.CoreDefault,new i.a({operationName:"UnexpectedEgressBytesCall",resultDescription:"isWorkerReady: "+this.isWorkerReady}))}tryToConnectAndInitializeSession(){this.currentReconnectAttempt++,this.lastInitializationAttemptTimeMs=a.b.getCurrentTimeMs();const e=t=>{this.permanentlyClosed||this.isOffline()||(this.connect(this.sliceUrl?this.sliceUrl:this.globalUrl),this.sessionInitializer.initSession({isTokenRefresh:!1,isReconnectOnSameSlice:!!this.sliceUrl,extensionConfigs:this.extensionConfigs,onResponse:(s,o)=>{if(t.success=!s,t.resourceId=o?o.sliceUrl:"",t.dimension2=this.getNetworkModeLogString(),this.getNetworkMode()===d.a.HttpFallback?(t.resultDescription=s?"HTTP Error: "+s.error:"",t.dimension0=t.success?"HTTPOK":"HTTPFail"):(t.resultDescription=s?"WS Error: "+s.error:"",t.dimension0=t.success?"WSOK":"WSFail"),s||!this.worker)return this.sliceUrl=void 0,this.close(),this.httpTestsLeft>0?(this.httpTestsLeft--,this.testHttpConnection(t.stop())):(this.httpFallbackEnabled&&this.improvedWebSocketEnabled?this.getNetworkMode()===d.a.JSWebSockets?0===this.workerOpenCount&&this.httpTestsSuccessCount>=5?(t.dimension1="WSBlocked",t.dimension3="HTTP Fallback",this.networkMode=d.a.HttpFallback,this.currentReconnectAttempt=0,this.resetHttpTestsCounter()):this.sessionOfflineModeEnabled&&0===this.httpTestsSuccessCount&&(this.startOfflineMode(),t.dimension1="WSOffline"):this.sessionOfflineModeEnabled&&0===this.httpTestsSuccessCount&&(this.startOfflineMode(),t.dimension1="HTTPOffline"):this.closeWSBlockedSession&&0===this.workerOpenCount&&this.httpTestsSuccessCount>=5?(this.permanentlyClosed=!0,t.dimension1="WSBlocked",t.dimension3="CloseWSBlockedSession",this.onDetectedWSBlock()):this.sessionOfflineModeEnabled&&0===this.httpTestsSuccessCount&&(this.startOfflineMode(),t.dimension1="WSOffline"),this.logCountLimiter.log(()=>{r.a.info(508843782,r.b.CoreDefault,t.stop())})),void this.initInternal();if(this.logCountLimiter.log(()=>{r.a.info(508843781,r.b.CoreDefault,t.stop())}),o.forceReconnect){this.close();const t=new i.a({operationName:"ForcedReconnect"}).start();t.resultSignature=`globalUrl: ${this.globalUrl}. sliceUrl: ${this.sliceUrl}`,this.sliceUrl=void 0,setTimeout(()=>{e(t)},1e3)}else clearTimeout(this.connTimeout),this.sliceUrl=o.sliceUrl,this.ready();this.resetHttpTestsCounter()}}))},t=new i.a({operationName:"TryToConnectAndInitializeSession",resultSignature:"Reconnection attempt #"+this.currentReconnectAttempt}).start();e(t)}getNetworkRateController(){return this.networkRateController||(this.networkRateController=new u.a(this.networkRateSettings,{closeWorkerOnReliabilityFailureEnabled:this.closeWorkerOnReliabilityFailureEnabled,ingressAfterCloseEnabled:this.ingressAfterCloseEnabled})),this.networkRateController}connect(e){const t=this.getNetworkMode();this.networkWorkerLogOp.start(),this.networkWorkerLogOp.resultDescription=this.getNetworkModeLogString(),this.networkWorkerLogOp.dimension0=t.toString(),this.logCountLimiter.log(()=>r.a.info(508372418,r.b.CoreDefault,this.networkWorkerLogOp.stop())),this.worker=this.workerFactory(t),this.worker.init(e,this.improvedWebSocketEnabled?this.getNetworkRateController().ingressFromWorker.bind(this.networkRateController):this.ingress,()=>{this.workerOpenCount++,this.improvedWebSocketEnabled&&this.getNetworkRateController().open(),this.leaveOfflineMode()},e=>{this.close(),this.onConnectionClose(e)},this.improvedWebSocketEnabled,this.jsond2ContentTypeEnabled),this.improvedWebSocketEnabled&&this.getNetworkRateController().init(this.worker,this.ingress,this.queryEgressCacheSize,t,this.clientMetadata)}ready(){this.isWorkerReady=!0,this.pendingInitPromise=void 0,this.currentReconnectAttempt=0}castBinaryData(e){if(e){if(Array.isArray(e.__binaryMembers__))for(const t of e.__binaryMembers__)ArrayBuffer.isView(e[t])||(e[t]=new Uint8Array(e[t]));for(const t of Object.keys(e))"object"==typeof e[t]&&null!==e[t]&&this.castBinaryData(e[t])}}isOffline(){return!!this.offlineInterval}startOfflineMode(){this.offlineInterval=setInterval(()=>{this.testHttpConnection()},6e4)}leaveOfflineMode(){this.isOffline()&&(clearInterval(this.offlineInterval),this.offlineInterval=void 0,this.resetHttpTestsCounter(),this.tryToConnectAndInitializeSession())}resetHttpTestsCounter(){this.httpTestsLeft=5,this.httpTestsSuccessCount=0}getNetworkModeLogString(){return"NetworkMode: "+(this.getNetworkMode()===d.a.JSWebSockets?"WebSocket":"HTTP")}}h.initialAttemptTimeout=1e5,h.reconnectAttemptTimeout=2e4,h.className="NetworkWorkerManager"},39554:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var o=s(39464),n=s(39467),i=s(39482),r=s(39555);class a{constructor(e,t){var s,n,r,c,l,u,d;this.logCountLimiter=new i.a(a.className),this.emptyMessageId=0,this.egressMessageCount=0,this.egressByteCount=0,this.prevSeq=-1,this.pendingQueue=[],this.egressRateLogOp=new o.a({operationName:"NetworkEgressRate",success:!0}),this.egressLogOp=new o.a({operationName:"NetworkEgressControl",success:!0}).start(),this.egressedCache=new Map,this.rpsThreshold=null!==(s=null==e?void 0:e.rpsThreshold)&&void 0!==s?s:150,this.bpsThreshold=null!==(n=null==e?void 0:e.bpsThreshold)&&void 0!==n?n:5e8,this.pendingMaxSize=null!==(r=null==e?void 0:e.pendingMaxSize)&&void 0!==r?r:1e4,this.egressedMaxSize=null!==(c=null==e?void 0:e.egressedMaxSize)&&void 0!==c?c:1e4,this.messageMaxSize=null!==(l=null==e?void 0:e.messageMaxSize)&&void 0!==l?l:3e6,this.closeWorkerOnReliabilityFailureEnabled=null===(u=null==t?void 0:t.closeWorkerOnReliabilityFailureEnabled)||void 0===u||u,this.ingressAfterCloseEnabled=null===(d=null==t?void 0:t.ingressAfterCloseEnabled)||void 0===d||d,this.initPromise=new Promise(e=>{this.resolveInitPromise=e})}init(e,t,s,o,n){this.worker=e,this.ingress=t,this.queryEgressCacheSize=s,this.clientMetadata=n,this.egressRateControlTimer=setInterval(()=>this.flush(),1e3),this.networkMode=o,this.reliabilityManager=Object(r.a)(this.worker,this.close.bind(this),this.closeWorkerOnReliabilityFailureEnabled),this.resolveInitPromise()}open(){const e=new o.a({operationName:"NetworkRateControllerOpen",success:!0,dimension3:"networkMode: "+this.networkMode}).start();this.initPromise.then(()=>{if(!this.reliabilityManager)return e.success=!1,e.resultDescription="Reliability Manager is undefined",void this.collectTelemetry(!1,"OnOpenFailure","Reliability Manager is undefined");this.collectTelemetry(!0,"OnOpen"),this.egressRateControlIntervalStart=Date.now(),this.reliabilityManager.start(),this.flush()}).catch(t=>{var s;e.success=!1,e.resultDescription=null!==(s="Catch: "+(null==t?void 0:t.message))&&void 0!==s?s:"",this.collectTelemetry(!1,"OnOpenFailure",t)}).finally(()=>{n.a.info(507834384,n.b.CoreDefault,e.stop())})}ingressFromWorker(e,t){const s=new o.a({operationName:"NetworkRateControllerIngress",success:!0,dimension3:"networkMode: "+this.networkMode}).start();try{if(!this.reliabilityManager&&!this.ingressAfterCloseEnabled)return s.success=!1,s.resultDescription="Reliability Manager is undefined",void this.collectTelemetry(!1,"ingressFromWorkerFailure","Reliability Manager is undefined");if(!this.reliabilityManager)return void this.ingress(e,t);if(!this.reliabilityManager.needsParsedResponses()&&this.reliabilityManager.isReliabilityResponse(e))return void this.reliabilityManager.onResponse();this.ingress(e,e=>{null==t||t(e),this.reliabilityManager.needsParsedResponses()&&this.reliabilityManager.isReliabilityResponse(e)&&this.reliabilityManager.onResponse(e)})}finally{n.a.info(507799170,n.b.CoreDefault,s.stop())}}close(){this.collectTelemetry(!0,"OnClose");const e=new o.a({operationName:"NetworkRateControllerClose",success:!0,dimension3:"networkMode: "+this.networkMode}).start();this.reliabilityManager?this.reliabilityManager.close():e.resultDescription="Reliability Manager is undefined",this.worker=void 0,this.prevSeq=-1,this.clearEgressControlTimeout(),this.reliabilityManager=void 0,n.a.info(507834381,n.b.CoreDefault,e.stop())}clearMessageQueues(){this.pendingQueue=[],this.egressedCache.clear()}egress(e){var t,s,i,r,a;const c=new o.a({operationName:"NetworkRateControllerEgress",success:!0,dimension3:"networkMode: "+this.networkMode}).start();if(!this.reliabilityManager)return c.success=!1,c.resultDescription="Reliability Manager is undefined",n.a.info(507834380,n.b.CoreDefault,c.stop()),void this.collectTelemetry(!1,"EgressFailure","Reliability Manager is undefined");const l=this.getMessageSize(e);if(l>=this.messageMaxSize)return c.success=!1,c.resultSignature="Message size exceeded "+this.messageMaxSize,c.resultDescription="Message size: "+l,n.a.info(507834379,n.b.CoreDefault,c.stop()),void this.collectTelemetry(!0,"Message size exceeded "+this.messageMaxSize,""+l);if((e.obj instanceof ArrayBuffer||e.isHttpSessionInitMessage)&&this.worker)return c.resultDescription=`isArrayBuffer: ${e.obj instanceof ArrayBuffer}, isHttpSessionInitMessage: ${e.isHttpSessionInitMessage}`,n.a.info(507834378,n.b.CoreDefault,c.stop()),void this.worker.egress(e);this.validateSyncMessage(e.messageId,e.seqId);const u=this.queryEgressCacheSize(),d=this.egressMessageCount>=this.rpsThreshold,h=this.egressByteCount>=this.bpsThreshold,p=u>this.egressedMaxSize,g=this.reliabilityManager.checkConnection(),f=0!==this.pendingQueue.length,m=this.pendingQueue.length>=this.pendingMaxSize;if(!g||d||h||f||m||p){let o="";const l=[];(f||m)&&(o+=m?"Pending queue max exceeded. ":"Pending queue not empty. ",l.push(this.pendingQueue.length.toString().length.toString())),p&&(o+=u>=this.egressedMaxSize?"Egressed cache max exceeded. ":"",l.push(u.toString().length.toString())),d&&(o+="RPS exceeded. ",l.push(this.egressMessageCount.toString().length.toString())),h&&(o+="BPS exceeded. ",l.push(this.egressByteCount.toString().length.toString())),o+=g?"":"Not connected. ",c.success=!1,c.resultSignature=o,c.resultDescription="networkMode: "+this.networkMode,c.dimension0=null!==(t=l[0])&&void 0!==t?t:"",c.dimension1=null!==(s=l[1])&&void 0!==s?s:"",c.dimension2=null!==(i=l[2])&&void 0!==i?i:"",c.dimension3=null!==(r=l[3])&&void 0!==r?r:"",n.a.info(507834377,n.b.CoreDefault,c.stop());const y=`pendingQueueSize: ${this.pendingQueue.length} | egressCacheSize: ${u} | rps: ${this.egressMessageCount} | bps: ${this.egressByteCount}`;this.collectTelemetry(!0,o,y);const b=null!==(a=e.messageId)&&void 0!==a?a:"id"+this.emptyMessageId++;this.pendingQueue.push({obj:e.obj,seqId:null==e?void 0:e.seqId,messageId:b,isHttpSessionInitMessage:null==e?void 0:e.isHttpSessionInitMessage})}else this.sendToNetworkWorker(e,c)}getMessageSize(e){return e.obj instanceof ArrayBuffer?e.obj.byteLength:e.obj.length}sendToNetworkWorker(e,t){try{if(!this.worker)return this.collectTelemetry(!1,"SendToNetworkWorkerFailure","NetworkWorker is undefined"),t.success=!1,void(t.resultDescription="NetworkWorker is undefined");if(!this.reliabilityManager)return this.collectTelemetry(!1,"SendToNetworkWorkerFailure","Reliability Manager is undefined"),t.success=!1,void(t.resultDescription="Reliability Manager is undefined");this.worker.egress(e),this.reliabilityManager.postEgress();const s=this.getMessageSize(e);this.logEgressCount(s)}catch(s){t.success=!1,t.resultDescription=s?s.message:"",this.collectTelemetry(!1,"sendToWorker",s?s.message:"")}finally{n.a.info(507834374,n.b.CoreDefault,t.stop())}}flush(){const e=new o.a({operationName:"NetworkRateControllerFlush",success:!0,dimension3:"networkMode: "+this.networkMode});if(!this.reliabilityManager)return e.start(),e.success=!1,e.resultDescription="Reliability Manager is undefined",n.a.info(507834373,n.b.CoreDefault,e.stop()),void this.collectTelemetry(!1,"FlushFailure","Reliability Manager is undefined");let t=0,s=0;for(;this.pendingQueue.length>0&&this.queryEgressCacheSize()<this.egressedMaxSize&&t<this.rpsThreshold&&s<this.bpsThreshold&&this.reliabilityManager.checkConnection();){e.start();const o=this.pendingQueue.shift();this.sendToNetworkWorker(o,e),t++,s+=this.getMessageSize(o)}}clearEgressControlTimeout(){this.egressRateControlTimer&&(clearInterval(this.egressRateControlTimer),this.egressRateControlTimer=void 0)}validateSyncMessage(e,t){if(!(void 0===t||void 0===e||t<=this.prevSeq)){if(t&&t!==this.prevSeq+1){const e=new o.a({operationName:"NetworkRateControllerAbandonedSyncMessage",success:!0,dimension3:"networkMode: "+this.networkMode}).start();e.resultDescription="Gap in sync message",e.dimension0=""+this.prevSeq,e.dimension1=""+t,e.dimension2=""+(t-this.prevSeq),n.a.info(507834370,n.b.CoreDefault,e.stop()),this.collectTelemetry(!0,"abandonedSyncMessage","Gap in sync message",[""+this.prevSeq,""+t,""+(t-this.prevSeq)])}this.prevSeq=t}}logEgressCount(e){var t;const s=Date.now();if(s-this.egressRateControlIntervalStart>1e3){if((this.egressMessageCount>50||this.egressByteCount>1e5)&&(this.egressRateLogOp.start(),this.egressRateLogOp.resultDescription=this.egressMessageCount>50?"rps limit exceeded":"",this.egressRateLogOp.resultDescription=this.egressByteCount>1e5?"bps limit exceeded":"",this.egressRateLogOp.dimension0=(s-this.egressRateControlIntervalStart).toString(),this.egressRateLogOp.dimension1=""+this.egressMessageCount,this.egressRateLogOp.dimension2=""+this.egressByteCount,this.egressRateLogOp.dimension3="networkMode: "+this.networkMode,n.a.info(508843792,n.b.CoreDefault,this.egressRateLogOp.stop())),"Production"!==(null===(t=this.clientMetadata)||void 0===t?void 0:t.releaseAudienceGroup)){const e=this.queryEgressCacheSize();this.collectTelemetry(!0,"networkMode: "+this.networkMode,"egress",[""+(0===this.pendingQueue.length?"0":this.pendingQueue.length.toString().length),""+(0===e?"0":e.toString().length),`${this.rpsThreshold} | ${this.bpsThreshold}`])}this.egressRateControlIntervalStart=s,this.egressMessageCount=0,this.egressByteCount=0}this.egressMessageCount++,this.egressByteCount+=null!=e?e:0}collectTelemetry(e,t,s,o){const n=new Array(4).fill("");if(o)for(let i=0;i<o.length;i++)n[i]=o[i];n[3]=n[3]?n[3]:"networkMode: "+this.networkMode,i.b.collectTelemetry(this.egressLogOp,this.logCountLimiter,e,t,s,n)}}a.className="NetworkRateController"},39555:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(39557),n=s(39556),i=s(39477);const r=(e,t,s)=>e instanceof i.a?new n.a(e):new o.a(e,t,s)},39556:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var o=s(39464),n=s(39467),i=s(39478);const r=JSON.stringify(new i.v({longPollTimeoutHint:15e3}));class a{constructor(e){this.remainingRetryAttempts=4,this.isAsleep=!1,this.isLongPollSuccessful=!1,this.isActiveLongPoll=!1,this.isResponseReceived=!1,this.lastEgressTime=0,this.longPollLogOp=new o.a({operationName:"OnLongPollMessage",success:!0}),this.worker=e}start(){const e=new o.a({operationName:"StartHttpReliabilityManager",success:!0}).start();n.a.info(508163399,n.b.CoreDefault,e.stop()),this.trySendLongPoll(!0),this.isLongPollSuccessful=!0}onResponse(e){if(!e||this.isResponseReceived){const e=new o.a({operationName:"HttpReliabilityManagerFailure",success:!1}).start();return void n.a.info(508162497,n.b.CoreDefault,e.stop())}this.isResponseReceived=!0,this.isActiveLongPoll=!1;const t=e;t.error?(this.isLongPollSuccessful=!1,--this.remainingRetryAttempts,this.remainingRetryAttempts>0?(this.longPollLogOp.success=!1,this.longPollLogOp.resultDescription="Retry attempts left : "+this.remainingRetryAttempts,this.longPollLogOp.resultSignature=t.error,n.a.info(508163398,n.b.CoreDefault,this.longPollLogOp.stop()),"Request timed out"===t.error||3===this.remainingRetryAttempts?this.trySendLongPoll(!0):this.enqueueSendLongPoll()):(this.longPollLogOp.success=!1,this.longPollLogOp.resultDescription="Long poll still not received after all retry attempts",n.a.info(508163397,n.b.CoreDefault,this.longPollLogOp.stop()),this.worker&&this.worker.close())):(this.longPollLogOp.success=!0,this.longPollLogOp.resultDescription="Long poll received",n.a.info(508163401,n.b.CoreDefault,this.longPollLogOp.stop()),this.remainingRetryAttempts=4,this.isLongPollSuccessful=!0,this.trySendLongPoll())}close(){const e=new o.a({operationName:"CloseHttpReliabilityManager",success:!0}).start();n.a.info(508162467,n.b.CoreDefault,e.stop()),this.sendLongPollTimer&&(clearTimeout(this.sendLongPollTimer),this.sendLongPollTimer=void 0),this.isActiveLongPoll=!1,this.isLongPollSuccessful=!1,this.worker=void 0}checkConnection(){if(this.isAsleep){const e=new o.a({operationName:"AwakenHttpReliabilityManager",success:!0}).start();n.a.info(508162496,n.b.CoreDefault,e.stop()),this.trySendLongPoll(!0),this.isAsleep=!1}return this.isLongPollSuccessful}isReliabilityResponse(e){return"string"!=typeof e&&i.w.typeGuard(e)}postEgress(){this.lastEgressTime=Date.now(),this.trySendLongPoll()}needsParsedResponses(){return!0}enqueueSendLongPoll(){this.sendLongPollTimer=setTimeout(()=>{this.trySendLongPoll(!0)},2e4)}trySendLongPoll(e){if(!0===this.isActiveLongPoll){const e=new o.a({operationName:"LongPollNoOp",success:!0}).start();return e.resultDescription="Already active long poll",void n.a.info(508163396,n.b.CoreDefault,e.stop())}if(Date.now()-this.lastEgressTime>6e4&&!e){const e=new o.a({operationName:"LongPollNoOp",success:!0}).start();return e.resultDescription="Sleeping due to inactivity",n.a.info(508162466,n.b.CoreDefault,e.stop()),void(this.isAsleep=!0)}this.worker&&(this.longPollLogOp.start(),this.isActiveLongPoll=!0,this.isResponseReceived=!1,this.worker.egress({obj:r,isHttpSessionLongPollMessage:!0,isHttpSessionInitMessage:!1}))}}},39557:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(39464),n=s(39482);class i{constructor(e,t,s){this.logCountLimiter=new n.a(i.className),this.lastPingTime=0,this.lastPongTime=0,this.lastEgressTime=0,this.remainingPingFailures=3,this.isPingPongSuccessful=!1,this.pingPongLogOp=new o.a({operationName:"WebSocketReliabilityManager",success:!0}).start(),this.worker=e,this.closeWorkerOnReliabilityFailure=s,this.rateControllerClose=t}start(){n.b.collectTelemetry(this.pingPongLogOp,this.logCountLimiter,!0,"ping","initial ping"),this.isPingPongSuccessful=!0,this.ping(),this.startInterval()}onResponse(){this.lastPongTime=Date.now()}isReliabilityResponse(e){return"string"==typeof e&&1===e.length&&e===i.pingPongMessage}close(){this.lastPingTime=0,this.lastPongTime=0,this.isPingPongSuccessful=!1,this.clearPingInterval(),this.worker=void 0}checkConnection(){return this.isPingPongSuccessful}postEgress(){this.lastEgressTime=Date.now()}needsParsedResponses(){return!1}ping(){this.lastPingTime=Date.now(),this.worker&&this.worker.egress({obj:i.pingPongMessage})}startInterval(){this.pingInterval=setInterval(()=>{if(this.isPingPongSuccessful=this.lastPongTime>=this.lastPingTime&&this.lastPongTime-this.lastPingTime<=3e4,this.lastPongTime>this.lastEgressTime)return;const e=this.lastPongTime-this.lastPingTime;this.isPingPongSuccessful?(this.remainingPingFailures=3,n.b.collectTelemetry(this.pingPongLogOp,this.logCountLimiter,!0,"ping","WebSocket channel active",[""+e,""+this.remainingPingFailures]),this.ping()):this.remainingPingFailures>0?(--this.remainingPingFailures,n.b.collectTelemetry(this.pingPongLogOp,this.logCountLimiter,!0,"ping","Pong not received within 30000 ms",[""+e,""+this.remainingPingFailures]),this.ping()):(n.b.collectTelemetry(this.pingPongLogOp,this.logCountLimiter,!1,"ping","Pong still not received after all retry attempts",[""+e,""+this.remainingPingFailures]),this.closeWorkerOnReliabilityFailure&&this.worker?this.worker.close():this.rateControllerClose())},3e4)}clearPingInterval(){this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0)}}i.pingPongMessage="~",i.className="WebSocketReliabilityManager"},39558:function(e,t,s){"use strict";s.d(t,"a",(function(){return x}));var o,n=s(39571),i=s(39464),r=s(39520),a=s(39467),c=s(39474),l=s(39482),u=s(39504),d=s(39505),h=s(39484),p=s(39565),g=s(39566),f=s(39516),m=s(39568),y=s(39559),b=s(39561),T=s(39567),w=s(39570),v=s(39569);!function(e){e[e.Restricted=0]="Restricted",e[e.Unrestricted=1]="Unrestricted",e[e.Suppressed=2]="Suppressed"}(o||(o={}));class k{constructor(){this.canaryTextTileEventSubmittedByDocSessionId=new Set,this.stateByDocSessionId=new Map,this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map}getOutputSchema(){return this.lambdas[this.lambdas.length-1].outputSchema}scheduleExecution(e,t){const s=this.docSessionIdExtractor?this.docSessionIdExtractor(e):void 0,n=this.getStateForDocSessionId(s);if(n===o.Restricted){const e=this.getExecutionQueueForDocSessionId(s);e.push(t),1===e.length&&t()}else n===o.Unrestricted?t():o.Suppressed}onStart(e){this.incrementExecutionCountForDocSessionId(e)}onFinish(e,t){if(this.decrementExecutionCountForDocSessionId(e),t===d.a.Authentication)this.stateByDocSessionId.set(e,o.Suppressed),this.executionQueueByDocSessionId.delete(e);else if(this.stateByDocSessionId.get(e)===o.Restricted){const s=this.getExecutionQueueForDocSessionId(e);if(s.shift(),void 0===t){this.stateByDocSessionId.set(e,o.Unrestricted),this.executionQueueByDocSessionId.delete(e);for(const e of s)e()}else if(s.length>0){(0,s[0])()}}}onRefresh(e){this.stateByDocSessionId=new Map,this.triggerOnRefresh&&(e?(this.executionQueueByDocSessionId.delete(e),this.executionCountByDocSessionId.delete(e)):(this.executionQueueByDocSessionId=new Map,this.executionCountByDocSessionId=new Map)),this.canaryTextTileEventSubmittedByDocSessionId.delete(e)}getStateForDocSessionId(e){let t=this.stateByDocSessionId.get(e);return void 0===t&&(t=k.executionQueuesEnabled?o.Restricted:o.Unrestricted,this.stateByDocSessionId.set(e,t)),t}getExecutionQueueForDocSessionId(e){let t=this.executionQueueByDocSessionId.get(e);return void 0===t&&(t=[],this.executionQueueByDocSessionId.set(e,t)),t}incrementExecutionCountForDocSessionId(e){const t=this.executionCountByDocSessionId.get(e)||0;this.executionCountByDocSessionId.set(e,t+1)}decrementExecutionCountForDocSessionId(e){const t=this.executionCountByDocSessionId.get(e)||0;t<=1?this.executionCountByDocSessionId.delete(e):this.executionCountByDocSessionId.set(e,t-1)}}k.executionQueuesEnabled=!0;const S=e=>({category:h.a.Schema,schema:{name:e}}),C="Tiling.TextTileEvent",_=(e,t)=>e===C&&t&&t.type==p.a.TextTileEventType.Refresh,I=(e,t)=>"ClpSlideTile"===e&&t&&t.eventType==g.a.SlideTileEventType.Refresh,A=(e,t)=>_(e,t)||I(e,t),M=(e,t)=>{var s,o;return e===C?null===(o=null===(s=t.tile)||void 0===s?void 0:s.metadata)||void 0===o?void 0:o.docSessionId:"ClpSlideTile"===e?t.docId:void 0};const x=new class{constructor(){this.inputSchemasToWorkflows=new Map,this.inputSchemasToReduceWorkflows=new Map,this.reduceWorkflowsGroupingKeyExtractors=new Map,this.defaultWorkflowOptions={canProduceNullResult:!1,shouldSendResultsToHost:!0,enabledByDefault:!1,throttleSettings:{shouldBeThrottled:!1},triggerOnRefresh:!1},this.resultCache=new T.a,this.reduceTimerCache=new m.a,this.lookupTableCache=new Map,this.throttling=new v.a,this.lastTileRefreshSeq=-1,this.lastTileRefreshSeqByDocSessionId=new Map,this.tileRefreshByDocSessionIdEnabled=!0}init(e,t,s){const o=new i.a({operationName:"InitRuntimeALv1",resourceId:e});o.start(),this.clientMetadata=t,this.clientMetadata&&(this.clientMetadata.runtimeVersion=Object(c.a)()),this.hostCallbacks=s;const n=[];return n.push(this.isFeatureEnabled("DisableWebSocket").then(s=>{if(!!s)return!1;return!(["Outlook Mac","Outlook Win32","PowerPoint Mac","PowerPoint Web","PowerPoint Win32","Word Mac","Word Win32"].indexOf(`${t.appName} ${t.appPlatform}`)>=0)||b.c(l.b.convertServiceUrlToWebSocket(e),this.clientMetadata)}).then(t=>{e&&(this.serviceUrl=t?l.b.convertServiceUrlToWebSocket(e):e,this.executeRemoteLambda=t?b.b:y.b,this.clearRemoteLambdaTokenCache=t?b.a:y.a,this.serviceProtocol=this.serviceUrl.split(":")[0].toLowerCase())})),n.push(this.isFeatureEnabled("WorkflowQueuesDisabled").then(e=>{k.executionQueuesEnabled=!e})),n.push(this.isFeatureEnabled("TileRefreshByDocSessionIdDisabled").then(e=>{this.tileRefreshByDocSessionIdEnabled=!e})),Promise.all(n).then(()=>{this.logOperation(o,!0)}).catch(e=>{this.logOperation(o,!1,"Error",e?e.message:"(no error)")})}getServiceProtocol(){return this.serviceProtocol}registerSchemas(e,t){return Promise.resolve()}registerSimpleLocalWorkflow(e,t,s=this.defaultWorkflowOptions){return t.source=t.source||w.a.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToWorkflows,s)}registerSimpleRemoteWorkflow(e,t,s,o,n=this.defaultWorkflowOptions){const i=[];return t&&(t.source=w.a.Custom,i.push(t)),s.source=s.func?w.a.Custom:w.a.Remote,i.push(s),o&&(o.source=w.a.Custom,i.push(o)),this.registerHardcodedWorkflow(e,i,this.inputSchemasToWorkflows,n)}registerMultipleLambdasWorkflow(e,t,s=this.defaultWorkflowOptions){return this.registerHardcodedWorkflow(e,t,this.inputSchemasToWorkflows,s)}registerReduceWorkflow(e,t,s,o=10,n=this.defaultWorkflowOptions){return this.reduceWorkflowsGroupingKeyExtractors.set(t.inputSchema,s),this.resultCache.setBucketSize(t.inputSchema,o),t.source=t.source||w.a.Custom,this.registerHardcodedWorkflow(e,[t],this.inputSchemasToReduceWorkflows,n)}registerMultipleLambdasReduceWorkflow(e,t,s,o=10,n=this.defaultWorkflowOptions){return this.reduceWorkflowsGroupingKeyExtractors.set(t[0].inputSchema,s),this.resultCache.setBucketSize(t[0].inputSchema,o),this.registerHardcodedWorkflow(e,t,this.inputSchemasToReduceWorkflows,n)}submit(e,t,s){this.submitToWorkflows(e,t,s,this.inputSchemasToWorkflows)}getGroupingKey(e,t,s){const o=this.reduceWorkflowsGroupingKeyExtractors.get(s);if(null==o)throw new Error("Reduce workflow does not have a grouping extractor");return o(t,e)}submitToWorkflows(e,t,s,o=this.inputSchemasToWorkflows){if(!this.hostCallbacks)return;let n;n=s?r.a.fromString(s):new r.a,this.handleTileRefresh(e,t,n);const i=o.get(e)||[];for(const r of i)A(e,t)&&!r.triggerOnRefresh||(r.useCanaryTextTile&&e===C&&!r.canaryTextTileEventSubmittedByDocSessionId.has(M(e,t))&&(this.submitToWorkflow(C,{type:(a=t).type,tile:{metadata:{docSessionId:a.tile.metadata.docSessionId,docId:a.tile.metadata.docId,seqnoCLPRefresh:a.tile.metadata.seqnoCLPRefresh,tileId:"A56B3127DBDFD0D6"},elements:[{text:"B91153AE828B4E48"}]}},n,r,o),r.canaryTextTileEventSubmittedByDocSessionId.add(M(e,t))),this.submitToWorkflow(e,t,n,r,o));var a}submitToWorkflow(e,t,s,o,n){const r={messageType:d.b.Input,correlationVector:s.newChild(),payload:t,payloadSchema:S(o.lambdas[0].inputSchema),clientMetadata:this.clientMetadata},c=new i.a({cv:r.correlationVector.toString(),operationName:"ExecuteWorkflow",resourceId:o.name});c.setClientMetadata(this.clientMetadata),c.start(),o.scheduleExecution(t,()=>{try{if(r.payload&&r.payload.tile&&r.payload.tile.metadata&&r.payload.tile.metadata.tileId){const s=r.payload.tile.metadata.tileId;this.throttling.execute(s,o,()=>this.executeWorkflow(c,r,t,o,e,n))}else this.executeWorkflow(c,r,t,o,e,n)}catch(s){c.success=!1,c.resultSignature="ExecuteException",c.resultDescription=s?s.message:"(no error)",a.a.error(559290447,a.b.CoreDefault,c.stop())}})}handleTileRefresh(e,t,s){if(!A(e,t))return;const o=this.tileRefreshByDocSessionIdEnabled?M(e,t):void 0,n=((e,t)=>{var s,o;return _(e,t)?null===(o=null===(s=t.tile)||void 0===s?void 0:s.metadata)||void 0===o?void 0:o.seqnoCLPRefresh:(I(e,t),-1)})(e,t);if(this.tileRefreshByDocSessionIdEnabled){const e=this.lastTileRefreshSeqByDocSessionId.get(o);if(e>=0&&n<=e)return}else if(n<=this.lastTileRefreshSeq)return;const r=new i.a({cv:s.toString(),operationName:"TileRefresh",resultDescription:"",success:!0});if(r.start(),this.tileRefreshByDocSessionIdEnabled&&!o)return r.success=!1,r.resultDescription="NoDocSessionId",void a.a.info(559290448,a.b.CoreDefault,r.stop());this.inputSchemasToReduceWorkflows.forEach((e,t)=>{e.some(e=>e.triggerOnRefresh)&&(this.tileRefreshByDocSessionIdEnabled?(this.resultCache.clear(t,{primary:o}),this.resultCache.clear(this.getForcedDocLevelSchema(t),{primary:o}),this.reduceTimerCache.clear(t,o)):(this.resultCache.clear(t),this.resultCache.clear(this.getForcedDocLevelSchema(t)),this.reduceTimerCache.clear(t)),e.some(e=>!e.triggerOnRefresh)&&(r.resultDescription+="X_"),r.resultDescription+=t+" ")}),this.clearRemoteLambdaTokenCache();const c=[];this.inputSchemasToWorkflows.forEach(e=>c.push(...e)),this.inputSchemasToReduceWorkflows.forEach(e=>c.push(...e));for(const i of c)this.tileRefreshByDocSessionIdEnabled?i.onRefresh(o):i.onRefresh();this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.set(o,n):this.lastTileRefreshSeq=n,a.a.info(559290449,a.b.CoreDefault,r.stop())}executeWorkflow(e,t,s,o,i,r){const c=o.docIdExtractor?o.docIdExtractor(t.payload):void 0,l=o.docSessionIdExtractor(s),u=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(l):this.lastTileRefreshSeq;o.onStart(l);const h=t=>{const c=this.tileRefreshByDocSessionIdEnabled?this.lastTileRefreshSeqByDocSessionId.get(l):this.lastTileRefreshSeq;if(o.triggerOnRefresh&&c!==u)return e.success=!0,e.resultSignature="TileRefreshIgnore",void a.a.info(559290450,a.b.CoreDefault,e.stop());const h=t.messageType==d.b.Exception&&t.payload.exceptionType==d.a.NoOutput,p=h&&o.canProduceNullResult,g=p?o.lambdas[o.lambdas.length-1].outputSchema:t.payloadSchema.schema.name,f=p?null:t.payload;t.messageType===d.b.Input||p?(o.shouldSendResultsToHost&&(r===this.inputSchemasToReduceWorkflows?this.hostCallbacks.onResult("Reduce.Input",s,g,f):this.hostCallbacks.onResult(i,s,g,f)),e.success=!0,e.resultSignature=h?"NoOutput":"ValidOutput"):h?(e.success=!0,e.resultSignature="NoOutput"):(e.success=!1,e.resultSignature="Exception",e.resultDescription=Object(n.a)(t)),r!==this.inputSchemasToReduceWorkflows&&this.updateResultCacheForReduceWorkflows(i,s,g,f,t.correlationVector.toString()),t.moreResults||(e.stop(),a.a.info(559290451,a.b.CoreDefault,e),o.onFinish(l,t.payload&&t.payload.exceptionType?Object(n.b)(t):void 0))};o.preExecutionPromise.then(()=>{const e={lookupTable:this.lookupTableCache.get(o.name),docId:c,docSessionId:l};let s=h;for(let t=o.lambdas.length-1;t>=0;t--)s=this.createLambdaExecutionStep(o.name,o.lambdas[t],e,s,h);s(t)})}getForcedDocLevelSchema(e){return"~"+e}updateResultCacheForReduceWorkflows(e,t,s,o,n){const i=this.inputSchemasToReduceWorkflows.get(s);if(i){let r;"docSessionId"===e?(r=this.getGroupingKey(e,t,s),this.resultCache.setResult(this.getForcedDocLevelSchema(s),r,o),r.secondary="*"):(r=this.getGroupingKey(e,t,s),((e,t)=>e===C&&t&&t.type==p.a.TextTileEventType.Delete||"ClpSlideTile"===e&&t&&t.eventType==g.a.SlideTileEventType.Delete)(e,t)&&null!=r.primary&&null!=r.secondary?this.resultCache.clear(void 0,r):this.resultCache.setResult(s,r,o));const c=i.some(e=>e.deferReduceUntilIdle),l=[];this.inputSchemasToWorkflows.forEach(e=>l.push(...e.filter(e=>e.getOutputSchema()===s)));const u=()=>c&&l.some(e=>e.executionCountByDocSessionId.get(r.primary)>0),d=i.map(e=>e.deferReduceUntilIdleMaxDelayMs||0).reduce((e,t)=>Math.max(e,t));this.reduceTimerCache.setReduceTimer(s,r.primary,()=>{const e=this.resultCache.getResults(s,r);if(e.push(...this.resultCache.getResults(this.getForcedDocLevelSchema(s),{primary:r.primary})),Array.isArray(e)){const t={id:r.primary,values:e,isReduceInput:!0};this.submitToWorkflows(s,t,n,this.inputSchemasToReduceWorkflows)}else a.a.error(559290452,a.b.CoreDefault,`Cached results have unexpected type "${typeof e}"`)},500,u,d)}}isFeatureEnabled(e,t=!1,s="None"){return this.hostCallbacks&&this.hostCallbacks.isFeatureEnabled?this.hostCallbacks.isFeatureEnabled("Microsoft.Office.AugLoop."+e,s).catch(()=>Promise.resolve(t)):Promise.resolve(t)}areLicenseFeaturesEnabled(e){return this.hostCallbacks&&this.hostCallbacks.areLicenseFeaturesEnabled?this.hostCallbacks.areLicenseFeaturesEnabled(e).catch(()=>Promise.resolve(!1)):Promise.resolve(!1)}isWorkflowEnabled(e,t,s,o,n){if(t.some(e=>e.source===w.a.Remote||e.source===w.a.BatchedRemote)){if(!this.serviceUrl)return n.resultDescription="Disabled because no service URL available for remote workflow",Promise.resolve(!1);if(this.clientMetadata&&this.clientMetadata.privateMode&&t.some(e=>(e.source===w.a.Remote||e.source===w.a.BatchedRemote)&&!e.canRunInPrivateMode))return n.resultDescription="Disabled because we are running in private mode",Promise.resolve(!1)}let i;return(!this.clientMetadata||"Mac"!==this.clientMetadata.appPlatform&&"Win32"!==this.clientMetadata.appPlatform)&&(o=!0,n.resultDescription="Enabled by default due to platform name"),i=o?Promise.resolve(!0):this.isFeatureEnabled("WorkflowEnabled."+e),i.then(t=>t?this.isFeatureEnabled("WorkflowDisabled."+e).then(e=>e?(n.resultDescription="Disabled because explicitly disabled",!1):!s||this.areLicenseFeaturesEnabled(s).then(e=>(e||(n.resultDescription="Disabled because license check failed"),e))):(n.resultDescription="Disabled because not explicitly enabled",!1))}registerHardcodedWorkflow(e,t,s=this.inputSchemasToWorkflows,o){if(!e||e.length>40)throw new Error("Workflow name has invalid length");if(!1===new RegExp(/^[A-Z][a-zA-Z0-9_]+$/).test(e))throw new Error("Workflow name has invalid format");s.forEach(t=>{if(t.some(t=>t.name===e))throw new Error("Workflow name already registered.")});const n=new i.a({operationName:"WorkflowRegistration",resourceId:e,success:!0});return n.setClientMetadata(this.clientMetadata),n.start(),this.isWorkflowEnabled(e,t,o.licenseFeatures,o.enabledByDefault,n).then(i=>{if(n.resultSignature=i?"Enabled":"Disabled",n.stop(),a.a.info(559290453,a.b.CoreDefault,n),i){const n=t[0].inputSchema;let i=s.get(n);i||(i=[],s.set(n,i));let a=Promise.resolve();o.lookupTableLambda&&(a=new Promise((t,s)=>{const n=new r.a,i={messageType:d.b.Input,correlationVector:n,payloadSchema:S(o.lookupTableLambda.inputSchema),clientMetadata:this.clientMetadata,payload:{}},a=s=>{s.messageType===d.b.Input&&s.payload&&this.lookupTableCache.set(e,s.payload),t()};this.createLambdaExecutionStep("",o.lookupTableLambda,{},a,a)(i)}));const c=new k;c.name=e,c.lambdas=t,c.canProduceNullResult=o.canProduceNullResult,c.shouldSendResultsToHost=o.shouldSendResultsToHost,c.triggerOnRefresh=o.triggerOnRefresh,c.throttleSettings=o.throttleSettings||this.defaultWorkflowOptions.throttleSettings,c.docIdExtractor=o.docIdExtractor,c.docSessionIdExtractor=e=>e.isReduceInput?e.id:M(n,e),c.deferReduceUntilIdle=o.deferReduceUntilIdle,c.deferReduceUntilIdleMaxDelayMs=o.deferReduceUntilIdleMaxDelayMs,c.useCanaryTextTile=o.useCanaryTextTile,c.preExecutionPromise=a,i.push(c)}})}logOperation(e,t,s,o){e.stop(),e.success=t,e.resultSignature=s,e.resultDescription=o,a.a.info(559290454,a.b.CoreDefault,e)}handleLambdaError(e,t,s,o,i){null!=e.exceptionType?Object(n.c)(t,e):e instanceof Error?Object(n.c)(t,{exceptionType:o,message:e.message}):Object(n.c)(t,{exceptionType:d.a.Unknown,message:e?e.toString():void 0}),this.logOperation(s,!1,"Exception",Object(n.a)(t)),i(t)}handleLambdaOutput(e,t,s,o,i,r){e&&e.exceptionType!==d.a.NoOutput?null!=e.exceptionType?this.handleLambdaError(e,t,s,e.exceptionType,r):e instanceof Error?this.handleLambdaError(e,t,s,d.a.LambdaErrorCallback,r):(t.payload=e,t.payloadSchema=S(o),this.logOperation(s,!0),i(t)):(Object(n.c)(t,{exceptionType:d.a.NoOutput}),this.logOperation(s,!0,"NoOutput"),r(t))}executeCustomLambdaStep(e,t,s,o,i,r){if(null==s.func)Object(n.c)(e,{exceptionType:d.a.LambdaThrow,message:"No lambda function set"}),this.logOperation(t,!1,"Error",Object(n.a)(e)),r(e);else{const n=o=>{this.handleLambdaOutput(o,e,t,s.outputSchema,i,r)},c=(s,o)=>{this.handleLambdaOutput(s,e,t,o,r,r)};try{s.func(e.payload,s.config,o,n,c)}catch(a){this.handleLambdaError(a,e,t,d.a.LambdaThrow,r)}}}executeLocalLambdaStep(e,t,s,o,i){null==this.hostCallbacks.executeLocalLambda?(Object(n.c)(e,{exceptionType:d.a.LambdaThrow,message:"No local lambda host callback set"}),this.logOperation(t,!1,"Error",Object(n.a)(e)),i(e)):this.hostCallbacks.executeLocalLambda(s.inputSchema,e.payload,s.outputSchema).then(n=>{this.handleLambdaOutput(n,e,t,s.outputSchema,o,i)}).catch(s=>{this.handleLambdaError(s,e,t,d.a.LambdaThrow,i)})}executeRemoteLambdaStep(e,t,s,o,i,r){if(this.serviceUrl){t.resourceId+="."+this.serviceProtocol;const n=(o,n)=>{o?this.handleLambdaError(o,e,t,o.exceptionType||d.a.LambdaErrorCallback,r):this.handleLambdaOutput(n,e,t,s.outputSchema,i,r)};if(o.authTickets=s.authTickets,s.source===w.a.Remote)this.executeRemoteLambda(this.serviceUrl,e,S(s.inputSchema),S(s.outputSchema),e.correlationVector,this.clientMetadata,this.hostCallbacks,o,n);else{this.batchedRemoteLambdaManager||(this.batchedRemoteLambdaManager=new u.a((e,t,s)=>{const{remoteLambda:o,lambdaContext:n}=t.context;this.executeRemoteLambda(this.serviceUrl,{messageType:d.b.Input,correlationVector:{id:t.cv},payload:e,payloadSchema:S(o.inputSchema),clientMetadata:this.clientMetadata},S(o.remoteInputSchema),S(o.remoteOutputSchema),{id:t.cv},this.clientMetadata,this.hostCallbacks,n,s)},!1,!1,!1,(e,t,s)=>{var o;const{lambdaContext:n}=s;this.updateResultCacheForReduceWorkflows("docSessionId",null!==(o=n.docSessionId)&&void 0!==o?o:n.docId,e,t)}));const{batchOptions:t}=s,i=this.normalizeBatchOptions(t),{groupingKeyExtractor:r}=i;i.groupingKeyExtractor=e=>`${s.name}-${r(e)}`;const a={name:s.name,remoteLambda:s,lambdaContext:o};this.batchedRemoteLambdaManager.addBatchItem(e.payload,i,a,e.correlationVector.id.length>127?e.correlationVector.id.substring(0,127)+"!":e.correlationVector.id,void 0,n)}}else Object(n.c)(e,{exceptionType:d.a.LambdaThrow,message:"No URL for remote lambda"}),this.logOperation(t,!1,"Error",Object(n.a)(e)),r(e)}createLambdaExecutionStep(e,t,s,o,r){return a=>{const c=new i.a({cv:a.correlationVector.toString(),operationName:"ExecuteLambda",resourceId:t.name,dimension0:e});c.start(),t.source===w.a.Custom?this.executeCustomLambdaStep(a,c,t,s,o,r):t.source===w.a.Local?this.executeLocalLambdaStep(a,c,t,o,r):t.source===w.a.Remote||t.source===w.a.BatchedRemote?this.executeRemoteLambdaStep(a,c,t,s,o,r):(Object(n.c)(a,{exceptionType:d.a.LambdaThrow,message:"Unknown/No lambda location set"}),this.logOperation(c,!1,"Error",Object(n.a)(a)),r(a))}}normalizeBatchOptions(e){if(!e)throw new Error("Expected batchConfig");const t=Object.assign({},e);return e.estimateSize||(t.estimateSize=f.a),t}}},39559:function(e,t,s){"use strict";s.d(t,"a",(function(){return c})),s.d(t,"b",(function(){return u}));var o=s(39467),n=s(39480),i=s(39505),r=s(39560);let a;const c=()=>{a=new r.a};c();const l=(e,t,s,r,c,u,d,h,p,g)=>{const f={method:"POST",headers:{"content-type":"application/json","X-CorrelationId":c},body:JSON.stringify({payload:t.payload,payloadSchema:s,requestedSchema:r,clientMetadata:u,tokens:a.getAuthTokenEntries(d,p.docId)})};Object(n.b)(e,f,(n,f)=>{n?g(new Error(`Fetch error in remote lambda request to ${e}: ${n}`)):401===f.status?h>0?(o.a.info(572838109,o.b.CoreDefault,"Auth token required for remote lambda request"),f.json().then(e=>a.updateAuthToken(d,{Tickets:[e],DocId:p.docId})).then(()=>{l(e,t,s,r,c,u,d,h-1,p,g)}).catch(e=>{g({exceptionType:i.a.Authentication,message:e.message})})):g({exceptionType:i.a.Authentication,message:"Remote lambda request retry with authentication token failed"}):f.ok?f.json().then(e=>{if(Array.isArray(e))if(e.length>0){let s=0;for(const o of e)t.moreResults=++s<e.length,g(null,o)}else g(new Error("No output"));else g(new Error("Did not receive a valid response for remote lambda request"))}).catch(e=>{g({exceptionType:i.a.LambdaThrow,message:e.message})}):g(new Error("Remote lambda request failed with status "+f.status))})},u=(e,t,s,o,n,r,c,u,d)=>{Array.isArray(u.authTickets)?a.updateAuthToken(c,{Tickets:u.authTickets,DocId:u.docId}).then(()=>{l(e,t,s,o,n.id,r,c,1,u,d)}).catch(e=>{d({exceptionType:i.a.Authentication,message:e.message})}):l(e,t,s,o,n.id,r,c,1,u,d)}},39560:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39482);class n{constructor(e=33e5){this.tokenCache=new Map,this.requestMap=new Map,this.requestRecordMap=new Map,this.tokenExpirationMs=e}updateAuthToken(e,t){const s=JSON.stringify(t);let n=this.requestRecordMap.get(s);return(void 0===n||this.isTokenExpired(n))&&(n={requestPromise:e.requestAuthToken(t).then(e=>{if(!e||!e.Token)throw new Error("No token available for request "+s);this.tokenCache.set(s,e.Token)}),requestTime:o.b.getCurrentTimeMs()},this.requestRecordMap.set(s,n)),n.requestPromise}getAuthTokenEntries(e,t){return Array.from(this.tokenCache.keys()).map(e=>{let t=this.requestMap.get(e);return void 0===t&&(t=JSON.parse(e),this.requestMap.set(e,t)),{requestKey:e,request:t}}).filter(({request:e})=>!t||e.DocId===t).map(({requestKey:t,request:s})=>(this.isTokenExpired(this.requestRecordMap.get(t))&&this.updateAuthToken(e,s),{ticket:s.Tickets[0],token:this.tokenCache.get(t)}))}isTokenExpired(e){return o.b.getCurrentTimeMs()>e.requestTime+this.tokenExpirationMs}}},39561:function(e,t,s){"use strict";s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return h})),s.d(t,"c",(function(){return p}));var o=s(39467),n=s(39563),i=s(39505),r=s(39560),a=s(39562);let c;const l=()=>{c=new r.a};l();const u=new a.a(3e4,()=>new n.a,50),d=(e,t,s,n,r,a,l,h,p,g)=>{const f={payload:t.payload,payloadSchema:s,requestedSchema:n,clientMetadata:a,tokens:c.getAuthTokenEntries(l,p.docId)};let m="";n&&n.schema&&(m=n.schema.name);let y=!1;u.addRequest(e,f,r,m,(u,f,m)=>{if(!y)if(y=!0,null!=f)if(f.exceptionType===i.a.Authentication)try{const u=JSON.parse(f.data);h>0?(o.a.info(572838108,o.b.CoreDefault,"Auth token required for remote lambda WebSocket request"),c.updateAuthToken(l,{Tickets:[u],DocId:p.docId}).then(()=>{d(e,t,s,n,r,a,l,h-1,p,g)}).catch(e=>{g({exceptionType:i.a.Authentication,message:e.message})})):g({exceptionType:i.a.Authentication,message:"Remote lambda request retry with authentication token failed"})}catch(b){g({exceptionType:i.a.Authentication,message:b.message})}else g(new Error(`Error in remote lambda WebSocket request to ${e}: ${f}`));else t.moreResults=!1,g(null,u)})},h=(e,t,s,o,n,r,a,l,u)=>{Array.isArray(l.authTickets)?c.updateAuthToken(a,{Tickets:l.authTickets,DocId:l.docId}).then(()=>{d(e,t,s,o,n.id,r,a,1,l,u)}).catch(e=>{u({exceptionType:i.a.Authentication,message:e.message})}):d(e,t,s,o,n.id,r,a,1,l,u)},p=(e,t)=>u.testConnection(e,t)},39562:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var o=s(39464),n=s(39520),i=s(39467),r=s(39482);class a{constructor(e,t,s,o,n,i){this.requestId=e,this.correlationId=t,this.schemaName=s,this.data=o,this.callback=n,this.requestTimeoutInMs=i,this.ended=!1,this.startTime=0}startRequest(){this.startTime=r.b.getCurrentTimeMs()}getMsUntilTimeout(){const e=r.b.getCurrentTimeMs()-this.startTime;return this.requestTimeoutInMs-e}endRequest(e){this.ended||(this.invokeCallback(null,e,!0),this.ended=!0)}addResponseData(e){this.invokeCallback(e,null,!1)}invokeCallback(e,t,s){new Promise(()=>this.callback(e,t,s)).catch(e=>{})}}class c{constructor(e,t,s){this.requestCounter=0,this.activeRequests=[],this.pendingRequests=[],this.requestTimeoutInMs=e,this.workerFactory=t,this.maxActiveRequests=s}testConnection(e,t){let s=!1;const a=new o.a({cv:(new n.a).toString(),operationName:"WebSocketTest",resourceId:e,success:!0}).start();return new Promise(o=>{const n=r.b.createHealthCheckRequest(t);e?this.addRequest(e,n,a.cv,"HealthCheckRequest",(e,t,n)=>{t&&(a.success=!1,a.resultSignature="Error",a.resultDescription=t.message||t),e&&"OK"===e.status&&(s=!0),n&&(a.success&&!s&&(a.success=!1,a.resultSignature="NoResponseData"),i.a.info(556617949,i.b.CoreDefault,a.stop()),o(a.success))}):(a.success=!1,a.resultSignature="EmptyUrl",i.a.info(557641870,i.b.CoreDefault,a.stop()),o(a.success))})}addRequest(e,t,s,o,n){const i=(this.requestCounter++).toString(),r=new a(i,s,o,t,n,this.requestTimeoutInMs);this.getWorker(e),this.pendingRequests.push(r),this.egressPendingRequests()}egressPendingRequests(){for(;this.pendingRequests.length>0&&this.activeRequests.length<this.maxActiveRequests;){const e=this.pendingRequests.shift();if(this.activeRequests.push(e),1===this.activeRequests.length){const t=e.getMsUntilTimeout();setTimeout(this.onTimeout.bind(this),t)}e.startRequest(),this.worker&&this.worker.egress({obj:this.createRequestMessage(e.data,e.requestId,e.correlationId)})}}createRequestMessage(e,t,s){return JSON.stringify({correlationId:s,requestId:t,body:e})}onTimeout(){for(;this.activeRequests.length>0;){const e=this.activeRequests[0],t=e.getMsUntilTimeout();if(!(t<=0))return void setTimeout(this.onTimeout.bind(this),t);{const t=new Error("Request timed out");e.endRequest(t),this.activeRequests.shift(),this.egressPendingRequests()}}}onMessage(e){try{const t=JSON.parse(e);for(let e=0;e<this.activeRequests.length;e++){const s=this.activeRequests[e];if(s.requestId===t.requestId){t.end?(this.activeRequests.splice(e,1),s.endRequest(t.error),this.egressPendingRequests()):t.body&&s.addResponseData(t.body);break}}}catch(t){i.a.error(557641871,i.b.CoreDefault,t)}}onClose(e){const t=new Error("Connection closed: "+e);for(const s of this.activeRequests)s.endRequest(t);this.activeRequests=[];for(const s of this.pendingRequests)s.endRequest(t);this.pendingRequests=[],this.worker=void 0}getWorker(e){return this.worker||(this.worker=this.workerFactory(),this.worker.init(e,this.onMessage.bind(this),()=>{},this.onClose.bind(this))),this.worker}}},39563:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var o=s(39564),n=s.n(o),i=s(39464),r=s(39467),a=s(39482);class c{constructor(){this.hasBeenOpened=!1,this.hadEgressError=!1,this.lastEgressTime=0,this.lastPongTime=0,this.remainingPingFailures=3,this.egressMessageCount=0,this.egressByteCount=0,this.isClosing=!1,this.pendingEgress=[]}init(e,t,s,o){this.ws=new n.a(e),this.logOp=new i.a({operationName:c.className,success:!0,dimension1:"V1"}).start(),this.egressTimer=Date.now(),this.egressMessageCountOp=new i.a({operationName:"WSEgressMessageCount",success:!0,dimension1:"V1"}),this.egressByteCountOp=new i.a({operationName:"WSEgressByteOrderOfMagnitude",success:!0,dimension1:"V1"}),this.ingressByteCountOp=new i.a({operationName:"WSIngressByteOrderOfMagnitude",success:!0,dimension1:"V1"});const a=e=>{this.logPingLatencyOp&&(this.logPingLatencyOp.success=e,r.a.info(507789790,r.b.CoreDefault,this.logPingLatencyOp.stop()),this.logPingLatencyOp=void 0)};this.ws.addEventListener("open",e=>{s(),c.logCountLimiter.log(()=>{this.logOp.resourceId="OnOpen",this.logOp.resultDescription="",this.logOp.success=!0,this.logOp.dimension0=this.pendingEgress.length.toString(),r.a.info(507789789,r.b.CoreDefault,this.logOp.stop())}),this.hasBeenOpened=!0,this.pendingEgress.forEach(e=>{this.egress({obj:e})}),this.pendingEgress=[],this.pingInterval=setInterval(()=>{this.logPingLatencyOp&&(--this.remainingPingFailures,a(!1)),this.remainingPingFailures>0&&this.hasBeenOpened&&this.lastPongTime<this.lastEgressTime&&(this.logPingLatencyOp=new i.a({operationName:"Ping",success:!0,dimension0:this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString().length.toString():void 0,dimension1:"V1"}).start(),this.ws.send(c.pingPongMessage,e=>{e&&(--this.remainingPingFailures,a(!1))}))},3e4)}),this.ws.addEventListener("message",e=>{this.logPingLatencyOp&&"string"==typeof e.data&&1===e.data.length&&e.data[0]===c.pingPongMessage?(a(!0),this.lastPongTime=Date.now()):(this.logIngressCount(e.data),t(e.data))}),this.ws.addEventListener("error",e=>{this.errorMessage=e.message,c.logCountLimiter.log(()=>{this.logOp.resourceId="OnError",this.logOp.resultDescription=this.errorMessage,this.logOp.success=!1,r.a.info(507789788,r.b.CoreDefault,this.logOp.stop())}),this.ws.close()}),this.ws.addEventListener("close",e=>{c.logCountLimiter.log(()=>{this.logOp.resourceId="OnClose",this.logOp.resultDescription=e?`code: ${e.code}. reason: ${e.reason}`:"",this.logOp.success=!0,r.a.info(507789787,r.b.CoreDefault,this.logOp.stop())}),this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),o(this.errorMessage),this.isClosing=!1})}egress(e){const t=e.obj;this.logEgressCount(t instanceof ArrayBuffer||t instanceof Uint8Array?t.byteLength:t.length),this.lastEgressTime=Date.now(),this.hasBeenOpened?this.ws.send(t,e=>{e&&!this.hadEgressError&&(this.hadEgressError=!0,c.logCountLimiter.log(()=>{this.logOp.resourceId="OnFirstEgressError",this.logOp.resultDescription=e.message,this.logOp.success=!1,r.a.info(507789786,r.b.CoreDefault,this.logOp.stop())}))}):this.pendingEgress.push(t)}close(){this.isClosing||(this.isClosing=!0,this.pingInterval&&(clearInterval(this.pingInterval),this.pingInterval=void 0),this.ws.close())}logEgressCount(e){const t=Date.now(),s=t-this.egressTimer;s>1e3&&(this.egressMessageCount>50&&(this.egressMessageCountOp.start(),this.egressMessageCountOp.resultDescription="Egress message count: "+this.egressMessageCount.toString()+", Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+s.toString(),r.a.info(507789785,r.b.CoreDefault,this.egressMessageCountOp.stop())),this.egressByteCount>1e5&&(this.egressByteCountOp.start(),this.egressByteCountOp.dimension2=this.egressByteCount.toString().length.toString(),this.egressMessageCountOp.resultDescription="Buffered amount: "+(this.ws.bufferedAmount>=0?this.ws.bufferedAmount.toString():"-")+", Time elapsed: "+s.toString(),r.a.info(507789784,r.b.CoreDefault,this.egressByteCountOp.stop())),this.egressTimer=t,this.egressMessageCount=0,this.egressByteCount=0),this.egressMessageCount++,this.egressByteCount+=null!=e?e:0}logIngressCount(e){const t=e.length;t>1e5&&(this.ingressByteCountOp.start(),this.ingressByteCountOp.dimension2=t.toString().length.toString(),r.a.info(507789783,r.b.CoreDefault,this.ingressByteCountOp.stop()))}}c.className="WebSocketWorker",c.logCountLimiter=new a.a(c.className),c.pingPongMessage="~"},39564:function(e,t,s){(function(t){var s=null;"undefined"!=typeof WebSocket?s=WebSocket:"undefined"!=typeof MozWebSocket?s=MozWebSocket:void 0!==t?s=t.WebSocket||t.MozWebSocket:"undefined"!=typeof window?s=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(s=self.WebSocket||self.MozWebSocket),e.exports=s}).call(this,s(10702))},39565:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){let t,s,o,n,i,r;!function(e){e[e.Unknown=0]="Unknown",e[e.Text=1]="Text",e[e.Slide=2]="Slide"}(t=e.TileType||(e.TileType={})),function(e){e[e.Generic=0]="Generic",e[e.Title=1]="Title",e[e.SmartArt=2]="SmartArt",e[e.TableCell=3]="TableCell",e[e.TextBox=4]="TextBox",e[e.Notes=5]="Notes"}(s=e.TextTileType||(e.TextTileType={})),function(e){e[e.Undefined=0]="Undefined",e[e.Word=1]="Word",e[e.Phrase=2]="Phrase",e[e.Sentence=3]="Sentence",e[e.Paragraph=4]="Paragraph"}(o=e.TextTileElementUnit||(e.TextTileElementUnit={})),function(e){e[e.Undefined=0]="Undefined",e[e.Bullet=1]="Bullet",e[e.Numbered=2]="Numbered"}(n=e.ListType||(e.ListType={})),function(e){e[e.Undefined=0]="Undefined",e[e.AlphaLcParenBoth=1]="AlphaLcParenBoth",e[e.AlphaUcParenBoth=2]="AlphaUcParenBoth",e[e.AlphaLcParenR=3]="AlphaLcParenR",e[e.AlphaUcParenR=4]="AlphaUcParenR",e[e.AlphaLcPeriod=5]="AlphaLcPeriod",e[e.AlphaUcPeriod=6]="AlphaUcPeriod",e[e.ArabicParenBoth=7]="ArabicParenBoth",e[e.ArabicParenR=8]="ArabicParenR",e[e.ArabicPeriod=9]="ArabicPeriod",e[e.ArabicPlain=10]="ArabicPlain",e[e.RomanLcParenBoth=11]="RomanLcParenBoth",e[e.RomanUcParenBoth=12]="RomanUcParenBoth",e[e.RomanLcParenR=13]="RomanLcParenR",e[e.RomanUcParenR=14]="RomanUcParenR",e[e.RomanLcPeriod=15]="RomanLcPeriod",e[e.RomanUcPeriod=16]="RomanUcPeriod",e[e.CircleNumDbPlain=17]="CircleNumDbPlain",e[e.CircleNumWdBlackPlain=18]="CircleNumWdBlackPlain",e[e.CircleNumWdWhitePlain=19]="CircleNumWdWhitePlain",e[e.ArabicDbPeriod=20]="ArabicDbPeriod",e[e.ArabicDbPlain=21]="ArabicDbPlain",e[e.Ea1ChsPeriod=22]="Ea1ChsPeriod",e[e.Ea1ChsPlain=23]="Ea1ChsPlain",e[e.Ea1ChtPeriod=24]="Ea1ChtPeriod",e[e.Ea1ChtPlain=25]="Ea1ChtPlain",e[e.Ea1JpnChsDbPeriod=26]="Ea1JpnChsDbPeriod",e[e.Ea1JpnKorPlain=27]="Ea1JpnKorPlain",e[e.Ea1JpnKorPeriod=28]="Ea1JpnKorPeriod",e[e.Arabic1Minus=29]="Arabic1Minus",e[e.Arabic2Minus=30]="Arabic2Minus",e[e.Hebrew2Minus=31]="Hebrew2Minus",e[e.ThaiAlphaPeriod=32]="ThaiAlphaPeriod",e[e.ThaiAlphaParenR=33]="ThaiAlphaParenR",e[e.ThaiAlphaParenBoth=34]="ThaiAlphaParenBoth",e[e.ThaiNumPeriod=35]="ThaiNumPeriod",e[e.ThaiNumParenR=36]="ThaiNumParenR",e[e.ThaiNumParenBoth=37]="ThaiNumParenBoth",e[e.HindiAlphaPeriod=38]="HindiAlphaPeriod",e[e.HindiNumPeriod=39]="HindiNumPeriod",e[e.HindiNumParenR=40]="HindiNumParenR",e[e.HindiAlpha1Period=41]="HindiAlpha1Period"}(i=e.ListNumeration||(e.ListNumeration={})),function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(r=e.TextTileEventType||(e.TextTileEventType={}))}(o||(o={}))},39566:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){let t;!function(e){e[e.Undefined=0]="Undefined",e[e.Delete=1]="Delete",e[e.Add=2]="Add",e[e.Change=3]="Change",e[e.Refresh=4]="Refresh"}(t=e.SlideTileEventType||(e.SlideTileEventType={}))}(o||(o={}))},39567:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{constructor(){this.cache=new Map,this.bucketSizes=new Map}setBucketSize(e,t){this.bucketSizes.set(e,t)}setResult(e,t,s){if(!t.primary)return;let o=this.cache.get(e);o||(o=new Map,this.cache.set(e,o));let n=o.get(t.primary);if(n||(n=t.secondary?new Map:[],o.set(t.primary,n)),t.secondary){n.set(t.secondary,s)}else{const t=n;t.length==this.getBucketSize(e)&&t.shift(),t.push(s)}}getResults(e,t){const s=this.cache.get(e);if(s){const e=s.get(t.primary);if(e){if(!t.secondary)return e;const s=Array.from(e.values());if(s.length>0)return s}}return[]}clear(e,t){t?this.cache.forEach((s,o)=>{if(!e||e===o)if(t.secondary){const e=s.get(t.primary);e&&e.delete(t.secondary)}else s.delete(t.primary)}):e?this.cache.delete(e):this.cache.clear()}getBucketSize(e){return this.bucketSizes.get(e)||10}}},39568:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));class o{constructor(){this.cache=new Map}setReduceTimer(e,t,s,o=500,n=(()=>!1),i=5e3){this.cache.has(e)||this.cache.set(e,new Map);const r=this.cache.get(e);r.has(t)&&clearTimeout(r.get(t).timer);const a=()=>{const a=r.get(t),c=Date.now()-a.start;n()&&c<i?a.timer=setTimeout(a.timerCallback,Math.min(o,i-c)):(r.size>1?r.delete(t):this.cache.delete(e),s())};r.set(t,{start:Date.now(),timerCallback:a,timer:setTimeout(a,o)})}clear(e,t){this.cache.forEach((s,o)=>{e&&e!==o||s.forEach((e,s)=>{t&&t!==s||clearTimeout(e.timer)})}),this.cache.clear()}}},39569:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39482);class n{constructor(){this.throttleInfoMap=new Map}execute(e,t,s){if(t.throttleSettings.shouldBeThrottled&&t.throttleSettings.throttlingInterval>0){const n=this.getWorkflowThrottleInfo(t.name);if(null==n.currentTileId)n.currentTileId=e,n.timeOfPreviousStartedEvent=o.b.getCurrentTimeMs(),s();else if(n.currentTileId===e){const e=o.b.getCurrentTimeMs(),i=this.delayTime(n,e,t.throttleSettings.throttlingInterval);i>0?(n.latestCallback=s,null==n.lastTimeout&&(n.lastTimeout=setTimeout(()=>{const e=this.getWorkflowThrottleInfo(t.name);e.lastTimeout=void 0,e.timeOfPreviousStartedEvent=o.b.getCurrentTimeMs(),e.latestCallback()},i))):(n.timeOfPreviousStartedEvent=e,s())}else null!=n.lastTimeout&&(clearTimeout(n.lastTimeout),n.latestCallback(),n.lastTimeout=void 0),n.currentTileId=e,n.timeOfPreviousStartedEvent=o.b.getCurrentTimeMs(),s()}else s()}delayTime(e,t,s){const o=t-e.timeOfPreviousStartedEvent;return Math.max(s-o,0)}getWorkflowThrottleInfo(e){let t=this.throttleInfoMap.get(e);return t||(t={currentTileId:void 0,timeOfPreviousStartedEvent:-1,latestCallback:()=>{},lastTimeout:void 0},this.throttleInfoMap.set(e,t)),t}}},39570:function(e,t,s){"use strict";var o;s.d(t,"a",(function(){return o})),function(e){e[e.Unknown=0]="Unknown",e[e.Local=1]="Local",e[e.Custom=2]="Custom",e[e.Remote=3]="Remote",e[e.BatchedRemote=4]="BatchedRemote"}(o||(o={}))},39571:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return c}));var o=s(39484),n=s(39505);const i={category:o.a.Schema,schema:{name:"Exception",path:"message-schema.proto"}},r=(o.a.Schema,(e,t=!1)=>{if(null==e)return"Invalid message passed";if(null==e.payload)return n.a[n.a.NoOutput]+": Payload is null";if(null==e.payload.exceptionType)return"Payload is not an exception";{let s=n.a[e.payload.exceptionType];return s+=e.payload.message?": "+e.payload.message:": No description",s+=t&&e.payload.data?"\n"+e.payload.data.toString():"",s}}),a=e=>null==e||null==e.payload||null==e.payload.exceptionType?n.a.Unknown:e.payload.exceptionType,c=(e,t)=>{if(null==e)throw new Error("Cannot set exception on null message");e.payload=t,e.payloadSchema=i,e.messageType=n.b.Exception}},39572:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionInitMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Excel_Session_Protocol_ExcelServerSessionExtensionConfig"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(e){o.a.assign(r,this,e)}static getTypeName(){return"AugLoop_Excel_Session_Protocol_ExcelWorkbookUpdated"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[r.getTypeName()])}}r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()};class a{constructor(e){o.a.assign(a,this,e)}static getTypeName(){return"AugLoop_Excel_Session_Protocol_ExcelAccessTokenRefreshed"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class c{constructor(e){o.a.assign(c,this,e)}static getTypeName(){return"AugLoop_Excel_Session_Protocol_ExcelKeepAlive"}static getBaseTypes(){return["AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[c.getTypeName()])}}c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()};class l{constructor(e){o.a.assign(l,this,e)}static getTypeName(){return"AugLoop_Excel_Session_Protocol_ExcelSessionCloseReason"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[l.getTypeName()])}}l.H_={T_:l.getTypeName(),B_:l.getBaseTypes()};class u{constructor(e){o.a.assign(u,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_Excel_Session_Protocol_ObserverStatusAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[u.getTypeName()])}}u.H_={T_:u.getTypeName(),B_:u.getBaseTypes()};class d{constructor(e){o.a.assign(d,this,e)}get metadata(){return this.M_}set metadata(e){this.M_=e}static getTypeName(){return"AugLoop_Excel_Session_Protocol_FullSeedingAnnotation"}static getBaseTypes(){return["AugLoop_Core_Annotation"]}static typeGuard(e){return o.a.matchesTypesFor(e,[d.getTypeName()])}}d.H_={T_:d.getTypeName(),B_:d.getBaseTypes()}},39573:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionInitMessage"}static getBaseTypes(){return["AugLoop_Session_Protocol_SessionInitMessage","AugLoop_Session_Protocol_Message"]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Powerpoint_Session_Protocol_PowerPointSessionExtensionConfig"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()}},39574:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(39494),n=s(39482);class i{constructor(e,t){var s,n,i,r,a,c;this.kind=o.d.SingleItem,this.isStateful=!1,this.id=e,t&&(this.inputTypes=null!==(s=t.inputTypes)&&void 0!==s?s:this.inputTypes,this.outputTypes=null!==(n=t.outputTypes)&&void 0!==n?n:this.outputTypes,this.isStateful=null!==(i=t.isStateful)&&void 0!==i?i:this.isStateful,this.requestedContextTypesRules=null!==(r=t.requestedContextTypesRules)&&void 0!==r?r:this.requestedContextTypesRules,this.definitionOverrideTargetWorkflows=null!==(a=t.definitionOverrideTargetWorkflows)&&void 0!==a?a:this.definitionOverrideTargetWorkflows,this.correlatedSignals=0!==(null===(c=t.correlatedSignals)||void 0===c?void 0:c.length)?t.correlatedSignals:this.correlatedSignals)}static create(e){return new i(e)}setInputTypes(e){return this.inputTypes=Object(n.c)(e),this}setOutputTypes(e){return this.outputTypes=Object(n.c)(e),this}setStateful(){return this.isStateful=!0,this}setRequestedContexts(e){var t;return this.requestedContextTypesRules=(null!==(t=this.requestedContextTypesRules)&&void 0!==t?t:this.requestedContextTypesRules=[]).concat(e),this}setLambdaType(e){return this.factory=e,this}setDefinitionOverrideTargetWorkflows(e){return this.definitionOverrideTargetWorkflows=e,this}setCorrelatedSignals(e){return 0!==e.length&&(this.correlatedSignals=e),this}setLambda(e,t){return this.factory=()=>({init:t||(e=>Promise.resolve()),execute:e,dispose:()=>{}}),this}validateOptions(){return{isValid:!0}}}},39575:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(39576),n=s(39487),i=s(39515);class r{constructor(e){this.config=e,this.nextMessageId=0,this.responseCallbacks=new Map;const t=["session","chats"],s=Object(i.a)(),r=[...t,s];this.messagesPath=[...r,"messages"],this.config.session.submitOperations([new n.a({parentPath:t,items:[{id:s,body:e.chat}]}),new n.a({parentPath:r,items:[{id:"messages",body:new o.a}]})])}static create(e){const t=new r(e);return t.activateAnnotation(e.responseType).then(()=>t)}send(e,t){const s=""+this.nextMessageId++;this.responseCallbacks.set(s,t),this.config.session.submitOperations([new n.a({parentPath:this.messagesPath,items:[{id:s,body:e}]})])}close(){return this.config.session.releaseAnnotation(this.activatedAnnotationToken)}activateAnnotation(e){return this.config.session.activateAnnotation(e,{callback:e=>{if(n.a.typeGuard(e)&&this.isUnderSubtree(e.parentPath,this.messagesPath))for(const t of e.items){const s=e.parentPath[e.parentPath.length-1],o=this.responseCallbacks.get(s);o&&(o(t.body),this.responseCallbacks.delete(s))}}}).then(({token:e})=>{this.activatedAnnotationToken=e})}isUnderSubtree(e,t){if(e.length<t.length)return!1;for(let s=0;s<t.length;s++)if(e[s]!==t[s])return!1;return!0}}},39576:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(39479);class n{constructor(e){o.a.assign(n,this,e)}static getTypeName(){return"AugLoop_Chat_ChatsHolder"}static getBaseTypes(){return["AugLoop_Core_TileGroup"]}static typeGuard(e){return o.a.matchesTypesFor(e,[n.getTypeName()])}}n.H_={T_:n.getTypeName(),B_:n.getBaseTypes()};class i{constructor(e){o.a.assign(i,this,e)}static getTypeName(){return"AugLoop_Chat_Chat"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[i.getTypeName()])}}i.H_={T_:i.getTypeName(),B_:i.getBaseTypes()};class r{constructor(e){o.a.assign(r,this,e)}static getTypeName(){return"AugLoop_Chat_MessagesHolder"}static getBaseTypes(){return["AugLoop_Core_TileGroup"]}static typeGuard(e){return o.a.matchesTypesFor(e,[r.getTypeName()])}}r.H_={T_:r.getTypeName(),B_:r.getBaseTypes()};class a{constructor(e){o.a.assign(a,this,e)}static getTypeName(){return"AugLoop_Chat_ChatMessage"}static getBaseTypes(){return[]}static typeGuard(e){return o.a.matchesTypesFor(e,[a.getTypeName()])}}a.H_={T_:a.getTypeName(),B_:a.getBaseTypes()};class c{constructor(e){o.a.assign(c,this,e)}static getTypeName(){return"AugLoop_Chat_TextChatMessage"}static getBaseTypes(){return["AugLoop_Chat_ChatMessage"]}static typeGuard(e){return o.a.matchesTypesFor(e,[c.getTypeName()])}}c.H_={T_:c.getTypeName(),B_:c.getBaseTypes()}},39596:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var o=s(10926),n=s(39597),i=s(39601),r=s(39600),a=s(39599);const c=o.forwardRef((e,t)=>{const s=Object(n.a)(e,t),o=Object(a.a)(s);return Object(r.a)(s),Object(i.a)(s,o)});c.displayName="Skeleton"},39597:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));s(10926);var o=s(12018),n=s(12021),i=s(39598);const r=(e,t)=>{const{animation:s,appearance:r}=Object(i.b)(),{animation:a=(null!=s?s:"wave"),appearance:c=(null!=r?r:"opaque")}=e;return{animation:a,appearance:c,components:{root:"div"},root:o.a.always(Object(n.a)("div",{ref:t,role:"progressbar","aria-busy":!0,"aria-label":"Loading Content",...e}),{elementType:"div"})}}},39598:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return a}));var o=s(10926);const n=o.createContext(void 0),i={},r=n.Provider,a=()=>{var e;return null!==(e=o.useContext(n))&&void 0!==e?e:i}},39599:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));var o=s(10926);const n=e=>{const{animation:t,appearance:s}=e;return{skeletonGroup:o.useMemo(()=>({animation:t,appearance:s}),[t,s])}}},39600:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(12003);const n="fui-Skeleton",i=e=>(e.root.className=Object(o.a)(n,e.root.className),e)},39601:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var o=s(12034),n=s(12033),i=s(39598);const r=(e,t)=>(Object(n.a)(e),Object(o.a)(i.a,{value:t.skeletonGroup,children:Object(o.a)(e.root,{})}))},39602:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var o=s(10926),n=s(39603),i=s(39605),r=s(39604);const a=o.forwardRef((e,t)=>{const s=Object(n.a)(e,t);return Object(r.a)(s),Object(i.a)(s)});a.displayName="SkeletonItem"},39603:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));s(10926);var o=s(12018),n=s(12021),i=s(39598);const r=(e,t)=>{const{animation:s,appearance:r}=Object(i.b)(),{animation:a=(null!=s?s:"wave"),appearance:c=(null!=r?r:"opaque"),size:l=16,shape:u="rectangle"}=e;return{appearance:c,animation:a,size:l,shape:u,components:{root:"div"},root:o.a.always(Object(n.a)("div",{ref:t,...e}),{elementType:"div"})}}},39604:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var o=s(17804),n=s(12003),i=s(11988);const r="fui-SkeletonItem",a=Object(o.a)({root:{qhf8xq:"f10pi13n",B68tc82:"f1p9o1ba",Bmxbyg5:"f1sil6mw",Bkjc3bi:"f1qx3921",B8a6bjv:"fj9j8l8",Bpptf2m:"f1b6djjb",Bgh53k4:"f1dsdmen",w3vfg9:"f1cpbl36",vin17d:"f1a27w2r",Ezkn3b:"f452v7t",Gqtpxc:"f4akx1t",B3vm3ge:"f18p5put"},wave:{Bv12yb3:"fj20wtk",Bcmaq0h:["f101ziu5","f152emvt"],Bpep1pd:"f9jxvrw"},waveRtl:{Bv12yb3:"f105t0nc",Bcmaq0h:["f101ziu5","f152emvt"],Bpep1pd:"f9jxvrw"},pulse:{Bv12yb3:"fnm2mpv",vin17d:"f1iuewzk",De3pzq:"f1gjxg63"},translucent:{Bcmaq0h:["fss7axp","f4160cw"]},translucentPulse:{De3pzq:"f162mh4z"}},{d:[".f10pi13n{position:relative;}",".f1p9o1ba{overflow-x:hidden;}",".f1sil6mw{overflow-y:hidden;}",".f1qx3921{background-size:300% 100%;}",".fj9j8l8{background-position-x:center;}",".f1b6djjb{background-position-y:center;}",".f1dsdmen{background-attachment:fixed;}",".f1cpbl36{animation-iteration-count:infinite;}",".f1a27w2r{animation-duration:3s;}",".f452v7t{animation-timing-function:linear;}",".fj20wtk{animation-name:fma800j;}",".f101ziu5{background-image:linear-gradient(\n      to right,\n      var(--colorNeutralStencil1) 0%,\n      var(--colorNeutralStencil2) 50%,\n      var(--colorNeutralStencil1) 100%);}",".f152emvt{background-image:linear-gradient(\n      to left,\n      var(--colorNeutralStencil1) 0%,\n      var(--colorNeutralStencil2) 50%,\n      var(--colorNeutralStencil1) 100%);}",".f105t0nc{animation-name:fj9wi3p;}",".fnm2mpv{animation-name:f12o7gg6;}",".f1iuewzk{animation-duration:1s;}",".f1gjxg63{background-color:var(--colorNeutralStencil1);}",".fss7axp{background-image:linear-gradient(\n      to right,\n      var(--colorNeutralStencil1Alpha) 0%,\n      var(--colorNeutralStencil2Alpha) 50%,\n      var(--colorNeutralStencil1Alpha) 100%);}",".f4160cw{background-image:linear-gradient(\n      to left,\n      var(--colorNeutralStencil1Alpha) 0%,\n      var(--colorNeutralStencil2Alpha) 50%,\n      var(--colorNeutralStencil1Alpha) 100%);}",".f162mh4z{background-color:var(--colorNeutralStencil1Alpha);}"],m:[["@media screen and (prefers-reduced-motion: reduce){.f4akx1t{animation-duration:0.01ms;}}",{m:"screen and (prefers-reduced-motion: reduce)"}],["@media screen and (prefers-reduced-motion: reduce){.f18p5put{animation-iteration-count:1;}}",{m:"screen and (prefers-reduced-motion: reduce)"}],["@media screen and (forced-colors: active){.f9jxvrw{background-color:WindowText;}}",{m:"screen and (forced-colors: active)"}]],k:["@keyframes fma800j{from{background-position-x:300%;}to{background-position-x:0%;}}","@keyframes fj9wi3p{from{background-position-x:0%;}to{background-position-x:300%;}}","@keyframes f12o7gg6{0%{opacity:1;}50%{opacity:0.4;}100%{opacity:1;}}"]}),c=Object(o.a)({8:{Bqenvij:"f1x82gua"},12:{Bqenvij:"fvblgha"},16:{Bqenvij:"fd461yt"},20:{Bqenvij:"fjamq6b"},24:{Bqenvij:"frvgh55"},28:{Bqenvij:"fxldao9"},32:{Bqenvij:"f1d2rq10"},36:{Bqenvij:"f8ljn23"},40:{Bqenvij:"fbhnoac"},48:{Bqenvij:"ff2sm71"},56:{Bqenvij:"fzki0ko"},64:{Bqenvij:"f16k9i2m"},72:{Bqenvij:"f1shusfg"},96:{Bqenvij:"fypu0ge"},120:{Bqenvij:"fjr5b71"},128:{Bqenvij:"fele2au"},root:{a9b677:"fly5x3f",Bbmb7ep:["fff7au0","f1bjk9e1"],Beyfa6y:["f1bjk9e1","fff7au0"],B7oj6ja:["fwsfkhu","f8wkphi"],Btl43ni:["f8wkphi","fwsfkhu"]}},{d:[".f1x82gua{height:8px;}",".fvblgha{height:12px;}",".fd461yt{height:16px;}",".fjamq6b{height:20px;}",".frvgh55{height:24px;}",".fxldao9{height:28px;}",".f1d2rq10{height:32px;}",".f8ljn23{height:36px;}",".fbhnoac{height:40px;}",".ff2sm71{height:48px;}",".fzki0ko{height:56px;}",".f16k9i2m{height:64px;}",".f1shusfg{height:72px;}",".fypu0ge{height:96px;}",".fjr5b71{height:120px;}",".fele2au{height:128px;}",".fly5x3f{width:100%;}",".fff7au0{border-bottom-right-radius:4px;}",".f1bjk9e1{border-bottom-left-radius:4px;}",".fwsfkhu{border-top-right-radius:4px;}",".f8wkphi{border-top-left-radius:4px;}"]}),l=Object(o.a)({8:{a9b677:"f1o3cbw4",Bqenvij:"f1x82gua"},12:{a9b677:"frx94fk",Bqenvij:"fvblgha"},16:{a9b677:"fjw5fx7",Bqenvij:"fd461yt"},20:{a9b677:"f64fuq3",Bqenvij:"fjamq6b"},24:{a9b677:"fq4mcun",Bqenvij:"frvgh55"},28:{a9b677:"f1w9dchk",Bqenvij:"fxldao9"},32:{a9b677:"f1szoe96",Bqenvij:"f1d2rq10"},36:{a9b677:"fpdz1er",Bqenvij:"f8ljn23"},40:{a9b677:"feqmc2u",Bqenvij:"fbhnoac"},48:{a9b677:"f124akge",Bqenvij:"ff2sm71"},56:{a9b677:"f1u66zr1",Bqenvij:"fzki0ko"},64:{a9b677:"fa9ln6p",Bqenvij:"f16k9i2m"},72:{a9b677:"fhcae8x",Bqenvij:"f1shusfg"},96:{a9b677:"f1kyr2gn",Bqenvij:"fypu0ge"},120:{a9b677:"fwfqyga",Bqenvij:"fjr5b71"},128:{a9b677:"f1iksgmy",Bqenvij:"fele2au"}},{d:[".f1o3cbw4{width:8px;}",".f1x82gua{height:8px;}",".frx94fk{width:12px;}",".fvblgha{height:12px;}",".fjw5fx7{width:16px;}",".fd461yt{height:16px;}",".f64fuq3{width:20px;}",".fjamq6b{height:20px;}",".fq4mcun{width:24px;}",".frvgh55{height:24px;}",".f1w9dchk{width:28px;}",".fxldao9{height:28px;}",".f1szoe96{width:32px;}",".f1d2rq10{height:32px;}",".fpdz1er{width:36px;}",".f8ljn23{height:36px;}",".feqmc2u{width:40px;}",".fbhnoac{height:40px;}",".f124akge{width:48px;}",".ff2sm71{height:48px;}",".f1u66zr1{width:56px;}",".fzki0ko{height:56px;}",".fa9ln6p{width:64px;}",".f16k9i2m{height:64px;}",".fhcae8x{width:72px;}",".f1shusfg{height:72px;}",".f1kyr2gn{width:96px;}",".fypu0ge{height:96px;}",".fwfqyga{width:120px;}",".fjr5b71{height:120px;}",".f1iksgmy{width:128px;}",".fele2au{height:128px;}"]}),u=Object(o.a)({root:{Bbmb7ep:["fqgqgel","fchfifz"],Beyfa6y:["fchfifz","fqgqgel"],B7oj6ja:["fc7b1hi","f1dpx5h9"],Btl43ni:["f1dpx5h9","fc7b1hi"]}},{d:[".fqgqgel{border-bottom-right-radius:50%;}",".fchfifz{border-bottom-left-radius:50%;}",".fc7b1hi{border-top-right-radius:50%;}",".f1dpx5h9{border-top-left-radius:50%;}"]}),d=e=>{const{animation:t,appearance:s,size:o,shape:d}=e,{dir:h}=Object(i.b)(),p=a(),g=c(),f=l(),m=u();return e.root.className=Object(n.a)(r,p.root,"wave"===t&&p.wave,"wave"===t&&"rtl"===h&&p.waveRtl,"pulse"===t&&p.pulse,"translucent"===s&&p.translucent,"pulse"===t&&"translucent"===s&&p.translucentPulse,"rectangle"===d&&g.root,"rectangle"===d&&g[o],"square"===d&&f[o],"circle"===d&&m.root,"circle"===d&&f[o],e.root.className),e}},39605:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var o=s(12034),n=s(12033);const i=e=>(Object(n.a)(e),Object(o.a)(e.root,{}))}}]);