/*! For license information please see PlayerApiHost.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@pa-client/core")):"function"==typeof define&&define.amd?define("PlayerApiHost",["@pa-client/core"],t):"object"==typeof exports?exports.PlayerApiHost=t(require("@pa-client/core")):e.PlayerApiHost=t(e["@pa-client/core"])}(function(){return this?this:window}(),(function(e){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=3)}([function(e,t,n){"use strict";var r,i;Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingEventBase=t.EventType=t.MessagingActivity=void 0,function(e){e[e.OpenConnection=0]="OpenConnection",e[e.CloseConnection=1]="CloseConnection",e[e.SendMessage=2]="SendMessage",e[e.SignalRSend=3]="SignalRSend",e[e.Subscribe=4]="Subscribe",e[e.ConnectionDisconnected=5]="ConnectionDisconnected",e[e.OnConnectionClosed=6]="OnConnectionClosed",e[e.OnDataReceived=7]="OnDataReceived",e[e.OnMessageFromWorker=8]="OnMessageFromWorker",e[e.OnErrorFromWorker=9]="OnErrorFromWorker",e[e.RouteMessage=10]="RouteMessage",e[e.RouterInitialize=11]="RouterInitialize",e[e.RouterSendMessage=12]="RouterSendMessage",e[e.RouterShutdown=13]="RouterShutdown",e[e.WorkerHandleMessage=14]="WorkerHandleMessage",e[e.CreateMessagingEvent=15]="CreateMessagingEvent",e[e.OnSignalRLogReceived=16]="OnSignalRLogReceived",e[e.OnConnectionReconnected=17]="OnConnectionReconnected",e[e.OnConnectionReconnecting=18]="OnConnectionReconnecting"}(r||(t.MessagingActivity=r={})),function(e){e[e.DataEvent=0]="DataEvent",e[e.VerboseEvent=1]="VerboseEvent",e[e.ErrorEvent=2]="ErrorEvent"}(i||(t.EventType=i={}));var o=function(){function e(e,t){this.eventType=t,this._activity="string"==typeof e?e:r[e]}return Object.defineProperty(e.prototype,"activity",{get:function(){return this._activity},enumerable:!1,configurable:!0}),e}();t.MessagingEventBase=o},function(t,n){t.exports=e},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingClientFactory=void 0;var r=n(4),i=function(){function e(){}return e.prototype.createMessageClient=function(e,t,n,i,o){return new r.MessagingWorkerClient(e,t,n,i,o)},e}();t.MessagingClientFactory=i},function(e,t,n){e.exports=n(10)},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingWorkerClient=void 0;var o=n(5),a=n(6),s=n(0),c=n(7),l=n(8),u=n(9),p=function(e){function t(t,n,r,l,p){var d=e.call(this)||this;d._worker=t,d._invalidEventFormatMessage="Invalid event format",d._createMessagingEvent=function(e,t){var n;try{switch(d._require(e,"object"),d._require(e._activity,"string"),e.eventType){case s.EventType.DataEvent:d._require(e._data,"object"),d._require(e._data.command,"string"),n=new o.MessagingDataEvent(e._activity,e._data,e._channel,e._dataReceivedTimestamp,t);break;case s.EventType.VerboseEvent:n=new c.MessagingVerboseEvent(e._activity,e._data);break;case s.EventType.ErrorEvent:d._require(e._errorData,"object"),d._require(e._errorData.reason,"number"),d._require(e._error,"object"),n=new a.MessagingErrorEvent(e._activity,e._errorData,e._error);break;default:throw new Error(d._invalidEventFormatMessage)}}catch(t){var r={reason:a.MessagingErrorReason.InvalidEventFormat,data:e};n=new a.MessagingErrorEvent(s.MessagingActivity.CreateMessagingEvent,r,t)}return n},d._require=function(e,t){if(typeof e!==t)throw new Error(d._invalidEventFormatMessage)},d._worker.onmessage=function(e){if(e.data){var t=d._createMessagingEvent(e.data,Date.now());l(t)}else l(new a.MessagingErrorEvent(s.MessagingActivity.OnMessageFromWorker,{reason:a.MessagingErrorReason.InvalidEventFormat},new Error("".concat(d._invalidEventFormatMessage,": ").concat(e))))},d._worker.onerror=function(e){l(new a.MessagingErrorEvent(s.MessagingActivity.OnErrorFromWorker,{reason:a.MessagingErrorReason.WebWorkerError},e.error))};var g={command:u.WorkerCommand.Initialize,payload:i({endpoint:n,receiveChannels:r},p)};return d._worker.postMessage(g),d}return r(t,e),t.prototype.sendMessage=function(e){var t={command:u.WorkerCommand.SendMessage,payload:e};this._worker.postMessage(t)},t.prototype.shutdown=function(){var e={command:u.WorkerCommand.Shutdown};this._worker.postMessage(e)},t.prototype.subscribe=function(e){var t={command:u.WorkerCommand.Subscribe,payload:{channel:e}};this._worker.postMessage(t)},t}(l.MessagingClient);t.MessagingWorkerClient=p},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingDataEvent=void 0;var i=n(0),o=function(e){function t(t,n,r,o,a){var s=e.call(this,t,i.EventType.DataEvent)||this;return s._data=n,s._channel=r,s._dataReceivedTimestamp=o,s._dataReceivedOnMainThreadTimestamp=a,s}return r(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"channel",{get:function(){return this._channel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataReceivedTimestamp",{get:function(){return this._dataReceivedTimestamp},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataReceivedOnMainThreadTimestamp",{get:function(){return this._dataReceivedOnMainThreadTimestamp},enumerable:!1,configurable:!0}),t}(i.MessagingEventBase);t.MessagingDataEvent=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingErrorEvent=t.MessagingErrorReason=void 0;var i,o=n(0);!function(e){e[e.InitializeFailed=-1]="InitializeFailed",e[e.MessagingNotInitialized=-2]="MessagingNotInitialized",e[e.OpenFailed=-3]="OpenFailed",e[e.CloseFailed=-4]="CloseFailed",e[e.SendFailed=-5]="SendFailed",e[e.InvalidDataReceived=-6]="InvalidDataReceived",e[e.ConnectionClosed=-7]="ConnectionClosed",e[e.WebWorkerError=-8]="WebWorkerError",e[e.WorkerFailure=-9]="WorkerFailure",e[e.InvalidWorkerMessage=-10]="InvalidWorkerMessage",e[e.InvalidEventFormat=-11]="InvalidEventFormat",e[e.SubscribeFailed=-12]="SubscribeFailed"}(i||(t.MessagingErrorReason=i={}));var a=function(e){function t(t,n,r){var i=e.call(this,t,o.EventType.ErrorEvent)||this;return i._errorData=n,i._error=r,i}return r(t,e),Object.defineProperty(t.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorData",{get:function(){return this._errorData},enumerable:!1,configurable:!0}),t}(o.MessagingEventBase);t.MessagingErrorEvent=a},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingVerboseEvent=void 0;var i=n(0),o=function(e){function t(t,n){var r=e.call(this,t,i.EventType.VerboseEvent)||this;return r._data=n,r}return r(t,e),Object.defineProperty(t.prototype,"data",{get:function(){return this._data},enumerable:!1,configurable:!0}),t}(i.MessagingEventBase);t.MessagingVerboseEvent=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessagingClient=t.MessageChunkStringLength=void 0,t.MessageChunkStringLength=1048576;var r=function(){return function(){}}();t.MessagingClient=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerCommand=void 0,function(e){e[e.Initialize=0]="Initialize",e[e.SendMessage=1]="SendMessage",e[e.Shutdown=2]="Shutdown",e[e.OnError=3]="OnError",e[e.Subscribe=4]="Subscribe"}(r||(t.WorkerCommand=r={}))},function(e,t,n){"use strict";n.r(t);var r={};n.r(r),n.d(r,"RemoteInkManagerPluginDelegator",(function(){return ae})),n.d(r,"RemoteInkManagerImplementation",(function(){return oe}));var i={};n.r(i),n.d(i,"MicrophoneIframeProxy",(function(){return ce})),n.d(i,"MicrophonePlugin",(function(){return le}));var o={};n.r(o),n.d(o,"CrossDomainXMLHttpRequestImplementation",(function(){return pe})),n.d(o,"DefaultXMLHttpRequestFactory",(function(){return de})),n.d(o,"IXMLHttpRequestFactory",(function(){})),n.d(o,"CDSAuthProvider",(function(){return ue}));var a={};n.r(a),n.d(a,"AppModuleServicePlugin",(function(){return Fe})),n.d(a,"AppModuleManager",(function(){return yt}));var s={};n.r(s),n.d(s,"VersionSupportPluginProxy",(function(){return K})),n.d(s,"CameraPlugin",(function(){return X})),n.d(s,"InkControl",(function(){return r})),n.d(s,"Microphone",(function(){return i})),n.d(s,"XMLHttpRequest",(function(){return o})),n.d(s,"AccelerometerPluginProxy",(function(){return fe})),n.d(s,"AppLifecycleRequestAction",(function(){return te})),n.d(s,"AppLifecyclePlugin",(function(){return ke})),n.d(s,"CompassPluginProxy",(function(){return Ie})),n.d(s,"ConsolePluginImplementation",(function(){return Te})),n.d(s,"DevicePluginProxy",(function(){return Re})),n.d(s,"FileSystemPluginProxy",(function(){return Me})),n.d(s,"GeoLocationPluginProxy",(function(){return Ne})),n.d(s,"NetworkInfoPluginProxy",(function(){return xe})),n.d(s,"ProxyPlugin",(function(){return se})),n.d(s,"PublishedAppTelemetryPluginProxy",(function(){return He})),n.d(s,"SienaFilePickerPlugin",(function(){return De})),n.d(s,"StatusBarPluginProxy",(function(){return Ue})),n.d(s,"KeyboardPluginProxy",(function(){return Oe})),n.d(s,"AppDependenciesResolverPlugin",(function(){return Ve})),n.d(s,"AppModuleService",(function(){return a})),n.d(s,"TeamsSdkPlugin",(function(){return vt})),n.d(s,"OfficeHeaderPlugin",(function(){return Ct})),n.d(s,"fetchNavBarData",(function(){return Pt})),n.d(s,"OfficeHeaderWorkloadId",(function(){return _t})),n.d(s,"MicrosoftGraphPlugin",(function(){return Et})),n.d(s,"AuthenticationPlugin",(function(){return Rt})),n.d(s,"AuthenticationResult",(function(){})),n.d(s,"AuthenticationTokenOptions",(function(){})),n.d(s,"MonitorPlugin",(function(){return Tt}));var c={};n.r(c),n.d(c,"Plugins",(function(){return s})),n.d(c,"AppHostAPIHandler",(function(){return Ht})),n.d(c,"CommandDispatcher",(function(){return Mt})),n.d(c,"IFrameCommunicationChannel",(function(){return Nt})),n.d(c,"WebCapabilitiesManager",(function(){return xt}));var l={};n.r(l),n.d(l,"AppHostPluginHandler",(function(){return Ot})),n.d(l,"AppHttpClientPluginHandler",(function(){return Ft})),n.d(l,"RuntimeFunctionsPluginHandler",(function(){return zt})),n.d(l,"UrlLauncherPluginHandler",(function(){return Bt})),n.d(l,"TeamsHostClientTypePluginHandler",(function(){return Wt})),n.d(l,"EcsFeaturesPluginHandler",(function(){return jt}));var u={};n.r(u),n.d(u,"Plugins",(function(){return l}));var p={};n.r(p),n.d(p,"NoArguments",(function(){return Zt})),n.d(p,"VoidResult",(function(){return $t})),n.d(p,"isValidPluginDefinition",(function(){return en})),n.d(p,"isValidActionDefinition",(function(){return tn})),n.d(p,"isValidArgumentDefinition",(function(){return nn})),n.d(p,"isValidResultDefinition",(function(){return rn}));var d={};n.r(d),n.d(d,"isValidSerializedError",(function(){return un})),n.d(d,"bindIsValidSerializedError",(function(){return pn})),n.d(d,"isValidAnySerializedError",(function(){return dn})),n.d(d,"SerializedMessageOnlyErrorSerializedVersion",(function(){return hn})),n.d(d,"createSerializedMessageOnlyError",(function(){return mn})),n.d(d,"serializeErrorBase",(function(){return fn})),n.d(d,"ErrorSerializersManager",(function(){return bn})),n.d(d,"__placeholderInterfaces",(function(){return An})),n.d(d,"UnknownSerializedErrorName",(function(){return Cn})),n.d(d,"UnknownSerializedError",(function(){return Pn})),n.d(d,"MessageOnlyErrorSerializer",(function(){return _n})),n.d(d,"SerializationErrorReason",(function(){return gn})),n.d(d,"SerializationErrorName",(function(){return yn})),n.d(d,"SerializationError",(function(){return vn})),n.d(d,"serializeToEnumValueName",(function(){return wn})),n.d(d,"tryDeserializeFromEnumValueName",(function(){return Sn})),n.d(d,"deserializeFromEnumValueName",(function(){return En}));var g={};n.r(g),n.d(g,"ActionsControllerPluginHandler",(function(){return kn})),n.d(g,"Metadata",(function(){return p})),n.d(g,"LocalPluginErrorReason",(function(){return Qt})),n.d(g,"LocalPluginErrorName",(function(){return on})),n.d(g,"LocalPluginError",(function(){return an})),n.d(g,"ContextAwareCapability",(function(){return sn})),n.d(g,"tryGetPluginDefinitionForController",(function(){return cn})),n.d(g,"pluginController",(function(){return ln}));var h={};n.r(h),n.d(h,"VoidArgs",(function(){return In})),n.d(h,"VoidResult",(function(){return Tn})),n.d(h,"isValidServiceDefinition",(function(){return Ln})),n.d(h,"isValidCommandName",(function(){return Hn})),n.d(h,"isValidCommandDefinition",(function(){return Dn})),n.d(h,"isValidEventName",(function(){return Un})),n.d(h,"isValidEventDefinition",(function(){return On})),n.d(h,"isValidArgsDefinition",(function(){return Vn})),n.d(h,"isValidResultDefinition",(function(){return Fn}));var m={};n.r(m);var f={};n.r(f),n.d(f,"Metadata",(function(){return h})),n.d(f,"ServiceContracts",(function(){return m}));var y={};n.r(y),n.d(y,"createInitialLocalHostState",(function(){return zn})),n.d(y,"updateLocalHostStateAfterPluginMetadataExchanged",(function(){return Bn}));var v={};n.r(v),n.d(v,"Plugins",(function(){return g})),n.d(v,"Serialization",(function(){return d})),n.d(v,"Services",(function(){return f})),n.d(v,"LocalHostState",(function(){return y})),n.d(v,"MetadataService",(function(){return Jn}));var _={};n.r(_),n.d(_,"pluginDefinition",(function(){return Xn})),n.d(_,"Controller",(function(){return Yn}));var C={};n.r(C),n.d(C,"V2",(function(){return _}));var P={};n.r(P),n.d(P,"AppDataSourceConfig",(function(){return rr})),n.d(P,"AppCdsDataSourceConfig",(function(){return ir})),n.d(P,"AppCdsDatabaseReferenceComponentConfig",(function(){return or})),n.d(P,"AppMetadata",(function(){return ar})),n.d(P,"HostMetadata",(function(){return sr})),n.d(P,"pluginDefinition",(function(){return lr})),n.d(P,"Controller",(function(){return ur}));var b={};n.r(b),n.d(b,"AppConnection",(function(){return Kn})),n.d(b,"pluginDefinition",(function(){return cr})),n.d(b,"Controller",(function(){return hr}));var A={};n.r(A),n.d(A,"V1",(function(){return b})),n.d(A,"V2",(function(){return P}));var w={};n.r(w),n.d(w,"AppUserProfile",(function(){return dr})),n.d(w,"UserProfileV1",(function(){return gr})),n.d(w,"pluginDefinition",(function(){return fr})),n.d(w,"Controller",(function(){return yr}));var S={};n.r(S),n.d(S,"V2",(function(){return w}));var E={};n.r(E),n.d(E,"HttpRequest",(function(){return wr})),n.d(E,"HttpResponse",(function(){return Sr})),n.d(E,"pluginDefinition",(function(){return Tr})),n.d(E,"Controller",(function(){return Rr}));var k={};n.r(k),n.d(k,"V1",(function(){return E}));var I={};n.r(I),n.d(I,"SaveData",(function(){return kr})),n.d(I,"LoadData",(function(){return Ir})),n.d(I,"pluginDefinition",(function(){return Lr})),n.d(I,"Controller",(function(){return Hr}));var T={};n.r(T),n.d(T,"V1",(function(){return I}));var R={};n.r(R),n.d(R,"AppIdentityServicePlugin",(function(){return C})),n.d(R,"AppPowerAppsClientPlugin",(function(){return A})),n.d(R,"PowerAppsServicePlugin",(function(){return S})),n.d(R,"SendHttpPipelinePlugin",(function(){return k})),n.d(R,"SaveDataLoadDataPlugin",(function(){return T}));var M={};n.r(M),n.d(M,"__placeholder",(function(){return jr})),n.d(M,"AppUserProfile",(function(){return xr})),n.d(M,"isValidResourceDescription",(function(){return Dr})),n.d(M,"isValidAppAccessToken",(function(){return Ur})),n.d(M,"serviceDefinition",(function(){return Wr}));var N={};n.r(N),n.d(N,"V1",(function(){return M}));var x={};n.r(x),n.d(x,"AppDataSourceConfig",(function(){return Or})),n.d(x,"AppCdsDataSourceConfig",(function(){return Vr})),n.d(x,"AppCdsDatabaseReferenceComponentConfig",(function(){return Fr})),n.d(x,"AppMetadata",(function(){return zr})),n.d(x,"HostMetadata",(function(){return Br})),n.d(x,"serviceDefinition",(function(){return qr}));var L={};n.r(L),n.d(L,"V1",(function(){return x}));var H={};n.r(H),n.d(H,"HostAuthenticationService",(function(){return N})),n.d(H,"HostRuntimeService",(function(){return L}));var D={};n.r(D),n.d(D,"IPABinarySerializerV1",(function(){})),n.d(D,"SerializedPABinaryV1",(function(){})),n.d(D,"PABinarySerializer",(function(){return Ar})),n.d(D,"isValidSerializedPABinaryV1",(function(){return Pr})),n.d(D,"createAppErrorsSerializer",(function(){return Gr})),n.d(D,"LocalPluginErrorName",(function(){return Jr})),n.d(D,"LocalPluginErrorSerializer",(function(){return Yr})),n.d(D,"ServiceErrorResponseSerializer",(function(){return Xr})),n.d(D,"ServiceErrorSerializer",(function(){return $r}));var U={};n.r(U),n.d(U,"Platform",(function(){return v})),n.d(U,"Plugins",(function(){return R})),n.d(U,"Services",(function(){return H})),n.d(U,"Serialization",(function(){return D}));var O={};n.r(O),n.d(O,"DataStateManager",(function(){return ei})),n.d(O,"IDataStateManager",(function(){})),n.d(O,"IAppLocalStore",(function(){})),n.d(O,"IPowerAppsLocalStore",(function(){})),n.d(O,"AppLocalStore",(function(){return ti})),n.d(O,"PowerAppsLocalStore",(function(){return ni}));var V=function(){function e(e,t){this._eventName=e,this._eventObject=t}return Object.defineProperty(e.prototype,"eventName",{get:function(){return this._eventName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eventObject",{get:function(){return this._eventObject},enumerable:!1,configurable:!0}),e}(),F=function(){function e(){}return e.prototype.convertBlobToBase64Async=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,Core.IO.Utility.Conversion.convertBlobToArrayBuffer(e)];case 1:return t=n.sent(),[2,this.convertArrayBufferToBase64(t)]}}))}))},e.prototype.convertArrayBufferToBase64=function(e){return Core.IO.Utility.Conversion.arrayBufferToBase64(e)},e.prototype.convertBase64ToBlob=function(e,t){return Core.IO.Utility.Conversion.base64ToBlob(e,t)},e.prototype.convertBase64ToArrayBuffer=function(e){return Core.IO.Utility.Conversion.base64ToArrayBuffer(e)},e}();function z(e){var t=this;return new Promise((function(n,r){return __awaiter(t,void 0,void 0,(function(){var t,i;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,e()];case 1:return t=o.sent(),n(t),[3,3];case 2:return i=o.sent(),r(i),[3,3];case 3:return[2]}}))}))}))}var B,W=function(){function e(e,t){this._typeConvertor=e||new F,this._pluginResultTypeConvertors=t||[]}return e.prototype.getMessageSerializedAsStringAsync=function(e){return Core.Utility.isUndefined(e)&&(e=""),this._convertToValueSuitableForGuest(e).then((function(e){return JSON.stringify(e)}))},e.prototype._convertToValueSuitableForGuest=function(e){var t=this;if(Core.Utility.isArray(e)){var n=new Array;return e.forEach((function(e){var r=t._convertToValueSuitableForGuest(e);n.push(r)})),Core.PromiseUtils.join(n)}if(Core.Utility.isBlob(e))return z((function(){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,this._typeConvertor.convertBlobToBase64Async(e)];case 1:return t=n.sent(),[2,{argumentType:"Blob",blobType:e.type,data:t}]}}))}))}));if(Core.Utility.isArrayBuffer(e)){var r={argumentType:"ArrayBuffer",data:this._typeConvertor.convertArrayBufferToBase64(e)};return Promise.resolve(r)}if(e instanceof V){return function(e){return t._convertToValueSuitableForGuest(e.eventObject).then((function(t){var n=new V(e.eventName,t);return n.argumentType="CordovaEventInfo",n}))}(e)}for(var i=function(n){var r=o._pluginResultTypeConvertors[n];if(r.canConvert(e))return{value:z((function(){return __awaiter(t,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,r.convertAsync(e)];case 1:return[2,t.sent()]}}))}))}))}},o=this,a=0;a<this._pluginResultTypeConvertors.length;a++){var s=i(a);if("object"==typeof s)return s.value}return Promise.resolve(e)},e}();!function(e){e[e.NoResult=0]="NoResult",e[e.Ok=1]="Ok",e[e.ClassNotFoundException=2]="ClassNotFoundException",e[e.IllegalAccessException=3]="IllegalAccessException",e[e.InstantiationException=4]="InstantiationException",e[e.MalformedUrlException=5]="MalformedUrlException",e[e.IOException=6]="IOException",e[e.InvalidAction=7]="InvalidAction",e[e.JsonException=8]="JsonException",e[e.Error=9]="Error"}(B||(B={}));var j,q=function(){function e(e,t,n){this._message=t,this._status=e,this._keepCallBack=!1,this._transfer=n}return e.prototype.getMessageSerializedAsString=function(){var e=this._message;return(new W).getMessageSerializedAsStringAsync(e)},Object.defineProperty(e.prototype,"keepCallback",{get:function(){return this._keepCallBack},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rowMessage",{get:function(){return this._message},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"transfer",{get:function(){return this._transfer},enumerable:!1,configurable:!0}),e.prototype.keepCallBack=function(){this._keepCallBack=!0},e}();!function(e){e[e.Camera=0]="Camera",e[e.Microphone=1]="Microphone",e[e.Location=2]="Location"}(j||(j={}));var G,J=function(){function e(e){this._commChannel=e,this._isDisposed=!1}return Object.defineProperty(e.prototype,"isDisposed",{get:function(){return this._isDisposed},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this._isDisposed=!0},e.prototype.initializeEventHandlingFunctionality=function(e){var t=new q(B.NoResult,null);t.keepCallBack(),this._eventDispatcherCallbackId=e.callbackId,this._sendPluginResults(t,e.callbackId)},e.prototype.sendIllegalAccessToCapabilitiyExceptionResult=function(t,n){var r=new q(B.IllegalAccessException,"Your app has no access to : "+e.getNameOfCapabilities(n));this._sendPluginResults(r,t)},e.prototype.sendIllegalAccessToFileLocationExceptionResult=function(e,t){var n=new q(B.IllegalAccessException,"Your app has no access to the following location : "+t);this._sendPluginResults(n,e)},e.prototype.sendIllegalAccessToActionNameExceptionResult=function(e,t){var n=new q(B.IllegalAccessException,"Action name was not found : "+t);this._sendPluginResults(n,e)},e.prototype._sendPluginResults=function(e,t){return!this._isDisposed&&this._commChannel?this._commChannel.sendPluginResult(e,t):Promise.resolve()},e.prototype._dispatchEvent=function(e,t){if(!Core.Utility.isNullOrUndefined(this._eventDispatcherCallbackId)){var n=new V(e,t),r=new q(B.Ok,n);r.keepCallBack(),this._sendPluginResults(r,this._eventDispatcherCallbackId)}},e.getNameOfCapabilities=function(e){var t;switch(e){case j.Camera:t="Camera";break;case j.Location:t="Location";break;case j.Microphone:t="Microphone";break;default:throw new Error("The capability that was passed is invalid")}return t},e}(),K=(function(){function e(e){this._typeConvertor=e||new F}e.prototype.deserializeArgumentsIfNeeded=function(e){for(var t=[],n=0;n<e.length;n++)if(e[n]&&e[n].hasOwnProperty("argumentType")){var r=null;"Blob"===e[n].argumentType?r=this._typeConvertor.convertBase64ToBlob(e[n].data,e[n].blobType):"ArrayBuffer"===e[n].argumentType?r=this._typeConvertor.convertBase64ToArrayBuffer(e[n].data):(console.warn("argumentType is not being dealt with"),r=e[n]),t.push(r)}else t.push(e[n]);return t}}(),function(e){function t(t,n){var r=this;return(r=e.call(this,t)||this)._pluginVersionManagerInstance=n,r}return __extends(t,e),t.prototype.exchangePluginManagerVersion=function(e){var t=e.args[0];this._pluginVersionManagerInstance.setAppPluginManagerVersion(t),this._pluginVersionManagerInstance.setClientPluginManagerVersion();var n=this._pluginVersionManagerInstance.getClientPluginManagerVersion(),r=new q(B.Ok,n);this._sendPluginResults(r,e.callbackId)},t.prototype.exchangeAllPluginVersions=function(e){var t=e.args[0];this._pluginVersionManagerInstance.setAppPluginVersionHashTable(t),this._pluginVersionManagerInstance.setClientPluginVersionHashTable();var n=this._pluginVersionManagerInstance.getAllClientPluginVersions(),r=new q(B.Ok,n);this._sendPluginResults(r,e.callbackId)},t}(J)),X=function(e){function t(t,n){var r=this;return(r=e.call(this,t)||this)._capabilitiesManager=n,r}return __extends(t,e),t.prototype.initialize=function(e){var t=this;Core.FeatureGates.sandboxing.appHostXHRSandbox&&void 0!==e&&void 0!==e.args&&e.args.length>0&&void 0!==this._capabilitiesManager&&void 0!==this._capabilitiesManager.getAppFolderPath()&&(e.args[0].appFolderPath=this._capabilitiesManager.getAppFolderPath()),Cordova.exec((function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(n){t._sendPluginResults(new q(B.Error,n),e.callbackId)}),"CanvasCamera","initialize",e.args)},t.prototype.startCapture=function(e){var t=this,n=this._commChannel.appHostElement();CanvasCamera.capture=function(e){Core.FeatureGates.sandboxing.appHostXHRSandbox?t._commChannel.invokeScriptAsync("CanvasCamera.capture('"+e+"');"):n.contentWindow.CanvasCamera.capture(e)},Cordova.exec((function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(n){t._sendPluginResults(new q(B.Error,n),e.callbackId)}),"CanvasCamera","startCapture",e.args)},t.prototype.stopCapture=function(e){var t=this;Cordova.exec((function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(n){t._sendPluginResults(new q(B.Error,n),e.callbackId)}),"CanvasCamera","stopCapture",e.args)},t.prototype.captureImage=function(e){var t=this;Cordova.exec((function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(n){t._sendPluginResults(new q(B.Error,n),e.callbackId)}),"CanvasCamera","captureImage",e.args)},t.prototype.dispose=function(){e.prototype.dispose.call(this),window.CanvasCamera&&delete CanvasCamera.capture},Object.defineProperty(t.prototype,"requiredCapability",{get:function(){return j.Camera},enumerable:!1,configurable:!0}),t}(J),Y="draw",Q="erase",Z=0,$=1;!function(e){e[e.CIRCLE=0]="CIRCLE",e[e.RECTANGLE=1]="RECTANGLE"}(G||(G={}));var ee;!function(e){e[e.all=0]="all",e[e.selected=1]="selected",e[e.recent=2]="recent"}(ee||(ee={}));var te,ne=1,re=2,ie=4,oe=function(){function e(e,t){this._pointerDownEvent=new EventObject,this._pointerMoveEvent=new EventObject,this._pointerUpEvent=new EventObject,this._resizeEvent=new EventObject,this._uniqueId=e,this._inkManager=t||new Windows.UI.Input.Inking.InkManager,this._penId=-1,this._inputType=7,this._controlContextMode=Y,window.addEventListener("resize",this._resizeInkControl.bind(this))}return Object.defineProperty(e.prototype,"pointerDownEvent",{get:function(){return this._pointerDownEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerMoveEvent",{get:function(){return this._pointerMoveEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pointerUpEvent",{get:function(){return this._pointerUpEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"resizeEvent",{get:function(){return this._resizeEvent},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){Core.Log.verbose(" Dispose the control in RemoteInkManagerImplementation"),this._inkManager=null,this._penId=-1,this._uniqueId=0,this._pointerDownEvent.dispose(),this._pointerMoveEvent.dispose(),this._pointerUpEvent.dispose(),this._resizeEvent.dispose(),this._removeOverlay()},e.prototype.disposeRemoteInkView=function(e){return this._removeOverlay(),null},e.prototype.disableRemoteInkControl=function(e){Core.Log.verbose("In RemoteInkManagerImpl - disableRemoteInkControl"),this._isDisabled=e.args[2],this._isDisabled&&this._removeOverlay()},e.prototype.recognizeAsync=function(e){var t=this;Core.Log.verbose("In RemoteInkManagerImpl - recognizeAsync");var n=e.args[2],r=Core.PromiseUtils.createCompletablePromise(),i="";return this._inkManager.recognizeAsync(n).then((function(e){t._inkManager.updateRecognitionResults(e);for(var n=e.length,o=0;o<n;o++){var a=e[o].getTextCandidates(),s=a.length>0?a[0]:"";i=i.length>0?i+" "+s:s}r.complete(i)})),r.promise},e.prototype.startCapturingPointer=function(e){return Core.Log.verbose("In RemoteInkManagerImpl - startCapturingPointer"),this._inkControlSize=e.args[3],this._inputType=e.args[4],this._controlContextMode=e.args[5],this._createLayerOnWebView(),null},e.prototype.setDefaultDrawingAttributes=function(e){Core.Log.verbose("In RemoteInkManagerImpl - setDefaultDrawingAttributes");var t=e.args[2],n=AppMagic.Controls.Common.Ink.InkSerialization.convertToWindowsInkDrawingAttributes(t);return this._inkManager.setDefaultDrawingAttributes(n),null},e.prototype.setMode=function(e){Core.Log.verbose("In RemoteInkManagerImpl - setMode");var t=e.args[2];return this._controlContextMode=t,null},e.prototype.getMode=function(e){return Core.Log.verbose("In RemoteInkManagerImpl - getMode"),this._inkManager.mode},e.prototype.clearSelection=function(e){Core.Log.verbose("In RemoteInkManagerImpl - clearSelection");for(var t=this._inkManager.getStrokes(),n=t.length,r=0;r<n;r++)t[r].selected=!1;return null},e.prototype.clearAllStrokes=function(e){console.log("In RemoteInkManagerImpl - clearAllStrokes");var t=this._inkManager.getStrokes(),n=t.length,r=!1;if(n>0){for(var i=0;i<n;i++)t[i].selected=!0;this._inkManager.deleteSelected(),r=!0}return r},e.prototype.updateDrawingAttributes=function(e){console.log("In RemoteInkManagerImpl - updateDrawingAttributes");var t=e.args[2],n=e.args[3],r=!1;return this._inkManager.getStrokes().forEach((function(e){if(e.selected&&e.drawingAttributes[t]!==n){var i=e.drawingAttributes;i[t]=n,e.drawingAttributes=i,r=!0}})),r},e.prototype.getRenderingStrokes=function(e){Core.Log.verbose("In RemoteInkManagerImpl - getRenderingStrokes");var t=[];return this._inkManager.getStrokes().forEach((function(e){var n=e.selected,r=e.drawingAttributes,i=Core.Utility.ColorUtility.toColorString(r.color),o=r.size,a=new AppMagic.Controls.Common.Ink.InkStroke(i,o,n),s=a.renderingSegments;e.getRenderingSegments().forEach((function(e){s.push(new AppMagic.Controls.Common.Ink.InkStrokeRenderingSegment(e.bezierControlPoint1,e.bezierControlPoint2,e.position))})),t.push(a)})),t},e.prototype.saveStrokesToObjectURL=function(e){Core.Log.verbose("In RemoteInkManagerImpl - streamFromUriAsync");var t=Core.PromiseUtils.createCompletablePromise();if(this._inkManager.getStrokes().length>0){var n=new Windows.Storage.Streams.InMemoryRandomAccessStream;this._inkManager.saveAsync(n).then((function(){var e=MSApp.createBlobFromRandomAccessStream("image/gif",n);t.complete(e)}),(function(){n.close(),t.error("SaveStrokesToObjectURL in RemoteInkManagerImplementation failed")}))}else t.complete(null);return t.promise},e.prototype.streamFromUriAsync=function(e){var t=this;Core.Log.verbose("In RemoteInkManagerImpl - streamFromUriAsync");var n=e.args[2];return this._streamFromUriAsync(n).then((function(e){var n=function(){e.close()};return Promise.resolve().then((function(){return t._inkManager.loadAsync(e)})).then(n,n)}),Core.Utility.noOpFn),null},e.prototype._removeOverlay=function(){var e=document.getElementById("overlay-inkcontrol-div");e&&(e.removeEventListener("pointerdown",this._onpointerdownHandler,!0),e.removeEventListener("pointermove",this._onpointermoveHandler,!0),e.removeEventListener("pointerup",this._onpointerupHandler,!0),e.removeEventListener("pointerout",this._onpointeroutHandler,!0),document.getElementsByClassName("app-host-container")[0].removeChild(e))},e.prototype._streamFromUriAsync=function(e){return WinJS.xhr({url:e,responseType:"blob"}).then((function(e){return Contracts.checkValue(e),Contracts.checkValue(e.response),e.response.msDetachStream()}))},e.prototype._onpointerdownHandler=function(e){var t={},n=Y;if(-1===this._penId&&this._isInsideInkControl(e)&&("pen"===e.pointerType&&(this._inputType&ie)===ie||"touch"===e.pointerType&&(this._inputType&re)===re||"mouse"===e.pointerType&&(this._inputType&ne)===ne&&0===e.button)){var r={x:0,y:0};this._inkManager.selectWithLine(r,r);var i=e.currentPoint;i.properties.isEraser||this._controlContextMode===Q?(this._inkManager.mode=$,n=Q):this._inkManager.mode=Z,this._inkManager.processPointerDown(i),this._penId=e.pointerId,t={mode:n,point:this._getXYPosition(i),pointerId:e.pointerId},this._pointerDownEvent.dispatch([this._uniqueId,t])}},e.prototype._onpointermoveHandler=function(e){console.log("PointerMoveHandler valled in RemoteInkManagerPluginImplementation "),-1!==this._penId&&e.pointerId===this._penId&&this._isInsideInkControl(e)&&this._pointerMoveOperations(e)},e.prototype._pointerMoveOperations=function(e){for(var t=e.pointerId,n=e.currentPoint,r=e.intermediatePoints,i=!1,o=r.length-1;o>=0;o--){var a,s=r[o];a=s.properties.isLeftButtonPressed?this._inkManager.processPointerUpdate(s):{height:0,width:0,x:0,y:0},AppMagic.Controls.Common.Ink.InkSerialization.isZero(a)||this._controlContextMode!==this._inkManager.mode||(i=!0)}var c={pointerId:t,point:this._getXYPosition(n),redraw:i};this._pointerMoveEvent.dispatch([this._uniqueId,c])},e.prototype._onpointerupHandler=function(e){console.log("PointerUpHandler valled in RemoteInkManagerPluginImplementation "),this._pointerOutOperations(e)},e.prototype._onpointeroutHandler=function(e){console.log("PointerOutHandler valled in RemoteInkManagerPluginImplementation "),this._pointerOutOperations(e),this._removeOverlay()},e.prototype._pointerOutOperations=function(e){if(e.currentPoint){var t={};if(-1!==this._penId){if(e&&e.pointerId===this._penId){var n=e.currentPoint,r=this._inkManager.processPointerUp(n),i=e.pointerId,o=AppMagic.Controls.Common.Ink.InkSerialization.isZero(r)&&n.properties.isEraser;t={pointerId:i,point:this._getXYPosition(n),isDigitizerEraser:o}}this._penId=-1,this._pointerUpEvent.dispatch([this._uniqueId,t])}}},e.prototype._createLayerOnWebView=function(){if(!this._isDisabled){this._removeOverlay();var e=document.createElement("div");e.id="overlay-inkcontrol-div",e.style.position="absolute",e.style.width=this._inkControlSize.width+"px",e.style.height=this._inkControlSize.height+"px",e.style.backgroundColor="rgba(0, 0, 0, 0.01)";var t=document.getElementsByClassName("app-host-container")[0];t.appendChild(e),e.addEventListener("pointerdown",this._onpointerdownHandler.bind(this),!0),e.addEventListener("pointermove",this._onpointermoveHandler.bind(this),!0),e.addEventListener("pointerout",this._onpointeroutHandler.bind(this),!0),e.addEventListener("pointerup",this._onpointerupHandler.bind(this),!0);var n=t.querySelector(".fullscreen-app-host");this._webViewRect=n.getBoundingClientRect(),e.style.top=this._webViewRect.top+this._inkControlSize.y+"px",e.style.left=this._webViewRect.left+this._inkControlSize.x+"px"}},e.prototype._isInsideInkControl=function(e){var t=this._inkControlSize.x+this._webViewRect.left,n=this._inkControlSize.y+this._webViewRect.top,r=this._inkControlSize.width+t,i=this._inkControlSize.height+n;return t<e.x&&e.x<r&&n<e.y&&e.y<i},e.prototype._resizeInkControl=function(){console.log("In RemoteInkManagerImpl - in _resizeInkControl"),setTimeout(this._render.bind(this),500)},e.prototype._render=function(){this._resizeEvent.isDisposed||this._resizeEvent.dispatch([this._uniqueId])},e.prototype._getXYPosition=function(e){return{x:e.rawPosition.x,y:e.rawPosition.y}},e}(),ae=function(e){function t(n){var r=this;return r=e.call(this,n)||this,t._remoteInkManagerCollection={},t._uniqueIdsCollection=[],r._onPointerDownHandler=r._dispatchPointerDown.bind(r),r._onPointerMoveHandler=r._dispatchPointerMove.bind(r),r._onPointerUpHandler=r._dispatchPointerUp.bind(r),r._onResizeHandler=r._dispatchResize.bind(r),r}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),Core.Log.verbose("Dispose the control in RemoteInkManagerPluginDelegator");for(var n=0;n<t._uniqueIdsCollection.length;n++){var r=t._uniqueIdsCollection[n],i=t._remoteInkManagerCollection[r];i&&(i.pointerDownEvent.removeListener(this._onPointerDownHandler),i.pointerMoveEvent.removeListener(this._onPointerMoveHandler),i.pointerUpEvent.removeListener(this._onPointerUpHandler),i.resizeEvent.removeListener(this._onResizeHandler),i.dispose())}},t.prototype.remoteInkMangerHandler=function(e){var t=this;Core.Log.verbose("In remoteInkManagerHandler");var n=e.args[0],r=e.args[1],i=this._getRemoteInkManagerInstance(r);if("recognizeAsync"===n||"saveStrokesToObjectURL"===n)i[n](e).then((function(n){var r=new q(B.Ok,n);t._sendPluginResults(r,e.callbackId)}));else{var o=i[n](e),a=new q(B.Ok,o);this._sendPluginResults(a,e.callbackId)}},t.prototype._addRemoteInkManagerEntry=function(e){if(t._remoteInkManagerCollection||(t._remoteInkManagerCollection={}),!t._remoteInkManagerCollection[e]){var n=new oe(e);t._remoteInkManagerCollection[e]=n,t._uniqueIdsCollection.push(e),n.pointerDownEvent.addListener(this._onPointerDownHandler),n.pointerMoveEvent.addListener(this._onPointerMoveHandler),n.pointerUpEvent.addListener(this._onPointerUpHandler),n.resizeEvent.addListener(this._onResizeHandler)}},t.prototype._dispatchPointerDown=function(e){this._dispatchEvent("pointerDown",e)},t.prototype._dispatchPointerMove=function(e){this._dispatchEvent("pointerMove",e)},t.prototype._dispatchPointerUp=function(e){this._dispatchEvent("pointerUp",e)},t.prototype._dispatchResize=function(e){this._dispatchEvent("resize",e)},t.prototype._getRemoteInkManagerInstance=function(e){return this._addRemoteInkManagerEntry(e),t._remoteInkManagerCollection[e]},t}(J),se=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.prototype._proxyCommand=function(e){if(Core.Environment.isWebPlayer()){var t={serviceName:e.serviceName,actionName:e.actionName};Core.Telemetry.Log.trackErrorEvent(Core.Telemetry.Strings.webPlayerUnsupportedCordovaRequest,t);var n=new q(B.Error,"web player does not have cordova");this._commChannel.sendPluginResult(n,e.callbackId)}else Cordova.exec(this._proxyWin(e),this._proxyFail(e),e.serviceName,e.actionName,e.args)},t.prototype._proxyFail=function(e){var t=this;return function(n){var r=new q(B.Error,n);t._commChannel&&t._commChannel.sendPluginResult(r,e.callbackId)}},t.prototype._proxyWin=function(e){var t=this;return function(n){var r=new q(B.Ok,n);t._commChannel&&t._commChannel.sendPluginResult(r,e.callbackId)}},t}(J),ce=function(e){function t(t,n){var r=e.call(this,t)||this;return r._capabilitiesManager=n,r}return __extends(t,e),t.prototype.initializeMicrophone=function(e){Core.FeatureGates.sandboxing.appHostXHRSandbox&&Core.Utility.isDefined(e)&&Core.Utility.isDefined(e.args)&&e.args.length>0&&Core.Utility.isDefined(this._capabilitiesManager)&&Core.Utility.isDefined(this._capabilitiesManager.getAppFolderPath())&&(e.args[0]=0,e.args[1]={appFolderPath:this._capabilitiesManager.getAppFolderPath()}),this._proxyCommand(e)},t.prototype.startMicrophone=function(e){this._proxyCommand(e)},t.prototype.stopMicrophone=function(e){this._proxyCommand(e)},t.prototype.disposeMicrophone=function(e){this._proxyCommand(e)},t.prototype.dispose=function(){e.prototype.dispose.call(this)},Object.defineProperty(t.prototype,"requiredCapability",{get:function(){return j.Microphone},enumerable:!1,configurable:!0}),t}(se),le=function(e){function t(t){var n=e.call(this,t)||this;return n._isRecordingExternally=!1,n._commChannel=t,n}return __extends(t,e),t.prototype.recordMicrophone=function(e){var t=this;if(this._isRecordingExternally){var n=new q(B.Error,"Recording already in progress");this._sendPluginResults(n,e.callbackId)}else{this._isRecordingExternally=!0,microsoftTeams.media.selectMedia({mediaType:4,maxMediaCount:1,audioProps:{maxDuration:10}},(function(n,r){if(n){var i=new q(B.Error,n);t._sendPluginResults(i,e.callbackId)}else{var o=r[0];i=new q(B.Ok,{useBlob:!1,base64Preview:o.preview,blob:null,content:o.content,format:o.format,mimeType:o.mimeType});t._sendPluginResults(i,e.callbackId)}t._isRecordingExternally=!1}))}},t}(J),ue=function(){function e(e){var t,n,r,i;e?this._authProvider=e:(null===(n=null===(t=window.webPlayerServerConfig)||void 0===t?void 0:t.UnifiedAppConfig)||void 0===n?void 0:n.InstanceUrl)&&(this._authProvider=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.ComponentKeys.ClientAuthenticationRuntime).azureAuthenticationManager.getProviderForResourceUrl(window.webPlayerServerConfig.UnifiedAppConfig.InstanceUrl,!0));var o=null===(i=null===(r=window.webPlayerServerConfig)||void 0===r?void 0:r.UnifiedAppConfig)||void 0===i?void 0:i.InstanceUrl;if(o)try{this._instanceUrlHost=new Core.UrlBuilder(o).host}catch(e){Core.Telemetry.Log.trackErrorEvent("CDSAuthProvider.constructor",e)}}return e.prototype.getAuthToken=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this.isAllowedCDSUrl(e)?[4,this.getCDSToken()]:[3,2];case 1:return[2,t.sent()];case 2:return[2,""]}}))}))},e.prototype.isAllowedCDSUrl=function(e){var t;if(e&&this._instanceUrlHost){try{t=new Core.UrlBuilder(e).host}catch(e){Core.Telemetry.Log.trackErrorEvent("CDSAuthProvider.isAllowedCDSUrl",e)}return t===this._instanceUrlHost}return!1},e.prototype.getCDSToken=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this._authProvider?[4,this._authProvider.authenticateSilentAsync()]:[3,2];case 1:return e.sent(),[2,this._authProvider.store.accessToken];case 2:return[2,""]}}))}))},e}(),pe=function(e){function t(t,n,r){var i=this;return(i=e.call(this,t)||this)._xhrFactory=n,i._pendingXhrs=[],i._capabilitiesManager=r,i._CDSAuthProvider=new ue,i}return __extends(t,e),t.prototype.dispose=function(){this._pendingXhrs.forEach((function(e){e.abort(),e.onreadystatechange=null})),this._pendingXhrs=null,e.prototype.dispose.call(this)},t.prototype.executeRequest=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r,i,o,a,s,c=this;return __generator(this,(function(l){switch(l.label){case 0:return t=e.args[0],n=e.args[1],r=e.args[2],i=e.args[3],o=e.args[4],0!==r.indexOf("ms-appdata://")||this._capabilitiesManager.hasAccessToPath(r)?(i=i||{},Core.FeatureGates.services.enableCDSHttpRequests&&Core.Environment.isTrustedUCI()&&"CDS"===i.resource?i.overriddenRequestHeaders.Authorization?[3,2]:[4,this._CDSAuthProvider.getAuthToken(r)]:[3,2]):(this._dispatchEvent("onreadystatechange",[t,4,null,401,"Unauthorized","",null]),[2,this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,r)]);case 1:(a=l.sent())&&(i.overriddenRequestHeaders.Authorization="Bearer "+a),l.label=2;case 2:return s=this._xhrFactory.createXMLHttpRequest(),this._pendingXhrs.push(s),s.onreadystatechange=function(){var e=null;try{""!==s.responseType&&"text"!==s.responseType||(e=s.responseText)}catch(e){console.log(e)}if(s.readyState===s.DONE){var n=c._pendingXhrs.indexOf(s);c._pendingXhrs.splice(n,1)}c.isDisposed||c._dispatchEvent("onreadystatechange",[t,s.readyState,s.response,s.status,s.statusText,s.getAllResponseHeaders(),e])},s.open(n,r,!0),s.responseType=i.responseType,i.overriddenRequestHeaders&&Object.keys(i.overriddenRequestHeaders).forEach((function(e){s.setRequestHeader(e,i.overriddenRequestHeaders[e])})),s.send(o),this._sendPluginResults(new q(B.NoResult,null),e.callbackId),[2]}}))}))},t}(J),de=function(){function e(){}return e.prototype.createXMLHttpRequest=function(){return new XMLHttpRequest},e}(),ge={frequency:500},he={frequency:500},me={enableHighAccuracy:!0},fe=function(e){function t(t,n){var r=e.call(this,t)||this;return r._watchIds=[],r._accelerometerPlugin=n||navigator.accelerometer,r}return __extends(t,e),t.prototype.start=function(e){var t=this;if(this._accelerometerPlugin){var n=this._accelerometerPlugin.watchAcceleration((function(n){var r=new q(B.Ok,n);r.keepCallBack(),t._sendPluginResults(r,e.callbackId)}),(function(n){var r=new q(B.Error,n);r.keepCallBack(),t._sendPluginResults(r,e.callbackId)}),he);this._watchIds.push(n)}else{var r=new q(B.Error,"Accelerometer is unsupported");this._sendPluginResults(r,e.callbackId)}},t.prototype.stop=function(e){if(e.args&&e.args.length>0){var t=e.args[0];this._accelerometerPlugin.clearWatch(t);var n=this._watchIds.indexOf(t);this._watchIds.splice(n,1)}var r=new q(B.Ok,null);this._sendPluginResults(r,e.callbackId)},t.prototype.getWatches=function(){return this._watchIds},t.prototype.dispose=function(){var e=this;this._watchIds.forEach((function(t){e._accelerometerPlugin.clearWatch(t)})),this._watchIds=null},t}(J);!function(e){e.NOTIFY_APP_LOADED="notifyAppLoaded",e.NOTIFY_APP_FULL_LOAD="notifyAppFullLoad",e.SHOW_TOAST_MESSAGE="showToastMessage",e.CLEAR_ALL_TOASTS="clearAllToasts",e.NOTIFY_APP_FAILED="notifyAppFailed",e.TOGGLE_NAV_BAR="toggleNavbar",e.NOTIFY_APP_INDEX_LOADED="notifyAppIndexLoaded",e.SHOW_PLAYER_CONTEXT_MENU="showPlayerContextMenu",e.HIDE_PLAYER_CONTEXT_MENU="hidePlayerContextMenu",e.NOTIFY_UPDATE_APP_CONTROL_INFO="notifyUpdateAppControlInfo",e.NOTIFY_APP_ACTIVITY_EVENT="notifyAppActivityEvent",e.NOTIFY_UPDATE_EXIT_PROMPT="notifyUpdateExitPrompt",e.NOTIFY_APP_RUNTIME_START="notifyAppRuntimeStart",e.CRITICAL_FAILURE="criticalFailure"}(te||(te={}));var ye,ve,_e,Ce,Pe,be,Ae,we,Se,Ee,ke=function(e){function t(t,n){var r=e.call(this,t)||this;return r._notificationProvider=n,r._commChannel=t,r._generatePluginsByNames(),r}return __extends(t,e),t.prototype._generatePluginsByNames=function(){this[te.NOTIFY_APP_LOADED]=this._notifyAppLoaded,this[te.NOTIFY_APP_FULL_LOAD]=this._notifyAppFullLoad,this[te.SHOW_TOAST_MESSAGE]=this._showToastMessage,this[te.CLEAR_ALL_TOASTS]=this._clearAllToasts,this[te.NOTIFY_APP_FAILED]=this._notifyAppFailed,this[te.TOGGLE_NAV_BAR]=this._toggleNavbar,this[te.NOTIFY_APP_INDEX_LOADED]=this._notifyAppIndexLoaded,this[te.SHOW_PLAYER_CONTEXT_MENU]=this._showPlayerContextMenu,this[te.HIDE_PLAYER_CONTEXT_MENU]=this._hidePlayerContextMenu,this[te.NOTIFY_UPDATE_APP_CONTROL_INFO]=this._notifyUpdateAppControlInfo,this[te.NOTIFY_APP_RUNTIME_START]=this._notifyAppRuntimeStart},t.prototype._notifyAppRuntimeStart=function(e){this._commChannel.appRuntimeStartEvent.dispatch(e.args);var t=new q(B.Ok,null);this._sendPluginResults(t,e.callbackId)},t.prototype._notifyAppLoaded=function(e){this._commChannel.appLoadedEvent.dispatch(e.args);var t=new q(B.Ok,null);this._sendPluginResults(t,e.callbackId)},t.prototype._notifyAppFullLoad=function(e){this._commChannel.appFullLoadEvent.dispatch(e.args);var t=new q(B.Ok,null);this._sendPluginResults(t,e.callbackId)},t.prototype._showToastMessage=function(e){var t=e.args[1],n={type:e.args[0],message:t,timeout:e.args[2],preventDuplicates:e.args[3],clickHandler:null};this._notificationProvider.showToastMessage(n)},t.prototype._clearAllToasts=function(){this._notificationProvider.clearAllToasts()},t.prototype._notifyAppFailed=function(e){Core.Log.error("AppLifecyclePlugin.notifyAppFailed","Published app error. message: ".concat(e.args[0],", stack: ").concat(Core.Telemetry.Utility.scrubSensitiveDataSafe(e.args[1]))),Core.Environment.isSharedAppHost()||this._commChannel.appFailedEvent.dispatch(e.args);var t=new q(B.Ok,null);this._sendPluginResults(t,e.callbackId)},t.prototype._toggleNavbar=function(e){this._commChannel.toggleNavbarEvent.dispatch();var t=new q(B.Ok,null);this._sendPluginResults(t,e.callbackId)},t.prototype._notifyAppIndexLoaded=function(e){this._commChannel.appIndexLoadedEvent.dispatch(e.args);var t=new q(B.Ok,null);this._sendPluginResults(t,e.callbackId)},t.prototype._showPlayerContextMenu=function(e){var t=e.args,n={clientX:t[0],clientY:t[1],pageX:t[2],pageY:t[3],screenX:t[4],screenY:t[5]};window&&window.postMessage({messageType:"showContextMenu",payload:n},"*")},t.prototype._hidePlayerContextMenu=function(e){window&&window.postMessage({messageType:"hideContextMenu"},"*")},t.prototype._notifyUpdateAppControlInfo=function(e){var t=e.args,n=t[0],r=t[1];this._notificationProvider.updateConfirmExitProperties(r,n)},t}(J),Ie=function(e){function t(t,n){var r=e.call(this,t)||this;return r._watchIds=[],r._compassPlugin=n||navigator.compass,r}return __extends(t,e),t.prototype.watchHeading=function(e){var t=this,n=this._compassPlugin.watchHeading((function(n){var r=new q(B.Ok,n);r.keepCallBack(),t._sendPluginResults(r,e.callbackId)}),(function(n){var r=new q(B.Error,n);r.keepCallBack(),t._sendPluginResults(r,e.callbackId)}),ge);this._watchIds.push(n)},t.prototype.getHeading=function(e){var t=this;this._compassPlugin.getCurrentHeading((function(n){var r=new q(B.Ok,n);t._sendPluginResults(r,e.callbackId)}),(function(n){var r=new q(B.Error,n);t._sendPluginResults(r,e.callbackId)}))},t.prototype.stopHeading=function(e){var t=e.args[0];this._compassPlugin.clearWatch(t);var n=this._watchIds.indexOf(t);this._watchIds.splice(n,1);var r=new q(B.Ok,null);this._sendPluginResults(r,e.callbackId)},t.prototype.getWatches=function(){return this._watchIds},t.prototype.dispose=function(){var e=this;this._watchIds.forEach((function(t){e._compassPlugin.clearWatch(t)})),this._watchIds=null},t}(J),Te=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.logLevel=function(e){var t=e.args[0],n=e.args[1];switch(t){case"LOG":console.log(n);break;case"ERROR":console.error(n);break;case"WARN":console.warn(n);break;case"INFO":console.info(n);break;case"DEBUG":console.debug(n)}var r=new q(B.Ok,null);this._sendPluginResults(r,e.callbackId)},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t}(J),Re=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.getDeviceInfo=function(e){if(null!==e.callbackId){var t={cordova:"none",platform:"browser",model:Core.Environment.getBrowserId(),version:null,uuid:null},n=new q(B.Ok,t);this._sendPluginResults(n,e.callbackId)}},t.prototype.dispose=function(){},t}(J),Me=function(e){function t(t,n){var r=e.call(this,t)||this;return r._deviceCapabilitiesManger=n,r}return __extends(t,e),t.prototype.requestFileSystem=function(e){this._proxyCommand(e)},t.prototype.requestAllFileSystems=function(e){this._proxyCommand(e)},t.prototype.requestAllPaths=function(e){this._proxyCommand(e)},t.prototype.makeEntryForPath=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.makeEntryForLocalURL=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.makeEntryForURL=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.resolveLocalFileSystemURI=function(e){this._proxyCommand(e)},t.prototype.getDirectory=function(e){if(e.args[2].create&&!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.getFile=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.getParent=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.getMetadata=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.setMetadata=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.remove=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.removeRecursively=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.moveTo=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0])||!this._deviceCapabilitiesManger.hasAccessToPath(e.args[1]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.doCopyMove=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0])||!this._deviceCapabilitiesManger.hasAccessToPath(e.args[1]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.copyTo=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0])||!this._deviceCapabilitiesManger.hasAccessToPath(e.args[1]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.getFileMetadata=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.readEntries=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.readAsText=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.readAsDataURL=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.readAsArrayBuffer=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.readAsBinaryString=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.truncate=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.write=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.testFileExists=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.testDirectoryExists=function(e){if(!this._deviceCapabilitiesManger.hasAccessToPath(e.args[0]))return this.sendIllegalAccessToFileLocationExceptionResult(e.callbackId,e.args[0]);this._proxyCommand(e)},t.prototype.getFreeDiskSpace=function(e){var t=new q(B.Error,"You don't have access to getFreeDiskSpace");this._sendPluginResults(t,e.callbackId)},t.prototype._getLocalFilesystemPath=function(e){this._proxyCommand(e)},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t}(se),Ne=function(e){function t(t,n){var r=e.call(this,t)||this;return r._watchIds=[],r._geoLocationPlugin=n||navigator.geolocation,r}return __extends(t,e),t.prototype.getLocation=function(e){var t=this;this._geoLocationPlugin.getCurrentPosition((function(n){var r=n.coords,i=new q(B.Ok,{accuracy:r.accuracy,altitude:r.altitude,altitudeAccuracy:r.altitudeAccuracy,heading:r.heading,latitude:r.latitude,longitude:r.longitude,speed:r.speed});t._sendPluginResults(i,e.callbackId)}),(function(n){var r=new q(B.Error,n);t._sendPluginResults(r,e.callbackId)}),me)},t.prototype.addWatch=function(e){var t=this,n=this._geoLocationPlugin.watchPosition((function(n){var r=new q(B.Ok,n.coords);r.keepCallBack(),t._sendPluginResults(r,e.callbackId)}),(function(n){var r=new q(B.Error,n);r.keepCallBack(),t._sendPluginResults(r,e.callbackId)}),me);this._watchIds.push(n)},t.prototype.clearWatch=function(e){var t=e.args[0];this._geoLocationPlugin.clearWatch(t);var n=this._watchIds.indexOf(t);this._watchIds.splice(n,1);var r=new q(B.Ok,null);this._sendPluginResults(r,e.callbackId)},t.prototype.getWatches=function(){return this._watchIds},t.prototype.dispose=function(){var t=this;e.prototype.dispose.call(this),this._watchIds.forEach((function(e){t._geoLocationPlugin.clearWatch(e)})),this._watchIds=null},Object.defineProperty(t.prototype,"requiredCapability",{get:function(){return j.Location},enumerable:!1,configurable:!0}),t}(J),xe=function(e){function t(t){var n=e.call(this,t)||this;return n._eventsAttached=!1,n._callbackId=null,n._onlineEventListener=null,n._offlineEventListener=null,n._onlineEventListener=n._handleOnlineEvent.bind(n),n._offlineEventListener=n._handleOfflineEvent.bind(n),n}return __extends(t,e),t.prototype._sendCurrentNetworkTypeAsAPluginResult=function(){if(null!==this._callbackId){var e;e=Core.Environment.isWebPlayer()?navigator.onLine?"unknown":"none":navigator.connection.type;var t=new q(B.Ok,e);t.keepCallBack(),this._sendPluginResults(t,this._callbackId)}},t.prototype.getConnectionInfo=function(e){this._callbackId=e.callbackId,this._sendCurrentNetworkTypeAsAPluginResult(),this._eventsAttached||(window.addEventListener("online",this._onlineEventListener,!1),window.addEventListener("offline",this._offlineEventListener,!1),this._eventsAttached=!0)},t.prototype._handleOnlineEvent=function(e){this._sendCurrentNetworkTypeAsAPluginResult()},t.prototype._handleOfflineEvent=function(e){this._sendCurrentNetworkTypeAsAPluginResult()},t.prototype.dispose=function(){this._eventsAttached&&(window.removeEventListener("online",this._onlineEventListener,!1),window.removeEventListener("offline",this._offlineEventListener,!1)),this._onlineEventListener=null,this._offlineEventListener=null},t}(J),Le=function(){function e(){}return e.getCustomPageTelemetryData=function(e){if(e)return e.appId?{childCanvasAppId:e.appId,childCanvasAppLogicalName:e.appLogicalName}:{childCanvasAppLogicalName:e.appLogicalName}},e}(),He=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.startScenario=function(e){var t=e.args[0],n=Le.getCustomPageTelemetryData(e.context),r=Core.Telemetry.Log.startScenario(t,n),i=new q(B.Ok,r);this._sendPluginResults(i,e.callbackId)},t.prototype.endScenario=function(e){var t=e.args[0],n=Le.getCustomPageTelemetryData(e.context);Core.Telemetry.Log.endScenario(t,{customScenarioData:n});var r=new q(B.Ok,null);this._sendPluginResults(r,e.callbackId)},t.prototype.trackEvent=function(e){var t=e.args[0],n=e.args[1],r=Le.getCustomPageTelemetryData(e.context);Core.Telemetry.Log.trackEvent(t,__assign(__assign({},n),r));var i=new q(B.Ok,null);this._sendPluginResults(i,e.callbackId)},t.prototype.trackMetric=function(e){var t=e.args[0],n=e.args[1],r=Le.getCustomPageTelemetryData(e.context);Core.Telemetry.Log.trackMetric(t,n,r);var i=new q(B.Ok,null);this._sendPluginResults(i,e.callbackId)},t.prototype.trackException=function(e){var t=e.args[0],n=Core.Utility.isJsonObjectOrUndefined(e.args[1])?e.args[1]:void 0,r=Le.getCustomPageTelemetryData(e.context);Core.Telemetry.Log.trackException(t,__assign(__assign({},n),r));var i=new q(B.Ok,null);this._sendPluginResults(i,e.callbackId)},t.prototype.trackErrorEvent=function(e){var t=e.args[0],n=e.args[1],r=Le.getCustomPageTelemetryData(e.context);Core.Telemetry.Log.trackErrorEvent(t,__assign(__assign({},n),r));var i=new q(B.Ok,null);this._sendPluginResults(i,e.callbackId)},t}(J),De=function(e){function t(t,n){var r=e.call(this,t)||this;return r._commChannel=t,r._deviceCapabilititesManager=n,r}return __extends(t,e),t.prototype.launchSelectFilePicker=function(e){var t=this;Cordova.exec((function(n){n&&t._deviceCapabilititesManager.addToFutureFilesAllowedList(n);var r=new q(B.Ok,n);t._sendPluginResults(r,e.callbackId)}),(function(n){var r=new q(B.Error,n);t._sendPluginResults(r,e.callbackId)}),"SienaFilePickerPlugin","launchSelectFilePicker",e.args)},t.prototype.launchSaveFilePicker=function(e){var t=this;Cordova.exec((function(n){t._deviceCapabilititesManager.addToFutureFilesAllowedList(n);var r=new q(B.Ok,n);t._sendPluginResults(r,e.callbackId)}),(function(n){var r=new q(B.Error,n);t._sendPluginResults(r,e.callbackId)}),"SienaFilePickerPlugin","launchSaveFilePicker",e.args)},t.prototype.openFile=function(e){var t=this;Cordova.exec((function(n){var r=new q(B.Ok,n);t._sendPluginResults(r,e.callbackId)}),(function(n){var r=new q(B.Error,n);t._sendPluginResults(r,e.callbackId)}),"SienaFilePickerPlugin","openFile",e.args)},t.prototype.launchTeamsMobileImagePicker=function(e){var t=this,n={mediaType:1,maxMediaCount:1,imageProps:{sources:e.args&&e.args[0]?[1]:[1,2]}};microsoftTeams.media.selectMedia(n,(function(n,r){if(n)if("9000"===n.errorCode.toString()||"100"===n.errorCode.toString())Core.Telemetry.Log.trackErrorEvent("SienaFilePickerPlugin.launchTeamsMobileImagePicker.selectMedia.error",n),microsoftTeams.media.captureImage((function(n,r){if(n){var i={name:n.errorCode.toString(),message:n.message},o=new q(B.Error,i);t._sendPluginResults(o,e.callbackId)}else{o=new q(B.Ok,r[0]);t._sendPluginResults(o,e.callbackId)}}));else{var i={name:n.errorCode.toString(),message:n.message},o=new q(B.Error,i);t._sendPluginResults(o,e.callbackId)}else{var a=r[0];if(a.preview){o=new q(B.Ok,{content:a.preview,mimeType:a.mimeType});t._sendPluginResults(o,e.callbackId)}else Core.Telemetry.Log.trackActivityEvent("SienaFilePickerPlugin.launchTeamsMobileImagePicker.getMedia"),a.getMedia((function(n,r){if(n){Core.Telemetry.Log.trackErrorEvent("SienaFilePickerPlugin.launchTeamsMobileImagePicker.getMedia.error",[n]);var i={name:n.errorCode.toString(),message:n.message},o=new q(B.Error,i);t._sendPluginResults(o,e.callbackId)}else{Core.Telemetry.Log.trackActivityEvent("SienaFilePickerPlugin.launchTeamsMobileImagePicker.getMedia.success",{message:"getMedia success, blob size: "+r.size+" bytes"});o=new q(B.Ok,{blob:r});t._sendPluginResults(o,e.callbackId)}}))}}))},t.prototype.launchTeamsMobileFileViewer=function(e){var t=e.args[0];t&&microsoftTeams.openFilePreview(t)},t._getTeamsNotificationType=function(e){var t;switch(e){case"fileDownloadStart":t=microsoftTeams.NotificationTypes.fileDownloadStart;break;case"fileDownloadComplete":t=microsoftTeams.NotificationTypes.fileDownloadComplete;break;default:throw new Error("The Teams notification type that was passed is invalid")}return t},t.prototype.showTeamsDownloadNotification=function(e){var n,r=null===(n=null==e?void 0:e.args)||void 0===n?void 0:n[0];if(r){var i=r.message,o=r.notificationType;i&&o&&microsoftTeams.showNotification({message:i,notificationType:t._getTeamsNotificationType(o)})}},t}(J),Ue=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype._ready=function(e){if(null!==e.callbackId){var t=new q(B.Ok,!1);this._sendPluginResults(t,e.callbackId)}},t.prototype.dispose=function(){},t}(J),Oe=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.init=function(e){this._callbackId=e.callbackId;var t=new q(B.Ok,"OK");t.keepCallBack(),this._sendPluginResults(t,this._callbackId),this._keyboardShownHandler=this._keyboardShownHandler.bind(this),this._keyboardHiddenHandler=this._keyboardHiddenHandler.bind(this),window.addEventListener("native.keyboardshow",this._keyboardShownHandler),window.addEventListener("native.keyboardhide",this._keyboardHiddenHandler)},t.prototype.close=function(e){this._proxyCommand(e)},t.prototype.show=function(e){this._proxyCommand(e)},t.prototype.disableScroll=function(e){this._proxyCommand(e)},t.prototype.hideKeyboardAccessoryBar=function(e){this._proxyCommand(e)},t.prototype.dispose=function(){window.removeEventListener("native.keyboardshow",this._keyboardShownHandler),window.removeEventListener("native.keyboardhide",this._keyboardHiddenHandler),e.prototype.dispose.call(this)},t.prototype._keyboardShownHandler=function(e){var t=e.keyboardHeight,n=new q(B.Ok,"S".concat(t));n.keepCallBack(),this._sendPluginResults(n,this._callbackId)},t.prototype._keyboardHiddenHandler=function(e){var t=new q(B.Ok,"H");t.keepCallBack(),this._sendPluginResults(t,this._callbackId)},t}(se),Ve=function(e){function t(t,n){var r=e.call(this,t)||this;return r._commChannel=t,r._metadataParser=n,r}return __extends(t,e),t.prototype.getAppDependencies=function(e){var t=this;this._metadataParser.getAppDependencies({onSuccess:function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)},onFailure:function(n){var r=n.message?n.message:"Unknown Error in getAppDependencies";Core.Telemetry.Log.trackErrorEvent(r),t._sendPluginResults(new q(B.Error,r),e.callbackId)}})},t.prototype.getAppDetails=function(e){var t=this;this._metadataParser.getAppDetails({onSuccess:function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)},onFailure:function(n){var r=n.message?n.message:"Unknown Error in getAppDetailsAsync";Core.Telemetry.Log.trackErrorEvent(r),t._sendPluginResults(new q(B.Error,r),e.callbackId)}})},t.prototype.refreshWebPlayerPackageDetails=function(e){var t=this;this._metadataParser.refreshWebPlayerPackageDetails({onSuccess:function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)},onFailure:function(n){var r=n.message?n.message:"Unknown Error in refreshWebPlayerPackageDetailsAsync";Core.Telemetry.Log.trackErrorEvent(r),t._sendPluginResults(new q(B.Error,r),e.callbackId)}})},t}(J),Fe=function(e){function t(t,n){var r=e.call(this,t)||this;return r._appModuleManager=n,r}return __extends(t,e),t.prototype.getRootAppMetadata=function(e){var t=this,n=e.args[0];this._appModuleManager.getRootAppMetadataAsync(!!n).then((function(n){return t._sendPluginResults(new q(B.Ok,n),e.callbackId)})).catch((function(n){t._sendPluginResults(new q(B.Error,t._appModuleManager.isSharedAppHostError(n)?n:n.message),e.callbackId)}))},t.prototype.getCanvasAppMetadata=function(e){var t=this;if(null==e?void 0:e.args[0]){var n=e.args[0],r=e.args[1];this._appModuleManager.getCanvasAppMetadataAsync(n,!!r).then((function(n){return t._sendPluginResults(new q(B.Ok,n),e.callbackId)})).catch((function(n){t._sendPluginResults(new q(B.Error,t._appModuleManager.isSharedAppHostError(n)?n:n.message),e.callbackId)}))}else this._sendPluginResults(new q(B.Error,"the app logical name is null or undefined."),e.callbackId)},t.prototype.getChildComponentLibraryMetadata=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o;return __generator(this,(function(a){switch(a.label){case 0:if(!(null==e?void 0:e.args[0]))return this._sendPluginResults(new q(B.Error,"the component library logical name is null or undefined."),e.callbackId),[2];t=e.args,n=t[0],r=t[1],a.label=1;case 1:return a.trys.push([1,3,,4]),[4,this._appModuleManager.getChildComponentLibraryMetadataAsync(n,r)];case 2:return i=a.sent(),this._sendPluginResults(new q(B.Ok,i),e.callbackId),[3,4];case 3:return o=a.sent(),this._sendPluginResults(new q(B.Error,this._appModuleManager.isSharedAppHostError(o)?o:o.message),e.callbackId),[3,4];case 4:return[2]}}))}))},t}(J),ze=n(1);!function(e){e.galleryIdKey="galleryId",e.versionKey="version",e.gallerySourceKey="gallerySource",e.instanceIdKey="instanceId"}(ye||(ye={})),function(e){e.sienaAppType="SienaApp",e.powerAppType="PowerApp"}(ve||(ve={})),function(e){e.getApiVersion=function(){return Object(ze.isWebPlayer)()||Object(ze.isReactNativePlayer)()||Object(ze.isWebAuthoring)()?"2020-06-01":"2018-10-01"},e.getEnvironmentPermissionExpandQueryParam=function(e){return e>="2019-05-01"?"properties.permissions":"Permissions"},e.getCdmRpApiVersion=function(){return"2016-11-01"},e.getCuratedApiVersion=function(){return"2021-02-01"},e.powerPlatformApiVersion="1",e.powerPlatformSafePublishApiVersion="3",e.paRpInvokeUrl="api/invoke",e.appVersionKey="versionstring",e.providers="providers/Microsoft.PowerApps",e.generateTransientStorageValue="generateTransientStorage",e.generateResourceStorageValue="generateResourceStorage",e.apiVersionKey="api-version",e.objectIdsValue="objectIds",e.appsValue="apps",e.unifiedAppsValue="unifiedApps",e.sessions="sessions",e.displayName="displayName",e.updateDisplayName="updateDisplayName",e.validateAppDisplayName="validateAppDisplayName",e.versions="versions",e.globalAppsValue="globalApps",e.curatedAppsValue="curatedApps",e.entitiesFolderName="entities",e.listPackageValue="listPackage",e.roleAssignmentsValue="roleAssignments",e.noCacheKey="nc",e.retrieveConsentLinks="listLoginUris",e.listApplicationCategoriesValue="listApplicationCategories",e.appPermission="permissions",e.serverSession="initiateDocumentServerSession",e.refreshServerSession="refreshDocumentServerSession",e.tenantPrefix="tenant-",e.trialConsentPath="trial",e.redirectQueryParam="redirect",e.authoringRedirectQueryValue="authoring",e.playerRedirectQueryValue="player",e.blockingEnrollCallQueryParam="_blocking",e.actionQueryParam="action",e.appSourceTrialQueryParamValue="AppSourceTrial",e.pollQueryParam="_poll",e.refreshCacheQueryParam="refreshCache",e.environmentsValue="environments",e.instancesValue="instances",e.solutionsValue="solutions",e.componentsValue="components",e.organizationSettingsValue="organizationsettings",e.apiConsumptionInterval=3e5,e.checkPrivileges="checkPrivileges",e.excludeQueryParam="exclude",e.excludeSolutionFlowQueryParamValue="excludeSolutionCloudFlows",function(e){e.publishValue="publish",e.packageValue="package",e.setFavoriteValue="setFavorite",e.unsetFavoriteValue="unsetFavorite",e.clientMetadata="clientinfo/clientmetadata",e.acquireLeaseValue="acquireLease",e.releaseLeaseValue="releaseLease",e.healthCheck="healthcheck",e.portalHome="home",e.customBrandingAssets="customAssets/default",e.checkComponentUpdates="checkComponentUpdates",e.makeSolutionAware="makeSolutionAware",e.componentDependencies="componentDependencies",e.startSession="startSession",e.endSession="endSession",e.refreshSession="refreshSession",e.getSessions="sessions",e.getAppExtendedMetadata="getAppExtendedMetadata"}(e.UrlPaths||(e.UrlPaths={}))}(_e||(_e={})),function(e){e.author="",e.appVersion="1.0.0.0",e.sienaVersion="0000",e.publisherVersion="0.0.0",e.minimumRequiredApiVersion="0.0.0",e.backgroundImageUrl="https://sienatestappgallery.blob.core.windows.net/backgroundimagegallery/0f94216f-6b09-410e-a6c3-3f5a73aaccd6_1701458968_V1.0.1.png",e.backgroundColor="RGBA(0, 176, 240, 1)",e.blobDocumentName="document.msapp",e.blobPackageName="player.msappk",e.blobAssetsName="assets.zip",e.blobLogoSmallName="logoSmallFile",e.blobStableControlIdentityName="identity.json",e.blobWebPlayerRootFolder="web-player/",e.blobWebPlayerIndexFile="index.web.html",e.blobWebPlayerManifestFile="manifest.json",e.galleryItemSource="https://www.microsoft.com"}(Ce||(Ce={})),function(e){e.parametersKey="parameters",e.descriptionJsonPointer="/properties/description",e.documentUriJsonPointer="/properties/outputs/documentUri/value",e.playerPackageUriJsonPointer="/properties/outputs/playerPackageUri/value",e.wadlUrisJsonPointer="/properties/outputs/wadlUris/value"}(Pe||(Pe={})),function(e){e.backgroundColor="backgroundColor",e.displayName="displayName",e.publisher="publisher",e.sienaVersion="sienaVersion",e.publisherVersion="publisherVersion",e.minimumRequiredApiVersion="minimumRequiredApiVersion",e.deviceCapabilities="deviceCapabilities",e.hasComponent="hasComponent",e.hasUnlockedComponent="hasUnlockedComponent",e.isHidden="isHidden",e.isUnifiedRootApp="isUnifiedRootApp",e.templateId="templateId",e.optimizedForTeamsMeeting="optimizedForTeamsMeeting",e.coauthoringEnabled="coauthoringEnabled",e.imageUrl="imageUrl",e.originalImageUrl="originalImageUrl",e.supportsPortrait="supportsPortrait",e.supportsLandscape="supportsLandscape",e.primaryDeviceWidth="primaryDeviceWidth",e.primaryDeviceHeight="primaryDeviceHeight",e.primaryFormFactor="primaryFormFactor",e.localConnectionReferencesJSON="localConnectionReferencesJSON",e.sharePointSiteId="sp-site-id",e.sharePointListId="sp-list-id",e.iconSetting="iconSetting",e.backgroundFillSetting="backgroundFillSetting",e.offlineProfileId="offlineProfileId",e.offlineLargeFilesSupport="offlineLargeFilesSupport",e.showStatusBar="showStatusBar"}(be||(be={})),function(e){e.ChannelAvailability="ChannelAvailability",e.LaunchNativeExperience="LaunchNativeExperience"}(Ae||(Ae={})),function(e){e.defaultPackageFileName="player.msappk",e.defaultDocumentFileName="doc.msapp",e.defaultAssetsFileName="assets.zip",e.defaultLogoSmallFileName="powerAppLogoSmall"}(we||(we={})),function(e){e.docDownloadUrlKey="docDownloadUrl"}(Se||(Se={})),function(e){!function(e){e.gcmSenderId="233986630110"}(e.Prod||(e.Prod={})),function(e){e.gcmSenderId="845762260408"}(e.TestInProd1||(e.TestInProd1={})),function(e){e.gcmSenderId="845762260408"}(e.TestInProd2||(e.TestInProd2={})),function(e){e.gcmSenderId="845762260408"}(e.WebAuthTest||(e.WebAuthTest={})),function(e){e.gcmSenderId="233986630110"}(e.WebAuthProd||(e.WebAuthProd={})),e.registerDeviceApi="registerDeviceNotifications",e.registerDevicePowerPlatformApi="pushNotifications/register",e.unregisterDeviceApi="unregisterDeviceNotifications",e.unregisterDevicePowerPlatformApi="pushNotifications/unregister",e.sendTestNotification="sendTestNotification"}(Ee||(Ee={}));var Be,We,je,qe;!function(e){e.EnvironmentDisplayName="environment.DisplayName",e.UnpublishedAppDefinition="unpublishedAppDefinition",e.UserConsent="consent"}(Be||(Be={})),function(e){e.Metadata="metadata",e.Environment="environment"}(We||(We={})),function(e){e.SupportsMobileCapability="supportsMobileCapability eq 'true'",e.ClassificationFilterUnformatted="classification eq '{0}'"}(je||(je={})),function(e){e.ClassicCanvasApp="ClassicCanvasApp",e.AppComponentLibrary="AppComponentLibrary",e.CustomCanvasPage="CustomCanvasPage",e.UnifiedApp="UnifiedApp"}(qe||(qe={}));var Ge,Je;qe.ClassicCanvasApp,qe.AppComponentLibrary,qe.CustomCanvasPage,qe.UnifiedApp;!function(e){e.CanvasApp="CanvasApp",e.AppModule="AppModule"}(Ge||(Ge={})),function(e){e.msFlowWorkflowName="workflowName",e.msWorkflowEntityId="workflowEntityId",e.msWorkflowDisplayName="workflowDisplayName"}(Je||(Je={}));var Ke;!function(e){e.checkPlans="checkPlans",e.plans="plans",e.features="features",e.tenants="tenants"}(Ke||(Ke={}));var Xe,Ye,Qe;!function(e){e.ConnectorMoreInfoDefaultLink="https://go.microsoft.com/fwlink/?linkid=851284"}(Xe||(Xe={})),function(e){e.SharepointFormApp="SharepointFormApp",e.TeamsApp="TeamsApp"}(Ye||(Ye={})),function(e){e.Enabled="Enabled",e.Expired="Expired"}(Qe||(Qe={}));var Ze,$e;!function(e){e.Environment="Environment",e.Solution="Solution",e.NotSpecified="NotSpecified"}(Ze||(Ze={})),function(e){e.Read="providers/PowerPlatform.Governance/Operations/Read",e.Write="providers/PowerPlatform.Governance/Operations/Write",e.Delete="providers/PowerPlatform.Governance/Operations/Delete"}($e||($e={}));var et,tt,nt,rt,it;function ot(e){var t=[],n=e.controls;for(var r in n)r&&t.push(r.toLowerCase());return t}function at(e){var t={};e.staticDependencies&&e.staticDependencies.forEach((function(e){t[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl}));var n=e.controlDependencies;for(var r in n)r&&n[r].forEach((function(e){e&&e.sourcePath&&(t[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl)}));return t}function st(e){var t=[];return(null==e?void 0:e.app)&&(t=e.app),t}function ct(e){var t,n={};return(null===(t=null==e?void 0:e.dataComponentDependencies)||void 0===t?void 0:t.expressionRuntime)&&e.dataComponentDependencies.expressionRuntime.forEach((function(e){n[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl})),n}function lt(e,t){var n,r=[];return(null===(n=null==e?void 0:e.dataComponentDependencies)||void 0===n?void 0:n[t])&&(r=e.dataComponentDependencies[t]),r}!function(e){e[e.InternalServerError=500]="InternalServerError",e[e.ServiceUnavailable=503]="ServiceUnavailable"}(et||(et={})),function(e){e.PublishedAppGetAppDetails="PublishedAppGetAppDetails",e.WebPlayerDownloadManifest="WebPlayerDownloadManifest",e.WebPlayerDownloadManifestRetry="WebPlayerDownloadManifestRetry",e.WebPlayerDownloadIndex="WebPlayerDownloadIndex",e.WebPlayerDownloadIndexRetry="WebPlayerDownloadIndexRetry",e.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata="PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata"}(tt||(tt={})),function(e){e[e.split=0]="split",e[e.zip=1]="zip",e[e.unknown=2]="unknown"}(nt||(nt={})),function(e){e.WebPackageUrl="WebPackageUrl",e.UnauthenticatedWebPackageUrl="UnauthenticatedWebPackageUrl"}(rt||(rt={})),function(e){e[e.NotStart=0]="NotStart",e[e.InProgress=1]="InProgress",e[e.Processed=2]="Processed",e[e.Error=3]="Error"}(it||(it={}));var ut,pt=function(){function e(e,t){this._indexHtmlDownloader=e.indexHtmlDownloader,this._manifestJsonDownloader=e.manifestJsonDownloader,this._telemetryLogger=e.telemetryLogger,this._appMetadataResponseProcessor=e.appMetadataResponseProcessor,this._config=t,this._isInDebugMode=this._checkIfUsingDebugConfig(this._config.debugConfig)}return e.prototype._checkIfUsingDebugConfig=function(e){return e&&"string"==typeof e.publishedAppResourceHash&&"string"==typeof e.publishedAppResourceUrl},e.prototype._scrubOtherSensitiveDataSafe=function(e){var t=this;try{if(new RegExp(/(password|token|key|sig)/i).test(e)){var n=e;return["password","token","key","sig"].forEach((function(e){n=t._replaceRestOfStringIfFound(n,e,"_scrubbedSensitiveData_")})),n.toString()}return e}catch(e){return this._telemetryLogger.trackErrorEvent("BasePublishedAppMetadataParser._scrubOtherSensitiveDataSafe",{errorMessage:e.message,message:"Failed to scrub sensitive data from the URL"}),""}},e.prototype._replaceRestOfStringIfFound=function(e,t,n){return e.toLowerCase().indexOf(t)>0?e.replace(e.substring(e.toLowerCase().indexOf(t)),n):e},e.prototype.setAppDetails=function(t,n,r,i,o,a,s){var c=e._getSASKeyExpiryDate(t).getTime(),l=Date.now()+9e5,u=this._scrubOtherSensitiveDataSafe(t),p=this._scrubOtherSensitiveDataSafe(n);c<l?this._telemetryLogger.trackErrorEvent("BasePublishedAppMetadataParser.setAppDetails",{scrubbedIndexWebHtmlUrl:u,scrubbedReadonlyIndexWebHtmlUrl:p,source:s,errorMessage:"SAS key expired or very close to expire."}):(this._telemetryLogger.trackActivityEvent("BasePublishedAppMetadataParser.setAppDetails",{documentServerVersion:i?JSON.stringify(i):"",scrubbedIndexWebHtmlUrl:u,scrubbedReadonlyIndexWebHtmlUrl:p,source:s}),this._appVersion=o,this._updatedHash=a,this._primaryWebPlayerPackageUrl=t,this._secondaryWebPlayerPackageUrl=n,this._appPackageResourcesKind=r,this._documentServerVersion=i,this._packageKind=this._getPackageKindConfig(r,{isInDebugMode:this._isInDebugMode,isWebPlayerBVT:this._config.isWebPlayerBVT}),this._primaryWebPlayerManifestUrl=this._primaryWebPlayerPackageUrl.replace("index.web.html","manifest.json"),this._secondaryWebPlayerManifestUrl=this._secondaryWebPlayerPackageUrl.replace("index.web.html","manifest.json"),this._currentWebPlayerPackageUrl=this._primaryWebPlayerPackageUrl,this._currentWebPlayerManifestUrl=this._primaryWebPlayerManifestUrl,this._overrideSVGUpdateFunction=!i||i.minor<18e3&&i.major<3,this._overrideSVGUpdateFunction&&this._telemetryLogger.trackActivityEvent("WebPlayer.SVGUpdate.OverrideFunction"),this._isAppMetadataSet=!0)},e.prototype.getAppDetails=function(e,t){var n=this;if(!this._config.isWebPlayer)throw this._telemetryLogger.error("PublishedAppMetadataParser.getAppDetails","GetAppDetails should only be called in web player"),"Not supported";this._isAppMetadataSet||e.onFailure(new Error("Please make sure you call setAppDetails first"));var r,i,o,a,s,c,l,u=this._telemetryLogger.startScenario(tt.PublishedAppGetAppDetails,new Date,{}),p={manifestType:"publishedApp"},d=this._telemetryLogger.startScenario(tt.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata,new Date,__assign(__assign({},p),{operationName:"PlayerLifecycle.PlayerSDK.PlayApp.LoadMetadata.FetchAppPackageMetadata"}));this._telemetryLogger.updateOpenAppData({playerResourcesSplitEnabled:this._packageKind===nt.split});var g=this._generateEmptyError(),h=this._generateEmptyError(),m=it.NotStart,f=it.NotStart;m=it.InProgress,this._downloadResourceImpl("manifest",{onSuccess:function(t){if(r=n._appMetadataResponseProcessor.getWebPlayerZipDetails(t,n._packageKind,n._isInDebugMode),i=n._appMetadataResponseProcessor.getSplitPackageDetails(t,n._packageKind),o=n._appMetadataResponseProcessor.generateWebPlayerDetails(n._currentWebPlayerPackageUrl),a=n._appMetadataResponseProcessor.generateWebPlayerResourceDetails(),c=n._appMetadataResponseProcessor.getDataComponentPackageDetails(t,n._packageKind),l=n._appMetadataResponseProcessor.getComponentLibraryPackageDetails(t,n._packageKind),m=it.Processed,f===it.Processed){n._telemetryLogger.endScenario(u),n._telemetryLogger.endScenario(d,p);var y={packageKind:n._packageKind,webPlayerZipDetails:r,webPlayerPackageDetails:o,webPlayerResourceDetails:a,splitPackageDetails:i,scriptPackageDetails:s,overrideSVGUpdateFunction:n._overrideSVGUpdateFunction,appVersion:n._appVersion,appId:n._config.appId};c&&(y.dataComponentPackageDetails=c),l&&(y.componentLibraryPackageDetails=l),e.onSuccess(y)}else f===it.Error&&(n._telemetryLogger.failScenario(u,{}),n._telemetryLogger.failScenario(d,{customScenarioData:__assign({manifestParsingState:n._getProcessStateString(m),htmlParsingState:n._getProcessStateString(f)},p)}),e.onFailure(n._mergeErrorMessage(g,h)))},onFailure:function(t){g=t,m=it.Error,f!==it.Processed&&f!==it.Error||(n._telemetryLogger.failScenario(u,{}),n._telemetryLogger.failScenario(d,{customScenarioData:__assign({manifestParsingState:n._getProcessStateString(m),htmlParsingState:n._getProcessStateString(f)},p)}),e.onFailure(n._mergeErrorMessage(g,h)))}},t,!0),f=it.InProgress,this._downloadResourceImpl("index",{onSuccess:function(t){if(s=n._appMetadataResponseProcessor.generateScriptPackageDetails(t,n._updatedHash),f=it.Processed,m===it.Processed){n._telemetryLogger.endScenario(u),n._telemetryLogger.endScenario(d,p);var y={packageKind:n._packageKind,webPlayerZipDetails:r,webPlayerPackageDetails:o,webPlayerResourceDetails:a,splitPackageDetails:i,scriptPackageDetails:s,overrideSVGUpdateFunction:n._overrideSVGUpdateFunction,appVersion:n._appVersion,appId:n._config.appId};c&&(y.dataComponentPackageDetails=c),l&&(y.componentLibraryPackageDetails=l),e.onSuccess(y)}else m===it.Error&&(n._telemetryLogger.failScenario(u,{}),n._telemetryLogger.failScenario(d,{customScenarioData:__assign({manifestParsingState:n._getProcessStateString(m),htmlParsingState:n._getProcessStateString(f)},p)}),e.onFailure(n._mergeErrorMessage(g,h)))},onFailure:function(t){h=t,f=it.Error,m!==it.Processed&&m!==it.Error||(n._telemetryLogger.failScenario(u,{}),n._telemetryLogger.failScenario(d,{customScenarioData:__assign({manifestParsingState:n._getProcessStateString(m),htmlParsingState:n._getProcessStateString(f)},p)}),e.onFailure(n._mergeErrorMessage(g,h)))}},t,!0)},e.prototype.getAppBaseMetadata=function(){return{indexWebHtmlUrl:this._primaryWebPlayerPackageUrl,readonlyIndexWebHtmlUrl:this._secondaryWebPlayerPackageUrl,appPackageResourcesKind:this._appPackageResourcesKind,documentServerVersion:this._documentServerVersion,appVersion:this._appVersion}},e.prototype._generateEmptyError=function(){var e=new Error;return e.name="",e.message="",e.stack="",e},e.prototype._mergeErrorMessage=function(e,t){var n=new Error;return n.name="Failed to get and parse appMetadata",n.message=e.message+"\n"+t.message,n.stack=e.stack+"\n"+t.stack,n},e.prototype.getAppControls=function(e,t){var n=this;this._downloadResourceImpl("manifest",{onSuccess:function(t){var r=n._appMetadataResponseProcessor.parseControlsListFromManifest(t);e.onSuccess(r)},onFailure:function(t){e.onFailure(t)}},t,!0)},e.prototype.getAppDependencies=function(e,t){this._downloadResourceImpl("manifest",{onSuccess:function(t){e.onSuccess(t)},onFailure:function(t){e.onFailure(t)}},t,!0)},e.prototype._downloadResourceImpl=function(e,t,n,r){var i=this,o="index"===e?tt.WebPlayerDownloadIndex:tt.WebPlayerDownloadManifest;r?"index"===e?this._currentWebPlayerPackageUrl=this._primaryWebPlayerPackageUrl:this._currentWebPlayerManifestUrl=this._primaryWebPlayerManifestUrl:"index"===e?this._currentWebPlayerPackageUrl=this._secondaryWebPlayerPackageUrl:this._currentWebPlayerManifestUrl=this._secondaryWebPlayerManifestUrl;var a="index"===e?this._indexHtmlDownloader:this._manifestJsonDownloader,s=this._telemetryLogger.startScenario(o,new Date),c={url:"index"===e?this._currentWebPlayerPackageUrl:this._currentWebPlayerManifestUrl,method:"GET"};a.downloadResource(c,{onSuccess:function(e){i._telemetryLogger.endScenario(s),t.onSuccess(e)},onFailure:function(n){var o="index"===e?"Failed to download indexWebHtml":"Failed to download manifest";i._telemetryLogger.failScenario(s,{message:o}),r?i._downloadResourceImpl(e,t,!0,!1):t.onFailure(n)}},n)},e._getSASKeyExpiryDate=function(e){var t=this.getUrlParams(e,"se");return new Date(decodeURIComponent(t))},e.getUrlParams=function(e,t){var n=new RegExp("[?&]"+t+"=([^&#]*)").exec(e);return null==n?null:decodeURI(n[1])||null},e.isSASKeyExpired=function(e){var t=this._getSASKeyExpiryDate(e);return(new Date).getTime()>t.getTime()},e.getTimeUntilSASRenewalInMs=function(e){var t=this._getSASKeyExpiryDate(e).getTime();if(!isNaN(t)){var n=t-(new Date).getTime(),r=Math.floor(51*Math.random())+10;(r<10||r>60)&&(r=10);var i=n-(r*=6e4);return i<=0?0:i}},e.prototype._getPackageKindConfig=function(e,t){var n;return n=nt.zip,t.isWebPlayerBVT||t.isInDebugMode||(n="split"===(null==e?void 0:e.toLocaleLowerCase())?nt.split:nt.zip),n},e.prototype._getProcessStateString=function(e){var t="";switch(e){case it.NotStart:t="NotStarted";break;case it.InProgress:t="InProgress";break;case it.Processed:t="Processed";break;case it.Error:t="Error"}return t},e}(),dt=function(){function e(e){this._fetchResource=e,this._callbackArray=[],this._isDownloading=!1,this._cacheResource=void 0}return e.prototype.downloadResource=function(e,t,n){if(!this._isDownloading)return n?(this._cacheResource=void 0,void this._downloadResourceImpl(e,t,n)):void(this._cacheResource?t.onSuccess(this._cacheResource):this._downloadResourceImpl(e,t));this._callbackArray.push(t)},e.prototype._downloadResourceImpl=function(e,t,n){var r=this;this._callbackArray.push(t),this._isDownloading=!0,this._fetchResource(e,{onSuccess:function(e){r._cacheResource=e,r._isDownloading=!1;for(var t=r._callbackArray.length,n=0;n<t;n++){r._callbackArray.shift().onSuccess(e)}},onFailure:function(e){r._isDownloading=!1;for(var t=r._callbackArray.length,n=0;n<t;n++){r._callbackArray.shift().onFailure(e)}}},n)},e}(),gt=function(){function e(e){this._config=e}return e.prototype.getWebPlayerZipDetails=function(e,t,n){var r=null;if(t===nt.zip){var i=this._config.cdnPath,o=null;n&&(i=this._config.debugConfig.publishedAppResourceUrl,o=this._config.debugConfig.publishedAppResourceHash),"/"!==i.charAt(i.length-1)&&(i+="/"),null===o&&(o=e.hash),r={rootPath:i+=o+"/PlayerResources/"}}return r},e.prototype.getSplitPackageDetails=function(e,t){return t===nt.split?{appDependencies:at(e),nonSharedAppResources:st(e)}:null},e.prototype.getDataComponentPackageDetails=function(e,t){return t===nt.split&&(null==e?void 0:e.dataComponentDependencies)?{expressionRuntime:ct(e),scripts:lt(e,"scripts"),metadata:lt(e,"metadata")}:void 0},e.prototype.getComponentLibraryPackageDetails=function(e,t){return t===nt.split&&(null==e?void 0:e.componentNameMap)&&(null==e?void 0:e.expressionRuntime)?{componentNameMap:e.componentNameMap,expressionRuntime:e.expressionRuntime.map((function(e){var t;return(t={})[e.sourcePath.toLocaleLowerCase()]=e.sourceUrl,t})).reduce((function(e,t){return __assign(__assign({},e),t)}))}:void 0},e.prototype.generateWebPlayerResourceDetails=function(){var e={};if(void 0!==window.ResourceLoader){e["js/MessageWorker.js"]=window.ResourceLoader.mapResourceUrl(document,"js/MessageWorker.js")}return{resourceMap:e}},e.prototype.generateWebPlayerDetails=function(e){var t=(e=e.split("#")[0]).split("?")[1];return e.indexOf("index.web.html?")>=0?{host:e.replace("index.web.html?","").replace(t,""),queryString:"?"+t,proxyPath:this._config.webPlayerProxyUrl,timeUntilSASRenewalInMs:pt.getTimeUntilSASRenewalInMs(e)}:{host:e.replace("index.web.html",""),queryString:"",proxyPath:this._config.webPlayerProxyUrl}},e.prototype.generateScriptPackageDetails=function(e,t){var n=function(e){for(var t,n,r,i,o=(new DOMParser).parseFromString(e,"text/html").head.getElementsByTagName("script"),a=[],s=0;s<o.length;s++){var c=o[s].text;-1!==c.indexOf("AppResources")?t=o[s].innerText:-1!==c.indexOf("AppPrefetchResources")?n=o[s].innerText:-1!==c.indexOf("LanguageSpecificResources")?r=o[s].innerText:-1!==c.indexOf("PowerAppsTitle")?i=o[s].innerText:a.push(o[s].outerHTML)}return{appResourcesScript:t,prefetchAppResourcesScript:n,languageResourcesScript:r,powerAppsTitleScript:i,headerScripts:a}}(e);return{appResources:null==n?void 0:n.appResourcesScript,appLoadLinkResources:null==n?void 0:n.prefetchAppResourcesScript,languageSpecificResources:null==n?void 0:n.languageResourcesScript,powerAppsTitle:null==n?void 0:n.powerAppsTitleScript,headerScripts:null==n?void 0:n.headerScripts,updatedHash:t}},e.prototype.parseControlsListFromManifest=function(e){return ot(e)},e.prototype.parseNestedCanvasAppsFromManifest=function(e){return function(e){return e.nestedCanvasApps}(e)},e}(),ht=function(e){function t(t,n,r,i,o){var a=e.call(this,{indexHtmlDownloader:new dt((function(e,t,n){return a._sendHttpTextResponseAsync(e,t,n)})),manifestJsonDownloader:new dt((function(e,t,n){return a._sendHttpJsonResponseAsync(e,t,n)})),telemetryLogger:o||new mt,appMetadataResponseProcessor:new gt(n)},n)||this;return a._httpClient=t,a._listPackageClient=r,a._loadedPromise=new Promise((function(e){a._loadedPromiseResolve=e})),a._cache=i,a}return __extends(t,e),t.prototype._sendHttpTextResponseAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var r,i;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),r=void 0,!this._cachedMetadata||n?[3,1]:(r=this._cachedMetadata.indexWebHtml,[3,3]);case 1:return[4,this._httpClient.sendHttpTextResponseAsync(e)];case 2:r=o.sent(),this._checkIfUpdateCache(r,null),o.label=3;case 3:return t.onSuccess(r),[3,5];case 4:return i=o.sent(),t.onFailure(i),[3,5];case 5:return[2]}}))}))},t.prototype._sendHttpJsonResponseAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var r,i;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,4,,5]),r=void 0,!this._cachedMetadata||n?[3,1]:(r=JSON.parse(this._cachedMetadata.manifestJson),[3,3]);case 1:return[4,this._httpClient.sendHttpJsonResponseAsync(e)];case 2:r=o.sent(),this._checkIfUpdateCache(null,r),o.label=3;case 3:return t.onSuccess(r),[3,5];case 4:return i=o.sent(),t.onFailure(i),[3,5];case 5:return[2]}}))}))},t.prototype._checkIfUpdateCache=function(e,t){if(!this._indexWebHtml&&e&&(this._indexWebHtml=e),!this._manifestJsonObject&&t&&(this._manifestJsonObject=t),this._cache&&!this._cacheUpdate&&this._manifestJsonObject&&this._indexWebHtml){var n={indexWebHtml:this._indexWebHtml,manifestJson:JSON.stringify(this._manifestJsonObject)},r=pt._getSASKeyExpiryDate(this._currentWebPlayerPackageUrl);this._cache.setCachedPublishedAppMetadataLater(this._config.appId,this._currentWebPlayerPackageUrl,r,n),this._cacheUpdate=!0}},t.prototype.setAppDetails=function(t,n,r,i,o,a,s){e.prototype.setAppDetails.call(this,t,n,r,i,o,a,s),this._loadCacheDataAsync()},t.prototype._loadCacheDataAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return this._cache?(e=this,[4,this._cache.getCachedPublishedAppMetadataAsync(this._config.appId,this._currentWebPlayerPackageUrl)]):[3,2];case 1:e._cachedMetadata=t.sent(),t.label=2;case 2:return this._cachedMetadata&&this._telemetryLogger.trackActivityEvent("PublishedAppMetadataParser.usingCachedData"),this._loadedPromiseResolve(),[2]}}))}))},t.prototype.getAppDetails=function(e,t){this._getAppDetailsAsync(e,t)},t.prototype._getAppDetailsAsync=function(t,n){return __awaiter(this,void 0,Promise,(function(){var r;return __generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._loadedPromise];case 1:return i.sent(),e.prototype.getAppDetails.call(this,t,n),[3,3];case 2:return r=i.sent(),t.onFailure(r),[3,3];case 3:return[2]}}))}))},t.prototype.refreshWebPlayerPackageDetails=function(e){this._refreshWebPlayerPackageDetailsAsync(e)},t.prototype._refreshWebPlayerPackageDetailsAsync=function(e){var t;return __awaiter(this,void 0,Promise,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,this._listPackageClient.value.listPackageAsync()];case 1:return n=i.sent(),(null===(t=null==n?void 0:n.result)||void 0===t?void 0:t.webPackageUri)?e.onSuccess(this._appMetadataResponseProcessor.generateWebPlayerDetails(n.result.webPackageUri.value)):(null==n?void 0:n.error)?(Core.Telemetry.Log.trackErrorEvent("ListPackage failed when getting new SAS key",{error:n.error}),e.onFailure(n.error)):e.onFailure(new Error("Unknown Error in PublishedAppMetadataParser.refreshWebPlayerPackageDetailsAsync")),[3,3];case 2:return r=i.sent(),e.onFailure(r),[3,3];case 3:return[2]}}))}))},t.prototype.getAppControls=function(t,n){Core.Environment.isPublishedAppExternalToHost()&&Core.Environment.publishedAppHasCachedFiles()?this._getAppControlsAsync(t):e.prototype.getAppControls.call(this,t,n)},t.prototype._getAppControlsAsync=function(t,n){return __awaiter(this,void 0,Promise,(function(){var r,i,o,a;return __generator(this,(function(s){switch(s.label){case 0:r=Core.Loader.ObjectFactory.instance.getSingleton(Core.Player.IHostMessageProviderSingletonKey),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,r.getManifestJsonAsync()];case 2:return i=s.sent(),o=JSON.parse(i),t.onSuccess(ot(o)),[3,4];case 3:return a=s.sent(),Core.Log.errorEx("PowerAppsClient.InstallApp.Error",{error:a,message:"Error occurred parsing the manifest json to get app controls"}),e.prototype.getAppControls.call(this,t,n),[3,4];case 4:return[2]}}))}))},t}(pt),mt=function(){function e(){}return e.prototype.trackActivityEvent=function(e,t){Core.Telemetry.Log.trackActivityEvent(e,t)},e.prototype.trackErrorEvent=function(e,t,n){Core.Telemetry.Log.trackErrorEvent(e,t,n)},e.prototype.error=function(e,t){Core.Log.errorEx(e,t)},e.prototype.startScenario=function(e,t,n){var r;switch(e){case tt.PublishedAppGetAppDetails:r=Core.Telemetry.ScenarioName.PublishedAppGetAppDetails;break;case tt.WebPlayerDownloadManifest:r=Core.Telemetry.ScenarioName.WebPlayerDownloadManifest;break;case tt.WebPlayerDownloadManifestRetry:r=Core.Telemetry.ScenarioName.WebPlayerDownloadManifestRetry;break;case tt.WebPlayerDownloadIndex:r=Core.Telemetry.ScenarioName.WebPlayerDownloadIndex;break;case tt.WebPlayerDownloadIndexRetry:r=Core.Telemetry.ScenarioName.WebPlayerDownloadIndexRetry;break;case tt.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata:r=Core.Telemetry.ScenarioName.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata}return Core.Telemetry.Log.startScenario(r,n,t)},e.prototype.endScenario=function(e,t){return Core.Telemetry.Log.endScenario(e,t)},e.prototype.updateOpenAppData=function(e){Core.Telemetry.Log.updateOpenAppData(e)},e.prototype.failScenario=function(e,t){Core.Telemetry.Log.failScenario(e,t)},e}(),ft=function(){function e(e,t){this._childCanvasAppLogicalName=e,this._childCanvasAppId=t}return e.prototype.trackActivityEvent=function(e,t){var n=Le.getCustomPageTelemetryData({appId:this._childCanvasAppId,appLogicalName:this._childCanvasAppLogicalName});Core.Telemetry.Log.trackActivityEvent(e,__assign(__assign({},t),n))},e.prototype.trackErrorEvent=function(e,t,n){var r=Le.getCustomPageTelemetryData({appId:this._childCanvasAppId,appLogicalName:this._childCanvasAppLogicalName});Core.Telemetry.Log.trackErrorEvent(e,__assign(__assign({},t),r),n)},e.prototype.error=function(e,t){var n=Le.getCustomPageTelemetryData({appId:this._childCanvasAppId,appLogicalName:this._childCanvasAppLogicalName}),r=__assign({message:t},n);Core.Log.errorEx(e,JSON.stringify(r))},e.prototype.startScenario=function(e,t,n){var r;switch(e){case tt.PublishedAppGetAppDetails:r=Core.Telemetry.ScenarioName.PublishedAppGetAppDetails;break;case tt.WebPlayerDownloadManifest:r=Core.Telemetry.ScenarioName.WebPlayerDownloadManifest;break;case tt.WebPlayerDownloadManifestRetry:r=Core.Telemetry.ScenarioName.WebPlayerDownloadManifestRetry;break;case tt.WebPlayerDownloadIndex:r=Core.Telemetry.ScenarioName.WebPlayerDownloadIndex;break;case tt.WebPlayerDownloadIndexRetry:r=Core.Telemetry.ScenarioName.WebPlayerDownloadIndexRetry;break;case tt.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata:r=Core.Telemetry.ScenarioName.PlayerLifecyclePlayerSDKPlayAppLoadMetadataFetchAppPackageMetadata}var i=Le.getCustomPageTelemetryData({appId:this._childCanvasAppId,appLogicalName:this._childCanvasAppLogicalName});return Core.Telemetry.Log.startScenario(r,__assign(__assign({},n),i),t)},e.prototype.endScenario=function(e,t){var n=Le.getCustomPageTelemetryData({appId:this._childCanvasAppId,appLogicalName:this._childCanvasAppLogicalName});return Core.Telemetry.Log.endScenario(e,__assign(__assign({},t),n))},e.prototype.updateOpenAppData=function(e){Core.Telemetry.Log.updateOpenAppData(e)},e.prototype.failScenario=function(e,t){Core.Telemetry.Log.failScenario(e,t)},e}(),yt=function(){function e(e,t,n,r,i,o,a,s,c){this._httpClient=e,this._lazyAppResourceManager=t,this._baseConfig=n,this._initializeAppConnections=r,this._lazyAppType=i,this._lazyListPackageClient=o,this._rootAppMetadataParser=a,this._cache=s,this._initializePromise=c,this._operationNamePrefix="AppModuleManager",this._metadataParserMap=HashTableUtility.create(),this._rootAppMetadataParser&&(this._rootAppDetailsPromise=this.getRootAppMetadataAsync(!1))}return e.prototype.getRootAppMetadataAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o;return __generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this._initializePromise];case 1:if(t=a.sent(),!this._rootAppMetadataParser)throw new Error("root app metadata parser is null or undefined");return i=new Promise((function(e,t){n=e,r=t})),this._rootAppMetadataParser.getAppDetails({onSuccess:n,onFailure:r},e,null==t?void 0:t.appName),[2,i];case 2:throw o=a.sent(),this._handleError(o,"".concat(this._operationNamePrefix,".GetRootAppMetadata.Failure"),{});case 3:return[2]}}))}))},e.prototype.getCanvasAppMetadataAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,i,o,a,s;return __generator(this,(function(c){switch(c.label){case 0:return c.trys.push([0,10,,11]),[4,this._initializePromise];case 1:if(c.sent(),!e)throw Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".getCanvasAppMetadata.Failure"),{message:"appLogicalName is null or undefined"}),new Error("appLogicalName is null or undefined");return n=new ft(e),this._metadataParserMap[e]?[4,this._getAppDetailsAsync(e,n,t)]:[3,3];case 2:return[2,c.sent()];case 3:return r=void 0,Core.FeatureGates.appHost.enableRootAppMetadataByLogicalName&&this._lazyAppType.value===qe.UnifiedApp?[4,this._verifyCanvasAppExistsInRootAppManifest(e)]:[3,5];case 4:return c.sent(),r=this._childCanvasMetadataParser(e,n),[3,8];case 5:return[4,this._getAppIdFromLogicalNameAsync(e)];case 6:if((i=c.sent()).errorMessage)throw new Error(i.errorMessage);return o=i.appId,[4,this._getCanvasAppPreloadDataAsync(o,t)];case 7:if(!(a=c.sent()))throw new Error("the canvasAppPreloadData is null or undefined");this._initializeAppConnections(a),n=new ft(e,o),r=this._createCanvasAppMetadataParser(e,o,a.appPreloadData,n),c.label=8;case 8:if(!r)throw new Error("the metadata parser is null or undefined");return n.trackActivityEvent("".concat(this._operationNamePrefix,".CreateNewParser")),this._metadataParserMap[e]=r,[4,this._getAppDetailsAsync(e,n,t)];case 9:return[2,c.sent()];case 10:throw s=c.sent(),this._handleError(s,"".concat(this._operationNamePrefix,".getCanvasAppMetadata.Failure"),{customPage:e||"undefined"});case 11:return[2]}}))}))},e.prototype.getChildComponentLibraryMetadataAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,i,o=this;return __generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,3,,4]),[4,this._initializePromise];case 1:if(a.sent(),!e)throw new Error("componentLibraryLogicalName is empty, null or undefined");if(this._lazyAppType.value!==qe.UnifiedApp)throw new Error("Nested components are only nested inside root apps");return[4,this.getCanvasAppMetadataAsync(e,t)];case 2:if(!(n=a.sent()).componentLibraryPackageDetails)throw new Error("".concat(e," is not a component library - missing componentLibraryPackageDetails"));return r=this._rootAppMetadataParser.getAppBaseMetadata().indexWebHtmlUrl,Object.keys(n.componentLibraryPackageDetails.componentNameMap).forEach((function(t){n.componentLibraryPackageDetails.componentNameMap[t]=o._resolveFullMetadataPaths(r,e,n.componentLibraryPackageDetails.componentNameMap[t])})),[2,n];case 3:throw i=a.sent(),this._handleError(i,"".concat(this._operationNamePrefix,".getNestedComponentLibraryMetadataAsync.Failure"),{componentLibrary:e||"undefined"});case 4:return[2]}}))}))},e.prototype.isSharedAppHostError=function(e){return null==e?void 0:e.code},e.prototype._handleError=function(e,t,n){if(this.isSharedAppHostError(e))return Core.Telemetry.Log.trackErrorEvent(t,__assign({code:e.code,message:e.message},n)),e;var r=this._createErrorObject(e);return Core.Telemetry.Log.trackErrorEvent(t,__assign({message:r.message,stack:r.stack},n)),r},e.prototype._handleCustomPageNotFound=function(e){throw Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".getCanvasAppMetadata.Failure"),{message:e}),new Error("Child Canvas app is not found in root app manifest")},e.prototype._verifyCanvasAppExistsInRootAppManifest=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i;return __generator(this,(function(o){switch(o.label){case 0:if(!this._rootAppDetailsPromise)throw new Error("_verifyCanvasAppExsitsInRootAppMnaifest invoked without being in root app mode.");return t=Date.now(),[4,this._rootAppDetailsPromise];case 1:if(!(n=o.sent()))throw Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".getCanvasAppMetadata.Failure"),{message:"rootAppDetails is null or undefined."}),new Error("Root app metadata parser failed");return n.nestedCanvasApps||this._handleCustomPageNotFound("rootAppDetails.nestedCanvasApps is null or undefined."),n.nestedCanvasApps.some((function(t){var n;return(null===(n=null==t?void 0:t.logicalName)||void 0===n?void 0:n.toLowerCase())===e.toLowerCase()}))||this._handleCustomPageNotFound("Child Canvas app is not found in root app manifest."),r=Date.now(),i=r-t,Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,"._verifyCanvasAppExistsInRootAppManifest.Success"),{duration:i}),[2]}}))}))},e.prototype._createErrorObject=function(e){return e?"string"==typeof e?new Error(e):e:new Error("Unknown error occurred")},e.prototype._resolveFullMetadataPaths=function(e,t,n){if(e.indexOf("manifest.json")<0)throw new Error("Root app url is incorrect, missing '".concat("manifest.json","'"));return t=t.toLowerCase(),{initJs:e.replace("manifest.json","".concat(t,"/web/js/").concat(n.initJs)),dependencyInfo:e.replace("manifest.json","".concat(t,"/web/componentMetadata/").concat(n.dependencyInfo))}},e.prototype._generateCanvasAppUrlFromRootApp=function(e,t){var n=e.indexOf("manifest.json");if(n<0)throw Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,"._generateCanvasAppUrlFromRootApp"),{message:"IndexWebHtml Url for root app is incorrect, missing '".concat("manifest.json","'. URL: ").concat(e)}),new Error("Root app metadata parser failed");return t=t.toLowerCase(),[e.slice(0,n),"".concat(t,"/web/").concat("index.web.html"),e.slice("manifest.json".length+n)].join("")},e.prototype._getAppDetailsAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var r=this;return __generator(this,(function(i){return this._metadataParserMap[e]?[2,new Promise((function(i,o){return __awaiter(r,void 0,void 0,(function(){var r=this;return __generator(this,(function(a){return this._metadataParserMap[e].getAppDetails({onSuccess:function(e){i(e),t.trackActivityEvent("".concat(r._operationNamePrefix,".GetAppDetails.Success"))},onFailure:function(e){t.trackErrorEvent("".concat(r._operationNamePrefix,".GetAppDetails.Failure"),{message:e.message,stack:e.stack}),AppMagic.Services.errorHasHttpResponse(e)&&e.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.NotFound&&r._lazyAppType.value===qe.UnifiedApp&&o(new Error("Child canvas app not found in root app manifest")),o(new Error("Child canvas app metadata parser failed"))}},!!n),[2]}))}))}))]:[2,null]}))}))},e.prototype._getAppIdFromLogicalNameAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s;return __generator(this,(function(c){switch(c.label){case 0:return e?this._baseConfig.environmentNameAsyncLazy.isValueCreated&&this._baseConfig.environmentNameAsyncLazy.value?[3,2]:[4,this._baseConfig.environmentNameAsyncLazy.valueAsync()]:[2,{appId:null,errorMessage:"logical name is null or undefined"}];case 1:if(!c.sent())return[2,{appId:null,errorMessage:"environmentName is null or undefined"}];c.label=2;case 2:return(t=new Core.UrlBuilder(AppMagic.PowerApps.PowerAppsUtility.getBaseUrl())).appendPath("/providers/Microsoft.PowerApps/environments/".concat(this._baseConfig.environmentNameAsyncLazy.value,"/apps/").concat(e)),n=new AppMagic.Services.BodilessHttpRequestBuilder,AppMagic.PowerApps.PowerAppsUtility.authorizeHttpBuilder(n,AppMagic.Services.HttpConstants.Method.GET,t.toUrl(),AppMagic.Runtime.Client.ResourceNames.PowerAppsService),r=null,i=null,o=n.generateSendHttpRequestParameters(),[4,this._httpClient.sendHttpJsonResponseAsync(o)];case 3:return(a=c.sent())?(null==(s=AppMagic.PowerApps.AppInfo.deserialize(a))?void 0:s.id)?r=s.id:i="appInfo or app id is null. Something may go wrong in appInfo deserializion":i="network response of getting appInfo is null or undefined",[2,{appId:r,errorMessage:i}]}}))}))},e.prototype._getCanvasAppPreloadDataAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(n){switch(n.label){case 0:return e?[4,this._lazyAppResourceManager.value.getAppPreloadDataAsync(e,!!t,!1,!0,0)]:[2,null];case 1:return[2,n.sent()]}}))}))},e.prototype._createCanvasAppMetadataParser=function(e,t,n,r){if(!e||!t||!this._isCanvasAppPreloadDataValid(n))return null;var i=this._generateCanvasAppMetadataParserConfig(t),o=new ht(this._httpClient,i,this._lazyListPackageClient,this._cache,r);return o.setAppDetails(n.webPackageUrl,n.webReadOnlyPackageUrl,n.appPackageResourcesKind,n.documentServerVersion,n.appVersion,null,"".concat(this._operationNamePrefix,"._createCanvasAppMetadataParser")),o},e.prototype._childCanvasMetadataParser=function(e,t){if(!e||!this._rootAppMetadataParser)return null;var n=this._rootAppMetadataParser.getAppBaseMetadata();if(!n.indexWebHtmlUrl||!n.readonlyIndexWebHtmlUrl)throw t.trackErrorEvent("".concat(this._operationNamePrefix,"._childCanvasMetadataParser"),{message:"indexWebHtmlUrl and/or readonlyIndexWebHtmlUrl from root app metadata are undefined."}),new Error("Root app metadata parser failed");var r=this._generateCanvasAppMetadataParserConfig(e),i=new ht(this._httpClient,r,this._lazyListPackageClient,this._cache,t),o=this._generateCanvasAppUrlFromRootApp(n.indexWebHtmlUrl,e),a=this._generateCanvasAppUrlFromRootApp(n.readonlyIndexWebHtmlUrl,e);return i.setAppDetails(o,a,n.appPackageResourcesKind,n.documentServerVersion,n.appVersion,null,"".concat(this._operationNamePrefix,"._childCanvasMetadataParser")),t.trackActivityEvent("".concat(this._operationNamePrefix,".rootAppCanvasAppMetadataParser.Success")),i},e.prototype._isCanvasAppPreloadDataValid=function(e){return!!(e&&e.webPackageUrl&&e.webReadOnlyPackageUrl&&e.appPackageResourcesKind)},e.prototype._generateCanvasAppMetadataParserConfig=function(e){return __assign(__assign({},this._baseConfig),{appId:e})},e}();!function(e){e.themeChanged="themeChanged",e.onSaved="onSaved",e.onRemoved="onRemoved",e.backButtonClicked="backButtonClicked",e.onChangedSettings="onChangedSettings",e.appButtonHoverEnter="appButtonHoverEnter",e.appButtonHoverLeave="appButtonHoverLeave",e.appButtonClicked="appButtonClicked",e.taskSubmitted="taskSubmitted",e.startedConversation="startedConversation",e.closedConversation="closedConversation"}(ut||(ut={}));var vt=function(e){function t(t){var n=e.call(this,t)||this;return n._operationNamePrefix="TeamsSdkPlugin",n}return __extends(t,e),t.prototype.enablePrintCapability=function(){try{this._ensureInTeams(),microsoftTeams.enablePrintCapability(),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".enablePrintCapability"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".enablePrintCapability.Failure"),{message:null==e?void 0:e.message})}},t.prototype.executeDeepLink=function(e){var t=this;try{this._ensureInTeams();var n=e.args[0];if(!n)throw new Error("DeepLink parameter is null or undefined");microsoftTeams.executeDeepLink(n,(function(n,r){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".executeDeepLink")),t._sendPluginResults(new q(B.Ok,{status:n,reason:r}),e.callbackId)}))}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".executeDeepLink.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.getContext=function(e){var t=this;try{this._ensureInTeams(),microsoftTeams.getContext((function(n){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".getContext"));var r=Object.assign({},{entityId:n.entityId,subEntityId:null==n?void 0:n.subEntityId,loginHint:null==n?void 0:n.loginHint,userObjectId:null==n?void 0:n.userObjectId,userPrincipalName:null==n?void 0:n.userPrincipalName,theme:null==n?void 0:n.theme,groupId:null==n?void 0:n.groupId,tid:null==n?void 0:n.tid,locale:n.locale,channelId:null==n?void 0:n.channelId});t._sendPluginResults(new q(B.Ok,r),e.callbackId)}))}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".getContext.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.getMruTabInstances=function(e){var t=this;try{this._ensureInTeams();var n=null==e?void 0:e.args[0];microsoftTeams.getMruTabInstances((function(n){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".getMruTabInstances")),t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),n)}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".getMruTabInstances.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.getTabInstances=function(e){var t=this;try{this._ensureInTeams();var n=null==e?void 0:e.args[0];microsoftTeams.getTabInstances((function(n){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".getTabInstances")),t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),n)}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".getMruTabInstances.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.initialize=function(e){var t=this;try{this._ensureInTeams();var n=__spreadArray([],null==e?void 0:e.args,!0);microsoftTeams.initialize((function(){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".initialize")),t._sendPluginResults(new q(B.Ok,{}),e.callbackId)}),n)}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".initialize.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.initializeWithFrameContext=function(e){var t=this;try{this._ensureInTeams();var n=e.args[0],r=e.args[1];if(!n)throw new Error("frameContext is null or undefined.");microsoftTeams.initializeWithFrameContext(n,(function(){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".initializeWithFrameContext")),t._sendPluginResults(new q(B.Ok,{}),e.callbackId)}),r)}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".initializeWithFrameContext.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.print=function(){try{this._ensureInTeams(),microsoftTeams.print(),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".print"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".print.Failure"),{message:null==e?void 0:e.message})}},t.prototype.setFrameContext=function(e){try{this._ensureInTeams();var t=e.args[0];if(!t)throw new Error("frameContext is null or undefined");microsoftTeams.setFrameContext(t),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".print"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".setFrameContext.Failure"),{message:null==e?void 0:e.message})}},t.prototype.shareDeepLink=function(e){try{this._ensureInTeams();var t=e.args[0];if(!t)throw new Error("deepLinkParameters is null or undefined");microsoftTeams.shareDeepLink(t),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".shareDeepLink"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".shareDeepLink.Failure"),{message:null==e?void 0:e.message})}},t.prototype.openFilePreview=function(e){try{this._ensureInTeams();var t=e.args[0];if(!t)throw new Error("filePreviewParameters is null or undefined");microsoftTeams.openFilePreview(t),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".openFilePreview"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".openFilePreview.Failure"),{message:null==e?void 0:e.message})}},t.prototype.conversationsOpenConversation=function(e){try{this._ensureInTeams();var t=e.args[0];if(!t)throw new Error("openConversationRequest is null or undefined");t.onStartConversation=this._onStartedConversation.bind(this),t.onCloseConversation=this._onClosedConversation.bind(this),microsoftTeams.conversations.openConversation(t),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".conversationsOpenConversation"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".conversationsOpenConversation.Failure"),{message:null==e?void 0:e.message})}},t.prototype.conversationsCloseConversation=function(){try{this._ensureInTeams(),microsoftTeams.conversations.closeConversation(),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".conversationsCloseConversation"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".conversationsCloseConversation.Failure"),{message:null==e?void 0:e.message})}},t.prototype.navigateBack=function(e){var t=this;try{this._ensureInTeams(),microsoftTeams.navigateBack((function(n,r){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".navigateBack")),t._sendPluginResults(new q(B.Ok,{status:n,reason:r}),e.callbackId)}))}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".navigateBack.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.navigateToTab=function(e){var t=this;try{this._ensureInTeams();var n=e.args[0];if(!(null==e?void 0:e.args[0]))throw new Error("tabInstance is null or undefined");microsoftTeams.navigateToTab(n,(function(n,r){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".navigateToTab")),t._sendPluginResults(new q(B.Ok,{status:n,reason:r}),e.callbackId)}))}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".navigateToTab.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.registerOnThemeChangeHandler=function(){try{this._ensureInTeams(),microsoftTeams.registerOnThemeChangeHandler(this._onThemeChanged.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".registerOnThemeChangeHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".registerOnThemeChangeHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype.registerAppButtonHoverEnterHandler=function(){try{this._ensureInTeams(),microsoftTeams.registerAppButtonHoverEnterHandler(this._onAppButtonHoverEnter.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".registerAppButtonHoverEnterHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".registerAppButtonHoverEnterHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype.registerAppButtonHoverLeaveHandler=function(){try{this._ensureInTeams(),microsoftTeams.registerAppButtonHoverLeaveHandler(this._onAppButtonHoverLeave.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".registerAppButtonHoverLeaveHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".registerAppButtonHoverLeaveHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype.registerAppButtonClickHandler=function(){try{this._ensureInTeams(),microsoftTeams.registerAppButtonClickHandler(this._onAppButtonClick.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".registerAppButtonClickHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".registerAppButtonClickHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype.settingsGetSettings=function(e){var t=this;try{this._ensureInTeams(),microsoftTeams.settings.getSettings((function(n){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".settingsGetSettings")),t._sendPluginResults(new q(B.Ok,n),e.callbackId)}))}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".settingsGetSettings.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.settingsSetSettings=function(e){var t=this;try{this._ensureInTeams();var n=null==e?void 0:e.args[0];microsoftTeams.settings.setSettings(n,(function(n,r){Core.Telemetry.Log.trackActivityEvent("".concat(t._operationNamePrefix,".settingsSetSettings")),t._sendPluginResults(new q(B.Ok,{status:n,reason:r}),e.callbackId)}))}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".settingsSetSettings.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t.message),e.callbackId)}},t.prototype.settingsRegisterOnSaveHandler=function(e){try{this._ensureInTeams(),microsoftTeams.settings.registerOnSaveHandler(this._onSaved.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".settingsRegisterOnSaveHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".settingsRegisterOnSaveHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype.settingsRegisterOnRemoveHandler=function(e){try{this._ensureInTeams(),microsoftTeams.settings.registerOnRemoveHandler(this._onRemoved.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".settingsRegisterOnRemoveHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".settingsRegisterOnRemoveHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype.tasksStartTask=function(e){try{this._ensureInTeams();var t=e.args[0];if(!t)throw new Error("taskInfo is null or undefined");microsoftTeams.tasks.startTask(t,this._onSubmitHandler.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".tasksStartTask"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".tasksStartTask.Failure"),{message:null==e?void 0:e.message})}},t.prototype.tasksUpdateTask=function(e){try{this._ensureInTeams();var t=e.args[0];if(!t)throw new Error("taskInfo is null or undefined");microsoftTeams.tasks.updateTask(t),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".tasksUpdateTask"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".tasksUpdateTask.Failure"),{message:null==e?void 0:e.message})}},t.prototype.tasksSubmitTask=function(e){try{this._ensureInTeams();var t=e.args[0],n=e.args[1];microsoftTeams.tasks.submitTask(t,n),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".tasksSubmitTask"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".tasksSubmitTask.Failure"),{message:null==e?void 0:e.message})}},t.prototype.registerBackButtonHandler=function(e){try{this._ensureInTeams(),microsoftTeams.registerBackButtonHandler(this._onBackButtonClicked.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".registerBackButtonHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".registerBackButtonHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype.registerChangeSettingsHandler=function(e){try{this._ensureInTeams(),microsoftTeams.registerChangeSettingsHandler(this._onChangeSettings.bind(this)),Core.Telemetry.Log.trackActivityEvent("".concat(this._operationNamePrefix,".registerChangeSettingsHandler"))}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".registerChangeSettingsHandler.Failure"),{message:null==e?void 0:e.message})}},t.prototype._onStartedConversation=function(e){this._dispatchEvent(ut.startedConversation,e)},t.prototype._onClosedConversation=function(e){this._dispatchEvent(ut.closedConversation,e)},t.prototype._onThemeChanged=function(e){this._dispatchEvent(ut.themeChanged,e)},t.prototype._onSaved=function(e){this._dispatchEvent(ut.onSaved,e)},t.prototype._onRemoved=function(e){this._dispatchEvent(ut.onRemoved,e)},t.prototype._onBackButtonClicked=function(){this._dispatchEvent(ut.backButtonClicked,[])},t.prototype._onChangeSettings=function(){this._dispatchEvent(ut.onChangedSettings,[])},t.prototype._onSubmitHandler=function(e,t){this._dispatchEvent(ut.taskSubmitted,[e,t])},t.prototype._onAppButtonHoverEnter=function(){this._dispatchEvent(ut.appButtonHoverEnter,[])},t.prototype._onAppButtonHoverLeave=function(){this._dispatchEvent(ut.appButtonHoverLeave,[])},t.prototype._onAppButtonClick=function(){this._dispatchEvent(ut.appButtonClicked,[])},t.prototype._ensureInTeams=function(){if(!Core.Environment.isSkypeTeams())throw new Error("Teams SDK is not supported in this host")},t}(J),_t="PowerAppsWebPlayer",Ct=function(e){function t(t){var n=e.call(this,t)||this;return n._operationNamePrefix="OfficeHeaderPlugin",n}return __extends(t,e),t.prototype.getNavBarData=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r;return __generator(this,(function(i){switch(i.label){case 0:i.label=1;case 1:return i.trys.push([1,3,,4]),t=e.args[0],[4,Pt(AppMagic.Services.Azure.Region.getCurrentRegion().name,t)];case 2:return 200==(n=i.sent()).status?this._sendPluginResults(new q(B.Ok,n.responseText),e.callbackId):this._sendPluginResults(new q(B.Error,"Request failed: response"),e.callbackId),[3,4];case 3:return r=i.sent(),Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".getOfficeHeaderNavBarData.Failure"),{message:null==r?void 0:r.message}),this._sendPluginResults(new q(B.Error,r),e.callbackId),[3,4];case 4:return[2]}}))}))},t}(J);function Pt(e,t){return void 0===t&&(t="5A2A8954-C79D-412F-BD98-0C7B0E372555"),__awaiter(this,void 0,Promise,(function(){var n,r,i,o,a,s;return __generator(this,(function(c){switch(c.label){case 0:n=Core.Environment.getOfficeHeaderResourceEndpoint(e),c.label=1;case 1:return c.trys.push([1,4,,5]),[4,(r=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.IClientRuntimeSingletonKey)).loaded.waitAsync()];case 2:return c.sent(),i="".concat(n,"/api/shell/navbardata?CurrentMainLinkId=").concat(_t,"&TrackingGuid=").concat(t),o=new AppMagic.Services.JsonHttpRequestBuilder,a=new Core.UrlBuilder(i).toUrl(),o.setBaseUrl(a),o.setMethod("GET"),o.addHeader("Accept","application/json"),AppMagic.Runtime.Client.addAuthorizationOptionsToBuilder(o,{resource:n,isDynamicResource:!0}),s=o.generateSendHttpRequestParameters(),AppMagic.Services.appendCustomHeadersOptions(s,{addCustomHeaders:!0}),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpAsync(r.httpClient,s,"fetchNavBarData",null)];case 3:return[2,c.sent()];case 4:throw c.sent();case 5:return[2]}}))}))}var bt;!function(e){e.Text="text",e.ArrayBuffer="arraybuffer",e.Blob="blob",e.Document="document",e.Json="json",e.PABinary="pabinary";var t=Object(ze.HashTableUtility_create)({text:e.Text,arraybuffer:e.ArrayBuffer,blob:e.Blob,document:e.Document,json:e.Json,pabinary:e.PABinary});e.tryConvertFromString=function(e){return"string"!=typeof e?null:t[e.toLowerCase()]||null},e.isValid=function(e){return"string"==typeof e&&t[e]===e}}(bt||(bt={}));var At,wt,St=["48x48","64x64","96x96","120x120","240x240","360x360","432x432","504x504","648x648"],Et=function(e){function t(t){var n=e.call(this,t)||this;return n.chatScopes=["Chat.Create","ChatMessage.Send","Chat.Read"],n.organizationScopes=["Organization.Read.All"],n.presenceScopes=["Presence.Read.All"],n.userScopes=["User.Read","User.ReadBasic.All","User.Read.All"],n.allowedHeaders=["ConsistencyLevel"],n._operationNamePrefix="MicrosoftGraphPlugin",n}return __extends(t,e),t.prototype.get=function(e){var t;return __awaiter(this,void 0,Promise,(function(){var n,r,i,o,a;return __generator(this,(function(s){return n=e.args[0],r=e.args[1],i=e.args[2],this._validateHeaders("GET",r,e.context),o=this._getGraphData(e,n,"GET",null,null!==(t=this._getResponseType(i))&&void 0!==t?t:bt.Json,null,r),a=function(e){return e.response},this._handleAndSendResponse(e,o,a),[2]}))}))},t.prototype.post=function(e){var t;return __awaiter(this,void 0,Promise,(function(){var n,r,i,o,a,s;return __generator(this,(function(c){return n=e.args[0],r=JSON.stringify(e.args[1]),i=e.args[2],o=e.args[3],this._validateHeaders("POST",i,e.context),a=this._getGraphData(e,n,"POST",r,null!==(t=this._getResponseType(o))&&void 0!==t?t:bt.Json,null,i),s=function(e){return null==e?void 0:e.response},this._handleAndSendResponse(e,a,s),[2]}))}))},t.prototype.getUser=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i;return __generator(this,(function(o){return t=e.args[0],n="v1.0/users/{".concat(t,"}"),r=this._getGraphData(e,n,"GET",null,bt.Json,this.userScopes),i=function(e){return e.response},this._handleAndSendResponse(e,r,i),[2]}))}))},t.prototype.getOrganizations=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){return"v1.0/organization",t=this._getGraphData(e,"v1.0/organization","GET",null,bt.Json,this.organizationScopes),n=function(e){return e.response},this._handleAndSendResponse(e,t,n),[2]}))}))},t.prototype.getPhoto=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o;return __generator(this,(function(a){return t=e.args[0],n=e.args[1]&&St.indexOf(e.args[1])>-1?e.args[1]:"64x64",r="v1.0/users/{".concat(t,"}/photos/").concat(n,"/$value"),i=this._getGraphData(e,r,"GET",null,bt.ArrayBuffer,this.userScopes),o=function(e){var t=e.response,n=e.headers["Content-Type"],r=btoa(String.fromCharCode.apply(null,new Uint8Array(t)));return"data:".concat(n,";base64,")+r},this._handleAndSendResponse(e,i,o),[2]}))}))},t.prototype.getPresence=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i;return __generator(this,(function(o){return t=e.args[0],n="v1.0/communications/presences/".concat(t),r=this._getGraphData(e,n,"GET",null,bt.Json,this.presenceScopes),i=function(e){return e.response},this._handleAndSendResponse(e,r,i),[2]}))}))},t.prototype.getPresencesByUserId=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r;return __generator(this,(function(i){return t=JSON.stringify({ids:e.args[0]}),"v1.0/communications/getPresencesByUserId",n=this._getGraphData(e,"v1.0/communications/getPresencesByUserId","POST",t,bt.Json,this.presenceScopes),r=function(e){var t;return null===(t=e.response)||void 0===t?void 0:t.value},this._handleAndSendResponse(e,n,r),[2]}))}))},t.prototype.batchRequest=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i;return __generator(this,(function(o){return"v1.0/$batch",t=JSON.stringify(e.args[0]),n=e.args[1],this._validateHeaders("BATCH",n,e.context),r=this._getGraphData(e,"v1.0/$batch","POST",t,bt.Json,null,n),i=function(e){return null==e?void 0:e.response},this._handleAndSendResponse(e,r,i),[2]}))}))},t.prototype.createChat=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r;return __generator(this,(function(i){return t=JSON.stringify(e.args[0]),"v1.0/chats",n=this._getGraphData(e,"v1.0/chats","POST",t,bt.Json,this.chatScopes),r=function(e){return e.response},this._handleAndSendResponse(e,n,r),[2]}))}))},t.prototype.createCall=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r;return __generator(this,(function(i){return t=JSON.stringify(e.args[0]),"v1.0/communications/calls",n=this._getGraphData(e,"v1.0/communications/calls","POST",t,bt.Json),r=function(e){return e.response},this._handleAndSendResponse(e,n,r),[2]}))}))},t.prototype._getGraphData=function(e,t,n,r,i,o,a){return __awaiter(this,void 0,void 0,(function(){var s,c,l,u,p,d,g,h,m,f;return __generator(this,(function(y){switch(y.label){case 0:s=e.serviceName+"."+e.actionName,y.label=1;case 1:return y.trys.push([1,4,,5]),[4,(c=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.IClientRuntimeSingletonKey)).loaded.waitAsync()];case 2:if(y.sent(),l=new AppMagic.Services.JsonHttpRequestBuilder,u=new Core.UrlBuilder("".concat(AppMagic.Services.Azure.Region.getCurrentRegion().microsoftGraphEndpoint)+t).toUrl(),l.setBaseUrl(u),l.setMethod(n),l.addHeader("Accept","application/json"),null!==r&&l.setJsonValue("",JSON.parse(r)),a)for(p in a)l.addHeader(p,a[p]);return d=AppMagic.Services.Azure.Region.getCurrentRegion().microsoftGraphResource,g=function(e,t){if(!e||!t||0===t.length)return e;var n=t.join(",");return"".concat(e).concat("|scopes|").concat(n)}(d,o),AppMagic.Runtime.Client.addAuthorizationOptionsToBuilder(l,{resource:g,isDynamicResource:!0}),h=l.generateSendHttpRequestParameters(),AppMagic.Services.appendCustomHeadersOptions(h,{addCustomHeaders:!0}),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpAsync(c.httpClient,h,"".concat(this._operationNamePrefix,".").concat(s),null,i)];case 3:return[2,y.sent()];case 4:if(m=y.sent(),f=null==m?void 0:m.message,AppMagic.Services.errorHasHttpResponse(m))throw new Error(JSON.stringify({status:m.response.status,message:f}));throw m;case 5:return[2]}}))}))},t.prototype._validateHeaders=function(e,t,n){var r=!1;for(var i in t)-1===this.allowedHeaders.indexOf(i)&&(r=!0);if(r){var o=Le.getCustomPageTelemetryData(n);throw Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".").concat(e),__assign({error:r,headers:t},o)),new Error("Disallowed headers in the request")}},t.prototype._getResponseType=function(e){switch(e){case"text":return bt.Text;case"arraybuffer":return bt.ArrayBuffer;case"blob":return bt.Blob;case"json":return bt.Json;default:return null}},t.prototype._handleAndSendResponse=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,o;return __generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,t];case 1:return 200==(r=a.sent()).status||201==r.status?(i=n(r),this._sendPluginResults(new q(B.Ok,i),e.callbackId)):this._sendPluginResults(new q(B.Error,"Request failed: ".concat(r)),e.callbackId),[3,3];case 2:return o=a.sent(),this._sendPluginResults(new q(B.Error,o),e.callbackId),[3,3];case 3:return[2]}}))}))},t}(J),kt=n(2),It=n(0),Tt=function(e){function t(t,n){var r=e.call(this,t)||this;return r._operationName="MonitorPlugin",r._monitorState=wt.Uninitialized,r._enableWebAuthResourceForMonitors=null!=n&&n,r}return __extends(t,e),t.prototype.initialize=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s;return __generator(this,(function(c){switch(c.label){case 0:if(t=e.callbackId,this._monitorState===wt.Initialized)return Core.Telemetry.Log.trackWarningEvent("".concat(this._operationName,".initialize"),{message:"Initialize was already called"}),[2,this._sendPluginResults(new q(B.Ok,{}),e.callbackId)];c.label=1;case 1:return c.trys.push([1,3,,4]),(n=this._getMessagingClientSetupOptions(e))&&n.monitorEndpoint&&n.monitorJoinToken&&n.channelsOfInterest?[4,this._tryGetSessionState(n)]:[2,this._logErrorAndSendResultsForOperation({message:"Bad attempt to initialize with bad parameters",code:At.ErrorBadParameters},"".concat(this._operationName,".initialize"),t)];case 2:return r=c.sent(),i=r.error,o=r.sessionState,i?[2,this._logErrorAndSendResultsForOperation(i,"".concat(this._operationName,".initialize._tryGetSessionState"),t)]:(this._sessionState=o,(a=this._trySetMessagingClient(n).clientError)?[2,this._logErrorAndSendResultsForOperation(a,"".concat(this._operationName,".initialize._trySetMessagingClient"),t)]:(this._monitorState=wt.Initialized,this._sendPluginResults(new q(B.Ok,{}),e.callbackId),[3,4]));case 3:return s=c.sent(),[2,this._logErrorAndSendResultsForOperation(s,"".concat(this._operationName,".initialize"),t)];case 4:return[2]}}))}))},t.prototype._getClientRuntime=function(){return __awaiter(this,void 0,void 0,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,(e=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.IClientRuntimeSingletonKey)).loaded.waitAsync()];case 1:return t.sent(),[2,e]}}))}))},t.prototype._getMessagingClientSetupOptions=function(e){var t=e.args[0];if(t)return{monitorEndpoint:t.mep,monitorJoinToken:t.mjt,channelsOfInterest:t.channelsOfInterest,joinSessionEndpoint:"".concat(t.mep,"/api/authoringsession/joinsession")}},t.prototype._tryGetSessionState=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s,c,l,u;return __generator(this,(function(p){switch(p.label){case 0:return this._isValidAuthoringServicesEndpoint(e.monitorEndpoint)?[4,this._getClientRuntime()]:[2,{error:{message:"Authoring services endpoint is invalid",code:At.ErrorBadParameters}}];case 1:t=p.sent(),n=new AppMagic.Services.JsonHttpRequestBuilder,r=new Core.UrlBuilder(e.joinSessionEndpoint).toUrl(),i=AppMagic.Services.Azure.Region.getCurrentRegion(),o=this._enableWebAuthResourceForMonitors?i.webAuthResource:i.powerAppsServiceResource,n.setBaseUrl(r),n.setMethod("POST"),n.addHeader("Accept","application/json"),n.addHeader("x-ms-join-session-token",e.monitorJoinToken),AppMagic.Runtime.Client.addAuthorizationOptionsToBuilder(n,{resource:o,isDynamicResource:!0}),a=n.generateSendHttpRequestParameters(),AppMagic.Services.appendCustomHeadersOptions(a,{addCustomHeaders:!0}),s=void 0,p.label=2;case 2:return p.trys.push([2,4,,5]),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpAsync(t.httpClient,a,"fetchClientSessionState",null)];case 3:return s=p.sent(),[3,5];case 4:return[2,{error:{message:p.sent(),code:At.AuthFailureRequestingClientSessionState}}];case 5:return(null==(c=JSON.parse(s.response))?void 0:c.sessionState)&&"string"==typeof c.sessionState?(l=s.headers["x-ms-is-session-owner"],u=c.sessionState,"0"!==l&&"1"!==l?[2,{error:{message:"Invalid WebAuth /joinsession response - session owner missing",code:At.MalformedResponseFailureRequestingClientSessionState}}]:[2,{sessionState:u}]):[2,{error:{message:"Invalid WebAuth /joinsession response - session state malformed or missing",code:At.MalformedResponseFailureRequestingClientSessionState}}]}}))}))},t.prototype.sendDiagEvents=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){t=e.callbackId;try{if(this._monitorState!==wt.Initialized)throw{message:"Call to send events with unsuccessful initialized, try to initialize monitor first successfully",code:At.ErrorWhileSendingEvents};n=JSON.stringify(e.args[0]),this._messagingClient.sendMessage({command:"Events",to:"DiagTool",payload:n,compressor:"pako"}),this._sendPluginResults(new q(B.Ok,{}),t)}catch(e){this._logErrorAndSendResultsForOperation({message:e,code:At.ErrorWhileSendingEvents},"".concat(this._operationName,".sendDiagEvents"),t)}return[2]}))}))},t.prototype.getWorkerUrl=function(e){e&&0!==e.trim().length||(e="/webplayer/js/messageworker.js"),e&&e.startsWith("/")&&(e=window.location.origin+e);var t="importScripts('".concat(e,"');"),n=new Blob([t],{type:"application/javascript"});return window.URL.createObjectURL(n)},t.prototype._trySetMessagingClient=function(e){var t=this;try{return this._messagingClient=(new kt.MessagingClientFactory).createMessageClient(new Worker(this.getWorkerUrl()),"".concat(e.monitorEndpoint,"/api/signalr/diagnosticshub"),this._channelsOfInterest,(function(e){if(e.eventType===It.EventType.ErrorEvent)return Core.Telemetry.Log.trackErrorEvent("".concat(t._operationName,".sendDiagEvents"),{message:e,code:At.ErrorWhileTransmittingEvents})}),{messageHeaders:{"x-ms-session-state":this._sessionState},token:this._sessionState}),{}}catch(e){return{clientError:{code:At.FailureJoiningMonitor,message:e}}}},t.prototype._logErrorAndSendResultsForOperation=function(e,t,n){Core.Telemetry.Log.trackErrorEvent(t,{error:e}),n&&this._sendPluginResults(new q(B.Error,{error:e}),n)},t.prototype._isValidAuthoringServicesEndpoint=function(e){var t=Core.Url.decode(e),n=AppMagic.Services.Azure.Constants.DefaultRegionProperties,r=this._getAllowedEndpoints(n);return!!this._isValidEndpoint(t,r)},t.prototype._getAllowedEndpoints=function(e){var t=new Set;return Object.keys(e).forEach((function(n){t.add(e[n].docServerEndpoint)})),t.add(new Core.Url("https://fakewebauth.example.net")),t.add(new Core.Url("https://fakewebauthcdn.example.com")),t.add(new Core.Url("https://local.create.powerapps.com")),t.add(new Core.Url("https://localhost")),t},t.prototype._isValidEndpoint=function(e,t){var n=!1,r=new Core.Url(e).getTrimmedHost(2);return t.forEach((function(e){e.getTrimmedHost(2)==r&&(n=!0)})),n},t}(J);!function(e){e.MalformedResponseFailureRequestingClientSessionState="MalformedResponseFailureRequestingClientSessionState",e.AuthFailureRequestingClientSessionState="AuthFailureRequestingClientSessionState",e.FailureJoiningMonitor="FailureJoiningMonitor",e.ErrorWhileSendingEvents="ErrorWhileSendingEvents",e.ErrorWhileTransmittingEvents="ErrorWhileTransmittingEvents",e.ErrorBadParameters="ErrorBadParameters"}(At||(At={})),function(e){e[e.InitializeFailWithoutConsent=0]="InitializeFailWithoutConsent",e[e.Initialized=1]="Initialized",e[e.Uninitialized=2]="Uninitialized"}(wt||(wt={}));var Rt=function(e){function t(t){var n,r,i=this;(i=e.call(this,t)||this)._operationNamePrefix="AuthenticationPlugin";var o=null===(r=null===(n=window.webPlayerServerConfig)||void 0===n?void 0:n.UnifiedAppConfig)||void 0===r?void 0:r.InstanceUrl;if(o)try{i._cdsInstanceUrlHost=new Core.UrlBuilder(o).host}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(i._operationNamePrefix,".constructor"),e)}return i}return __extends(t,e),t.prototype.acquireToken=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s,c,l;return __generator(this,(function(u){switch(u.label){case 0:u.label=1;case 1:if(u.trys.push([1,3,,4]),!e.args||1!=e.args.length)throw new Error("Invalid args.");if(t=e.args[0],!this.isAllowedResource(t.resource))throw new Error("Invalid resource: ".concat(t.resource));return n=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.ComponentKeys.ClientAuthenticationRuntime).azureAuthenticationManager,[4,(r=n.getProviderForResourceUrl(t.resource,!0)).authenticateSilentAsync()];case 2:return u.sent(),i=r.store,o=i.accessToken,a=i.expiresOn,s=a.toJSON(),c={accessToken:o,expiresOn:s},this._sendPluginResults(new q(B.Ok,c),e.callbackId),[3,4];case 3:return l=u.sent(),Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".acquireToken.Failure"),{message:null==l?void 0:l.message}),this._sendPluginResults(new q(B.Error,l),e.callbackId),[3,4];case 4:return[2]}}))}))},t.prototype.openAuthPopup=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n=this;return __generator(this,(function(r){try{if(!e.args||1!=e.args.length)throw new Error("Invalid args.");if(!Core.Environment.isSkypeTeams())throw new Error("openAuthPopup is only supported in Teams. The app is not running in Teams.");return t=e.args[0],[2,new Promise((function(r){microsoftTeams.authentication.authenticate({url:t,successCallback:function(t){n._sendPluginResults(new q(B.Ok,t),e.callbackId),r()},failureCallback:function(t){var i=t||"Unknown error occurred when calling microsoftTeams.authentication.authenticate";n._sendPluginResults(new q(B.Error,i),e.callbackId),r()},width:600,height:400})}))]}catch(t){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".openAuthPopup.Failure"),{message:null==t?void 0:t.message}),this._sendPluginResults(new q(B.Error,t),e.callbackId)}return[2]}))}))},t.prototype.isAllowedResource=function(e){var t;if(e&&this._cdsInstanceUrlHost){try{t=new Core.UrlBuilder(e).host}catch(e){Core.Telemetry.Log.trackErrorEvent("".concat(this._operationNamePrefix,".isAllowedResource"),e)}return t===this._cdsInstanceUrlHost}return!1},t}(J),Mt=function(){function e(e){this._capabilitiesManager=e}return e.prototype.handleCommand=function(e,t){if(t.actionName&&!e[t.actionName]){var n="Plugin handler does not have action name: ".concat(t.actionName," with Service Name: ").concat(t.serviceName);return Core.Log.errorEx("CommandDispatcher.handleCommand",n),Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.Strings.badPluginCallback,{actionName:t.actionName}),void e.sendIllegalAccessToActionNameExceptionResult(t.callbackId,t.actionName)}e[t.actionName]&&void 0===e.requiredCapability||this._capabilitiesManager.hasAccessToCapability(e.requiredCapability)?e[t.actionName](t):e.sendIllegalAccessToCapabilitiyExceptionResult(t.callbackId,e.requiredCapability)},e}(),Nt=function(){function e(e){var t=this;this._isDisposed=!1,this._lowMemoryWarningHandler=null,this._webPlayerFitToScreenHandler=null,this._webPlayerResizeHandler=null,this._webPlayerWindowResizeHandler=null,this._sizingLogMessageCount=0,this._maxSizingLogMessageCount=10,this._messageChannel=e,this._messageChannel.onCallback=function(e){if(!t._isDisposed){var n=t._callbackTracker.getValue(e.callbackId);n&&(t._callbackTracker.deleteValue(e.callbackId),n(JSON.parse(e.resultJson)))}},this._callbackTracker=new Collections.Generic.Dictionary,this._appFailedEvent=new EventObject,this._appFirstHttpClientEvent=new EventObject,this._appInvokeScriptBlockedEvent=new EventObject,this._appIndexLoadedEvent=new EventObject,this._appLoadedEvent=new EventObject,this._appFullLoadEvent=new EventObject,this._appRuntimeStartEvent=new EventObject,this._toggleNavbarEvent=new EventObject,this._lowMemoryWarningHandler=function(){t.invokeScriptAsync("document.dispatchEvent(new Event('lowMemoryWarning'));")};var n=function(){Core.UI.Utility.setFitToScreen(!0)},r=function(){var e=document.createEvent("Event");e.initEvent("resize",!0,!1),document.dispatchEvent(e)},i=function(e){return";(".concat(e.toString(),")();")},o=!0;this._webPlayerFitToScreenHandler=function(){t._logSizingEvent("IFrameCommunicationChannel.FitToScreen",{isFirstFit:o,isIframed:Core.Environment.isIframed()});var e=i(n),a=r;!o||Core.Environment.isIframed()?(e+=i(r),a=null):o=!1,t.invokeScriptAsync(e).then((function(){a&&a()}))},document.addEventListener("webPlayerFitToScreen",this._webPlayerFitToScreenHandler,!1),Core.Environment.isIframed()||Core.Environment.getBrowserId()===Core.Environment.BrowserId.Firefox?(this._webPlayerResizeHandler=function(){t._logSizingEvent("IFrameCommunicationChannel.WebPlayerResize",{}),t.invokeScriptAsync(i(r))},document.addEventListener("resize",this._webPlayerResizeHandler,!1),window.addEventListener("resize",this._webPlayerResizeHandler,!1)):(this._webPlayerWindowResizeHandler=function(){t._logSizingEvent("IFrameCommunicationChannel.WindowResize",{})},window.addEventListener("resize",this._webPlayerWindowResizeHandler,!1)),document.addEventListener("lowMemoryWarning",this._lowMemoryWarningHandler,!1)}return e.prototype.sendPluginResult=function(e,t){var n=e.rowMessage;if(0===t.indexOf("Geolocation")&&null!==n&&"object"==typeof n)for(var r in n=Object(),e.rowMessage)n[r]=e.rowMessage[r];var i={isPluginCall:!0,callbackId:t,status:e.status,args:[n],keepCallback:e.keepCallback},o=void 0;t.indexOf("instanceId=")>=0&&(o=t.split("_")[0].split("=")[1]);return this._messageChannel.postMessage(i,null==e?void 0:e.transfer,o),Promise.resolve()},e.prototype.invokeScriptAsync=function(e){var t=this,n=Core.PromiseUtils.createCompletablePromise(),r=Core.Utility.generate128BitUUID();this._callbackTracker.addValue(r,(function(e){if(e&&e.evalBlockedForOrigin)return t._appInvokeScriptBlockedEvent.dispatch(),void n.error("blocked");n.complete(e)}));var i={isPluginCall:!1,callbackId:r,evalString:e};return this._messageChannel.postMessage(i),n.promise},e.prototype.sendAppExitEvent=function(){return this.invokeScriptAsync('\n            var ev;\n            try {\n                ev = new Event("appExitRequested");\n            } catch (error) {\n                ev = document.createEvent("CustomEvent");\n                ev.initCustomEvent("appExitRequested", true, false, null);\n            }\n            document.dispatchEvent(ev);\n        ')},e.prototype.dispose=function(){this._lowMemoryWarningHandler&&(document.removeEventListener("lowMemoryWarning",this._lowMemoryWarningHandler),this._lowMemoryWarningHandler=null),this._webPlayerFitToScreenHandler&&(document.removeEventListener("webPlayerFitToScreen",this._webPlayerFitToScreenHandler),this._webPlayerFitToScreenHandler=null),this._webPlayerResizeHandler&&(document.removeEventListener("resize",this._webPlayerResizeHandler),window.removeEventListener("resize",this._webPlayerResizeHandler),this._webPlayerResizeHandler=null),this._webPlayerWindowResizeHandler&&(window.removeEventListener("resize",this._webPlayerWindowResizeHandler),this._webPlayerWindowResizeHandler=null),this._callbackTracker=null,this._messageChannel=null,this._isDisposed=!0},e.prototype.proxyWin=function(e){var t=this;return function(n){var r=new q(B.Ok,n);t.sendPluginResult(r,e.callbackId)}},e.prototype.proxyFail=function(e){var t=this;return function(n){var r=new q(B.Error,n);t.sendPluginResult(r,e.callbackId)}},e.prototype.appHostElement=function(){return this._messageChannel.appHostElement},Object.defineProperty(e.prototype,"appLoadedEvent",{get:function(){return this._appLoadedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appFullLoadEvent",{get:function(){return this._appFullLoadEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appRuntimeStartEvent",{get:function(){return this._appRuntimeStartEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appFailedEvent",{get:function(){return this._appFailedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appInvokeScriptBlockedEvent",{get:function(){return this._appInvokeScriptBlockedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"toggleNavbarEvent",{get:function(){return this._toggleNavbarEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appIndexLoadedEvent",{get:function(){return this._appIndexLoadedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appFirstHttpClientEvent",{get:function(){return this._appFirstHttpClientEvent},enumerable:!1,configurable:!0}),e.prototype._logSizingEvent=function(e,t){var n,r,i,o;this._sizingLogMessageCount<this._maxSizingLogMessageCount&&(this._sizingLogMessageCount++,Core.Telemetry.Log.trackEvent(e,__assign(__assign({},t),{playerWidth:window.innerWidth,playerHeight:window.innerHeight,iframeWidth:null===(r=null===(n=this._messageChannel)||void 0===n?void 0:n.appHostElement)||void 0===r?void 0:r.clientWidth,iframeHeight:null===(o=null===(i=this._messageChannel)||void 0===i?void 0:i.appHostElement)||void 0===o?void 0:o.clientHeight,count:this._sizingLogMessageCount,maxCount:this._maxSizingLogMessageCount})))},e}(),xt=function(){function e(){}return e.prototype.hasAccessToPath=function(e){return!0},e.prototype.addToFutureFilesAllowedList=function(e){},e.prototype.hasAccessToCapability=function(e){return!0},e.prototype.getAppFolderPath=function(){return""},e}(),Lt=AppMagic.Runtime.App.Plugins.PluginVersionManager,Ht=function(e){function t(t,n){void 0===n&&(n=null);var r=e.call(this)||this;return r._messageChannel=t,r._handleInvalidAppFrameLoad=n,r._allPluginsRegistered=!1,r._firstHttpClientEventDispatched=!1,r._messagesReceived=0,r._pendingMessages=[],r._reloadedIframe=!1,r._pluginVersionManager=new Lt(Core.Utility.noOpFn),r._capabilitiesManager=new xt,r.track("_nameToHandlerObject",new Collections.Generic.Dictionary),r._messageChannel.appHostElement&&r.track("_appHostElement",r._messageChannel.appHostElement),r._messageChannel.onPluginCall=r._onNativePluginCallFromAppHostToPlayer.bind(r),r._messageChannel.onReloadIframe=r._reloadIframe.bind(r),r._commChannel=new Nt(r._messageChannel),r._commandDispatcher=new Mt(r._capabilitiesManager),r._registerCommonAPIHandlers(),r}return __extends(t,e),Object.defineProperty(t.prototype,"appHost",{get:function(){return this._appHostElement},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"communicationChannel",{get:function(){return this._commChannel},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pluginVersionManager",{get:function(){return this._pluginVersionManager},enumerable:!1,configurable:!0}),t.prototype.start=function(){this._messageChannel.start()},t.prototype.dispose=function(){this._commChannel.dispose(),this._commChannel=null,this._commandDispatcher=null,this._messageChannel.onCallback=null,this._messageChannel.onPluginCall=null,clearTimeout(this._reloadFrameTimeout),e.prototype.dispose.call(this)},t.prototype.invokeScriptAsync=function(e){return this._commChannel.invokeScriptAsync(e)},t.prototype.registerHandler=function(e,t){this._nameToHandlerObject.setValue(e,t)},t.prototype.unregisterHandler=function(e){this._nameToHandlerObject.deleteValue(e)},t.prototype.didAppFrameReload=function(){return this._reloadedIframe},t.prototype.signalAllPluginsRegistered=function(){var e=this;this._allPluginsRegistered=!0,Core.Telemetry.Log.trackActivityEvent("AppHostAPIHandler.AllPluginsRegistered",{messagesQueued:this._pendingMessages.length});for(var t=0;t<this._pendingMessages.length;t++)this._onNativePluginCallFromAppHostToPlayer(this._pendingMessages[t]);0===this._messagesReceived&&this._appHostElement&&(this._setupInvalidAppFrameLoadHandler(),this._reloadFrameTimeout=setTimeout((function(){e._reloadIframe(!1)&&(Core.Telemetry.Log.trackActivityEvent("AppHostAPIHandler.NoMessagesReceivedWhenHostIsReady"),e._reloadFrameTimeout=setTimeout((function(){0===e._messagesReceived&&Core.Telemetry.Log.trackErrorEvent("PowerAppsClient.Error",{message:"No message received from published app iframe 30 seconds after reloading the iframe."})}),3e4))}),3e4))},t.prototype._onNativePluginCallFromAppHostToPlayer=function(e){this._messagesReceived++;var t={callbackId:e.callbackId,serviceName:e.service,actionName:e.action,args:e.actionArgs,context:e.commandContext},n=this._nameToHandlerObject.tryGetValue(t.serviceName);if(n.value){var r=n.outValue;this._firstHttpClientEventDispatched||"AppHttpClientPlugin"!==t.serviceName||(this._commChannel.appFirstHttpClientEvent.dispatch(),this._firstHttpClientEventDispatched=!0),this._commandDispatcher.handleCommand(r,t)}else if(this._allPluginsRegistered){var i={serviceName:t.serviceName,actionName:t.actionName};Core.Telemetry.Log.trackErrorEvent(Core.Telemetry.Strings.webPlayerUnsupportedCordovaRequest,i);var o=new q(B.Error,"web player does not have cordova");this._commChannel.sendPluginResult(o,t.callbackId)}else this._pendingMessages.push(e)},t.prototype._reloadIframe=function(e){if(0===this._messagesReceived&&!this._reloadedIframe){var t=this._appHostElement;if(t){this._reloadedIframe=!0;var n=new Core.Url(t.src),r=new Core.UrlBuilder(n);r.appendQuery("t=".concat(Date.now())),t.src=r.doneToString();var i={appFrameDidLoad:window.appFrameDidLoad,appFrameLoadedTime:window.appFrameLoadedTime,appLoaderStartTime:window.appLoaderStartTime,newIframeUrl:Core.Telemetry.Utility.scrubSensitiveDataSafe(t.src,["preloadIndexPath","loader","lv","piv"]),withCSRFError:e};return Core.Telemetry.Log.trackActivityEvent("PlayerLifecycle.PlayerSDK.PlayApp.LoadApp.CreateAppFrame.AppIframeReloaded",__assign({reason:"AppHostAPIHandler.reloadAppFrame"},i)),Core.Telemetry.Log.trackActivityEvent("AppHostAPIHandler.reloadAppFrame",__assign({},i)),!0}}return!1},t.prototype._setupInvalidAppFrameLoadHandler=function(){var e;return __awaiter(this,void 0,Promise,(function(){var t=this;return __generator(this,(function(n){switch(n.label){case 0:return window.appFrameDidLoad?[3,2]:[4,new Promise((function(e){return t._appHostElement.addEventListener("load",e)}))];case 1:n.sent(),n.label=2;case 2:return[4,new Promise((function(e){return setTimeout(e,5e3)}))];case 3:return n.sent(),0===this._messagesReceived&&this._appHostElement&&(Core.Telemetry.Log.trackActivityEvent("AppHostAPIHandler._handleInvalidAppFrameLoad",{appFrameDidLoad:window.appFrameDidLoad,appFrameLoadedTime:window.appFrameLoadedTime,appLoaderStartTime:window.appLoaderStartTime}),null===(e=this._handleInvalidAppFrameLoad)||void 0===e||e.call(this)),[2]}}))}))},t.prototype._registerCommonAPIHandlers=function(){this.registerHandler("VersionSupport",new K(this._commChannel,this._pluginVersionManager)),this.registerHandler("Console",new Te(this._commChannel)),this.registerHandler("RemoteInkManagerPlugin",new r.RemoteInkManagerPluginDelegator(this._commChannel)),this.registerHandler("CrossDomainXMLHttpRequest",new o.CrossDomainXMLHttpRequestImplementation(this._commChannel,new o.DefaultXMLHttpRequestFactory,this._capabilitiesManager)),this.registerHandler("NetworkStatus",new xe(this._commChannel)),this.registerHandler("Device",new Re(this._commChannel)),this.registerHandler("StatusBar",new Ue(this._commChannel)),this.registerHandler("TeamsSdk",new vt(this._commChannel)),this.registerHandler("Authentication",new Rt(this._commChannel)),this.registerHandler("MicrosoftGraph",new Et(this._commChannel)),this.registerHandler("Geolocation",new Ne(this._commChannel)),this.registerHandler("Accelerometer",new fe(this._commChannel)),this.registerHandler("Compass",new Ie(this._commChannel)),this.registerHandler("File",new Me(this._commChannel,this._capabilitiesManager)),this.registerHandler("PublishedAppTelemetry",new He(this._commChannel)),this.registerHandler("SienaFilePickerPlugin",new De(this._commChannel,this._capabilitiesManager)),this.registerHandler("Microphone",new i.MicrophonePlugin(this._commChannel)),this.registerHandler("Keyboard",new Oe(this._commChannel)),this.registerHandler("SienaMicPlugin",new i.MicrophoneIframeProxy(this._commChannel,this._capabilitiesManager)),this.registerHandler("CanvasCamera",new X(this._commChannel,this._capabilitiesManager))},t}(Core.Disposable),Dt=AppMagic.Runtime.App.Plugins,Ut=Core.Telemetry,Ot=function(e){function t(t,n){var r=e.call(this,n)||this;return r._appHostErrorHandler=t,r._nextCallbackId=1,r._pendingCallbacks=HashTableUtility.create(),r}return __extends(t,e),t.prototype.registerCommander=function(e){this._commander=e},t.prototype.executeHostToAppCommandAsync=function(e,t){var n={callbackId:(this._nextCallbackId++).toString(),fullName:e,args:t},r=Core.PromiseUtils.createCompletablePromise();return this._pendingCallbacks[n.callbackId]=r,this._commChannel.invokeScriptAsync("\ntry {\n    var appInstance = Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.App.CurrentAppInstanceFunctionSingletonKey)();\n    var appHostPlugin = appInstance.appHost.appHostPlugin;\n    appHostPlugin.executeHostToAppCommand(".concat(JSON.stringify(n),');\n} catch (err) {\n    var commandResult = {\n        successful: false,\n        error: {\n            message: "Error occurred while executing plugin script. " + ((err && err.toString()) || "")\n        }\n    };\n    Cordova.exec(function () { }, function () { },\n        "').concat("AppHostPlugin",'", "').concat("notifyHostToAppCommandCompleted",'", ["').concat(n.callbackId,'", commandResult]);\n}\n')).catch((function(t){Core.Log.errorEx("AppHostPluginHandler._executeHostToAppCommandAsync","Error occurred invoking script.",{error:t,eventData:{commandFullName:e}}),r.error(t)})),r.promise},t.prototype.notifyHostToAppCommandCompleted=function(e){Contracts.checkObject(e),Contracts.checkNonEmpty(e.callbackId),Contracts.checkArray(e.args),Contracts.check(2===e.args.length);var t=e.args[0];Contracts.checkString(t);var n=this._pendingCallbacks[t];Contracts.checkValue(n),delete this._pendingCallbacks[t];var r=e.args[1];if(!Dt.isValidHostCommandCallResult(r))throw new Dt.PluginError(Dt.PluginErrorReason.InvalidArgs);if(Contracts.checkObject(r),Contracts.checkBoolean(r.successful),!0===r.successful)this._sendPluginResults(new q(B.Ok,[]),e.callbackId),n.complete(r.value);else try{throw Dt.Serialization.deserializeError(r.error)}catch(t){this._sendPluginResults(new q(B.Ok,[]),e.callbackId),n.error(t)}},t.prototype.executeAppToHostCommand=function(e){var t,n=this;Contracts.checkObject(e),Contracts.checkNonEmpty(e.callbackId),Contracts.checkArray(e.args),Core.Tasks.scheduleAsync((function(){Contracts.check(1===e.args.length);var r=e.args[0];if(!Dt.isValidAppToHostCommandCallInfo(r))throw new Dt.PluginError(Dt.PluginErrorReason.Unknown,"Invalid plugin command args.");t={commandFullName:r.fullName};var i=n._commander.tryGetAppToHostCommand(r.fullName);if(!i)throw new Dt.PluginError(Dt.PluginErrorReason.CommandNotFound,"Command not found: "+r.fullName);return Promise.resolve(i.execute(r.args))}),"executeAppToHostCommand").then((function(e){return void 0===e?{successful:!0}:{successful:!0,value:e}}),(function(e){return Core.Log.errorEx("AppHostPluginHandler.executeAppToHostCommand",{error:e,eventData:t}),{successful:!1,error:Dt.Serialization.serializeError(e)}})).then((function(t){n._sendPluginResults(new q(B.Ok,[t]),e.callbackId)}))},t.prototype.getHidePlayerErrorToastsFeatureEnabledAsync=function(e){var t=this;Promise.resolve().then((function(){return t._appHostErrorHandler.getIsHidePlayerErrorToastsEnabledAsync()})).then((function(n){Ut.Log.trackActivityEvent(Ut.OperationNames.appHostPluginGetHidePlayerErrorToastsFeatureEnabledAsyncOpName,{hidePlayerErrorToasts:n}),t._sendPluginResults(new q(B.Ok,[n]),e.callbackId)})).catch((function(n){Core.Log.error("AppHostPluginHandler.getHidePlayerErrorToastsFeatureEnabledAsync",n),t._sendPluginResults(new q(B.Error,n),e.callbackId)}))},t.prototype.refreshConnectionsAsync=function(e){var t=this;Ut.Log.trackActivityEvent(Ut.OperationNames.appHostPluginRefreshConnectionsAsyncStartedOpName),Promise.resolve().then((function(){return t._appHostErrorHandler.refreshAppConnectionsAsync()})).then((function(){Ut.Log.trackActivityEvent(Ut.OperationNames.appHostPluginRefreshConnectionsAsyncSucceededOpName),t._sendPluginResults(new q(B.Ok,null),e.callbackId)}),(function(n){Core.Log.error("AppHostPluginHandler.refreshConnectionsAsync",n),t._sendPluginResults(new q(B.Error,n),e.callbackId)}))},t.prototype.handleAppRuntimeErrorAsync=function(e){var t=this,n=e.args[0],r=e.args[1]||null,i=null;r&&(r.headers=HashTableUtility.create(r.headers),i=new AppMagic.Services.ServiceError(n,{response:r,serviceType:AppMagic.Services.ServiceType.Connector})),Promise.resolve().then((function(){return t._appHostErrorHandler.handleRuntimeErrorAsync(n,i)})).then((function(){t._sendPluginResults(new q(B.Ok,null),e.callbackId)}),(function(n){Core.Log.error("AppHostPluginHandler.refreshConnectionsAsync",n),t._sendPluginResults(new q(B.Error,n),e.callbackId)}))},t}(J),Vt=AppMagic.Runtime.App.Plugins.Serialized;var Ft=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i._httpPipeline=t,i._deserializeRequestBodyDataArg=r,i._isTransferableSupported=!1,i._httpClient=new AppMagic.Services.HttpClient(t),i}return __extends(t,e),t.prototype.getArrayBufferAsTransferable=function(e){try{if(Core.FeatureGates.services.EnableTransferable&&Core.Environment.isWebPlayer()){var t=new ArrayBuffer(5),n=t.byteLength;this._sendPluginResults(new q(B.Ok,{testArrayBufferByteLength:n,testArrayBuffer:t},[t]),e.callbackId);var r=t.byteLength;Core.Telemetry.Log.trackActivityEvent("AppHttpClientPluginHandler_GetArrayBufferAsTransferable",{testArrayBufferByteLengthBeforeTransfer:n,testArrayBufferByteLengthAfterTransfer:r})}}catch(e){Core.Log.errorEx("AppHttpClientPluginHandler_GetArrayBufferAsTransferable_Error","Plugin action failed",e)}},t.prototype.setTransferableSupport=function(e){try{if(Core.FeatureGates.services.EnableTransferable&&Core.Environment.isWebPlayer()){var t=!1;1===e.args.length&&"boolean"==typeof e.args[0]&&(this._isTransferableSupported=e.args[0],t=!0),Core.Telemetry.Log.trackActivityEvent("AppHttpClientPluginHandler_setTransferableSupport",{isTransferableSupported:this._isTransferableSupported,receivedResultFromApp:t})}}catch(e){Core.Log.errorEx("AppHttpClientPluginHandler_setTransferableSupport_Error","Plugin action failed",e)}},t.prototype.sendHttpAsync=function(e){var t=this,n=e.args;Core.PromiseUtils.wrapFunctionCall((function(){return t._sendHttpAsync(n)})).then((function(n){t._sendPluginResults(new q(B.Ok,n,t._tryGetTransferable(n)),e.callbackId)}),(function(n){t._sendPluginResults(t._sendHttpErrorToPluginResult(n),e.callbackId)}))},t.prototype._sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s,c,l,u,p,d;return __generator(this,(function(g){switch(g.label){case 0:return t=Date.now(),n=this._deserializeRequestParameters([e[0],e[1]]),r=function(e){if(Contracts.checkStringOrNullOrUndefined(e,"actionArg: responseType"),!e)return null;var t=e.toLowerCase();if(Vt.ResponseTypes.indexOf(t)<0)throw new Error("Invalid responseType passed to sendHttpAsync (V1) via plugin. responseType = '".concat(e,"'"));return t}(e[2])||"text",i=e[0].requestSource,o=e[0].requestId,a=e[0].allowSessionStorage,Contracts.check(void 0===i||"PublishedApp"===i,"actionArg: request.requestSource"),s={method:n.method,url:n.url,responseType:r},n.headers&&(s.headers=n.headers),n.bodyData&&(s.bodyData=n.bodyData),i&&(s.requestSource=i),o&&(s.requestId=o),a&&(s.allowSessionStorage=a),[4,this._httpPipeline.sendHttpAsync(s)];case 1:if(c=g.sent(),l=Date.now(),c.responseType!==r)throw new Error("The http pipeline returned a responseType of '".concat(c.responseType,"' when the plugin requested '").concat(r,"'."));if(u=c.responseType,Vt.ResponseTypes.indexOf(u)<0)throw new Error("pipelineResponse.responseType of '".concat(c.responseType,"' is not supported by the plugin."));return p=void 0===c.response?null:c.response,d={status:c.status,headers:c.headers,responseType:u},Core.Utility.isDefined(c.duration)&&(d.duration=c.duration),Core.Utility.isDefined(c.responseSize)&&(d.responseSize=c.responseSize),"text"===r&&(d.responseText=c.responseText),c.performanceInformation&&(d.performanceInformation=c.performanceInformation),c.sendHttpPipelinePerf&&(d.sendHttpPipelinePerf=c.sendHttpPipelinePerf),AppMagic.Services.ServiceUtility.addSendHttpPipelinePerf("AppHttpClientPluginHandler",d,t,l,Date.now()),[2,[d,p]]}}))}))},t.prototype.sendHttpIgnoreResponseAsync=function(e){var t=this,n=e.args,r=this._deserializeRequestParameters(n);this._httpClient.sendHttpIgnoreResponseAsync(r).then((function(){t._sendPluginResults(new q(B.Ok,null),e.callbackId)}),(function(n){t._sendPluginResults(t._sendHttpErrorToPluginResult(n),e.callbackId)}))},t.prototype.sendHttpTextResponseAsync=function(e){var t=this,n=e.args,r=this._deserializeRequestParameters(n);this._httpClient.sendHttpTextResponseAsync(r).then((function(n){t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(n){t._sendPluginResults(t._sendHttpErrorToPluginResult(n),e.callbackId)}))},t.prototype.sendHttpJsonResponseAsync=function(e){var t=this,n=e.args,r=this._deserializeRequestParameters(n);this._httpClient.sendHttpJsonResponseAsync(r).then((function(n){void 0===n&&(n=null),t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(n){t._sendPluginResults(t._sendHttpErrorToPluginResult(n),e.callbackId)}))},t.prototype.sendHttpBlobResponseAsync=function(e){var t=this,n=e.args,r=this._deserializeRequestParameters(n);this._httpClient.sendHttpBlobResponseAsync(r).then((function(n){void 0===n&&(n=null),t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(n){var r=t._sendHttpErrorToPluginResult(n);t._sendPluginResults(r,e.callbackId)}))},t.prototype._deserializeRequestParameters=function(e){var t=e[0],n=e[1],r={method:t.method,url:t.url};return t.headers&&(r.headers=HashTableUtility.create(t.headers)),null!==n&&(r.bodyData=this._deserializeRequestBodyDataArg(n)),r},t.prototype._sendHttpErrorToPluginResult=function(e){return e instanceof AppMagic.Services.ServiceError?this._serviceErrorToPluginResult(e):e instanceof Core.SendHttpInvalidResponseError?this._sendHttpErrorInvalidResponseToPluginResult(e):e instanceof Core.SendHttpErrorWithResponse?this._sendHttpErrorWithResponseToPluginResult(e):e instanceof Core.SendHttpError?new q(B.Error,[e.message,e.requestUrl]):new q(B.Error,[e.message])},t.prototype._serviceErrorToPluginResult=function(e){var t,n=e.response;return n&&n.response&&(t=n.response,delete n.response),new q(B.Error,[e.message,null,n,t])},t.prototype._sendHttpErrorWithResponseToPluginResult=function(e){var t=e.response,n=t.response||null;return delete t.response,new q(B.Error,[e.message,e.requestUrl,t,n])},t.prototype._sendHttpErrorInvalidResponseToPluginResult=function(e){var t=e.response,n=t.response||null;return delete t.response,new q(B.Error,[e.message,e.requestUrl,t,n,e.errorKind])},t.prototype._tryGetTransferable=function(e){var t;if(Core.FeatureGates.services.EnableTransferable&&this._isTransferableSupported&&(null==e?void 0:e.length)>1&&"arraybuffer"===(null===(t=e[Vt.SendHttpResults.sendHttpResponse])||void 0===t?void 0:t.responseType)&&e[Vt.SendHttpResults.sendHttpResponseDataValue]instanceof ArrayBuffer)return[e[Vt.SendHttpResults.sendHttpResponseDataValue]]},t}(J),zt=function(e){function t(t,n){var r=e.call(this,n)||this;return r._handleBehaviorFunctionExitAsyncFn=t,r}return __extends(t,e),t.prototype.exitAppAsync=function(e){var t=this;Contracts.checkObject(e),Contracts.checkNonEmpty(e.callbackId),Contracts.checkArray(e.args),Contracts.check(1===e.args.length);var n=e.args[0];Contracts.checkBoolean(n),this._handleBehaviorFunctionExitAsyncFn(n).then((function(n){return t._sendPluginResults(new q(B.Ok,n),e.callbackId)}),(function(){return t._sendPluginResults(new q(B.Error,!1),e.callbackId)}))},t}(J),Bt=function(e){function t(t,n){var r=e.call(this,t)||this;return r._urlLauncher=n,r}return __extends(t,e),t.prototype.launchInNewWindowAsync=function(e){var t,n=this;this._urlLauncher.launchInNewWindowAsync(e.args[0]).then((function(r){t=r?new q(B.Ok,!0):new q(B.Error,!1),n._sendPluginResults(t,e.callbackId)}),(function(){t=new q(B.Error,!1),n._sendPluginResults(t,e.callbackId)}))},t}(J),Wt=function(e){function t(t,n){var r=e.call(this,n)||this;return r._teamsHostClientType=Core.Environment.TeamsHostClientType.None,r._teamsHostClientType=t,r}return __extends(t,e),t.prototype.getTeamsHostClientType=function(e){Contracts.checkObject(e),Contracts.checkNonEmpty(e.callbackId),this._sendPluginResults(new q(B.Ok,this._teamsHostClientType),e.callbackId)},t}(J),jt=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.getActivatedFallbackSwitchesAsync=function(e){this._sendPluginResults(new q(B.Ok,Core.FallbackSwitch.getActivatedSwitches()),e.callbackId)},t}(J);function qt(e){return Core.Utility.isObject(e)&&Core.Utility.isNumber(e.major)&&Core.Utility.isNumber(e.minor)&&e.major>=1&&e.minor>=0}var Gt=/^[1-9]\d*\.\d+$/;function Jt(e){var t=function(e){if(!Gt.test(e))return null;var t=e.split(".");return{major:parseInt(t[0],10),minor:parseInt(t[1],10)}}(e);if(null===t)throw new Error("Invalid semantic version string: '".concat(e,"'"));return t}function Kt(e,t){return e.major===t.major?e.minor-t.minor:e.major-t.major}var Xt=Object.freeze({isValid:function(e){return void 0===e}});function Yt(e){return Core.Utility.isObject(e)&&"function"==typeof e.isValid}var Qt,Zt=Object.freeze([]),$t=Xt;function en(e){return Core.Utility.isObject(e)&&Core.Utility.isNonEmptyString(e.serviceName)&&qt(e.pluginVersion)&&Core.Utility.isJsonHashTable(e.actions)}function tn(e){return Core.Utility.isObject(e)&&Core.Utility.isNumber(e.minMinorVersion)&&e.minMinorVersion>=0&&(void 0===e.actionNameOverride||Core.Utility.isNonEmptyString(e.actionNameOverride))&&Core.Utility.isArray(e.arguments)&&e.arguments.every(nn)&&rn(e.result)}function nn(e){return Yt(e)&&Core.Utility.isNonEmptyString(e.name)}function rn(e){return Yt(e)}!function(e){e[e.Unknown=0]="Unknown",e[e.CordovaError=1]="CordovaError",e[e.PluginNotFound=2]="PluginNotFound",e[e.ActionNotFound=3]="ActionNotFound",e[e.InvalidActionArgs=4]="InvalidActionArgs",e[e.InvalidActionResult=5]="InvalidActionResult"}(Qt||(Qt={}));var on="LocalPlugins.Platform.LocalPluginError";var an=function(e){function t(t,n,r){var i=e.call(this,function(e,t,n){return n=n||Qt[e],"Error occurred executing action '".concat(t.actionName,"' for plugin with serviceName '").concat(t.serviceName,"'. ").concat(n)}(t,n,r),on)||this;return i.reason=t,i.context=n,i.reasonMessage=r,i}return __extends(t,e),t}(Core.ErrorBase);var sn=function(){function e(){}return Object.defineProperty(e.prototype,"capabilityName",{get:function(){return e.ContextAwareCapabilityName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"commandContext",{get:function(){return this._commandContext},set:function(e){this._commandContext=e},enumerable:!1,configurable:!0}),e.ContextAwareCapabilityName="ContextAwareCapability",e}();function cn(e){var t=e.__localServicesPluginControllerRegistration;return t?t.pluginDefinition:null}function ln(e){return function(t){if(null!==cn(t.prototype))throw new Error("Duplicate 'pluginController' decorator applied to class.");HashTableUtility.forEach(e.actions,(function(e,n){if(!t.prototype.hasOwnProperty(n))throw new Error("Controller class '".concat(t.name,"' missing target implementation function for action with key '").concat(n,"'."));if("function"!=typeof t.prototype[n])throw new Error("Controller class '".concat(t.name,"' target for action with key '").concat(n,"' should be defined as a function."))}));var n={pluginDefinition:e};t.prototype.__localServicesPluginControllerRegistration=n}}function un(e,t){return dn(e)&&e.errorName===t}function pn(e){return function(t){return un(t,e)}}function dn(e){return Core.Utility.isObject(e)&&Core.Utility.isNonEmptyString(e.errorName)&&"string"==typeof e.message&&"number"==typeof e.serializedVersion&&e.serializedVersion>=0&&void 0===e.stack}var gn,hn=0;function mn(e,t){return{errorName:e,serializedVersion:hn,message:t||""}}function fn(e){var t;if(Core.Utility.isError(e)){if(e.name)return mn(e.name,e.message);t=e.message}else t="string"==typeof e?e:"An error of type ".concat(null===e?"null":typeof e," occurred.");return mn("Error",t)}!function(e){e[e.Unknown=0]="Unknown",e[e.TypeNotSupported=1]="TypeNotSupported",e[e.VersionNotSupported=2]="VersionNotSupported",e[e.InvalidData=3]="InvalidData"}(gn||(gn={}));var yn="LocalServices.Platform.Serialization.SerializationError";var vn=function(e){function t(t,n){var r=e.call(this,function(e,t){return"Serialization or deserialization failed. Reason: [".concat(gn[e],"] ").concat(t||"")}(t,n),yn)||this;return r.reason=t,r.reasonMessage=n,r}return __extends(t,e),t}(Core.ErrorBase),_n=function(){function e(e,t){this.errorName=e,this._errorCtor=t,this.minVersionSupported=hn,this.maxVersionSupported=hn}return e.prototype.serializeError=function(e,t){if(Contracts.check(t<=this.maxVersionSupported,"requestedVersion"),!(e instanceof this._errorCtor))throw new vn(gn.TypeNotSupported);return{errorName:this.errorName,serializedVersion:hn,message:e.message||""}},e.prototype.deserializeError=function(e){return new this._errorCtor(e.message)},e}(),Cn="LocalServices.Platform.Serialization.UnknownSerializedError";var Pn=function(e){function t(t){var n=e.call(this,function(e){return"[".concat(e.errorName,"] ").concat(e.message)}(t),Cn)||this;return n.serialized=t,n}return __extends(t,e),t}(Core.ErrorBase),bn=function(){function e(e){this._knownErrorTypesMetadataSets=e,this._serializersByName=HashTableUtility.create(),this.addMessageOnlySerializer("Error",Error)}return e.prototype.addSerializer=function(e){this._serializersByName[e.errorName]=e},e.prototype.addMessageOnlySerializer=function(e,t){var n=new _n(e,t);this.addSerializer(n)},e.prototype._getPreferredVersion=function(e,t){var n=this._knownErrorTypesMetadataSets[t];if(!n)return 0;var r=n[e];return r?r.preferredSerializerVersion:0},e.prototype.serializeError=function(e,t){if(Core.Utility.isError(e)&&e.name){var n=this._serializersByName[e.name];if(n){var r=this._getPreferredVersion(e.name,t);if(r>=n.minVersionSupported&&r<=n.maxVersionSupported)return n.serializeError(e,r);0!==r&&Core.Telemetry.Log.trackActivityEvent("ErrorSerializersManager.serializeError",{message:"Serializer does not support requested version. Falling back to message-only serializer.",errorName:e.name,minVersionSupported:n.minVersionSupported,maxVersionSupported:n.maxVersionSupported,requestedVersion:r})}}return fn(e)},e.prototype.deserializeError=function(e){var t=this._serializersByName[e.errorName];if(t){if(e.serializedVersion>=t.minVersionSupported&&e.serializedVersion<=t.maxVersionSupported)return t.deserializeError(e);0!==e.serializedVersion&&Core.Telemetry.Log.trackActivityEvent("ErrorSerializersManager.serializeError",{message:"Serializer does not support the serializedVersion. Deserializing as UnknownSerializedError.",errorName:e.errorName,minVersionSupported:t.minVersionSupported,maxVersionSupported:t.maxVersionSupported,serializedVersion:e.serializedVersion})}return new Pn(e)},e}(),An="LocalServices.Platform.Serialization.Errors.interfaces";function wn(e,t){return t[e]}function Sn(e,t){if(!e)return null;var n=t[e];return"number"==typeof n?n:null}function En(e,t,n){var r=Sn(e,t);return null===r?n:r}var kn=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;o.getSerializationState=n,o._errorsSerializer=r;for(var a=function(e){var t=i[e],n=cn(t);if(null===n)throw new Error("Invalid controller instance. The class for the controller must specify the 'pluginController' decorator.");if(0===e)s._serviceName=n.serviceName;else if(n.serviceName!==s._serviceName)throw new Error("All controllers must share the same serviceName. Expected: ".concat(s._serviceName,". Actual: ").concat(n.serviceName,"."));HashTableUtility.forEach(n.actions,(function(e,n){return o._registerCommandHandler(t,e,n)}))},s=this,c=0;c<i.length;c++)a(c);return o}return __extends(t,e),Object.defineProperty(t.prototype,"serviceName",{get:function(){return this._serviceName},enumerable:!1,configurable:!0}),t.prototype._registerCommandHandler=function(e,t,n){var r=this;var i=t.actionNameOverride||n;if(void 0!==this[i])throw new Error("The actionName '".concat(i,"' has already been defined for service '").concat(this._serviceName,"'."));var o=e&&e.capabilities&&e.capabilities[sn.ContextAwareCapabilityName],a={serviceName:this._serviceName,actionName:i,actionDef:t,actionImplementationFunc:function(t,r){return o&&(o.commandContext=r),e[n].apply(e,t)}};this[i]=function(e){var t=e.args||[];r._handleActionCall(a,e.callbackId,t,e.context)}},t.prototype._handleActionCall=function(e,t,n,r){var i=this;Promise.resolve().then((function(){return __awaiter(i,void 0,void 0,(function(){var i,o,a,s,c;return __generator(this,(function(l){switch(l.label){case 0:return l.trys.push([0,2,,3]),function(e,t,n){var r=t.length;if(n.length>r)throw new an(Qt.InvalidActionArgs,e,"Too many arguments specified. Allowed: ".concat(r,". Got: ").concat(n.length,"."));for(var i=0;i<r;i++){var o=t[i];if(!o.isValid(n[i]))throw new an(Qt.InvalidActionArgs,e,"The value for argument '".concat(o.name,"' (index ").concat(i,") is invalid."))}}(e,e.actionDef.arguments,n),[4,e.actionImplementationFunc(n,r)];case 1:return i=l.sent(),this._sendPluginResults(new q(B.Ok,i),t),[3,3];case 2:o=l.sent(),Core.PromiseUtils.throwIfCanceled(o),a={serviceName:e.serviceName,actionName:e.actionName,minMinorVersion:e.actionDef.minMinorVersion},Core.Log.errorEx("ActionsControllerPluginHandler._handleActionCall",{message:"Action executed with an error.",error:o,eventData:a}),s=void 0;try{c=this.getSerializationState().errorTypesSetVersion,s=this._errorsSerializer.serializeError(o,c)}catch(e){Core.Log.errorEx("ActionsControllerPluginHandler._handleActionCall",{message:"An error occurred trying to serialize an error thrown by a plugin action. Falling back to base serialization logic.",error:e,eventData:a}),s=fn(o)}return this._sendPluginResults(new q(B.Error,s),t),[3,3];case 3:return[2]}}))}))}))},t}(J);var In=Xt,Tn=Xt,Rn=/^[a-z][a-zA-Z0-9_]*Async$/,Mn=/^[a-z][a-zA-Z0-9_]*$/,Nn=/(Event|Async)$/i,xn=["isdisposed","disposed","dispose","disposeasync"];function Ln(e){return Core.Utility.isObject(e)&&Core.Utility.isNonEmptyString(e.serviceName)&&qt(e.serviceVersion)&&Core.Utility.isJsonHashTable(e.events)&&HashTableUtility.every(e.events,(function(e,t){return Un(t)}))&&Core.Utility.isJsonHashTable(e.commands)&&HashTableUtility.every(e.commands,(function(e,t){return Hn(t)}))}function Hn(e){return"string"==typeof e&&Rn.test(e)&&-1===xn.indexOf(e.toLowerCase())}function Dn(e){return Core.Utility.isObject(e)&&Core.Utility.isNumber(e.minMinorVersion)&&e.minMinorVersion>=0&&Vn(e.args)&&Fn(e.result)}function Un(e){return"string"==typeof e&&Mn.test(e)&&!Nn.test(e)&&-1===xn.indexOf(e.toLowerCase())}function On(e){return Core.Utility.isObject(e)&&Core.Utility.isNumber(e.minMinorVersion)&&e.minMinorVersion>=0&&Vn(e.args)}function Vn(e){return Yt(e)}function Fn(e){return Yt(e)}function zn(){return{isPluginMetadataExchanged:!1,localPlugins:HashTableUtility.create(),serialization:{errorTypesSetVersion:0}}}function Bn(e,t){return{isPluginMetadataExchanged:!0,localPlugins:e.localPlugins,serialization:{errorTypesSetVersion:Wn(t)}}}function Wn(e){return e.tryGetHighestSupportedVersionNumber("ErrorSerializersManager",AppMagic.Runtime.App.Plugins.MetadataActionName.LocalSerializerTypesSetVersion)||0}var jn=AppMagic.Runtime.App.Plugins;function qn(e){return parseInt(e,10)}function Gn(e,t){var n=e.split(",").map(Jt).sort(Kt);if(n.some((function(e,t){return t>0&&e.major===n[t-1].major})))throw new Error("The value for metadata action '".concat(jn.MetadataActionName.LocalPluginVersionsCSV,"' and serviceName '").concat(t,"' should contain only one item per major version."));return n}var Jn=function(){function e(e){this._pluginVersionManager=e}return e.prototype._tryGetAndParseMetadataStrings=function(e,t,n){if(!this._pluginVersionManager.versionsExchanged.hasFired){var r=new Core.InvalidOperationError("LocalSerialization.MetadataService._getAndParseMetadataStrings","PluginVersionManager must finish exchanging version metadata before trying to retrieve metadata.");throw Core.Log.errorEx("LocalSerialization.MetadataService._getAndParseMetadataStrings",{error:r,eventData:{serviceName:e,metadataOrActionName:t}}),r}var i=this._pluginVersionManager.tryGetAppVersionString(e,t),o=this._pluginVersionManager.tryGetHostVersionString(e,t);return{appValue:i?n(i,e):null,hostValue:o?n(o,e):null}},e.prototype.tryGetHighestSupportedVersionNumber=function(e,t){var n=this._tryGetAndParseMetadataStrings(e,t,qn),r=n.appValue,i=n.hostValue;return null===r||null===i?null:r<=i?r:i},e.prototype.tryGetHighestSupportedSemanticVersion=function(e,t){var n=this._tryGetAndParseMetadataStrings(e,t,Jt),r=n.appValue,i=n.hostValue;return null===r||null===i||r.major!==i.major?null:{major:r.major,minor:r.minor>i.minor?i.minor:r.minor}},e.prototype.tryGetHighestSupportedSemanticVersionFromList=function(e,t){var n=this._tryGetAndParseMetadataStrings(e,t,Gn),r=n.appValue,i=n.hostValue;return null===r||null===i?null:function(e,t){var n=e.length-1,r=t.length-1;if(n<0||r<0)return null;for(var i=e[n],o=t[r];i.major!==o.major;)if(i.major>o.major){if(--n<0)return null;i=e[n]}else{if(--r<0)return null;o=t[r]}return{major:i.major,minor:i.minor>o.minor?o.minor:i.minor}}(r,i)},e.prototype.tryGetHighestSupportedLocalPluginVersion=function(e){return this.tryGetHighestSupportedSemanticVersionFromList(e,jn.MetadataActionName.LocalPluginVersionsCSV)},e.prototype.tryGetHighestSupportedActionVersion=function(e,t){return this.tryGetHighestSupportedVersionNumber(e,t)},e}();var Kn,Xn={serviceName:"AppIdentityServicePlugin",pluginVersion:{major:2,minor:2},actions:{getAppAccessTokenAsync:{minMinorVersion:0,arguments:[{name:"connectionApiId",isValid:Core.Utility.isNonEmptyString}],result:{isValid:Core.Utility.isNonEmptyString}},getAppDynamicResourceAccessTokenAsync:{minMinorVersion:2,arguments:[{name:"resourceId",isValid:Core.Utility.isNonEmptyString}],result:{isValid:Core.Utility.isNonEmptyString}},getPowerBIReadOnlyAccessTokenAsync:{minMinorVersion:0,arguments:p.NoArguments,result:{isValid:Core.Utility.isNonEmptyString}},getFormsProReadOnlyAccessTokenAsync:{minMinorVersion:0,arguments:p.NoArguments,result:{isValid:Core.Utility.isNonEmptyString}},getMicrosoftStreamAccessTokenAsync:{minMinorVersion:0,arguments:p.NoArguments,result:{isValid:Core.Utility.isNonEmptyString}}}},Yn=function(){function e(e){this._serviceVNext=e}return e.prototype.getAppAccessTokenAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t={resourceName:"appservice",apiId:e},[4,this._serviceVNext.getAccessTokenForResourceAsync(t)];case 1:return[2,n.sent().accessToken]}}))}))},e.prototype.getAppDynamicResourceAccessTokenAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return t={resourceName:"dynamic",resourceId:e},[4,this._serviceVNext.getAccessTokenForResourceAsync(t)];case 1:return[2,n.sent().accessToken]}}))}))},e.prototype.getPowerBIReadOnlyAccessTokenAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e={resourceName:"powerbi-readonly"},[4,this._serviceVNext.getAccessTokenForResourceAsync(e)];case 1:return[2,t.sent().accessToken]}}))}))},e.prototype.getFormsProReadOnlyAccessTokenAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e={resourceName:"formspro-readonly"},[4,this._serviceVNext.getAccessTokenForResourceAsync(e)];case 1:return[2,t.sent().accessToken]}}))}))},e.prototype.getMicrosoftStreamAccessTokenAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return e={resourceName:"microsoftstream"},[4,this._serviceVNext.getAccessTokenForResourceAsync(e)];case 1:return[2,t.sent().accessToken]}}))}))},e=__decorate([ln(Xn)],e)}();function Qn(e,t){return t.indexOf(e)>=0}function Zn(e){return function(t){return null===t||e(t)}}function $n(e){return function(t){return t===e}}function er(e,t){return void 0===t&&(t={}),function(n){if(!Core.Utility.isArray(n))return!1;var r=n.length;if(void 0!==t.minItems&&t.minItems>0&&r<t.minItems)return!1;for(var i=0;i<r;i++)if(!e(n[i]))return!1;return!0}}function tr(e,t){return void 0===t&&(t={}),function(n){if(!Core.Utility.isAnyHashTable(n))return!1;for(var r in n){if(t.isValidKey&&!t.isValidKey(r))return!1;if(!e(n[r]))return!1}return!0}}function nr(e){if(Core.Utility.isFunction(e))return e;var t={};for(var n in e)t[n]=nr(e[n]);return function(e){return function e(t,n){if(!Core.Utility.isJsonObject(n))return!1;for(var r in t){var i=t[r];if(Core.Utility.isFunction(i)){if(!i(n[r]))return!1}else if(!e(i,n[r]))return!1}return!0}(t,e)}}(function(e){var t=nr({id:Core.Utility.isNonEmptyString,name:Core.Utility.isNonEmptyString,type:$n("connection"),properties:{apiId:Core.Utility.isNonEmptyString,api:{id:Core.Utility.isNonEmptyString,name:Core.Utility.isNonEmptyString,type:$n("api"),properties:{runtimeUrls:er(Core.Utility.isAbsoluteUrlString,{minItems:1}),capabilities:Core.Utility.isArray}}}});e.isValid=function(e){return t(e)}})(Kn||(Kn={}));var rr,ir,or,ar,sr,cr={serviceName:"AppPowerAppsClientPlugin",pluginVersion:{major:1,minor:0},actions:{loadAppConnectionsAsync:{minMinorVersion:0,arguments:p.NoArguments,result:{isValid:tr(Kn.isValid,{isValidKey:Core.Utility.isNonEmptyString})}}}};!function(e){var t=nr({apiId:Core.Utility.isNonEmptyString,connectionName:Core.Utility.isNonEmptyString,runtimeUrl:Core.Utility.isAbsoluteUrlString,datasetNameOverride:Core.Utility.isNonEmptyStringOrUndefined,tableNameOverride:Core.Utility.isNonEmptyStringOrUndefined});e.isValid=function(e){return t(e)}}(rr||(rr={})),function(e){var t=nr({runtimeUrl:Core.Utility.isAbsoluteUrlString,entitySetName:Core.Utility.isNonEmptyString,logicalName:Core.Utility.isNonEmptyString});e.isValid=function(e){return t(e)}}(ir||(ir={})),function(e){var t=nr({componentName:Core.Utility.isNonEmptyString,identifier:Core.Utility.isNonEmptyString,identifierType:Core.Utility.isNonEmptyString,runtimeUrl:Core.Utility.isAbsoluteUrlString});e.isValid=function(e){return t(e)}}(or||(or={})),function(e){var t=nr({appId:Core.Utility.isNonEmptyString,appName:Core.Utility.isNonEmptyString,sessionId:Core.Utility.isNonEmptyString,objectId:Core.Utility.isNonEmptyString,tenantId:Core.Utility.isNonEmptyString,environmentId:Core.Utility.isNonEmptyString});e.isValid=function(e){return t(e)}}(ar||(ar={})),function(e){var t=nr({osType:Core.Utility.isNonEmptyString,version:Core.Utility.isNonEmptyStringOrUndefined,offlineEnabled:Core.Utility.isBoolean});e.isValid=function(e){return t(e)}}(sr||(sr={}));var lr={serviceName:"AppPowerAppsClientPlugin",pluginVersion:{major:2,minor:6},actions:{loadAppConnectionsAsync:{minMinorVersion:0,actionNameOverride:"loadAppConnectionsAsync_v2",arguments:p.NoArguments,result:{isValid:tr(rr.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},getAppCdsDataSourceConfigsAsync:{minMinorVersion:1,actionNameOverride:"getAppCdsDataSourceConfigsAsync",arguments:p.NoArguments,result:{isValid:tr(ir.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},getAppCdsDatabaseReferenceComponents:{minMinorVersion:2,actionNameOverride:"getAppCdsDatabaseReferenceComponents",arguments:p.NoArguments,result:{isValid:er(or.isValid)}},getPcfUserIdFromCdsAsync:{minMinorVersion:3,actionNameOverride:"getPcfUserIdFromCdsAsync",arguments:p.NoArguments,result:{isValid:Core.Utility.isNonEmptyString}},loadNonCompositeConnectionsAsync:{minMinorVersion:4,actionNameOverride:"loadNonCompositeConnectionsAsync",arguments:p.NoArguments,result:{isValid:tr(rr.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},resolveCompositeConnectionsAsync:{minMinorVersion:4,actionNameOverride:"resolveCompositeConnectionsAsync",arguments:p.NoArguments,result:{isValid:tr(rr.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},getAppMetadataAsync:{minMinorVersion:5,actionNameOverride:"getAppMetadataAsync",arguments:p.NoArguments,result:{isValid:ar.isValid}},getHostMetadataAsync:{minMinorVersion:6,actionNameOverride:"getHostMetadataAsync",arguments:[{name:"browserUserAgent",isValid:Core.Utility.isNonEmptyString}],result:{isValid:sr.isValid}}}},ur=function(){function e(e,t){this._serviceVNext=e,this._capabilities=t}return Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!1,configurable:!0}),e.prototype.loadAppConnectionsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.getAppDataSourceConfigsAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.getAppCdsDataSourceConfigsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.getAppCdsDataSourceConfigsAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.getAppCdsDatabaseReferenceComponents=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.getAppCdsDatabaseReferenceComponents()];case 1:return[2,e.sent()]}}))}))},e.prototype.getPcfUserIdFromCdsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.getPcfUserIdFromCdsAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.loadNonCompositeConnectionsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.loadNonCompositeConnectionsAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.resolveCompositeConnectionsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.resolveCompositeConnectionsAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.getAppMetadataAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.getAppMetadataAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.getHostMetadataAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this.setCommandContext(),[4,this._serviceVNext.getHostMetadataAsync(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.setCommandContext=function(){var e=this._capabilities&&this._capabilities[sn.ContextAwareCapabilityName];e&&(this._serviceVNext.commandContext=e.commandContext)},e=__decorate([ln(lr)],e)}();function pr(e){return{id:"<connection id not used>",name:e.connectionName,type:"connection",properties:{apiId:e.apiId,api:{id:e.apiId,name:"<api name not used>",type:"api",properties:{runtimeUrls:[e.runtimeUrl],capabilities:[]}}}}}var dr,gr,hr=function(){function e(e){this._pluginVNext=e}return e.prototype.loadAppConnectionsAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this._pluginVNext.loadAppConnectionsAsync()];case 1:return e=t.sent(),[2,HashTableUtility.map(e,pr)]}}))}))},e=__decorate([ln(cr)],e)}();function mr(e){return null===e||(Core.Utility.isTuple(e)?gr.isValid(e[0])&&(null===e[1]||void 0===e[1]||Core.Utility.isBlob(e[1])):dr.isValid(e))}(function(e){var t=nr({fullName:Core.Utility.isStringOrUndefined,email:Core.Utility.isStringOrUndefined,imageUrl:Core.Utility.isAbsoluteUrlStringOrUndefined,objectId:Core.Utility.isStringOrUndefined});e.isValid=function(e){return t(e)}})(dr||(dr={})),function(e){var t=nr({fullName:Core.Utility.isStringOrUndefined,email:Core.Utility.isStringOrUndefined});e.isValid=function(e){return t(e)}}(gr||(gr={}));var fr={serviceName:"PowerAppsServicePlugin",pluginVersion:{major:2,minor:1},actions:{getPowerAppsCurrentUserAsync:{minMinorVersion:0,actionNameOverride:"getPowerAppsCurrentUser",arguments:p.NoArguments,result:{isValid:mr}},getPowerAppsCurrentUserAsyncV2:{minMinorVersion:1,actionNameOverride:"getPowerAppsCurrentUserV2",arguments:[{name:"getPartialUser",isValid:Core.Utility.isBoolean}],result:{isValid:mr}}}},yr=function(){function e(e){this._serviceVNext=e}return e.prototype.getPowerAppsCurrentUserAsyncV2=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._serviceVNext.tryGetCurrentUserAsyncV2(e)];case 1:return[2,t.sent()]}}))}))},e.prototype.getPowerAppsCurrentUserAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._serviceVNext.tryGetCurrentUserAsync()];case 1:return[2,e.sent()]}}))}))},e=__decorate([ln(fr)],e)}();var vr=Core.PABinary,_r=Core.InvalidBinarySourceReason,Cr=["PABinary-appRelativeFileV1","PABinary-base64StringV1","PABinary-invalidV1"];function Pr(e){return Core.Utility.isJsonObject(e)&&Cr.indexOf(e.serializedType)>=0}function br(e,t){return{serializedType:"PABinary-base64StringV1",base64:e,contentType:t}}var Ar=function(){function e(){}return e.prototype.serializeBinaryV1Async=function(e,t){return void 0===t&&(t=!1),__awaiter(this,void 0,Promise,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:switch(e.source.sourceType){case"appRelativeFile":return[3,1];case"arrayBuffer":return[3,2];case"base64String":return[3,3];case"blob":return[3,4];case"invalid":return[3,6]}return[3,7];case 1:return[2,r={serializedType:"PABinary-appRelativeFileV1",relativeUrl:e.source.relativeUrl,contentType:e.contentType,size:e.size}];case 2:return[2,br(Core.IO.Utility.Conversion.arrayBufferToBase64(e.source.buffer),e.contentType)];case 3:return[2,br(e.source.base64,e.contentType)];case 4:if(Core.Utility.isPABlobPolyfill(e.source.blob))throw new Core.InvalidOperationError("PABinarySerializer.serializeBinaryV1Async","Serialization of PABlob instances are not currently supported.");return[4,Core.IO.Utility.Conversion.convertBlobToArrayBuffer(e.source.blob)];case 5:return n=i.sent(),[2,br(Core.IO.Utility.Conversion.arrayBufferToBase64(n),e.contentType)];case 6:if(!t)throw Core.PABinary.createErrorFromInvalid(e);return 0===(r={serializedType:"PABinary-invalidV1",reasonName:_r[e.source.reason],contentType:e.contentType,size:e.size}).size&&delete r.size,r.contentType||delete r.contentType,[2,r];case 7:throw new Core.NotSupportedError("PABinarySerializer.serializeBinaryV1Async","PABinary sourceType '".concat(e.source.sourceType,"' cannot be serialized with this version."));case 8:return[2]}}))}))},e.prototype.deserializeBinary=function(e){switch(Contracts.check(Core.Utility.isJsonObject(e)),Contracts.checkNonEmpty(e.serializedType),e.serializedType){case"PABinary-appRelativeFileV1":return Contracts.checkNonEmpty(e.relativeUrl),Contracts.checkNonEmpty(e.contentType),Contracts.checkNumber(e.size),Contracts.check(e.size>=0,"size should be greater than or equal to 0."),vr.createFromAppRelativeFile(e.relativeUrl,e.size,e.contentType);case"PABinary-base64StringV1":return Contracts.checkString(e.base64),Contracts.checkNonEmpty(e.contentType),vr.createFromBase64String(e.base64,e.contentType);case"PABinary-invalidV1":Contracts.checkNonEmpty(e.reasonName),Contracts.checkNonEmptyOrUndefined(e.contentType),Contracts.checkNumberOrUndefined(e.size),Contracts.check((e.size||0)>=0,"size should be greater than or equal to 0.");var t=function(e){var t=_r[e];if("number"==typeof t)return t;return Core.Log.errorEx("Plugins.Serialization.deserializeInvalidBinarySourceReasonName[PluginError]","Unrecognized reasonName '".concat(e,"'. Converting to Unknown.")),_r.Unknown}(e.reasonName);return vr.createInvalid({reason:t,contentType:e.contentType,size:e.size});default:throw new Error("Unknown serialized PABinary serializedType: "+e.serializedType)}},e}();var wr,Sr,Er=tr(Core.Utility.isString,{isValidKey:Core.Utility.isNonEmptyString});!function(e){var t=nr({url:Core.Utility.isAbsoluteUrlString,method:function(e){return"string"==typeof e&&e.length>0&&e===e.toUpperCase()},headers:Er,binaryBody:Zn(Pr)});e.isValid=function(e){return t(e)&&null===HashTableUtility.tryGetKeyIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.ContentType)&&null===HashTableUtility.tryGetKeyIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.ContentLength)}}(wr||(wr={})),function(e){var t=nr({status:function(e){return"number"==typeof e&&e>=0},headers:Er,binaryBody:Zn(Pr)});e.isValid=function(e){return t(e)}}(Sr||(Sr={}));var kr,Ir,Tr={serviceName:"SendHttpPipelinePlugin",pluginVersion:{major:1,minor:0},actions:{sendHttpAsync:{minMinorVersion:0,arguments:[{name:"request",isValid:wr.isValid}],result:{isValid:Sr.isValid}}}},Rr=(AppMagic.Services,function(){function e(e,t){this._appSendHttpPipeline=e,this._pabinarySerializer=t}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s,c;return __generator(this,(function(l){switch(l.label){case 0:return t=Date.now(),n={url:e.url,method:e.method,headers:HashTableUtility.create(e.headers),requestSource:"PublishedApp",responseType:"pabinary",requestId:e.requestId},e.binaryBody&&(n.bodyData=this._pabinarySerializer.deserializeBinary(e.binaryBody)),[4,this._appSendHttpPipeline.sendHttpAsync(n)];case 1:if(r=l.sent(),i=Date.now(),"pabinary"!==r.responseType)throw new Error("sendHttpAsync should have returned a responseType of 'pabinary' but got '".concat(r.responseType,"'."));return o=r.response||null,c={status:r.status,headers:HashTableUtility.create(r.headers)},null!==o?[3,2]:(s=null,[3,4]);case 2:return[4,this._pabinarySerializer.serializeBinaryV1Async(o)];case 3:s=l.sent(),l.label=4;case 4:return c.binaryBody=s,a=c,void 0!==r.responseSize&&(a.responseSize=r.responseSize),void 0!==r.duration&&(a.duration=r.duration),r.performanceInformation&&(a.performanceInformation=r.performanceInformation),r.sendHttpPipelinePerf&&(a.sendHttpPipelinePerf=r.sendHttpPipelinePerf),AppMagic.Services.ServiceUtility.addSendHttpPipelinePerf("SendHttpPipelinePluginV1Controller",a,t,i,Date.now()),[2,a]}}))}))},e=__decorate([ln(Tr)],e)}());function Mr(e){return null!=e}function Nr(e){return"number"==typeof e&&e>=0}(function(e){var t=nr({key:Core.Utility.isNonEmptyString,estimatedSize:Nr,maxLimit:Nr,data:Zn(Pr),assets:Mr});e.isValid=function(e){return t(e)}})(kr||(kr={})),function(e){var t=nr({data:Zn(Pr),assets:Mr,isMissingKey:Core.Utility.isBoolean});e.isValid=function(e){return t(e)}}(Ir||(Ir={}));var xr,Lr={serviceName:"SaveDataLoadDataPlugin",pluginVersion:{major:1,minor:0},actions:{saveDataAsync:{minMinorVersion:0,arguments:[{name:"data",isValid:kr.isValid}],result:{isValid:Nr}},loadDataAsync:{minMinorVersion:0,arguments:[{name:"key",isValid:Core.Utility.isNonEmptyString}],result:{isValid:Ir.isValid}},clearDataAsync:{minMinorVersion:0,arguments:[{name:"key",isValid:Core.Utility.isNonEmptyStringOrNullOrUndefined}],result:{isValid:Core.Utility.isBoolean}}}},Hr=function(){function e(e,t,n){this._lazyDataStateManager=e,this._pabinarySerializer=t,this._capabilities=n,this._binaryResolver=new AppMagic.Services.WinJSPABinaryResolver(WinJS.xhr)}return Object.defineProperty(e.prototype,"capabilities",{get:function(){return this._capabilities},enumerable:!1,configurable:!0}),e.prototype.saveDataAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s,c,l=this;return __generator(this,(function(u){switch(u.label){case 0:u.label=1;case 1:return u.trys.push([1,8,,9]),[4,(t=this._lazyDataStateManager.value).getAppStoragePromiseAsync(this.getCustomPageLogicalName())];case 2:return u.sent(),n=e.key,r=e.estimatedSize,i=e.maxLimit,o=null,e.data?[4,this._pabinarySerializer.deserializeBinary(e.data)]:[3,5];case 3:return a=u.sent(),[4,this._binaryResolver.getAsTextAsync(a)];case 4:o=u.sent(),u.label=5;case 5:return s=HashTableUtility.create(),[4,Core.PromiseUtils.join(HashTableUtility.mapToArray(e.assets,(function(e,t){return __awaiter(l,void 0,void 0,(function(){var n,r,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,this._pabinarySerializer.deserializeBinary(e)];case 1:return n=o.sent(),r=s,i=t,[4,this._binaryResolver.getAsArrayBufferAsync(n)];case 2:return r[i]=o.sent(),[2]}}))}))})))];case 6:return u.sent(),[4,t.setDataStoreAsync(n,r,i,o,s)];case 7:return[2,u.sent()];case 8:throw c=u.sent(),Core.Log.error("Controller.saveDataAsync",c),c;case 9:return[2]}}))}))},e.prototype.loadDataAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,a,s,c=this;return __generator(this,(function(l){switch(l.label){case 0:l.label=1;case 1:return l.trys.push([1,9,,10]),[4,(t=this._lazyDataStateManager.value).getAppStoragePromiseAsync(this.getCustomPageLogicalName())];case 2:return l.sent(),[4,t.getDataStoreAsync(e)];case 3:return n=l.sent(),r=n.data?Core.PABinary.createFromText(n.data,AppMagic.Services.HttpConstants.MediaType.ApplicationJson):null,i=HashTableUtility.create(),n.assets?[4,Core.PromiseUtils.join(HashTableUtility.mapToArray(n.assets,(function(e,t){return __awaiter(c,void 0,void 0,(function(){var n,r,o,a,s;return __generator(this,(function(c){switch(c.label){case 0:return n=new Core.Url(t).getSegment(-1),r=n.substring(n.lastIndexOf(".")),o=Core.MimeTypes.tryGetMimeType(r.toLowerCase()),a=Core.PABinary.createFromArrayBuffer(e,o),[4,this._pabinarySerializer.serializeBinaryV1Async(a)];case 1:return s=c.sent(),i[t]=s,[2]}}))}))})))]:[3,5];case 4:l.sent(),l.label=5;case 5:return s={},null!=r?[3,6]:(o=null,[3,8]);case 6:return[4,this._pabinarySerializer.serializeBinaryV1Async(r)];case 7:o=l.sent(),l.label=8;case 8:return s.data=o,s.assets=i,s.isMissingKey=n.isMissingKey,[2,s];case 9:throw a=l.sent(),Core.Log.error("Controller.loadDataAsync",a),a;case 10:return[2]}}))}))},e.prototype.clearDataAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){switch(r.label){case 0:r.label=1;case 1:return r.trys.push([1,4,,5]),[4,(t=this._lazyDataStateManager.value).getAppStoragePromiseAsync(this.getCustomPageLogicalName())];case 2:return r.sent(),[4,t.clearDataStoreAsync(e)];case 3:return[2,r.sent()];case 4:throw n=r.sent(),Core.Log.error("Controller.clearDataAsync",n),n;case 5:return[2]}}))}))},e.prototype.getCustomPageLogicalName=function(){var e,t;return this.capabilities&&(null===(t=null===(e=this.capabilities[sn.ContextAwareCapabilityName])||void 0===e?void 0:e.commandContext)||void 0===t?void 0:t.appId)},e=__decorate([ln(Lr)],e)}();function Dr(e){return!(!Core.Utility.isJsonObject(e)||!Qn(e.resourceName,["appservice","dynamic","powerbi-readonly","formspro-readonly","microsoftstream"]))&&("appservice"===e.resourceName?Core.Utility.isNonEmptyString(e.apiId):"dynamic"!==e.resourceName||Core.Utility.isNonEmptyString(e.resourceId))}function Ur(e){return Core.Utility.isJsonObject(e)&&Qn(e.tokenType,["paauth","bearer","dynamicauth"])&&Core.Utility.isNonEmptyString(e.accessToken)}(function(e){var t=nr({fullName:Core.Utility.isStringOrUndefined,email:Core.Utility.isStringOrUndefined,imageUrl:Core.Utility.isAbsoluteUrlStringOrUndefined,objectId:Core.Utility.isStringOrUndefined});e.isValid=function(e){return t(e)}})(xr||(xr={}));var Or,Vr,Fr,zr,Br,Wr={serviceName:"HostAuthenticationService",serviceVersion:{major:1,minor:3},commands:{tryGetCurrentUserAsync:{minMinorVersion:0,args:h.VoidArgs,result:{isValid:Zn(xr.isValid)}},tryGetCurrentUserAsyncV2:{minMinorVersion:3,args:{isValid:Core.Utility.isBoolean},result:{isValid:Zn(xr.isValid)}},getAccessTokenForResourceAsync:{minMinorVersion:0,args:{isValid:Dr},result:{isValid:Ur}}},events:{}},jr="HostAuthenticationService.V1.server";(function(e){var t=nr({apiId:Core.Utility.isNonEmptyString,connectionName:Core.Utility.isNonEmptyString,runtimeUrl:Core.Utility.isAbsoluteUrlString,datasetNameOverride:Core.Utility.isNonEmptyStringOrUndefined,tableNameOverride:Core.Utility.isNonEmptyStringOrUndefined});e.isValid=function(e){return t(e)}})(Or||(Or={})),function(e){var t=nr({runtimeUrl:Core.Utility.isAbsoluteUrlString,entitySetName:Core.Utility.isNonEmptyString,logicalName:Core.Utility.isNonEmptyString});e.isValid=function(e){return t(e)}}(Vr||(Vr={})),function(e){var t=nr({componentName:Core.Utility.isNonEmptyString,identifier:Core.Utility.isNonEmptyString,identifierType:Core.Utility.isNonEmptyString,runtimeUrl:Core.Utility.isAbsoluteUrlString});e.isValid=function(e){return t(e)}}(Fr||(Fr={})),function(e){var t=nr({appId:Core.Utility.isNonEmptyString,appName:Core.Utility.isNonEmptyString,sessionId:Core.Utility.isNonEmptyString,objectId:Core.Utility.isNonEmptyString,tenantId:Core.Utility.isNonEmptyString,environmentId:Core.Utility.isNonEmptyString});e.isValid=function(e){return t(e)}}(zr||(zr={})),function(e){var t=nr({osType:Core.Utility.isNonEmptyString,version:Core.Utility.isNonEmptyStringOrUndefined,offlineEnabled:Core.Utility.isBoolean});e.isValid=function(e){return t(e)}}(Br||(Br={}));var qr={serviceName:"HostRuntimeService",serviceVersion:{major:1,minor:6},commands:{getAppDataSourceConfigsAsync:{minMinorVersion:0,args:h.VoidArgs,result:{isValid:tr(Or.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},getAppCdsDataSourceConfigsAsync:{minMinorVersion:1,args:h.VoidArgs,result:{isValid:tr(Vr.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},getAppCdsDatabaseReferenceComponents:{minMinorVersion:2,args:h.VoidArgs,result:{isValid:function(e){if(!Core.Utility.isArray(e))return!1;for(var t=e.length,n=0;n<t;n++)if(!Fr.isValid(e[n]))return!1;return!0}}},getPcfUserIdFromCdsAsync:{minMinorVersion:3,args:h.VoidArgs,result:{isValid:Core.Utility.isNonEmptyString}},loadNonCompositeConnectionsAsync:{minMinorVersion:4,args:h.VoidArgs,result:{isValid:tr(Or.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},resolveCompositeConnectionsAsync:{minMinorVersion:4,args:h.VoidArgs,result:{isValid:tr(Or.isValid,{isValidKey:Core.Utility.isNonEmptyString})}},getAppMetadataAsync:{minMinorVersion:5,args:h.VoidArgs,result:{isValid:function(e){return zr.isValid(e)}}},getHostMetadataAsync:{minMinorVersion:6,args:{isValid:Core.Utility.isNonEmptyString},result:{isValid:function(e){return Br.isValid(e)}}}},events:{appConnectionsChanged:{minMinorVersion:1,args:h.VoidArgs},appCdsDataSourcesChanged:{minMinorVersion:1,args:h.VoidArgs}}};function Gr(){var e,t,n,r=HashTableUtility.create({0:HashTableUtility.create((e={},e[Jr]={preferredSerializerVersion:1},e)),1:HashTableUtility.create((t={},t[Core.ApplicationErrorName]={preferredSerializerVersion:0},t)),2:HashTableUtility.create((n={},n[Core.ApplicationErrorName]={preferredSerializerVersion:0},n[AppMagic.Services.ServiceErrorName]={preferredSerializerVersion:1},n))}),i=new bn(r);return i.addMessageOnlySerializer(Core.ApplicationErrorName,Core.ApplicationError),i.addSerializer(new Yr),i.addSerializer(new $r),i}var Jr="LocalPlugins.Platform.LocalPluginError";pn(Jr);function Kr(e){return wn(e,Qt)}var Xr,Yr=function(){function e(){this.errorName=Jr,this.maxVersionSupported=1,this.minVersionSupported=1}return e.prototype.serializeError=function(e,t){if(!(e instanceof an))throw new vn(gn.TypeNotSupported);var n={errorName:Jr,serializedVersion:1,message:e.message||"",reasonName:Kr(e.reason),context:{serviceName:e.context.serviceName,actionName:e.context.actionName}};return e.reasonMessage&&(n.reasonMessage=e.reasonMessage),n},e.prototype.deserializeError=function(e){if(!function(e){return e.errorName===Jr&&1===e.serializedVersion&&"string"==typeof e.reasonName&&(void 0===e.reasonMessage||"string"==typeof e.reasonMessage)&&Core.Utility.isObject(e.context)&&"string"==typeof e.context.serviceName&&"string"==typeof e.context.actionName}(e))throw new vn(gn.InvalidData);return new an(function(e){return En(e,Qt,Qt.Unknown)}(e.reasonName),e.context,e.reasonMessage)},e}(),Qr=AppMagic.Services.ServiceErrorName,Zr=AppMagic.Services.ServiceError;pn(Qr);!function(e){e.isErrorResponse=function(e){return Core.Utility.isObject(e)&&"number"==typeof e.status&&Core.Utility.isAnyHashTable(e.headers)&&(null===e.responseText||"string"==typeof e.responseText)},e.serializeErrorResponse=function(e){var t={status:e.status,headers:HashTableUtility.create(e.headers),responseType:e.responseType,responseText:"text"===e.responseType&&"string"==typeof e.responseText?e.responseText:null,response:e.response};return Core.Utility.isDefined(e.responseSize)&&(t.responseSize=e.responseSize),Core.Utility.isDefined(e.duration)&&(t.duration=e.duration),t}}(Xr||(Xr={}));var $r=function(){function e(){this.errorName=Qr,this.maxVersionSupported=1,this.minVersionSupported=1}return e.prototype.serializeError=function(e,t){if(Contracts.check(this.minVersionSupported<=t&&t<=this.maxVersionSupported,"requestedVersion"),!(e instanceof Zr))throw new vn(gn.TypeNotSupported);var n={errorName:Qr,serializedVersion:1,message:e.message||"",serviceType:e.serviceType};return e.response&&(n.response=Xr.serializeErrorResponse(e.response)),n},e.prototype.deserializeError=function(e){if(!function(e){return e.errorName===Qr&&1===e.serializedVersion&&(void 0===e.response||Xr.isErrorResponse(e.response))}(e))throw new vn(gn.InvalidData);var t;return e.response?(e.response.headers=HashTableUtility.create(e.response.headers),null===e.response.responseText&&(e.response.responseText=void 0),t=new Core.SendHttpErrorWithResponse(e.message,e.response)):t=new Core.SendHttpError(e.message),Zr.createServiceError(t,e.serviceType)},e}();var ei=function(){function e(e,t,n,r,i){this._setStorePromise=null,this._appId=e.substring(e.lastIndexOf("/")),this._userId=t,this._channelId=null!=n?n:"",this._appLocalStore=r,this._powerAppsLocalStore=i,Core.Environment.isSharedAppHost()||(this._setStorePromise=this.setAppStorage()),Core.Telemetry.Log.trackActivityEvent("DataStateManager.constructor",{message:" DataStateManager Created ",userId:this._userId,channelId:this._channelId,appId:this._appId})}return e.prototype.setAppStorage=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._appLocalStore.setStoreAsync("PowerApps",this._appId,this._userId,this._channelId,e)];case 1:return t.sent(),[2,this._powerAppsLocalStore.setStoreAsync("PowerApps","PowerAppsList")]}}))}))},e.prototype.setDataStoreAsync=function(e,t,n,r,i){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(o){switch(o.label){case 0:return[4,this._appLocalStore.isSufficentStorageAsync()];case 1:return o.sent()?[4,this._appLocalStore.isValidDriverAsync()]:[2,Core.IO.SaveDataResult.InSufficientStorage];case 2:return o.sent()?[4,this._appLocalStore.isAppLimitExceeds(e,t,n)]:[2,Core.IO.SaveDataResult.UnsupportedStorage];case 3:return o.sent()?[4,this._appLocalStore.setDataStoreAsync(e,t,r,i)]:[2,Core.IO.SaveDataResult.QuotaExceeds];case 4:return o.sent(),[4,this._powerAppsLocalStore.setLastActiveTime(this._appId,this._userId,this._channelId,Date.now())];case 5:return o.sent(),[2,Core.IO.SaveDataResult.Success]}}))}))},e.prototype.getDataStoreAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return[4,this._appLocalStore.getDataStoreAsync(e)];case 1:return t=n.sent(),[4,this._powerAppsLocalStore.setLastActiveTime(this._appId,this._userId,this._channelId,Date.now())];case 2:return n.sent(),[2,t]}}))}))},e.prototype.clearAppStorage=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._appLocalStore.clearStoreAsync()];case 1:return e.sent(),[4,this._powerAppsLocalStore.clearAsync(this._appId,this._userId,this._channelId)];case 2:return e.sent(),[2]}}))}))},e.prototype.getAppStoragePromiseAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){return!Core.Environment.isSharedAppHost()||this._setStorePromise&&this._lastCustomPage==e||(this._setStorePromise=this.setAppStorage(e),this._lastCustomPage=e),[2,this._setStorePromise]}))}))},e.prototype.clearDataStoreAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return e?[3,2]:[4,this._appLocalStore.clearAsync()];case 1:return t.sent(),[2,!0];case 2:return[4,this._appLocalStore.clearDataStoreAsync(e)];case 3:return[2,t.sent()]}}))}))},e}(),ti=function(){function e(e){this._appLocalForage=e}return e.prototype.setDataStoreAsync=function(e,t,n,r){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(i){switch(i.label){case 0:return[4,this._appLocalForage.setValueAsync(e+"-data",n)];case 1:return i.sent(),[4,this._appLocalForage.setValueAsync(e+"-asset",r)];case 2:return i.sent(),[4,this._appLocalForage.setValueAsync(e+"-size",t)];case 3:return i.sent(),[2]}}))}))},e.prototype.setStoreAsync=function(e,t,n,r,i){return __awaiter(this,void 0,Promise,(function(){var o,a;return __generator(this,(function(s){switch(s.label){case 0:return[4,this._appLocalForage.setDatabaseAsync(e)];case 1:return s.sent(),o=t+":"+n+(r?":"+r:""),Core.Environment.isSharedAppHost()&&(a=AppMagic.PowerApps.PowerAppsUtility.tryGetConvergedAppIdentifier(),o=(null==a?void 0:a.appLogicalName)+":"+(null!=i?i:"")+":"+n+":"+(null==a?void 0:a.environmentId)+(r?":"+r:"")),[4,this._appLocalForage.setStoreAsync(o)];case 2:return[2,s.sent()]}}))}))},e.prototype.clearStoreAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._appLocalForage.clearAsync()];case 1:return e.sent(),[4,this._appLocalForage.deleteStoreAsync()];case 2:return e.sent(),[2]}}))}))},e.prototype.clearAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._appLocalForage.clearAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.clearDataStoreAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._appLocalForage.getKeysAsync()];case 1:return t.sent().indexOf(e+"-data")>=0?[4,this._appLocalForage.removeValueAsync(e+"-data")]:[3,5];case 2:return t.sent(),[4,this._appLocalForage.removeValueAsync(e+"-asset")];case 3:return t.sent(),[4,this._appLocalForage.removeValueAsync(e+"-size")];case 4:return t.sent(),[2,!0];case 5:return[2,!1]}}))}))},e.prototype.getDataStoreAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){switch(r.label){case 0:return[4,this._appLocalForage.getKeysAsync()];case 1:return t=r.sent(),n={},[4,this._appLocalForage.getValueAsync(e+"-data")];case 2:return n.data=r.sent(),[4,this._appLocalForage.getValueAsync(e+"-asset")];case 3:return n.assets=r.sent(),n.isMissingKey=t.indexOf(e+"-data")<0,[2,n]}}))}))},e.prototype.isAppLimitExceeds=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var r,i,o,a,s,c,l;return __generator(this,(function(u){switch(u.label){case 0:return[4,this._appLocalForage.getKeysAsync()];case 1:r=u.sent(),i=e+"-size",o=0,a=0,s=r,u.label=2;case 2:return a<s.length?"-size"!==(c=s[a]).substring(c.length-5)?[3,4]:[4,this._appLocalForage.getValueAsync(c)]:[3,5];case 3:l=u.sent(),c!==i&&(o+=l),u.label=4;case 4:return a++,[3,2];case 5:return o+t>n?(Core.Telemetry.Log.trackActivityEvent("AppLocalStore.isAppLimitExceeds",{message:"Quota exceeds: estimated size: ".concat(o," bytes and payload size: ").concat(t," bytes.")}),[2,!1]):[2,!0]}}))}))},e.prototype.isValidDriverAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this._appLocalForage.getDriverAsync()];case 1:return"asyncStorage"!==(e=t.sent())?(Core.Log.error("AppLocalStore.isValidDriverAsync","Unsupported Storage: Available Driver: ".concat(e,".")),[2,!1]):[2,!0]}}))}))},e.prototype.isSufficentStorageAsync=function(){var e;return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){switch(r.label){case 0:return(null===(e=null===navigator||void 0===navigator?void 0:navigator.storage)||void 0===e?void 0:e.estimate)?[4,navigator.storage.estimate()]:[3,2];case 1:if("number"==typeof(t=r.sent()).quota&&"number"==typeof t.usage&&(n=0,0!==t.quota&&(n=t.usage/t.quota*100),0===t.quota||n>95))return Core.Log.error("AppLocalStore.isSufficentStorageAsync","InSufficient Storage: estimate quota ".concat(t.quota," and current usage percent :").concat(n,".")),[2,!1];r.label=2;case 2:return[2,!0]}}))}))},e}(),ni=function(){function e(e){this._appLocalForage=e}return e.prototype.setLastActiveTime=function(e,t,n,r){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(i){switch(i.label){case 0:return[4,this._appLocalForage.setValueAsync(ri(e,t,n),r)];case 1:return i.sent(),[2]}}))}))},e.prototype.getLastActiveTime=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this._appLocalForage.getValueAsync(ri(e,t,n))];case 1:return[2,r.sent()]}}))}))},e.prototype.clearAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,this._appLocalForage.removeValueAsync(ri(e,t,n))];case 1:return[2,r.sent()]}}))}))},e.prototype.setStoreAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this._appLocalForage.setDatabaseAsync(e)];case 1:return n.sent(),[4,this._appLocalForage.setStoreAsync(t)];case 2:return[2,n.sent()]}}))}))},e}();function ri(e,t,n){return e+":"+t+(n?":"+n:"")}n.d(t,"CordovaPlugin",(function(){return J})),n.d(t,"ICapabilitiesManager",(function(){})),n.d(t,"ICommunicationChannel",(function(){})),n.d(t,"ICommandInfo",(function(){})),n.d(t,"CordovaPluginResult",(function(){return q})),n.d(t,"Status",(function(){return B})),n.d(t,"DeviceCapability",(function(){return j})),n.d(t,"CordovaEventInfo",(function(){return V})),n.d(t,"CordovaApiHost",(function(){return c})),n.d(t,"AppHostRuntime",(function(){return u})),n.d(t,"LocalServices",(function(){return U})),n.d(t,"CordovaPluginResultSerializationHelpers",(function(){return W})),n.d(t,"IPlayerAppHostApiHandler",(function(){})),n.d(t,"IPlayerCommunicationChannel",(function(){})),n.d(t,"IMessageChannel",(function(){})),n.d(t,"DataState",(function(){return O})),n.d(t,"requiredCapabilityKey",(function(){return"requiredCapability"}))}])}));
//# sourceMappingURL=D:/a/_work/1/s/obj/Assets/js/PlayerApiHost/PlayerApiHost.js.map