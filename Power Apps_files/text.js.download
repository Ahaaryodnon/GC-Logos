/*! For license information please see Text.js.LICENSE.txt */
(function(){return this?this:window}())["@pa-client/text"]=function(e){var t={};function i(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=e,i.c=t,i.d=function(e,t,o){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)i.d(o,n,function(t){return e[t]}.bind(null,n));return o},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){e.exports=i(1)},function(e,t,i){"use strict";i.r(t);var o={};i.r(o),i.d(o,"Text",(function(){return s}));var n,r=!1,a=null,l=0;!function(e){e.Singleline="singleline",e.Multiline="multiline",e.Password="password"}(n||(n={}));var u;!function(e){e.Text="text",e.Numeric="numeric",e.Auto="auto"}(u||(u={}));var s=function(){function e(){}return e.prototype.initControlContext=function(e){var t=this;Core.FeatureGates.controls.disableTextInputSkipCompare||e.controlWidget.setSkipCompare("Default",!0),e._isUserEdited=!1,e._accessibilityItem=null,e.isFocused=ko.observable(!1),e.keyboardMode=ko.pureComputed((function(){return t._getKeyboardMode(e)}));var i=e.modelProperties.Default.getValue(),o=e.modelProperties.Text.getValue();Core.Utility.isNullOrUndefined(i)&&"number"!==e.modelProperties.Format.getValue()&&(i=""),o||e.modelProperties.Text.setValue(i),AppMagic.Utility.createOrSetPrivate(e,"_textWithDelay",ko.observable(i).extend({notify:"always",rateLimit:{timeout:500,method:"notifyWhenChangesStop"}}))},e.prototype.initView=function(e,t){var i=this;e.spellcheck=t.modelProperties.EnableSpellCheck.getValue();var o=this._handleClick.bind(this,t);t.handleClick=o;var r=this._handleOnChange.bind(this,t);t.handleOnChange=r;var a=this._handleClearClick.bind(this,t);t.handleClearClick=a,t.onInputHandler=this._onInput.bind(this,t),e.addEventListener("input",t.onInputHandler),t.onBlurHandler=this._onBlurHandler.bind(this,t),e.addEventListener("focusout",t.onBlurHandler),t.onFocusHandler=this._onFocusHandler.bind(this,t),e.addEventListener("focusin",t.onFocusHandler),AppMagic.Utility.createOrSetPrivate(t,"mode",ko.pureComputed((function(){return this.properties.Mode()===n.Multiline?"multiline":this.properties.Mode()===n.Password?"password":"singleline"}),t)),AppMagic.Utility.createOrSetPrivate(t,"text",ko.pureComputed((function(){return this.initialized?this.properties.DelayOutput()?this._textWithDelay():this.properties.Text():""}),t)),t._textSubscription=t._textWithDelay.subscribe((function(e){t.modelProperties.Text.getValue()!==e&&t.modelProperties.Text.setValue(e,!1,!0)}));var l=t.modelProperties.DelayOutput.getValue();this.onChangeDelayOutput({newValue:l},t),ko.applyBindings(t,e),e.addEventListener("keydown",this._onKeyDown),t._onKeyUpHandler=function(e){return i._onKeyUp(t,e)},e.addEventListener("keyup",t._onKeyUpHandler),Core.Environment.getDeviceId()===Core.Environment.DeviceId.AndroidDevice&&(window.addEventListener("native.showkeyboard",this._enableSoftkeyWorkaround,!1),window.addEventListener("native.hidekeyboard",this._disableSoftkeyWorkaround,!1),window.addEventListener("focusin",this._focusin,!1)),this._updateAccessibilityItem(t)},e.prototype._enableSoftkeyWorkaround=function(e){0===l&&(l=e.keyboardHeight,p())},e.prototype._disableSoftkeyWorkaround=function(e){r=!1,document.activeElement.blur(),c(0)},e.prototype._focusin=function(e){p()},e.prototype._updateAccessibilityItem=function(e){if(e.realized){e._accessibilityItem&&(AppMagic.Controls.AccessibilityManager.unregisterItem(e._accessibilityItem),e._accessibilityItem.dispose(),e._accessibilityItem=null,e._inputElement=null,e._clearButtonElement=null);var t=[];e.modelProperties.Mode.getValue()===n.Multiline?t.push(e.container.querySelector(".appmagic-textarea")):(e._inputElement=e.container.querySelector(".appmagic-text"),e._clearButtonElement=e.container.querySelector(".appmagic-text-clear-button"),t.push(e._inputElement),t.push(e._clearButtonElement)),e._accessibilityItem=AppMagic.Controls.AccessibilityHelper.createAccessibilityItem(e,t),AppMagic.Controls.AccessibilityManager.registerItem(e._accessibilityItem)}},e.prototype.onChangeTabIndex=function(e,t){t._accessibilityItem&&AppMagic.Controls.AccessibilityManager.updateItemTabIndex(t._accessibilityItem,t.modelProperties.TabIndex.getValue())},e.prototype.onChangeX=function(e,t){this._onChangeLocation(t)},e.prototype.onChangeY=function(e,t){this._onChangeLocation(t)},e.prototype._onChangeLocation=function(e){e._accessibilityItem&&AppMagic.Controls.AccessibilityHelper.updateLocation(e._accessibilityItem,e)},e.prototype.disposeControlContext=function(e){e.isFocused=null,e._textWithDelay=null,e.keyboardMode.dispose(),e.keyboardMode=null},e.prototype.disposeView=function(e,t){e.removeEventListener("input",t.onInputHandler),t.onInputHandler=null,e.removeEventListener("focusout",t.onBlurHandler),t.onBlurHandler=null,e.removeEventListener("focusin",t.onFocusHandler),t.onFocusHandler=null,e.removeEventListener("keydown",this._onKeyDown),e.removeEventListener("keyup",t._onKeyUpHandler),t._onKeyUpHandler=null,window.removeEventListener("native.showkeyboard",this._enableSoftkeyWorkaround),window.removeEventListener("native.hidekeyboard",this._disableSoftkeyWorkaround),window.removeEventListener("focusin",this._focusin),t._textSubscription&&(t._textSubscription.dispose(),t._textSubscription=null),t.text&&(t.text.dispose(),t.text=null),t.mode&&(t.mode.dispose(),t.mode=null),t.handleClick=null,t.handleOnChange=null,t.handleClearClick=null,t._inputElement=null,t._clearButtonElement=null,t._accessibilityItem&&(AppMagic.Controls.AccessibilityManager.unregisterItem(t._accessibilityItem),t._accessibilityItem.dispose(),t._accessibilityItem=null),clearTimeout(t._onBlurTimeoutId),clearTimeout(t._notifyTimeoutId)},e.prototype._onKeyUp=function(e,t){var i;AppMagic.AuthoringTool.Runtime.isAuthoring&&e.isTemplate&&t.key===Core.UI.Constants.Keys.escape?this.OpenAjax.controlManager.executeShellAction({id:"ExitTextEditMode"}):e.modelProperties.Mode.getValue()!==n.Multiline&&Core.Environment.getBrowserId()===Core.Environment.BrowserId.InternetExplorer&&t.key===Core.UI.Constants.Keys.enter&&(null===(i=e._inputElement)||void 0===i||i.blur())},e.prototype._onKeyDown=function(e){AppMagic.KeyboardHandlers.stopPropagationOfCursorNavigation(e)},e.prototype.onChangeText=function(e,t){t.realized&&t.modelProperties.DelayOutput.getValue()&&t._textWithDelay()!==e.newValue&&t._textWithDelay(e.newValue)},e.prototype.onChangeDelayOutput=function(e,t){if(t.realized&&e.newValue&&e.newValue!==e.oldValue){var i=t.modelProperties.Text.getValue();t._textWithDelay(i)}},e.prototype.onChangeMode=function(e,t){this._updateAccessibilityItem(t)},e.prototype.onChangeFormat=function(e,t){var i=t.modelProperties.Default.getValue();t._isUserEdited&&(i=t.modelProperties.DelayOutput.getValue()?t._textWithDelay():t.modelProperties.Text.getValue());var o=this._validateTextWithCharacters(t,i);this._updateTextImmediately(t,o)},e.prototype.onChangeReset=function(e,t){e.newValue&&!e.oldValue&&this.resetControl(t)},e.prototype.onChangeDefault=function(e,t){this._resetTextToDefault(t)},e.prototype.onChangeMaxLength=function(e,t){var i=t.modelProperties.Default.getValue();t._isUserEdited&&(i=t.modelProperties.DelayOutput.getValue()?t._textWithDelay():t.modelProperties.Text.getValue());var o=this._restrictTextToMaxLength(i,e.newValue);this._updateTextImmediately(t,o)},e.prototype.onChangeEnableSpellCheck=function(e,t){t.container&&(t.container.spellcheck=t.modelProperties.EnableSpellCheck.getValue())},e.prototype.resetControl=function(e){this._resetTextToDefault(e)},e.prototype.interactWithControl=function(e,t){var i=null==t?void 0:t.Text;if(Core.Utility.isString(i)){var o=this._validateText(e,i);this._handleClick(e),this._updateText(e,o),this._handleOnChange(e)}},e.prototype._sanitizeMaxLength=function(e){return null===e?1/0:e<0?0:e},e.prototype._restrictTextToMaxLength=function(e,t){return e?(t=this._sanitizeMaxLength(t),e.substr(0,t)):e},e.prototype._getKeyboardMode=function(e){var t=e.properties.VirtualKeyboardMode(),i=e.properties.Format();return t&&i?t==u.Numeric||t===u.Auto&&"number"===i?"decimal":"text":null},e.prototype._formatText=function(e,t,i){void 0===i&&(i="");var o=e;return"number"===t&&Core.Utility.isNullOrUndefined(AppMagic.Data.DataValue.errorValueToNull(AppMagic.Functions._signedDecimalValue(e)))&&(o=i||""),o},e.prototype._formatTextWithCharacters=function(e,t){var i=e;if("number"===t){if(!e||!Core.Utility.isNullOrUndefined(AppMagic.Data.DataValue.errorValueToNull(AppMagic.Functions.value(null,e))))return e;var o=AppMagic.Data.DataValue.errorValueToNull(AppMagic.Functions._signedDecimalValue(e));i=Core.Utility.isNullOrUndefined(o)?"":o.toString()}return i},e.prototype._validateText=function(e,t,i){if(void 0===i&&(i=""),t&&"string"!=typeof t&&(Core.Log.error("Text._validateText","Text is of type '".concat(typeof t,"'; expected type 'string'. Stack: ").concat(Contracts._sourceFromStacktrace())),t=null),!e.modelProperties.Format)return t;var o=t;return o&&(o=this._formatText(o,e.modelProperties.Format.getValue(),i)),o},e.prototype._validateTextWithCharacters=function(e,t){if(t&&"string"!=typeof t&&(Core.Log.error("Text._validateTextWithCharacters","Text is of type '".concat(typeof t,"'; expected type 'string'. Stack: ").concat(Contracts._sourceFromStacktrace())),t=null),!e.modelProperties.Format)return t;var i=t;return i&&(i=this._formatTextWithCharacters(i,e.modelProperties.Format.getValue())),i},e.prototype._updateText=function(e,t){e.realized&&e.modelProperties.DelayOutput.getValue()&&e._textWithDelay()!==t?e._textWithDelay(t):e.modelProperties.Text.getValue()!==t&&e.modelProperties.Text.setValue(t)},e.prototype._updateTextImmediately=function(e,t){e.modelProperties.Text.getValue()!==t&&e.modelProperties.Text.setValue(t),e.modelProperties.DelayOutput.getValue()&&e._textWithDelay()!==t&&e._textWithDelay(t)},e.prototype._resetTextToDefault=function(e){e._isUserEdited=!1;var t=this._validateTextWithCharacters(e,e.modelProperties.Default.getValue()),i=this._restrictTextToMaxLength(t,e.modelProperties.MaxLength.getValue());this._updateTextImmediately(e,i)},e.prototype._onInput=function(e,t){var i=this;if(e.realized){var o=e.modelProperties.DelayOutput.getValue()?e._textWithDelay():e.modelProperties.Text.getValue();t.target.value!==o&&(e._isUserEdited=!0,AppMagic.Utility.executeImmediatelyAsync((function(){if(e.initialized&&e.realized){var n;Core.Utility.isNullOrUndefined(t.target.selectionStart)||(n=t.target.selectionStart);var r=t.target.value,a=i._validateText(e,r,o);if(i._updateText(e,a),r!==a){if(t.target.value=a,Core.Utility.isFunction(t.target.setSelectionRange)&&Core.Utility.isNumber(n)){n=a&&n>a.length?a.length:n;try{t.target.setSelectionRange(n,n)}catch(e){Core.Log.error("Text._onInput",e,"Error while setting text control selection range.")}}i._notifyInvalidText(e)}}})))}},e.prototype._handleClick=function(e){return e.viewState.displayMode()!==AppMagic.Constants.DisplayMode.Edit||e.behaviors.OnSelect(),!1},e.prototype._handleOnChange=function(e){var t;if(e.viewState.displayMode()!==AppMagic.Constants.DisplayMode.Edit)return!1;if(e.modelProperties.DelayOutput.getValue()){var i=e._textWithDelay();e.modelProperties.Text.getValue()!==i&&e.modelProperties.Text.setValue(i)}var o=e.modelProperties.Text.getValue();return(null===(t=AppMagic.TestStudio)||void 0===t?void 0:t.isRecordingMode())&&AppMagic.TestStudio.recordSetProperty(this.OpenAjax,"Text",o),AppMagic.Controls.Diagnostics.traceUserAction(AppMagic.Controls.Diagnostics.Operation.SetProperty,this.OpenAjax,"Text",o),e.behaviors.OnChange(),!1},e.prototype._handleClearClick=function(e){var t;if(e.viewState.displayMode()!==AppMagic.Constants.DisplayMode.Edit)return!1;if(!e.properties.Text())return!1;return e.modelProperties.Text.setValue(""),e._inputElement.focus(),(null===(t=AppMagic.TestStudio)||void 0===t?void 0:t.isRecordingMode())&&AppMagic.TestStudio.recordSetProperty(this.OpenAjax,"Text",""),AppMagic.Controls.Diagnostics.traceUserAction(AppMagic.Controls.Diagnostics.Operation.SetProperty,this.OpenAjax,"Text",""),e.behaviors.OnChange(),!1},e.prototype._onFocusHandler=function(e,t){e._onBlurTimeoutId&&(clearTimeout(e._onBlurTimeoutId),e._onBlurTimeoutId=null),e.isFocused(!0)},e.prototype._onBlurHandler=function(e,t){if(e.initialized&&e.realized){var i=t.relatedTarget;if(i){var o=!1;t.target===e._clearButtonElement&&i===e._inputElement&&(o=!0),t.target===e._inputElement&&i===e._clearButtonElement&&(o=!0),e.isFocused(o)}else e._onBlurTimeoutId=setTimeout((function(){e.initialized&&(e.isFocused(!1),e._onBlurTimeoutId=null)}),1);var n=e.modelProperties.DelayOutput.getValue()?e._textWithDelay():e.modelProperties.Text.getValue(),r=this._validateTextWithCharacters(e,n);this._updateTextImmediately(e,r),AppMagic.AuthoringTool.Runtime.isAuthoring&&this.OpenAjax.controlManager.executeShellAction({id:"ExitTextEditMode"})}},e.prototype._notifyInvalidText=function(e){if("number"===e.modelProperties.Format.getValue()){var t=e.container.querySelector(".a11y");clearTimeout(e._notifyTimeoutId),t.textContent="",t.textContent=AppMagic.Strings.TextInputInvalidEntry,e._notifyTimeoutId=setTimeout((function(){t.textContent=""}),5e3)}},e.prototype.enterTextMode=function(){var e=AppMagic.Controls.ControlWidget.getTextModeAuthoringContext(this);if(e){var t=e._inputElement;e.realized&&t&&(t.focus(),t.select())}},e.prototype.getTextAreaPosition=function(){var e=AppMagic.Controls.ControlWidget.getTextModeAuthoringContext(this);if(e){var t=e._inputElement;if(e.realized&&t&&t.parentElement)return AppMagic.Controls.PublishedAppInlineEditText.getInlineElementRelativePosition(t)}return null},e}();function p(){var e=document.activeElement,t=e.tagName.toLowerCase();if(("textarea"===t||"input"===t&&["text","password"].indexOf(e.type)>-1)&&0!==l){var i=document.activeElement.getBoundingClientRect();if(a!==i){a=i;var o=Math.max(document.documentElement.clientHeight,window.innerHeight||0)-(document.activeElement.getBoundingClientRect().height/2+document.activeElement.getBoundingClientRect().top);if(!r&&l>o||r){r=!0;var n=document.activeElement.getBoundingClientRect().height+(l-o);Math.abs(n)>3&&c(n)}}}}function c(e){var t="translate(0px, -"+e.toString()+"px)";document.body.style.transform=t,document.body.style["-webkit-transform"]=t}Core.exportToNamespace(["AppMagic","Controls"],o)}]);
//# sourceMappingURL=D:/a/_work/1/s/obj/Assets/js/Text/Text.js.map