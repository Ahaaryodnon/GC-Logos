"use strict";
/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */var AppMagic;!function(t){!function(t){!function(e){var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._container=null,e}return __extends(e,t),e.prototype.componentDidMount=function(){var t=this.props,e=t.controlContext,n=t.controlInstance.control;Core.Utility.isFunction(n.initView)&&n.initView(this._container,e)},e.prototype.componentWillUnmount=function(){var t=this.props,e=t.controlContext,n=t.controlInstance.control;Core.Utility.isFunction(n.disposeView)&&n.disposeView(this._container,e)},e}(t.ControlsContainer);e.ContainerViewBase=n}(t.Container||(t.Container={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={})),function(t){!function(e){!function(e){var n=function(){function e(){this._isAuthoring=t.AuthoringTool.Runtime.isAuthoring}return e.prototype.layoutChildren=function(t){},e.prototype.resizeAuthoringCanvas=function(t,e,n,o){this.OpenAjax.updateBoundsPropertyValue("Width",n,!0),this.OpenAjax.updateBoundsPropertyValue("Height",o,!0),this.OpenAjax.updateBoundsPropertyValue("X",t,!0),this.OpenAjax.updateBoundsPropertyValue("Y",e,!0)},e.prototype._getControlsLayoutInfo=function(t){var e=this;return t._children.map((function(t,n){var o=e._getControlLayoutInfo(t);return o.controlIndex=n,o}))},e.prototype._getContainerLayoutInfo=function(t){return this._getBaseControlInfo(t,!1)},e.prototype._applyLayoutInfoToControl=function(t,e,n){e.control;var o=e.controlContext,r=this._isAuthoring;o.modelProperties.LayoutX.setValue(n.x,!1,r,!0),o.modelProperties.LayoutY.setValue(n.y,!1,r,!0),o.modelProperties.LayoutWidth.setValue(n.width,!1,r,!0),o.modelProperties.LayoutHeight.setValue(n.height,!1,r,!0),t.isTemplate&&(o.modelProperties.X.setValue(n.x,!1,!1,!0),o.modelProperties.Y.setValue(n.y,!1,!1,!0),o.modelProperties.Width.setValue(n.width,!1,!1,!0),o.modelProperties.Height.setValue(n.height,!1,!1,!0))},e.prototype._getBaseControlInfo=function(e,n){var o=e.control,r=e.controlContext,i=o.OpenAjax.getPropertyValue("BorderThickness",r.bindingContext),s=o.OpenAjax.getPropertyValue("BorderStyle",r.bindingContext);"none"===t.Controls.converters.borderStyleConverter.view(s)&&(i=0);var a=0,c=0,l=0,u=0;return n&&o.OpenAjax.canLayoutControl()?(a=r.dataflowBounds.userXValue,c=r.dataflowBounds.userYValue,l=r.dataflowBounds.userWidthValue,u=Math.max(0,ko.isObservable(r.contentHeight)&&r.contentHeight.peek()||0,r.dataflowBounds.userHeightValue)):(a=o.OpenAjax.getPropertyValue("X",r.bindingContext),c=o.OpenAjax.getPropertyValue("Y",r.bindingContext),l=o.OpenAjax.getPropertyValue("Width",r.bindingContext),u=o.OpenAjax.getPropertyValue("Height",r.bindingContext)),{name:e.control.OpenAjax.controlName,x:a,y:c,width:l,height:u,visible:o.OpenAjax.getPropertyValue("Visible",r.bindingContext),borderThickness:i,controlIndex:0}},e.prototype._getControlLayoutInfo=function(t){var e=t.control,n=this._getBaseControlInfo(t,!0);return{name:n.name,x:n.x,y:n.y,width:n.width,height:n.height,visible:n.visible,borderThickness:n.borderThickness,controlIndex:n.controlIndex,widthFit:e.OpenAjax.getPropertyValue("WidthFit")}},e}();e.ContainerManager=n}(e.Container||(e.Container={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={})),function(t){!function(t){!function(t){var e=function(){function t(){}return t.layoutControls=function(e,o){Contracts.checkArray(e),Contracts.checkDefined(o),t._sortInfo(e);for(var r=o.borderThickness,i=e.map((function(e){return t._createNewLayoutInfo(e)})),s=function(t){var e=t.width?t.width+t.borderThickness:0,n=o.width-o.borderThickness;return n?e/n:0},a=new n(e,o),c=r/2;a.hasNext;){for(var l=a.getNextRowInfo(),u=0,h=0,d=r/2,p=l.maxVisibleControlHeight+l.maxVisibleControlBorderThickness,f=l.startIndex;f<=l.endIndex;f++){var C=e[f];i[f].height=p-C.borderThickness,i[f].y=c+C.borderThickness/2,i[f].x=d+C.borderThickness/2,C.visible&&(d+=C.width+C.borderThickness,C.widthFit&&(++u,h+=s(C)))}c+=l.maxVisibleControlHeight+l.maxVisibleControlBorderThickness;var y=0,x=o.width-o.borderThickness-l.rowWidth,b=l.startIndex===l.endIndex?x:Math.max(0,x);for(f=l.startIndex;f<=l.endIndex;f++){C=e[f];if(i[f].x+=y,C.widthFit&&C.visible){var g=h?Math.round(s(C)/h*b*10)/10:Math.round(b/u*10)/10;i[f].width+=g,y+=g}}}return this._checkResults(i),i},t._checkResults=function(t){for(var e=0,n=t;e<n.length;e++){var o=n[e];isNaN(o.height)||isNaN(o.width)||isNaN(o.x)||isNaN(o.y)||(o.height,o.width,o.x,o.y)}},t._sortInfo=function(t){t.sort((function(t,e){return t.y<e.y?-1:t.y>e.y?1:t.x<e.x?-1:t.x>e.x?1:t.controlIndex-e.controlIndex}))},t._createNewLayoutInfo=function(t){return{x:t.x||0,y:t.y||0,width:t.width||0,height:t.height||0,controlIndex:t.controlIndex}},t}();t.ContainerLayoutManager=e;var n=function(){function t(t,e){this._controlsInfo=t,this._containerInfo=e,this._cursor=0}return Object.defineProperty(t.prototype,"hasNext",{get:function(){return this._cursor<this._controlsInfo.length},enumerable:!1,configurable:!0}),t.prototype.getNextRowInfo=function(){for(var t=0,e=0,n=this._cursor,o=this._controlsInfo.length,r=null,i=this._containerInfo.borderThickness/2,s=this._containerInfo.width-this._containerInfo.borderThickness/2;n<o;){var a=this._controlsInfo[n];if(!(!r||a.y===r.y&&i+a.width+a.borderThickness<=s))break;a.visible&&(t=Math.max(t,a.height),e=Math.max(e,a.borderThickness),i+=a.width+a.borderThickness,r=a),n++}var c={startIndex:this._cursor,endIndex:n-1,maxVisibleControlHeight:t,maxVisibleControlBorderThickness:e,rowWidth:i-this._containerInfo.borderThickness/2};return this._cursor=n,c},t}()}(t.Container||(t.Container={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={})),function(t){!function(t){!function(e){var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return __extends(n,e),Object.defineProperty(n.prototype,"behaviorEventsOnAuthContext",{get:function(){return!0},enumerable:!1,configurable:!0}),n.prototype.initControlContext=function(t){e.prototype.initControlContext.call(this,t),t._children=[],t._childrenPropertiesSubscriptions=[],t._containerPropertiesSubscriptions=[],t._layoutInvalidated=ko.observable(!1),t._hasChildren=ko.observable(!1),t._accessibilityContainer=null;var n=ko.observable(0).extend({deferred:!0,notify:"always"});t._requestRenderObservable=n,t._requestRender=function(){return n(0)}},n.prototype.disposeControlContext=function(t){t._containerPropertiesSubscriptions&&(t._containerPropertiesSubscriptions.forEach((function(t){return t.dispose()})),t._containerPropertiesSubscriptions=[]),t._childrenPropertiesSubscriptions&&(t._childrenPropertiesSubscriptions.forEach((function(t){return t.dispose()})),t._childrenPropertiesSubscriptions=[]),t._requestRender=null,t._requestRenderObservable=null,t._layoutInvalidated=null,t._hasChildren=null},n.prototype.initView=function(e,n){n._accessibilityContainer=this._getAccessibilityContainer(n),t.AccessibilityManager.registerContainer(n._accessibilityContainer)},n.prototype.disposeView=function(e,n){n._accessibilityContainer&&(t.AccessibilityManager.unregisterContainer(n._accessibilityContainer),n._accessibilityContainer.dispose(),n._accessibilityContainer=null)},n.prototype.onChildContextAdded=function(t,e){if(this.isValidChildControl(e)){var n=e.controlWidget.control;Contracts.checkValue(n),t._children.push({control:n,controlContext:e}),t._hasChildren(!0)}},n.prototype.onChildContextRemoved=function(t,e){if(this.isValidChildControl(e)){var n=e.controlWidget.control;Contracts.checkValue(n);var o=t._children.findIndex((function(t){return t.control===n&&t.controlContext===e}));-1!==o&&(t._children.splice(o,1),t._hasChildren(t._children.length>0))}},n.prototype.managesChildrenLayout=function(){return this.OpenAjax.template.managesNestedControlBounds},n.prototype.requestLayoutChildren=function(){},n.prototype._getAccessibilityContainer=function(e){return t.AccessibilityHelper.createAccessibilityContainer(e)},n.prototype.isValidChildControl=function(t){return!t.controlWidget.isReplicable||t.isTemplate},n.prototype.promoteChildProperty=function(t,e){var n=t.controlWidget.control.OpenAjax.controlProperties[e];Contracts.checkObject(n),Contracts.checkNullOrUndefined(t.properties[e]),n.promotePropertyForView(t,e)},n}(t.PrintableControl);e.ContainerControlBase=n}(t.Container||(t.Container={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={}));
//# sourceMappingURL=Container.js.map