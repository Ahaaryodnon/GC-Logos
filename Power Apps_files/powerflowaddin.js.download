var PowerFlowAddin=function(e){var t={};function n(o){if(t[o])return t[o].exports;var r=t[o]={i:o,l:!1,exports:{}};return e[o].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(o,r,function(t){return e[t]}.bind(null,r));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Constants={FLOW_CONNECTION_PROVIDER:"/providers/Microsoft.PowerApps/apis/shared_powerflows",FLOW_URL_PREFIX:"/providers/Microsoft.Flow/",HTTP_GET:"GET",HTTP_POST:"POST",HTTP_DELETE:"DELETE",HTTP_PUT:"PUT",ACCEPT_HEADER:"accept",CONTENT_TYPE:"content-type",MIME_APPLICATION_JSON:"application/json",X_MS_CLIENT_REQUEST_ID:"x-ms-client-request-id",TELEMETRY_DF_BASE_URL:"https://api-dogfood.resources.windows-int.net",TELEMETRY_PROD_BASE_URL:"https://management.azure.com",TELEMETRY_GCC_BASE_URL:"https://management.usgovcloudapi.net",TELEMETRY_MOONCAKE_BASE_URL:"https://management.chinacloudapi.cn",TELEMETRY_USNAT_BASE_URL:"https://management.azure.eaglex.ic.gov",TELEMETRY_DF_VERSION:"2015-09-30-preview",TELEMETRY_PROD_VERSION:"2015-09-30-preview",EVENT_NAME_PREFIX:"MSLA.PF.",EVENT_GET_FLOW:"GET_FLOW",EVENT_LOAD_FLOWS:"LOAD_FLOWS",EVENT_REGISTER_SWAGGER:"REGISTER_SWAGGER",EVENT_REGISTER_WADL:"REGISTER_WADL",EVENT_DELETE_FLOW:"DELETE_FLOW",EVENT_UPDATE_FLOW_STATE:"UPDATE_FLOW_STATE",EVENT_UNREGISTER_WADL:"UNREGISTER_WADL",EVENT_ADD_FLOW_INVOCATION:"ADD_FLOW_INVOCATION",EVENT_REGISTER_COMPONENT:"REGISTER_COMPONENT",ADDIN_RESOURCE_PREFIX_PATH:"addin/content/images/",EVENT_GET_SOLUTIONID:"GET_SOLUTIONID",EVENT_GET_SOLUTION_FLOWS:"GET_SOLUTION_FLOWS",FLOWS_URL:"flows",ENVIRONMENTS_FEATURE_FLAG:"overrideFeatures=EnableEnvironments:true",FLOWS_DATA_REFRESH_TIME_IN_SECS:10,FLOWS_CONTROL_REFRESH_TIME_IN_SECS:3,RIBBON_ICON_PATH:"addin/content/Images/notification/ribbonicon.svg",TASKPANE_COMPONENT_NAME:"taskPaneComponent"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0);function r(e,t){return e.id()===t.id()&&e.name()===t.name()&&e.displayName()===t.displayName()}t.formatDate=function(e,t){var n=t.getDate(),o=t.getMonth()+1,r=t.getFullYear(),i="";switch(e){case"ddd MMM dd yy":i=t.toDateString();break;case"yyyy-mm-dd":i=r+"-"+o+"-"+n;break;case"dd-mm-yy":default:i=n+"-"+o+"-"+r}return i},t.containsFlow=function(e,t){return e.some((function(e){return r(e,t)}))},t.flowEqual=r,t.parseDebugInfomation=function(e){var t={message:""};if(e._message)try{t.message=JSON.parse(e._message)}catch(n){t.message=e._message}return t},t.removeDash=function(e){return e.split("-").join("")},t.getEnvironmentPath=function(e){var t=e.getCurrentEnvironment().powerAppsEnvironmentName;return t?"environments/"+t+"/":""},t.getEnvironmentFeatureFlag=function(e){return e.getCurrentEnvironment().powerAppsEnvironmentName?"?"+o.Constants.ENVIRONMENTS_FEATURE_FLAG:""}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0);t.Prod={apiVersionSuffix:"",endPoint:"https://web.powerapps.com/",telemetryBaseUrl:o.Constants.TELEMETRY_PROD_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.GCC={apiVersionSuffix:"",endPoint:"https://gov.web.powerapps.us/",telemetryBaseUrl:o.Constants.TELEMETRY_GCC_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.GCCH={apiVersionSuffix:"",endPoint:"https://make.high.powerapps.us/",telemetryBaseUrl:o.Constants.TELEMETRY_GCC_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.mooncake={apiVersionSuffix:"",endPoint:"https://make.powerapps.cn/",telemetryBaseUrl:o.Constants.TELEMETRY_MOONCAKE_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.dod={apiVersionSuffix:"",endPoint:"https://make.apps.appsplatform.us/",telemetryBaseUrl:o.Constants.TELEMETRY_GCC_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.usnat={apiVersionSuffix:"",endPoint:"https://make.powerapps.eaglex.ic.gov/",telemetryBaseUrl:o.Constants.TELEMETRY_USNAT_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.TestInProd1={apiVersionSuffix:"-alpha",endPoint:"https://tip1.web.powerapps.com/",telemetryBaseUrl:o.Constants.TELEMETRY_PROD_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.TestInProd2={apiVersionSuffix:"-beta",endPoint:"https://tip2.web.powerapps.com/",telemetryBaseUrl:o.Constants.TELEMETRY_PROD_BASE_URL,telemetryVersion:o.Constants.TELEMETRY_PROD_VERSION},t.FlowProd={apiVersion:"2016-11-01",microsoftFlowEndPoint:"https://flow.microsoft.com/",microsoftFlowApiEndPoint:"https://api.flow.microsoft.com/"},t.FlowGCC={apiVersion:"2016-11-01",microsoftFlowEndPoint:"https://gov.flow.microsoft.us/",microsoftFlowApiEndPoint:"https://gov.api.flow.microsoft.us/"},t.FlowGCCH={apiVersion:"2016-11-01",microsoftFlowEndPoint:"https://high.flow.microsoft.us/",microsoftFlowApiEndPoint:"https://high.api.flow.microsoft.us/"},t.FlowMooncake={apiVersion:"2016-11-01",microsoftFlowEndPoint:"https://www.powerautomate.cn/",microsoftFlowApiEndPoint:"https://api.powerautomate.cn/"},t.FlowDod={apiVersion:"2016-11-01",microsoftFlowEndPoint:"https://flow.appsplatform.us/",microsoftFlowApiEndPoint:"https://api.flow.appsplatform.us/"},t.FlowUSNat={apiVersion:"2016-11-01",microsoftFlowEndPoint:"https://flow.eaglex.ic.gov/",microsoftFlowApiEndPoint:"https://api.flow.eaglex.ic.gov/"},t.FlowTestInProd1={apiVersion:"2016-11-01-beta",microsoftFlowEndPoint:"https://tip1.flow.microsoft.com/",microsoftFlowApiEndPoint:"https://tip1.api.flow.microsoft.com/"},t.FlowTestInProd2={apiVersion:"2016-11-01-alpha",microsoftFlowEndPoint:"https://tip2.flow.microsoft.com/",microsoftFlowApiEndPoint:"https://tip2.api.flow.microsoft.com/"},t.powerAppsPortalEndPoint=t.TestInProd1,t.flowPortalEndPoint=t.FlowTestInProd1,t.updatePortalEndPoint=function(e){"test"===e.region?(t.powerAppsPortalEndPoint=t.TestInProd1,t.flowPortalEndPoint=t.FlowTestInProd1):"tip2"===e.region?(t.powerAppsPortalEndPoint=t.TestInProd2,t.flowPortalEndPoint=t.FlowTestInProd2):"int"===e.region||"preprod"===e.region||"prod"===e.region?(t.powerAppsPortalEndPoint=t.Prod,t.flowPortalEndPoint=t.FlowProd):"gccmoderate"===e.region?(t.powerAppsPortalEndPoint=t.GCC,t.flowPortalEndPoint=t.FlowGCC):"gcchigh"===e.region?(t.powerAppsPortalEndPoint=t.GCCH,t.flowPortalEndPoint=t.FlowGCCH):"mooncake"===e.region?(t.powerAppsPortalEndPoint=t.mooncake,t.flowPortalEndPoint=t.FlowMooncake):"dod"===e.region?(t.powerAppsPortalEndPoint=t.dod,t.flowPortalEndPoint=t.FlowDod):"usnat"===e.region&&(t.powerAppsPortalEndPoint=t.usnat,t.flowPortalEndPoint=t.FlowUSNat),t.powerAppsPortalEndPoint.apiVersion=e.apiVersion}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FullVersion="0.1.1.1108. . (RYMACDOW-1.171206-0953)",t.Version="0.1.1.1108"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Resources={RIBBON_TITLE:"FlowAddin_Flows",RIBBON_TOOLTIP:"FlowAddin_Tooltip",TASKPANE_COMPONENT_DISPLAYNAME:"FlowAddin_Flows",TEXT_EDIT_FLOW:"FlowAddin_TextEditFlow",TEXT_AVAILABLE_FLOWS:"FlowAddin_AvailableFlows",TEXT_SUBTITLE_AVAILABLE_SOLUTION_FLOWS:"FlowAddin_SolutionFlowsSubTitle",TEXT_SUBTITLE_AVAILABLE_FLOWS:"FlowAddin_FlowsSubtitle",TEXT_APP:"FlowAddin_App",TEXT_CREATE_FLOW:"FlowAddin_TextCreateFlow",TEXT_CONTROL_NO_FLOWS:"FlowAddin_TextControlNoFlows",TEXT_FLOWS_ON_APP:"FlowAddin_TextFlowsOnApp",TEXT_FLOWS_ON_CONTROL:"FlowAddin_TextFlowsOnControl",TEXT_INIT_FLOW_PROMPT:"FlowAddin_TextInitFlowPrompt",TEXT_INIT_NO_FLOWS:"FlowAddin_TextInitNoFlows",TEXT_REGISTERING_FLOW_PROMPT:"FlowAddin_TextRegisteringFlowPrompt",TEXT_REGISTER_FLOW_PROMPT:"FlowAddin_TextRegisterFlowPrompt",TEXT_UNREGISTER:"FlowAddin_TextUnregister",TEXT_REGISTER_FLOW_ERROR_PROMPT:"FlowAddin_TextRegisterFlowErrorPrompt",TEXT_UNABLE_TO_CONNECT:"FlowAddin_TextUnableToConnect"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(1);t.Flow=function(e,t,n,r,i,s,a){var l=this;this.id=ko.observable(),this.apiId=ko.observable(),this.displayName=ko.observable(),this.name=ko.observable(),this.iconUri=ko.observable(),this.succeeded=ko.observable(),this.lastRunTime=ko.observable(),this.lastModifiedTime=ko.observable(),this.isRunning=ko.observable(),this.formattedLastModifiedTime=ko.observable(),this.connections=ko.observableArray(),this.flowTriggerUri=ko.observable(),this.properties=ko.observable(),this.id(e),this.name(n),this.displayName(t),this.iconUri("addin/content/Images/notification/placeholder.svg"),this.properties(i),r&&(this.lastModifiedTime(r),this.formattedLastModifiedTime=ko.computed((function(){return o.formatDate("yyyy-mm-dd",l.lastModifiedTime())}),this)),s&&this.lastRunTime(s),a&&this.flowTriggerUri(a)}},function(e,t,n){"use strict";function o(e,t,n){return void 0===n&&(n=!0),n?!l(e)&&!l(t)&&e.toLowerCase()===t.toLowerCase():!l(e)&&!l(t)&&e===t}function r(e,t){if(!l(e)){var n=e.indexOf(t);n>=0&&e.splice(n,1)}}function i(e,t){e=e||{};for(var n=0,r=Object.keys(e);n<r.length;n++){var i=r[n];if(o(i,t))return e[i]}}function s(e,t){if(t.length&&e){for(var n=0;n<t.length-1;n++)if(!(e=i(e,t[n])))return;var o=t[t.length-1];o&&delete e[o]}}function a(e){return"string"==typeof e}function l(e){return null==e}function u(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return t?(t.forEach((function(t){t&&Object.keys(t).map((function(n){e[n]=f(t[n])}))})),e):e}function c(e){return e?e.map((function(e){return f(e)})):null}function p(e,t){var n,r=""+e;return r&&t&&(n=o(r.substring(0,t.length),t)),n}function d(e,t){var n,r=""+e;return r&&t&&(n=o(r.substr(r.length-t.length),t)),n}function f(e){return Array.isArray(e)?c(e):e instanceof Date?new Date(e.valueOf()):e&&"object"==typeof e?u({},e):e}function h(e){return e.reduce((function(e,t){return e+t}),0)}function _(e){var t={};if(!(e=e.slice("?"===e[0]?1:0)))return t;for(var n,o=/(?:^|&)([^&=]*)=?([^&]*)/g;null!==(n=o.exec(e));){var r=n[1],i=n[2];t[decodeURIComponent(r)]=decodeURIComponent(i)}return t}Object.defineProperty(t,"__esModule",{value:!0}),t.aggregate=function(e){return(e=e||[]).reduce((function(e,t){return e.concat(t)}),[])},t.arrayEquals=function(e,t){return e&&t?e.length===t.length&&e.every((function(e,n){return e===t[n]})):e===t},t.arrayEqualsOrderInsensitive=function(e,t){return e&&t?e.length===t.length&&e.every((function(e){return t.indexOf(e)>-1})):e===t},t.equals=o,t.csvContains=function(e,t,n){return void 0===n&&(n=!0),!(!e||!t)&&e.split(",").some((function(e){return o(e,t,n)}))},t.includes=function(e,t,n){return void 0===n&&(n=!0),n?!l(e)&&!l(t)&&e.toLowerCase().indexOf(t.toLowerCase())>-1:!l(e)&&!l(t)&&e.indexOf(t)>-1},t.first=function(e,t){for(var n=0,o=t;n<o.length;n++){var r=o[n];if(e(r))return r}},t.removeKeys=function(e,t){return(t||[]).filter((function(t){return e.hasOwnProperty(t)})).map((function(t){return delete e[t]})).filter((function(e){return e})).length>0},t.remove=r,t.exclude=function(e,t){l(e)||l(t)||t.forEach((function(t){r(e,t)}))},t.getPropertyValue=i,t.getObjectPropertyValue=function(e,t){for(var n=e||{},o=0,r=t;o<r.length;o++)n=i(n,r[o]);return n},t.setObjectPropertyValue=function(e,t,n){if(t.length&&e){for(var o=0;o<t.length-1;o++)e=i(e,t[o]);var r=t[t.length-1];r&&(e[r]=n)}},t.safeSetObjectPropertyValue=function(e,t,n){if(!t.length)return e;for(var r=e=e||{},s=0;s<t.length-1;s++){var a=r,l=t[s];"object"!=typeof(r=i(r,l))&&(r={},a[l]=r)}for(var u=t[t.length-1],c=0,p=Object.keys(r);c<p.length;c++){var d=p[c];if(o(d,u)){u=d;break}}return r[u]=n,e},t.deleteObjectProperty=s,t.deleteObjectProperties=function(e,t){t.length&&e&&t.forEach((function(t){s(e,t)}))},t.hasProperty=function(e,t){return"object"==typeof e&&Object.keys(e).some((function(e){return o(e,t)}))},t.isString=a,t.isBoolean=function(e){return"boolean"==typeof e},t.isEmptyString=function(e){return a(e)&&""===e},t.isNullOrUndefined=l,t.isNullOrEmpty=function(e){return"object"==typeof e?!e||!Object.keys(e).length:!e},t.isUndefinedOrEmptyString=function(e){return void 0===e||""===e},t.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},t.isValidIcon=function(e){return e&&(/^https:\/\//i.test(e)||/^data:image\//i.test(e))},t.map=function(e,t){if(!t)throw new Error("key required");var n={};return(e=e||[]).filter((function(e){return e.hasOwnProperty(t)})).forEach((function(e){var o=e[t];n[o]=e})),n},t.unmap=function(e,t){return e=e||{},Object.keys(e).map((function(n){var o=e[n];return t&&(o[t]=n),o}))},t.assign=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];return e=e||{},t.forEach((function(t){l(t)||Object.keys(t).map((function(n){e[n]=t[n]}))})),e},t.extend=u,t.uniqueArray=function(e){for(var t=[],n={},o=0,r=e.length;o<r;++o)n.hasOwnProperty(e[o])||(t.push(e[o]),n[e[o]]=1);return t},t.copyArray=c,t.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var o,r=/\{[a-zA-Z$_\d]*\}/g,i=/\{(\d+)\}/g,s=!1;if(t&&1===t.length&&t[0]&&"object"==typeof t[0]){var a=t[0];o=e.replace(r,(function(e){var t=e.substring(1,e.length-1);return a.hasOwnProperty(t)?(s=!0,a[t]):e}))}return s||(o=e.replace(i,(function(e,n){return void 0!==t[n]?t[n]:e}))),o},t.generateUniqueName=function(e,t,n){void 0===n&&(n=2);var o={},r=e;t.forEach((function(e){o[e]=!0}));for(var s=n;;){if(!i(o,r))return r;r=e+"_"+s++}},t.startsWith=p,t.endsWith=d,t.trim=function(e,t){var n=e;return n.length<t.length?e:(p(n,t)&&(n=n.length>1?n.substr(t.length):""),d(n,t)&&(n=n.length>1?n.substring(0,n.length-t.length):""),n)},t.addPrefix=function(e,t){return e&&t&&!p(e,t)&&(e=""+t+e),e},t.getJSONValue=function(e){try{return JSON.parse(e)}catch(t){return e}},t.createCopy=f,t.combineObjects=function(e,t){return Object.keys(t).reduce((function(e,n){return u({},e,((o={})[n]=t[n],o));var o}),u({},e))},t.isValidJSON=function(e){try{return JSON.parse(e),!0}catch(e){return!1}},t.sum=h,t.mapsum=function(e,t){return h(e.map(t))},t.findIndex=function(e,t){if(l(e))throw new TypeError("array cannot be null or undefined");if("function"!=typeof t)throw new TypeError("predicate is not a function");for(var n=Object(e),o=e.length>>>0,r=e,i=0;i<o;i++){var s=n[i];if(t.call(r,s,i,n))return i}return-1},t.isParentOrElement=function(e,t){for(var n=t;!l(n);){if(n===e)return!0;n=n.parentElement}return!1},t.parsePathnameAndQueryKeyFromUri=function(e){var t=document.createElement("a");t.href=e;var n=t.pathname,o=t.search;return{pathname:"/"+decodeURIComponent(n.replace(/(^\/+)/g,"")),queryKey:_(o)}},t.hexToRgb=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,n,o){return t+t+n+n+o+o}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(!t)throw new Error("wrong hex color");return{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}},t.validateUrl=function(e){return/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(e)},t.hexToRgbA=function(e,t){if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(e)){var n=e.substring(1).split("");3===n.length&&(n=[n[0],n[0],n[1],n[1],n[2],n[2]]);var o=parseInt("0x"+n.join(""),16);return t=t||1,"rgba("+[o>>16&255,o>>8&255,255&o].join(",")+", "+t+")"}throw new Error("Invalid Hex color value")},t.approximateSize=function(e){for(var t=[],n=0,o=[e],r=function(){var r=o.pop();switch(typeof r){case"boolean":n+=4;break;case"number":n+=8;break;case"string":n+=2*r.length;break;case"object":-1===t.indexOf(e)&&(t.push(e),Array.isArray(r)?r.forEach((function(e){return o.push(e)})):r&&Object.keys(r).forEach((function(e){return o.push(r[e])})))}};o.length;)r();return n},t.padStart=function(e,t,n){if(void 0===n&&(n=" "),e=String(e),String.prototype.padStart)return e.padStart(t,n);if(t>>=0,e.length>t)return String(e);if(n=String(n),(t-=e.length)>n.length)for(var o=t/n.length,r=0;r<o;r++)n+=n;return n.slice(0,t)+e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"];t.default=function(){for(var e,t="",n=0;n<4;n++)e=4294967296*Math.random()|0,t+=o[15&e]+o[e>>4&15]+o[e>>8&15]+o[e>>12&15]+o[e>>16&15]+o[e>>20&15]+o[e>>24&15]+o[e>>28&15];var r=o[8+4*Math.random()|0];return t.substr(0,8)+"-"+t.substr(9,4)+"-4"+t.substr(13,3)+"-"+r+t.substr(16,3)+"-"+t.substr(19,12)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(0),r=n(9),i=function(){function e(){}return e.taskPaneComponent={markupFilePath:"addin/components/taskpane/TaskPane.html",name:o.Constants.TASKPANE_COMPONENT_NAME,synchronous:!1,viewModelConstructorFunction:r.TaskPaneViewModel},e}();t.ComponentDefinitions=i},function(e,t,n){"use strict";var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){e.done?r(e.value):new n((function(t){t(e.value)})).then(s,a)}l((o=o.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,o,r,i,s={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(r=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[0,r.value]),i[0]){case 0:case 1:r=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,o=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((r=(r=s.trys).length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){s.label=i[1];break}if(6===i[0]&&s.label<r[1]){s.label=r[1],r=i;break}if(r&&s.label<r[2]){s.label=r[2],s.ops.push(i);break}r[2]&&s.ops.pop(),s.trys.pop();continue}i=t.call(e,s)}catch(e){i=[6,e],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};Object.defineProperty(t,"__esModule",{value:!0});var i=n(4),s=n(5),a=n(2),l=n(6),u=n(0),c=n(1),p=n(15),d=function(){function e(e,t,n){var o=this;this.allFlows=ko.observableArray(),this.contextualFlows=ko.observableArray(),this.errorMessage=ko.observable(""),this.resourcePrefixPath="",this.selectId=ko.observable(""),this.registering=ko.observable(!1),this.registerInfoIcon=ko.observable("pa-dtc-info.svg"),this.registerActionIcon=ko.observable("pa-dtc-close.svg"),this.isActionIconVisible=ko.observable(!0),this.registerError=ko.observable(!1),this.firstLoading=ko.observable(!0),this.showSolutionFlowsSubTitle=ko.observable(!1),this._loaded=ko.observable(!1),this._loading=ko.observable(!1),this._flowVersion="1.0",this._controlFilterRefreshTimerId=void 0,this._registerFlowsCollection=[],this.editFlow=function(e){var t=l.format("{baseUrl}manage/{environmentUrl}{flowUrl}",{baseUrl:a.flowPortalEndPoint.microsoftFlowEndPoint,environmentUrl:c.getEnvironmentPath(o._powerAppsContext),flowUrl:u.Constants.FLOWS_URL+"/"+e.name()});o._powerAppsContext.launchUriAsync(t)},this.selectFlow=function(e){if(e)try{var t,n,r=e.apiId()||u.Constants.FLOW_CONNECTION_PROVIDER,i={workflowName:e.name()};o._registerReadyState(e),o.unregisterWadl(e),o._registerFlowsCollection.push(e.name()),o._powerFlowService.getFlow(e.name()).then((function(e){return o._powerFlowService.installFlow(e)})).then((function(){return o._powerFlowService.getFlow(e.name())})).then((function(r){t=o._assembleConnectionsUrls(r),e.connections=r.connections;var i=o._powerFlowService.getWadl(e.name()),s=o._powerFlowService.getSwagger(e.name());return n=r.flowTriggerUri().split("/").slice(-4)[0],Promise.all([i,s])})).then((function(s){if(s&&2===s.length){var a=s[0],l=s[1];return o._registerWadlAndSwagger(e.name(),r,n,o._flowVersion,a,t,i,l)}return Promise.reject(new Error("Get wadl or swagger failure"))})).then((function(e){return o._addFlowInvocationAsync(e.result.serviceNamespace)})).then((function(){return o._filterFlowsForContextAsync()})).then((function(){o._registerFinishState(e)})).then(null,(function(t){o._registerErrorState(e,t.message)}))}catch(t){o._registerErrorState(e,t.message)}},this.unregisterWadl=function(e){o._getFlowRegistrationAsync(e).then((function(t){t&&t.serviceNamespace&&o._powerAppsContext.unregisterServiceAsync(t.serviceNamespace).then((function(){e&&o.contextualFlows.remove((function(t){return t.flow===e}))})).then(null,(function(t){o._analyticsService.logError(u.Constants.EVENT_NAME_PREFIX+u.Constants.EVENT_UNREGISTER_WADL,new Error(t.message),{flowId:e.name(),debugInformation:c.parseDebugInfomation(t.debugInformation)})}))})).then(null,(function(t){o._analyticsService.logError(u.Constants.EVENT_NAME_PREFIX+u.Constants.EVENT_UNREGISTER_WADL,new Error(t.message),{flowId:e.name()})}))},this.dismissFeedbackInfo=function(){o.registering()||o.selectId("")},this._powerFlowService=e,this._powerAppsContext=t,this._analyticsService=n,this.allFlows.extend({rateLimit:50}),this.textUnregister=t.getAuthoringResourceString(i.Resources.TEXT_UNREGISTER),this._textUnableToConnect=t.getAuthoringResourceString(i.Resources.TEXT_UNABLE_TO_CONNECT),this._textRegisteringFlowPrompt=t.getAuthoringResourceString(i.Resources.TEXT_REGISTERING_FLOW_PROMPT),this._textRegisterFlowPrompt=t.getAuthoringResourceString(i.Resources.TEXT_REGISTER_FLOW_PROMPT),this._textFlowsOnControl=t.getAuthoringResourceString(i.Resources.TEXT_FLOWS_ON_CONTROL),this._textApp=t.getAuthoringResourceString(i.Resources.TEXT_APP),this._textFlowsOnApp=t.getAuthoringResourceString(i.Resources.TEXT_FLOWS_ON_APP),this._textRegisterFlowErrorPrompt=t.getAuthoringResourceString(i.Resources.TEXT_REGISTER_FLOW_ERROR_PROMPT),this.textAvailableFlows=t.getAuthoringResourceString(i.Resources.TEXT_AVAILABLE_FLOWS),this.textAvailableSolutionFlowsSubTitle=t.getAuthoringResourceString(i.Resources.TEXT_SUBTITLE_AVAILABLE_SOLUTION_FLOWS),this.textAvailableFlowsSubTitle=t.getAuthoringResourceString(i.Resources.TEXT_SUBTITLE_AVAILABLE_FLOWS),this.textCreateFlow=t.getAuthoringResourceString(i.Resources.TEXT_CREATE_FLOW),this.textControlNoFlows=t.getAuthoringResourceString(i.Resources.TEXT_CONTROL_NO_FLOWS),this.textInitFlowPrompt=t.getAuthoringResourceString(i.Resources.TEXT_INIT_FLOW_PROMPT),this.textInitNoFlows=t.getAuthoringResourceString(i.Resources.TEXT_INIT_NO_FLOWS),this.textEdit=t.getAuthoringResourceString(i.Resources.TEXT_EDIT_FLOW),this.textFlowsOnContextTitle=ko.observable(t.getAuthoringResourceString(i.Resources.TEXT_FLOWS_ON_APP)),this.currentControlName=ko.observable(t.getAuthoringResourceString(i.Resources.TEXT_APP)),this.textRegisteringFlowFeedbackInfo=ko.observable(t.getAuthoringResourceString(i.Resources.TEXT_REGISTERING_FLOW_PROMPT)),void 0!==document.hidden?(this._hidden="hidden",this._visibilityChange="visibilitychange"):void 0!==document.msHidden?(this._hidden="msHidden",this._visibilityChange="msvisibilitychange"):void 0!==document.webkitHidden&&(this._hidden="webkitHidden",this._visibilityChange="webkitvisibilitychange"),this._registerForEvents()}return e.prototype.navigateToPowerFlowPortal=function(){var e=this;this._powerAppsContext.tryGetSolutionIdAsync().then((function(t){var n=t?l.format("{baseUrl}manage/{environmentUrl}solutions/{solutionId}/flows/new?",{baseUrl:a.flowPortalEndPoint.microsoftFlowEndPoint,environmentUrl:c.getEnvironmentPath(e._powerAppsContext),solutionId:t}):l.format("{baseUrl}/templates/?q=Power%20Apps%20Button&environment={environmentName}",{baseUrl:a.flowPortalEndPoint.microsoftFlowEndPoint,environmentName:e._powerAppsContext.getCurrentEnvironment().powerAppsEnvironmentName});e._powerAppsContext.launchUriAsync(n)})).catch((function(t){e.errorMessage(e._textUnableToConnect)}))},e.prototype.loadFlows=function(){var e=this;this._loading(!0),this.showSolutionFlowsSubTitle(!1),this._getFlowsAsync().then((function(t){e._loading(!1),e.firstLoading(!1),e._loaded(!0),e.errorMessage(""),e._updateFlowArray(e.allFlows,t.map((function(t){return new p.FlowViewModel(e,t)}))),e._filterFlowsForContextAsync()}),(function(t){e._loading(!1),e.firstLoading(!1),e._loaded(!0),e.errorMessage(e._textUnableToConnect),e._filterFlowsForContextAsync()}))},Object.defineProperty(e.prototype,"registerStatusStyle",{get:function(){return ko.observable(this.registerError()?"pf-background-error":"pf-background-warning")},enumerable:!0,configurable:!0}),e.prototype._assembleConnectionsUrls=function(e){var t={},n=e?e.connections():null;return n&&n.forEach((function(e){t[e.name()]=e.id()+"/connections/"+e.connectionName()})),t},e.prototype._registerReadyState=function(e){this.registering(!0),this.registerError(!1),this.registerActionIcon(""),this.isActionIconVisible(!1),this.registerInfoIcon("pa-dtc-info.svg"),this.selectId(e.id()),this.textRegisteringFlowFeedbackInfo(this._textRegisteringFlowPrompt)},e.prototype._registerErrorState=function(e,t){this._removeFlowFromCollection(e),this.registering(!1),this.registerError(!0),t?this.textRegisteringFlowFeedbackInfo(t):this.textRegisteringFlowFeedbackInfo(this._textRegisterFlowErrorPrompt),this.registerInfoIcon("pa-dtc-error.svg"),this.registerActionIcon("pa-dtc-close.svg"),this.isActionIconVisible(!0),this.selectId(e.id())},e.prototype._registerFinishState=function(e){this._removeFlowFromCollection(e),this.registering(!1),this.registerError(!1),this._lastControlSelected?(this.textRegisteringFlowFeedbackInfo(this._textRegisterFlowPrompt),this.registerActionIcon("pa-dtc-close.svg"),this.isActionIconVisible(!0)):this.selectId("")},e.prototype._registerForEvents=function(){var e=this,t=AppMagic.AuthoringTool.AddinFramework.EventId.TaskPane_TabSelectionEvent,n=AppMagic.AuthoringTool.AddinFramework.EventId.Selection_Changed,o=AppMagic.AuthoringTool.AddinFramework.EventId.TaskPane_CollapseEvent,r=AppMagic.AuthoringTool.AddinFramework.EventId.TaskPane_OpenPane,i=AppMagic.AuthoringTool.AddinFramework.EventId.EntityManager_EntityRenamed,s=AppMagic.AuthoringTool.AddinFramework.EventId.Document_DocumentReset,a=AppMagic.AuthoringTool.AddinFramework.EventId.User_LoggedIn,l=AppMagic.AuthoringTool.AddinFramework.EventId.User_LoggedOut;this._powerAppsContext.subscribeToEvent([t,n,o,r,a,l,s,i],(function(t,n){return e._handleEvents(t,n)}))},e.prototype._stopTimers=function(){this._controlFilterRefreshTimerId&&(clearInterval(this._controlFilterRefreshTimerId),this._controlFilterRefreshTimerId=void 0),document.removeEventListener(this._visibilityChange,this._loadFlowsOnTabVisible)},e.prototype._handleEvents=function(e,t){var n=this;switch(e){case AppMagic.AuthoringTool.AddinFramework.EventId.TaskPane_TabSelectionEvent:this._stopTimers(),this._controlFilterRefreshTimerId=setInterval((function(){n._lastControlSelected&&n._filterFlowsForContextAsync()}),1e3*u.Constants.FLOWS_CONTROL_REFRESH_TIME_IN_SECS),this._loadFlowsOnTabVisible=function(){document[n._hidden]||n._loadData()},document.addEventListener(this._visibilityChange,this._loadFlowsOnTabVisible);break;case AppMagic.AuthoringTool.AddinFramework.EventId.Runtime_PowerAppsEnvironmentChanged:this._stopTimers(),this._loadData();break;case AppMagic.AuthoringTool.AddinFramework.EventId.TaskPane_CollapseEvent:this._resumeState(),this.loadFlows();break;case AppMagic.AuthoringTool.AddinFramework.EventId.Selection_Changed:this.dismissFeedbackInfo(),t&&t.length?(this._lastControlSelected=t[0],this.currentControlName(this._lastControlSelected.controlName),this.textFlowsOnContextTitle(l.format(this._textFlowsOnControl,this._lastControlSelected.controlName))):(this._lastControlSelected=null,this.currentControlName(this._textApp),this.textFlowsOnContextTitle(this._textFlowsOnApp)),this._filterFlowsForContextAsync();break;case AppMagic.AuthoringTool.AddinFramework.EventId.User_LoggedIn:this._stopTimers(),this._powerFlowService.updateEnvironment(),this.loadFlows(),this.dismissFeedbackInfo();break;case AppMagic.AuthoringTool.AddinFramework.EventId.User_LoggedOut:case AppMagic.AuthoringTool.AddinFramework.EventId.Document_DocumentReset:this._resumeState(),this._clearFlows(),this._resetSelectionContext();break;case AppMagic.AuthoringTool.AddinFramework.EventId.EntityManager_EntityRenamed:var o=t;o.oldControlName&&o.newControlName&&this._lastControlSelected&&o.oldControlName===this._lastControlSelected.controlName&&(this.currentControlName(o.newControlName),this.textFlowsOnContextTitle(l.format(this._textFlowsOnControl,o.newControlName)))}},e.prototype._loadData=function(){!this._loading.peek()&&this._loaded.peek()&&this.loadFlows()},e.prototype._resumeState=function(){this._stopTimers(),this.dismissFeedbackInfo()},e.prototype._clearFlows=function(){this.allFlows([]),this.contextualFlows([]),this.firstLoading(!0)},e.prototype._resetSelectionContext=function(){this._lastControlSelected=null,this.currentControlName(this._textApp),this.textFlowsOnContextTitle(this._textFlowsOnApp),this.dismissFeedbackInfo()},e.prototype._registerWadlAndSwagger=function(e,t,n,o,r,i,s,a){var l={connectionApiId:t,connectionName:n,connectorId:e,connectorVersion:o,connectionDependencies:i,hiddenParameters:s};return this._powerAppsContext.registerServiceAsync(l,r,a)},e.prototype._getFlowRegistrationAsync=function(e){return this._powerAppsContext.getRegisteredServicesAsync().then((function(t){var n=t.result.filter((function(t){return t.connectorId===e.name()}));return null!==n&&n.length?n[0]:null}))},e.prototype._addFlowInvocationAsync=function(e){if(this._lastControlSelected)try{return this._powerAppsContext.setPartialServiceFunctionInvocationAsync(e,"Run",this._lastControlSelected)}catch(e){this._analyticsService.logError(u.Constants.EVENT_NAME_PREFIX+u.Constants.EVENT_ADD_FLOW_INVOCATION,e.message)}return Promise.resolve(null)},e.prototype._filterFlowsForContextAsync=function(){return o(this,void 0,void 0,(function(){var e,t,n,o=this;return r(this,(function(r){switch(r.label){case 0:return e=[],t=[],this._loading()?[3,4]:this._lastControlSelected?(n=this._powerAppsContext.getAddinServicesReferencedByControl(this._lastControlSelected),[3,3]):[3,1];case 1:return[4,this._powerAppsContext.getRegisteredServicesAsync()];case 2:n=r.sent(),r.label=3;case 3:n.resultStatus===AppMagic.AuthoringTool.AddinFramework.ResultStatus.Success&&(e=n.result),r.label=4;case 4:return e.forEach((function(e){var n=o.allFlows.peek().filter((function(t){return t.name===e.connectorId}));n&&n.length?t.push(n[0]):t.push(new p.FlowViewModel(o,new s.Flow(e.connectorId,e.serviceNamespace,e.connectorId,new Date)))})),this._updateFlowArray(this.contextualFlows,t),[2]}}))}))},e.prototype._removeFlowFromCollection=function(e){var t=this._registerFlowsCollection.indexOf(e.name());t>-1&&this._registerFlowsCollection.splice(t,1)},e.prototype._updateFlowArray=function(e,t){e.remove((function(e){return t.every((function(t){return t.id!==e.id}))}));var n=e.peek(),o=t.filter((function(e){return n.filter((function(t){return t.id===e.id})).length<=0}));e.push.apply(e,o)},e.prototype._getFlowsAsync=function(){return o(this,void 0,void 0,(function(){var e,t,n;return r(this,(function(o){switch(o.label){case 0:return[4,this._powerAppsContext.tryGetSolutionIdAsync()];case 1:return e=o.sent(),this.showSolutionFlowsSubTitle(!!e),t=e?this._powerFlowService.getSolutionFlows("PowerApp"):this._powerFlowService.getFlows("PowerAppsButton"),n=e?this._powerFlowService.getSolutionFlows("PowerAppV2"):this._powerFlowService.getFlows("PowerAppsButtonV2"),[2,Promise.all([t,n]).then((function(e){return Promise.resolve(e[0].concat(e[1]))})).catch((function(e){return Promise.reject(e)}))]}}))}))},e}();t.TaskPaneViewModel=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(11);t.Addin=o.Addin},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(12),r=n(8),i=n(3),s=n(16),a=n(21),l=function(){function e(){}return e.prototype.getId=function(){return"6d1f157d-95bf-406d-b65d-cfd3240f724e"},e.prototype.getVersion=function(){return i.Version},e.prototype.registerAsync=function(e){return this._powerAppsContext=e,this._addinAnalyticsService=s.initAnalyticService(e),s.startAnalyticPublish(this._addinAnalyticsService),this._powerflowService=new o.PowerFlowService(e,this._addinAnalyticsService),Promise.resolve(this._registerComponents())},e.prototype.unRegisterAsync=function(){s.stopAnalyticPublish(this._addinAnalyticsService);var e=this._powerAppsContext.unregisterKnockoutComponent(r.ComponentDefinitions.taskPaneComponent);if(e.resultStatus===AppMagic.AuthoringTool.AddinFramework.ResultStatus.Success)return Promise.resolve(a.createAddinFrameworkResult(AppMagic.AuthoringTool.AddinFramework.ResultStatus.Success,a.UNREGISTERASYNC));var t="";return e.resultStatus===AppMagic.AuthoringTool.AddinFramework.ResultStatus.Failed&&(t=t+"unRegisterTaskPane"+e.message),Promise.reject(a.createAddinFrameworkResult(AppMagic.AuthoringTool.AddinFramework.ResultStatus.Failed,a.UNREGISTERASYNC+" Failed: "+t))},e.prototype.suspendAsync=function(){return Promise.resolve(a.createAddinFrameworkResult(AppMagic.AuthoringTool.AddinFramework.ResultStatus.Success,"suspendAsync"))},e.prototype.resumeAsync=function(e){return Promise.resolve(a.createAddinFrameworkResult(AppMagic.AuthoringTool.AddinFramework.ResultStatus.Success,"resumeAsync"))},e.prototype._registerComponents=function(){var e=a.registerTaskPane(this._powerAppsContext,this._powerflowService,this._addinAnalyticsService);if(null===e)return a.createAddinFrameworkResult(AppMagic.AuthoringTool.AddinFramework.ResultStatus.Failed,a.REGISTERASYNC+" Failed: registerTaskPane ");var t=a.registerRibbonItem(this._powerAppsContext,e);return t.resultStatus===AppMagic.AuthoringTool.AddinFramework.ResultStatus.Failed?t:(this._addAccessibleClickBinding(),a.createAddinFrameworkResult(AppMagic.AuthoringTool.AddinFramework.ResultStatus.Success,a.REGISTERASYNC))},e.prototype._addAccessibleClickBinding=function(){ko.bindingHandlers.accessibleClick={init:function(e,t,n,o,r){e.tabIndex=0,"button"!==e.tagName.toLowerCase()&&e.setAttribute("role","button"),ko.bindingHandlers.click.init(e,t,n,o,r),ko.bindingHandlers.event.init(e,(function(t,n){return{keyup:function(t,n){var o=n.keyCode||n.which;13!==o&&32!==o||ko.utils.triggerEvent(e,"click")}}}),n,o,r)}}},e}();t.Addin=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(5),r=n(13),i=n(2),s=n(6),a=n(0),l=n(7),u=n(1),c=n(3),p=n(14),d=function(){function e(e,t){this._powerAppsContext=e,this._analyticsService=t,this.updateEnvironment()}return e.prototype.getSolutionFlows=function(e){var t=this,n=this.getSolutionFlowsHttpOptions(e);return this._powerAppsContext.getCdsHttpClientXhr(n).then((function(e){return t._onGetSolutionFlowsRequestComplete(e.result)})).then(null,(function(e){return t._analyticsService.logError(a.Constants.EVENT_NAME_PREFIX+a.Constants.EVENT_GET_SOLUTION_FLOWS,new Error(e.message),{debugInformation:u.parseDebugInfomation(e.debugInformation),targetUri:n.url,httpMethod:n.type}),Promise.reject(e)}))},e.prototype.installFlow=function(e){var t=this.getInstallFlowHttpOptions(e);return this._powerAppsContext.xhr(t,!0).then((function(e){return Promise.resolve()})).then(null,(function(e){return Promise.reject(e)}))},e.prototype.getFlows=function(e){var t=this;void 0===e&&(e="");var n=this.getFlowsHttpOptions(e);return this._powerAppsContext.xhr(n,!0).then((function(e){return t._onGetFlowsRequestComplete(e.result)})).then(null,(function(e){return t._analyticsService.logError(a.Constants.EVENT_NAME_PREFIX+a.Constants.EVENT_LOAD_FLOWS,new Error(e.message),{debugInformation:u.parseDebugInfomation(e.debugInformation),targetUri:n.url,httpMethod:n.type}),Promise.reject(e)}))},e.prototype.getFlow=function(e,t){var n=this;void 0===t&&(t="");var o=this.getFlowsHttpOptions(t,e);return this._powerAppsContext.xhr(o,!0).then((function(e){return n._onGetFlowRequestComplete(e.result)})).then(null,(function(e){return n._analyticsService.logError(a.Constants.EVENT_NAME_PREFIX+a.Constants.EVENT_GET_FLOW,new Error(e.message),{debugInformation:u.parseDebugInfomation(e.debugInformation),targetUri:o.url,httpMethod:o.type}),Promise.reject(e)}))},e.prototype.getWadl=function(e){var t=this,n=s.format("{baseUrl}{powerFlowProvider}{environmentUrl}{flowUrl}/listWadl?api-version={apiVersion}",{baseUrl:this._baseUrl,powerFlowProvider:a.Constants.FLOW_URL_PREFIX,environmentUrl:u.getEnvironmentPath(this._powerAppsContext),flowUrl:a.Constants.FLOWS_URL+"/"+e,apiVersion:i.flowPortalEndPoint.apiVersion}),o={type:a.Constants.HTTP_POST,responseType:"text",url:n,headers:this._getHttpHeaders()};return this._powerAppsContext.xhr(o,!0).then((function(e){return t._onGetWadlComplete(e.result)})).then(null,(function(e){return t._analyticsService.logError(a.Constants.EVENT_NAME_PREFIX+a.Constants.EVENT_REGISTER_WADL,new Error(e.message),{debugInformation:u.parseDebugInfomation(e.debugInformation),targetUri:o.url,httpMethod:o.type}),Promise.reject(e)}))},e.prototype.getSwagger=function(e){var t=this,n=s.format("{baseUrl}{powerFlowProvider}{environmentUrl}{flowUrl}/listSwagger?api-version={apiVersion}",{baseUrl:this._baseUrl,powerFlowProvider:a.Constants.FLOW_URL_PREFIX,environmentUrl:u.getEnvironmentPath(this._powerAppsContext),flowUrl:a.Constants.FLOWS_URL+"/"+e,apiVersion:i.flowPortalEndPoint.apiVersion}),o={type:a.Constants.HTTP_POST,responseType:"text",url:n,headers:this._getHttpHeaders()};return this._powerAppsContext.xhr(o,!0).then((function(e){try{var t=e.result.responseText;return Promise.resolve(t)}catch(e){return Promise.reject(e)}})).then(null,(function(e){return t._analyticsService.logError(a.Constants.EVENT_NAME_PREFIX+a.Constants.EVENT_REGISTER_SWAGGER,new Error(e.message),{debugInformation:u.parseDebugInfomation(e.debugInformation),targetUri:o.url,httpMethod:o.type}),Promise.reject(e)}))},e.prototype.updateEnvironment=function(){var e=this._powerAppsContext.getCurrentEnvironment(),t=e.apiVersion;i.updatePortalEndPoint(e),this._baseUrl=i.flowPortalEndPoint.microsoftFlowApiEndPoint,"/"===this._baseUrl.charAt(this._baseUrl.length-1)&&(this._baseUrl=this._baseUrl.substring(0,this._baseUrl.length-1)),this._analyticsService.setContextData({host:"powerflowaddin",powerflowAddinVersion:c.Version,apiVersion:t})},e.prototype.getFlowsHttpOptions=function(e,t){var n=s.format("{baseUrl}{powerFlowProvider}{environmentUrl}{flowUrl}{optionalFlowName}/?api-version={apiVersion}",{baseUrl:this._baseUrl,powerFlowProvider:a.Constants.FLOW_URL_PREFIX,environmentUrl:u.getEnvironmentPath(this._powerAppsContext),flowUrl:a.Constants.FLOWS_URL,optionalFlowName:t?"/"+t:"",apiVersion:i.flowPortalEndPoint.apiVersion});return"manual"===e?n+="&$filter=search('manual')":"PowerAppsButton"===e?n+="&$filter=properties/definitionSummary/triggers/any(t: t/type eq 'Request' and t/kind eq 'PowerApp')":"PowerAppsButtonV2"===e&&(n+="&$filter=properties/definitionSummary/triggers/any(t: t/type eq 'Request' and t/kind eq 'PowerAppV2')"),{type:a.Constants.HTTP_GET,responseType:"text",url:n,headers:this._getHttpHeaders()}},e.prototype.getInstallFlowHttpOptions=function(e){var t=s.format("{baseUrl}{powerFlowProvider}{environmentUrl}{flowUrl}{optionalFlowName}/install?api-version={apiVersion}",{baseUrl:this._baseUrl,powerFlowProvider:a.Constants.FLOW_URL_PREFIX,environmentUrl:u.getEnvironmentPath(this._powerAppsContext),flowUrl:a.Constants.FLOWS_URL,optionalFlowName:"/"+e.name(),apiVersion:i.flowPortalEndPoint.apiVersion});return{type:a.Constants.HTTP_POST,responseType:"text",url:t,headers:this._getHttpHeaders(),data:e.properties().toString()}},e.prototype.getSolutionFlowsHttpOptions=function(e){var t='/api/data/v9.0/workflows?$filter=(category eq 5 and contains(clientdata, \'"Kind":"'+e+"\"'))";return{type:a.Constants.HTTP_GET,responseType:"text",url:t,headers:this._getHttpHeaders()}},e.prototype._getHttpHeaders=function(){var e=Object.create(null);return e[a.Constants.ACCEPT_HEADER]=a.Constants.MIME_APPLICATION_JSON,e[a.Constants.CONTENT_TYPE]=a.Constants.MIME_APPLICATION_JSON,e[a.Constants.X_MS_CLIENT_REQUEST_ID]=l.default(),e},e.prototype._onGetWadlComplete=function(e){try{var t=e.responseText;return Promise.resolve(t)}catch(e){return Promise.reject(e)}},e.prototype._onGetFlowsRequestComplete=function(e){try{var t=JSON.parse(e.responseText).value.map(this._parseFlowResponse).filter((function(e){return null!==e}));return Promise.resolve(t)}catch(e){return Promise.reject(e)}},e.prototype._onGetSolutionFlowsRequestComplete=function(e){var t=this;try{var n=JSON.parse(e.responseText).value.map(this._parseSolutionFlowResponse).filter((function(e){return!!e}));return Promise.all(n.map((function(e){return t.getFlow(e.workflowidunique)})))}catch(e){return Promise.reject(e)}},e.prototype._onGetFlowRequestComplete=function(e){try{var t=JSON.parse(e.responseText),n=this._parseFlowResponse(t);return Promise.resolve(n)}catch(e){return Promise.reject(e)}},e.prototype._parseFlowResponse=function(e){var t,n,i,s=[];if(0===Object.keys(e.properties).length)return null;if(t=e.properties.displayName,i=new Date(e.properties.lastModifiedTime),n="Started"===e.properties.state,e.properties.connectionReferences)for(var a in e.properties.connectionReferences)if(e.properties.connectionReferences.hasOwnProperty(a)){var l=e.properties.connectionReferences[a];if(!l)return null;var u=l.id||"",c=l.displayName||"",p=l.iconUri||"";s.push(new r.Connection(a,u,c,p,l.connectionName))}var d=new o.Flow(e.id,t,e.name,i,JSON.stringify(e.properties),new Date,e.properties.flowTriggerUri);return d.isRunning(n),d.connections(s),e.properties&&e.properties.hasOwnProperty("apiId")&&d.apiId(e.properties.apiId),d},e.prototype._parseSolutionFlowResponse=function(e){return e&&new p.SolutionFlow(e.workflowidunique)},e}();t.PowerFlowService=d},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Connection=function(e,t,n,o,r){this.id=ko.observable(),this.displayName=ko.observable(),this.connectionName=ko.observable(),this.name=ko.observable(),this.iconUri=ko.observable(),this.id(t),this.name(e),this.displayName(n),this.iconUri(o),this.connectionName(r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.SolutionFlow=function(e){this.workflowidunique=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){var n=this;this._taskPaneViewModel=e,this._flow=t,this._selected=ko.computed((function(){return n._taskPaneViewModel.selectId()===n.id}))}return Object.defineProperty(e.prototype,"flow",{get:function(){return this._flow},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._flow.id()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"iconUri",{get:function(){return this._flow.iconUri()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._flow.name()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this._flow.displayName()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textEdit",{get:function(){return this._taskPaneViewModel.textEdit},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textUnregister",{get:function(){return this._taskPaneViewModel.textUnregister},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"textRegisteringFlowFeedbackInfo",{get:function(){return this._taskPaneViewModel.textRegisteringFlowFeedbackInfo()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentControlName",{get:function(){return this._taskPaneViewModel.currentControlName()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resourcePrefixPath",{get:function(){return this._taskPaneViewModel.resourcePrefixPath},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"selected",{get:function(){return this._selected()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"registerStatusStyle",{get:function(){return this._taskPaneViewModel.registerStatusStyle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"registerInfoIcon",{get:function(){return this._taskPaneViewModel.registerInfoIcon()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"registerActionIcon",{get:function(){return this._taskPaneViewModel.registerActionIcon()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isActionIconVisible",{get:function(){return this._taskPaneViewModel.isActionIconVisible()},enumerable:!0,configurable:!0}),e.prototype.unregisterWadl=function(){return this._taskPaneViewModel.unregisterWadl(this._flow)},e.prototype.editFlow=function(){this._taskPaneViewModel.editFlow(this._flow)},e.prototype.selectFlow=function(){this._taskPaneViewModel.selectFlow(this._flow)},e.prototype.dismissFeedbackInfo=function(){return this._taskPaneViewModel.dismissFeedbackInfo()},e}();t.FlowViewModel=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),r=n(17),i=n(0),s=n(2);function a(e,t){e.setContextData({host:"powerflowaddin",powerflowAddinVersion:o.Version,apiVersion:t})}t.initAnalyticService=function(e){var t=new r.AnalyticsService({getAccessToken:function(){return Promise.resolve(null)},postEventsToServer:function(t,n){var o=Object.create(null);o[i.Constants.CONTENT_TYPE]=i.Constants.MIME_APPLICATION_JSON;var r={type:i.Constants.HTTP_POST,responseType:"text",url:s.powerAppsPortalEndPoint.telemetryBaseUrl+"/providers/Internal.Telemetry/collect?api-version="+s.powerAppsPortalEndPoint.telemetryVersion,headers:o,data:JSON.stringify({events:n})};return e.xhr(r,!0).then((function(e){return{ok:200===e.result.status}}),(function(e){return Promise.reject(e)}))}});return a(t,e.getCurrentEnvironment().apiVersion),t},t.setContextData=a,t.startAnalyticPublish=function(e){e.startPublish()},t.stopAnalyticPublish=function(e){e.stopPublish(),e.flush()}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(18);t.AnalyticsService=o.AnalyticsService},function(e,t,n){"use strict";var o=this&&this.__assign||Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e};Object.defineProperty(t,"__esModule",{value:!0});var r=n(19),i=n(7),s=n(20);function a(){}var l=console.time||a,u=console.timeEnd||a,c=function(){function e(e){var t,n,r=this;this._eventsList=[],this._contextData={},this._publishTimer=null,this._profileStartDurations={},this._postEventsToServer=function(e,t){var n={method:"POST",headers:{authorization:"Bearer "+e,accept:"application/json","content-type":"application/json","x-ms-client-request-id":i.default()},body:JSON.stringify({events:t})};return window.fetch(r._settings.analyticsServiceUri,n)},this._settings=o({analyticsServiceUri:e.analyticsServiceUri,enableConsoleTrace:!1,flushBatchThreshold:20,flushBatchTimeout:2e4,maxServerThreshold:100,postEventsToServer:this._postEventsToServer,onLog:a},e),this._userAgent=(t={},n=window.navigator,t.browserName=n.appName,t.browserVersion=n.appVersion,t.browserArch=n.platform,t.osName="",t.osVersion="",t.osArch="",t.screenResolution=p(),t),this._settings.getAccessToken||(this._settings.getAccessToken=function(){return r._resolvePromise(null)})}return e.prototype._resolvePromise=function(e){return window.WinJS&&window.WinJS.Promise?window.WinJS.Promise.as(e):window.Promise.resolve(e)},e.prototype.getContext=function(){return{data:this._contextData,browserName:this._userAgent.browserName,browserVersion:this._userAgent.browserVersion,browserArch:this._userAgent.browserArch,screenResolution:p(),windowLocationHref:window.location.href,osName:this._userAgent.osName,osVersion:this._userAgent.osVersion,osArch:this._userAgent.osArch}},e.prototype.setContextData=function(e){this._contextData=o({},this._contextData,e)},e.prototype.replaceContextData=function(e){this._contextData=e},e.prototype.performanceNow=function(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()},e.prototype.logInfo=function(e,t,n,o,i,s){var a={code:"info",eventName:e,eventType:r.default.Trace,message:t};this._log(a,{},n,o,i,s)},e.prototype.logWarning=function(e,t,n,o,i,s){var a={code:"warning",eventName:e,eventType:r.default.Trace,message:t};this._log(a,{},n,o,i,s)},e.prototype.logError=function(e,t,n,o,i,a){var l={eventName:e,eventType:r.default.Error,message:("string"==typeof t?t:t&&t.message)||"",exception:s.serializeExceptionToJson(t)};this._log(l,{},n,o,i,a)},e.prototype.logHttpRequestStart=function(e,t,n,o,i,s,a,l){var u={eventName:e,eventType:r.default.Request,httpMethod:t,targetUri:n};void 0!==o&&(u.clientRequestId=o),this._log(u,{request:"start"},i,s,a,l)},e.prototype.logHttpRequestEnd=function(e,t,n,o,i,s,a,l,u,c){var p={contentLength:o.contentLength,durationInMilliseconds:Math.round(i),eventName:e,eventType:r.default.Request,httpMethod:t,httpStatusCode:o.status,targetUri:n},d={preciseDurationInMilliseconds:i,request:"end"};o.responseBodyOnError&&(d.responseBodyOnError=o.responseBodyOnError),void 0!==s&&(p.clientRequestId=s),o.serviceRequestId&&(p.serviceRequestId=o.serviceRequestId),o.hostName&&(p.hostName=o.hostName),o.apiVersion&&(p.apiVersion=o.apiVersion),this._log(p,d,a,l,u,c)},e.prototype.trackEvent=function(e,t,n,o,i){var s={eventName:e,eventType:r.default.Telemetry};this._log(s,{},t,n,o,i)},e.prototype.profileStart=function(e,t,n,o,i,s){var a={eventName:t,eventType:r.default.Telemetry};void 0===o&&(o=this.performanceNow()),this._settings.enableConsoleTrace&&l(t+" - "+e),i=i||new Date,this._profileStartDurations[e]=o,this._log(a,{profile:"start"},n,e,i,s)},e.prototype.profileEnd=function(e,t,n,o,i,s){var a={eventName:t,eventType:r.default.Telemetry},l={profile:"end"};void 0===o&&(o=this.performanceNow()-this._profileStartDurations[e]),this._settings.enableConsoleTrace&&u(t+" - "+e),i=i||new Date,delete this._profileStartDurations[e],l.preciseDurationInMilliseconds=o,a.durationInMilliseconds=Math.round(o),this._log(a,l,n,e,i,s)},e.prototype.profile=function(e,t,n,o,i,s){var a={eventName:t,eventType:r.default.Telemetry,durationInMilliseconds:Math.round(o)},l={profile:"profile",preciseDurationInMilliseconds:o};this._log(a,l,n,e,i,s)},e.prototype.startPublish=function(){var e=this,t=this._eventsList.length;t>=this._settings.flushBatchThreshold&&(this._settings.enableConsoleTrace&&console.debug("Logging Batch: log entry threshold count reached ("+t+"/"+this._settings.flushBatchThreshold),this._submitEvents()),this._publishTimer||(this._publishTimer=setInterval((function(){e._submitEvents()}),this._settings.flushBatchTimeout))},e.prototype.stopPublish=function(){this._publishTimer&&clearInterval(this._publishTimer)},e.prototype.flush=function(){return this._submitEvents()},e.prototype.dispose=function(){var e=this;this.flush().then((function(){return e.stopPublish()})).catch((function(){return e.stopPublish()}))},e.prototype._log=function(e,t,n,r,s,a){e.eventTimestamp=function(e){var t="";e.hasOwnProperty("toISOString")?t=e.toISOString():t=e.getUTCFullYear()+"-"+d(e.getUTCMonth()+1,2)+"-"+d(e.getUTCDate(),2)+"T"+d(e.getUTCHours(),2)+":"+d(e.getUTCMinutes(),2)+":"+d(e.getUTCSeconds(),2)+"."+d(e.getUTCMilliseconds(),3)+"Z";return t}(s||new Date),t.context=o({},this.getContext()),e.eventId=a||i.default(),void 0!==r&&(e.eventCorrelationId=r),void 0!==n&&(t.data=n),e.eventData=t,this._settings.enableConsoleTrace&&console.debug(e.eventName,JSON.stringify(e)),this._settings.onLog(e),this._eventsList.push(e)},e.prototype._submitEvents=function(){var e=this,t=this._eventsList.splice(0,this._settings.maxServerThreshold);return this._eventsList=[],t.length?this._settings.getAccessToken().then((function(n){return e._settings.postEventsToServer(n,t)})).then((function(n){n.ok||e._handleError(t,n)}),(function(n){e._handleError(t,n)})):this._resolvePromise(null)},e.prototype._handleError=function(e,t){var n="Error posting the log events to the service.";n=t instanceof Error?n+" "+t:n+" Status: "+t.statusText,console.error("Analytics Error:",n),this._eventsList=e.concat(this._eventsList)},e}();function p(){var e="";return(screen.width||screen.height)&&(e=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")),e}function d(e,t){for(var n=""+e,o=n.length;o<t;o++)n="0"+n;return n}t.AnalyticsService=c},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={Error:"Error",Request:"Request",Telemetry:"Telemetry",Trace:"Trace"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.serializeExceptionToJson=function(e){return JSON.stringify(function e(t){var n;if(void 0===t)return"---undefined---";if(null!==t){var o=Object.prototype.toString.call(t);"[object String]"===o||"[object Number]"===o||"[object Boolean]"===o?n=t:(n={},Object.keys(t).forEach((function(e){return n[e]=t[e]})),n.message=t.message,n.stack=t.stack,void 0!==t.innerException&&(n.innerException=e(t.innerException)))}else n=t;return n}(e))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(9),r=n(8),i=n(4),s=n(22),a=n(0),l=n(1);function u(e,t,n,o){return{componentData:{name:e.name,viewModel:t},menuData:{title:n,tooltip:n,onClick:o}}}t.REGISTERASYNC="registerAsync",t.UNREGISTERASYNC="unRegisterAsync",t.createPage=u,t.registerTaskPane=function(e,t,n){var s=new o.TaskPaneViewModel(t,e,n),c=u(r.ComponentDefinitions.taskPaneComponent,s,e.getAuthoringResourceString(i.Resources.TASKPANE_COMPONENT_DISPLAYNAME));return function(e,t,n,o){var r=e.registerKnockoutComponent(t);return r.resultStatus===AppMagic.AuthoringTool.AddinFramework.ResultStatus.Success?(n(),!0):(o.logError(a.Constants.EVENT_NAME_PREFIX+a.Constants.EVENT_REGISTER_COMPONENT,new Error(r.message),{debugInformation:l.parseDebugInfomation(r.message)}),!1)}(e,r.ComponentDefinitions.taskPaneComponent,(function(){e.registerToTaskPane(c)}),n)?c:null},t.createAddinFrameworkResult=function(e,t){return{debugInformation:t,message:t,resultStatus:e}},t.registerRibbonItem=function(e,t){var n=new s.ToggleTaskPaneRibbonItem(e,t).getMenuData();return e.registerToRibbonItem(AppMagic.AuthoringTool.AddinFramework.RibbonLocation.BehaviorTab,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(4),r=n(0),i=function(){function e(e,t){var n=this;this._ribbonOnClick=function(){return n._taskpanePage.componentData.viewModel.loadFlows(),n._powerAppsContext.showTaskPaneAsync(n._taskpanePage).then((function(){return{closeHost:!0}}))},this._powerAppsContext=e,this._taskpanePage=t,this._ribbonTitle=e.getAuthoringResourceString(o.Resources.RIBBON_TITLE),this._ribbonTooltip=e.getAuthoringResourceString(o.Resources.RIBBON_TOOLTIP)}return e.prototype.getMenuData=function(){return{menuData:{title:this._ribbonTitle,tooltip:this._ribbonTooltip,iconPath:r.Constants.RIBBON_ICON_PATH,onClick:this._ribbonOnClick}}},e}();t.ToggleTaskPaneRibbonItem=i}]);
//# sourceMappingURL=powerflowaddin.js.map