!function(t,e){"function"==typeof define&&define.amd?define(["tether"],e):"object"==typeof exports?module.exports=e(require("tether")):t.Drop=e(t.Tether)}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function i(t){var e=t.split(" "),n=l(e,2),i=n[0],o=n[1];if(["left","right"].indexOf(i)>=0){var s=[o,i];i=s[0],o=s[1]}return[i,o].join(" ")}function o(t,e){for(var n=void 0,i=[];(n=t.indexOf(e))!==-1;)i.push(t.splice(n,1));return i}function s(t){return E?Core.Utility.execUnsafeLocalFunction(function(){return t()}):t()}function r(){var l=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],u=function(){for(var t=arguments.length,e=Array(t),n=0;n<t;n++)e[n]=arguments[n];return new(a.apply(w,[null].concat(e)))};c(u,{createContext:r,drops:[],activeDrops:[],defaults:{}});var b={classPrefix:"drop",defaults:{position:"bottom left",openOn:"click",beforeClose:null,constrainToScrollParent:!0,constrainToWindow:!0,classes:"",remove:!1,openDelay:0,closeDelay:50,focusDelay:null,blurDelay:null,hoverOpenDelay:null,hoverCloseDelay:null,tetherOptions:{},matchWidth:!1,matchWidthTarget:null,clickBubble:!0,scaleFn:null}};c(u,b,l),c(u.defaults,b.defaults,l.defaults),"undefined"==typeof D[u.classPrefix]&&(D[u.classPrefix]=[]),u.updateBodyClasses=function(){for(var t=!1,e=D[u.classPrefix],n=e.length,i=0;i<n;++i)if(e[i].isOpened()){t=!0;break}t?d(document.body,u.classPrefix+"-open"):f(document.body,u.classPrefix+"-open")};var O={};O.click=document.addEventListener("click",function(t){var e=u.activeDrops.length;if(0!==e){var n=u.activeDrops.slice(0);do{var i=n.pop();i.closeHandler&&i.closeHandler(t)}while(0!==n.length&&u.activeDrops.length<e)}},!0),u.closeAll=function(){u.activeDrops.forEach(function(t){t.isOpened&&t.close()})};var w=function(r){function a(t){if(e(this,a),p(Object.getPrototypeOf(a.prototype),"constructor",this).call(this),this.options=c({},u.defaults,t),this.target=this.options.target,"undefined"==typeof this.target)throw new Error("Drop Error: You must provide a target.");var n="data-"+u.classPrefix,i=this.target.getAttribute(n);i&&null==this.options.content&&(this.options.content=i);for(var o=["position","openOn"],s=0;s<o.length;++s){var r=this.target.getAttribute(n+"-"+o[s]);r&&null==this.options[o[s]]&&(this.options[o[s]]=r)}this.options.classes&&this.options.addTargetClasses!==!1&&d(this.target,this.options.classes),u.drops.push(this),D[u.classPrefix].push(this),this._boundEvents=[],this.bindMethods(),this.setupElements(),this.setupEvents(),this.setupTether(),this._firstSetup=!1}return n(a,r),h(a,[{key:"_on",value:function(t,e,n,i){this._boundEvents.push({element:t,event:e,handler:n,useCapture:!!i}),t.addEventListener(e,n,!!i)}},{key:"bindMethods",value:function(){this.transitionEndHandler=this._transitionEndHandler.bind(this)}},{key:"setupElements",value:function(){var t=this;if(this.drop=document.createElement("div"),d(this.drop,u.classPrefix),this.options.classes&&d(this.drop,this.options.classes),this.content=document.createElement("div"),d(this.content,u.classPrefix+"-content"),"function"==typeof this.options.content){var e=function(){var e=t.options.content.call(t,t);if("string"==typeof e)T(t.content.innerHTML,e);else{if("object"!=typeof e)throw new Error("Drop Error: Content function should return a string or HTMLElement.");T(t.content.innerHTML,""),s(function(){return t.content.appendChild(e)})}};e(),this.on("open",e.bind(this))}else"object"==typeof this.options.content?s(function(){return t.content.appendChild(t.options.content)}):T(this.content.innerHTML,this.options.content);s(function(){return t.drop.appendChild(t.content)})}},{key:"setupTether",value:function(){var e=this.options.position.split(" ");e[0]=x[e[0]],e=e.join(" ");var n=[];this.options.constrainToScrollParent?n.push({to:"scrollParent",pin:"top, bottom",attachment:"together none"}):n.push({to:"scrollParent"}),this.options.constrainToWindow!==!1?n.push({to:"window",attachment:"together"}):n.push({to:"window"});var o={element:this.drop,target:this.target,attachment:i(e),targetAttachment:i(this.options.position),classPrefix:u.classPrefix,offset:"0 0",targetOffset:"0 0",enabled:!1,constraints:n,addTargetClasses:this.options.addTargetClasses};this.options.tetherOptions!==!1&&(this.tether=new t(c({},o,this.options.tetherOptions)))}},{key:"setupEvents",value:function(){var t=this;if(this.options.openOn){if("always"===this.options.openOn)return void setTimeout(this.open.bind(this));var e=this.options.openOn.split(" ");if(e.indexOf("click")>=0)for(var n=function(e){t.toggle(e),e.preventDefault(),t.options.clickBubble||e.stopPropagation()},i=0;i<g.length;++i){var o=g[i];this._on(this.target,o,n)}var s=null,r=null,a=function(e){null!==r?clearTimeout(r):s=setTimeout(function(){t.open(e),s=null},("focus"===e.type?t.options.focusDelay:t.options.hoverOpenDelay)||t.options.openDelay)},l=function(e){null!==s?clearTimeout(s):r=setTimeout(function(){t.close(e),r=null},("blur"===e.type?t.options.blurDelay:t.options.hoverCloseDelay)||t.options.closeDelay)};e.indexOf("hover")>=0&&(this._on(this.target,"mouseover",a),this._on(this.drop,"mouseover",a),this._on(this.target,"mouseout",l),this._on(this.drop,"mouseout",l)),e.indexOf("focus")>=0&&(this._on(this.target,"focus",a),this._on(this.drop,"focus",a),this._on(this.target,"blur",l),this._on(this.drop,"blur",l))}}},{key:"isOpened",value:function(){if(this.drop)return v(this.drop,u.classPrefix+"-open")}},{key:"closeHandler",value:function(t){this.isOpened()&&(t.target===this.drop||this.drop.contains(t.target)||t.target===this.target||this.target.contains(t.target)||this.close(t))}},{key:"toggle",value:function(t){var e=!0;if(this.options.beforeOpen&&(e=this.options.beforeOpen()),e&&this.isOpened()){var n=u.activeDrops.indexOf(this);u.activeDrops.slice(n).forEach(function(e){e.close(t)}),t.preventDefault()}else e&&(this.open(t),t.preventDefault())}},{key:"open",value:function(t){var e=this,n=arguments.length<=1||void 0===arguments[1]?null:arguments[1];if(!(this.isOpened()||this.options.beforeOpen&&!this.options.beforeOpen())&&this.drop){if(!this._firstSetup&&this.options.firstSetup)return"hidden"!==this.content.style.visibility&&(n=this.content.style.visibility,this.content.style.visibility="hidden"),void this.options.firstSetup(this.content).then(function(){requestAnimationFrame(function(){e._firstSetup=!0,e.open(t,n)})});this._firstSetup=!0,u.activeDrops.push(this),this.drop.parentNode||s(function(){return document.body.appendChild(e.drop)}),"undefined"!=typeof this.tether&&this.tether.enable(),d(this.drop,u.classPrefix+"-open"),d(this.drop,u.classPrefix+"-open-transitionend"),setTimeout(function(){e.drop&&(d(e.drop,u.classPrefix+"-after-open"),e.position(),null!==n&&(e.content.style.visibility=n),e.trigger("afterOpen"))}),this.position(),this.trigger("open"),u.updateBodyClasses()}}},{key:"_transitionEndHandler",value:function(t){t.target===t.currentTarget&&(v(this.drop,u.classPrefix+"-open")||f(this.drop,u.classPrefix+"-open-transitionend"),this.drop.removeEventListener(m,this.transitionEndHandler))}},{key:"beforeCloseHandler",value:function(t){var e=!0;return this.isClosing||"function"!=typeof this.options.beforeClose||(this.isClosing=!0,e=this.options.beforeClose(t,this)!==!1),this.isClosing=!1,e}},{key:"close",value:function(t){if(this.isOpened()&&this.beforeCloseHandler(t)){var e=u.activeDrops.indexOf(this);u.activeDrops.splice(e,1),f(this.drop,u.classPrefix+"-open"),f(this.drop,u.classPrefix+"-after-open"),this.drop.addEventListener(m,this.transitionEndHandler),this.trigger("close"),"undefined"!=typeof this.tether&&this.tether.disable(),u.updateBodyClasses(),this.options.remove&&this.remove(t)}}},{key:"remove",value:function(t){this.close(t),this.drop&&this.drop.parentNode&&this.drop.parentNode.removeChild(this.drop)}},{key:"position",value:function(){if(this.isOpened()){if(this.options.matchWidth){var t=void 0,e=void 0;if(this.options.matchWidthTarget?t=this.options.matchWidthTarget.getBoundingClientRect().width:this.options.scaleFn?(t=window.getComputedStyle(this.target).width,e=window.getComputedStyle(this.content).height):t=this.target.getBoundingClientRect().width,t=isNaN(t)?parseInt(t):t,this.content.style.width=t+"px",this.options.scaleFn){var n=1,i=this.options.scaleFn();isNaN(i)||0===i||(n=i);var o=parseInt(e)*n;this.drop.style.width=t*n+"px",this.drop.style.height=o+"px",this.content.style.transform="scale("+n+")",this.content.style.transformOrigin="0px 0px"}}"undefined"!=typeof this.tether&&this.tether.position()}}},{key:"destroy",value:function(){this.remove(),"undefined"!=typeof this.tether&&this.tether.destroy();for(var t=0;t<this._boundEvents.length;++t){var e=this._boundEvents[t],n=e.element,i=e.event,s=e.handler;n.removeEventListener(i,s)}this._boundEvents=[],this.tether=null,this.drop=null,this.content=null,this.target=null,o(D[u.classPrefix],this),o(u.drops,this)}}]),a}(y);return u}var a=Function.prototype.bind,l=function(){function t(t,e){var n=[],i=!0,o=!1,s=void 0;try{for(var r,a=t[Symbol.iterator]();!(i=(r=a.next()).done)&&(n.push(r.value),!e||n.length!==e);i=!0);}catch(l){o=!0,s=l}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw s}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),p=function(t,e,n){for(var i=!0;i;){var o=t,s=e,r=n;i=!1,null===o&&(o=Function.prototype);var a=Object.getOwnPropertyDescriptor(o,s);if(void 0!==a){if("value"in a)return a.value;var l=a.get;if(void 0===l)return;return l.call(r)}var h=Object.getPrototypeOf(o);if(null===h)return;t=h,e=s,n=r,i=!0,a=h=void 0}},u=t.Utils,c=u.extend,d=u.addClass,f=u.removeClass,v=u.hasClass,y=u.Evented,g=["click"];"ontouchstart"in document.documentElement&&g.push("touchstart");var b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"otransitionend",transition:"transitionend"},m="";for(var O in b)if({}.hasOwnProperty.call(b,O)){var w=document.createElement("p");"undefined"!=typeof w.style[O]&&(m=b[O])}var x={left:"right",right:"left",top:"bottom",bottom:"top",middle:"middle",center:"center"},C=!!window.WinJS&&!!window.WinJS.Utilities,E=!!window["Core.Utility"],P=window.WinJS,T=C?function(t,e){P.Utilities.setInnerHTMLUnsafe(t,e)}:function(t,e){t.innerHTML=e},D={},k=r();return document.addEventListener("DOMContentLoaded",function(){k.updateBodyClasses()}),k});