"use strict";
/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */var AppMagic;!function(t){!function(o){!function(n){var e=Core.UI.StyleHelpers.joinClasses,i=t.AuthoringTool.OpenAjaxPropertyNames,r={isUsingAutoLayout:!1,outerContainerStyle:{height:"100%",width:"100%"},childStyle:{}},a=function(a){function l(t){var o=a.call(this,t)||this;return o._container=null,o._knockoutSubscriptions=new Map,o._handleContainerRef=o._handleContainerRef.bind(o),o}return __extends(l,a),l.prototype._getFlexCssFromProperties=function(){var o,n,a,l,s,u,c,p,d,C,h,g,v,f=null!==(o=this.props.controlContext.properties)&&void 0!==o?o:{},y=(null===(n=f[i.LayoutMode])||void 0===n?void 0:n.call(f))===t.Constants.LayoutMode.Auto;if(!y)return r;var b=null===(a=f[i.LayoutDirection])||void 0===a?void 0:a.call(f),m=null===(l=f[i.LayoutGap])||void 0===l?void 0:l.call(f),x=null===(s=f[i.LayoutAlignItems])||void 0===s?void 0:s.call(f),_=null===(u=f[i.LayoutJustifyContent])||void 0===u?void 0:u.call(f),A=null===(c=f[i.LayoutOverflowX])||void 0===c?void 0:c.call(f),P=null===(p=f[i.LayoutOverflowY])||void 0===p?void 0:p.call(f),L=null===(d=f[i.LayoutWrap])||void 0===d?void 0:d.call(f),V=null===(C=f[i.PaddingTop])||void 0===C?void 0:C.call(f),S=null===(h=f[i.PaddingBottom])||void 0===h?void 0:h.call(f),M=null===(g=f[i.PaddingLeft])||void 0===g?void 0:g.call(f),H=null===(v=f[i.PaddingRight])||void 0===v?void 0:v.call(f),I=e(b===t.Constants.LayoutDirection.Horizontal?"horizontal":"vertical",L&&"wrap"),w={height:"100%",width:"100%",boxSizing:"border-box",overflowX:A,overflowY:P},G={height:"100%",width:"100%",boxSizing:"border-box",display:"flex",flexDirection:b,flexWrap:L?"wrap":"nowrap",justifyContent:_,alignItems:x,alignContent:L?x:void 0,paddingTop:V,paddingBottom:S,paddingLeft:M,paddingRight:H},k={};if(Core.FallbackSwitch.isActivated("Authoring.Container.UseLegacyGapCalculation")){var R="".concat(m,"px"),O=this.props.textDirection;L?(G.height="calc(100% + ".concat(R,")"),G.width="calc(100% + ".concat(R,")"),G.marginTop="calc(-1 * ".concat(R,")"),k.marginTop=R,"rtl"===O?(G.marginRight="calc(-1 * ".concat(R,")"),k.marginRight=R):(G.marginLeft="calc(-1 * ".concat(R,")"),k.marginLeft=R),G.alignContent=x):(G.height="100%",G.width="100%",G.alignItems=x,b===t.Constants.LayoutDirection.Horizontal?"rtl"===O?k.marginRight=R:k.marginLeft=R:k.marginTop=R)}else G.gap=m;return{isUsingAutoLayout:y,outerContainerStyle:w,innerContainerStyle:G,childStyle:k,extraClassNames:I}},l.prototype.render=function(){var t=this.props,i=t.controlContext,r=t.controlInstance,l=this._getFlexCssFromProperties(),s=l.isUsingAutoLayout,u=l.outerContainerStyle,c=l.innerContainerStyle,p=l.childStyle,d=l.extraClassNames,C=e("appmagic-group",aphrodite.css(n.GroupControlStyles.groupStyle));return s?React.createElement(o.ItemsContainerMeasurer,{onRefChanged:this._handleContainerRef,controlContext:i,controlInstance:r,isRootContainer:!1,style:u},React.createElement("div",{className:e(C,"appmagic-autolayout",d),style:c},this.getChildControls(p))):React.createElement("div",{ref:this._handleContainerRef,className:C,style:u},a.prototype.getChildControls.call(this,p))},l.prototype._handleContainerRef=function(t){var o;if(!Core.Utility.isNullOrUndefined(t)){this._container=t;var n=this.props.controlInstance.control;null===(o=n.initView)||void 0===o||o.call(n,this._container,this.props.controlContext)}},l.prototype.componentWillUnmount=function(){var t;if(this._knockoutSubscriptions.forEach((function(t){return t.dispose()})),this._knockoutSubscriptions.clear(),this._container){var o=this.props.controlInstance.control;null===(t=o.disposeView)||void 0===t||t.call(o,this._container,this.props.controlContext),this._container=null}},l.prototype.getChildControls=function(t){var o=this;void 0===t&&(t={});var n=this.props.controlInstance.childIds,e=n.map((function(n){var e,r,a=o.props.getControl(n),l=a.control.OpenAjax.getControlContext(o.props.bindingContext),s=null===(e=null==l?void 0:l.modelProperties)||void 0===e?void 0:e.ZIndex,u=0;if(s){var c=s.modelObservable;c||(l.controlWidget.controlProperties.ZIndex.promotePropertyForView(l,i.ZIndex),c=s.modelObservable),u=null!==(r=c())&&void 0!==r?r:0,Core.Environment.isAuthoringTool()&&!o._knockoutSubscriptions.has(n)&&o._knockoutSubscriptions.set(n,c.subscribe((function(){o.forceUpdate()})))}else Core.Telemetry.Log.trackActivityEvent("GroupControlView.getChildControls",{message:"zIndexModelProperty does not exist for a container control's child.",control:o.props.controlInstance.id,childId:n});return{zIndex:u,control:o._renderChildControl(a,t)}}));return Core.Environment.isAuthoringTool()&&this._knockoutSubscriptions.forEach((function(t,e){n.indexOf(e)<0&&(t.dispose(),o._knockoutSubscriptions.delete(e))})),e.sort((function(t,o){return t.zIndex-o.zIndex})).map((function(t){return t.control}))},l}(o.ControlsContainer);n.GroupControlView=a}(o.GroupContainer||(o.GroupContainer={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={})),function(t){!function(t){!function(o){var n=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return __extends(n,t),n.prototype.renderCore=function(){var t=this.props,n=t.getControl,e=t.controlInstance,i=t.controlContext,r=t.textDirection;return i._requestRenderObservable(),React.createElement(o.GroupControlView,{controlContext:i,getControl:n,controlInstance:e,bindingContext:i.bindingContext,textDirection:r})},n}(t.ObservableComponent);o.GroupContainer=n}(t.GroupContainer||(t.GroupContainer={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={})),function(t){!function(o){!function(n){var e=t.AuthoringTool.OpenAjaxPropertyNames,i={x:0,y:0,width:0,height:0},r=function(n){function r(){var o=n.call(this)||this;return o._koSubscriptions=[],o._containerManager=new t.Controls.Container.ContainerManager,o.getAuthoringCanvasPlaceHolder=o.getAuthoringCanvasPlaceHolder.bind(o),o.getAuthoringVisualPlaceHolder=o.getAuthoringVisualPlaceHolder.bind(o),o}return __extends(r,n),r.prototype.initControlContext=function(t){n.prototype.initControlContext.call(this,t),t._containerDiv=null,t._minHeight=null,t._maxHeight=null},Object.defineProperty(r.prototype,"isCanvasSelectable",{get:function(){return!1},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"shouldInsertChildrenWhenVisualSelected",{get:function(){return!0},enumerable:!1,configurable:!0}),r.prototype.skipChildConstraints=function(){return!1},r.prototype.initView=function(t,i){n.prototype.initView.call(this,t,i);var r=i.properties;this._koSubscriptions.push(r[e.ChildTabPriority].subscribe((function(){i.initialized&&i._accessibilityContainer&&o.AccessibilityHelper.updateItemChildTabPriority(i._accessibilityContainer,i)}))),this._koSubscriptions.push(r[e.EnableChildFocus].subscribe((function(){i.initialized&&i._accessibilityContainer&&o.AccessibilityHelper.updateItemEnableChildFocus(i._accessibilityContainer,i)}))),this.OpenAjax.controlManager.appModeObservable()!==o.AppMode.Publish&&this._initializeNestedCanvas(i)},r.prototype.disposeView=function(t,o){n.prototype.disposeView.call(this,t,o),this._koSubscriptions.forEach((function(t){return t.dispose()})),this._koSubscriptions=[]},r.prototype.childControlsCanExpandForPrint=function(){return!0},r.prototype.calculatePrintHeight=function(o){if(this.OpenAjax.variantName===t.Constants.Controls.GroupContainerVariantNames.Manual)return this._calculatePrintHeightForManualContainer(o);var n=o.modelProperties,e=n.LayoutDirection.getValue();return n.LayoutWrap.getValue()||e!==t.Constants.LayoutDirection.Vertical?this._calculatePrintHeightForAutoLayoutContainer(o):this._calculatePrintHeightForVerticalLayoutContainerNoWrap(o)},r.prototype._calculatePrintHeightForManualContainer=function(t){var o=0;return this.forEachPrintableChildControlContext(t,(function(t){var n=t.modelProperties,e=n.Y.getValue(),i=n.Height.getValue();o=Math.max(o,e+i)})),o},r.prototype._calculatePrintHeightForVerticalLayoutContainerNoWrap=function(t){var o,n,i=t.modelProperties,r=i.LayoutGap.getValue(),a=i.PaddingTop.getValue(),l=i.PaddingBottom.getValue(),s=0,u=a+l;this.forEachPrintableChildControlContext(t,(function(t){var o=t.modelProperties[e.AutoLayoutHeight].getValue();u+=o+(0==s++?0:r)}));var c=null!==(n=null===(o=i[e.AutoLayoutHeight])||void 0===o?void 0:o.getValue())&&void 0!==n?n:-1;return-1!==c&&u>c&&u-c<=Math.ceil(s/2)?c:u},r.prototype._calculatePrintHeightForAutoLayoutContainer=function(t){var o=t.modelProperties,n=o.PaddingTop.getValue(),i=o.PaddingBottom.getValue(),r=n,a=0;return this.forEachPrintableChildControlContext(t,(function(t){var o=t.modelProperties,n=o[e.AutoLayoutY].getValue(),i=o[e.AutoLayoutHeight].getValue();r=Math.min(r,n),a=Math.max(a,n+i)})),n+i+a-r},r.prototype.findBoundsForNewChild=function(t){return void 0===t&&(t=0),i},r.prototype.managesChildrenLayout=function(){var o=this.OpenAjax.variantName;return o===t.Constants.Controls.GroupContainerVariantNames.HorizontalAutoLayout||o===t.Constants.Controls.GroupContainerVariantNames.VerticalAutoLayout},r.prototype._initializeNestedCanvas=function(t){if(!this._authoringCanvas){var o=t.controlWidget.isInAutoLayoutContainer(t.bindingContext),n=t.properties[o?e.AutoLayoutHeight:e.Height],i=t.properties[o?e.AutoLayoutWidth:e.Width];null==n||n(n.peek()||0),null==i||i(i.peek()||0);var r=t.controlWidget;this._authoringCanvas=r.controlManager.initializeNestedCanvas(r.getId(),0,null,i,n,{childCanvasId:1,replicateControls:!0,originOffsetX:ko.observable(0),originOffsetY:ko.observable(0),templateWidth:i,templateHeight:n,onCanvasResize:this._containerManager.resizeAuthoringCanvas.bind(this)})}},r.prototype.getAuthoringCanvasPlaceHolder=function(){return null},r.prototype.getAuthoringVisualPlaceHolder=function(t){return null},r}(t.Controls.Container.ContainerControlBase);n.GroupControl=r,t.Controls.RegisterReactConvertedControl("AppMagic.Controls.GroupContainer.GroupControl",t.Controls.GroupContainer.GroupControl,t.Controls.GroupContainer.GroupContainer,(function(){return!0}))}(o.GroupContainer||(o.GroupContainer={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={})),function(t){!function(t){!function(t){t.GroupControlStyles=aphrodite.StyleSheet.create({groupStyle:{position:"relative",outline:"none"}})}(t.GroupContainer||(t.GroupContainer={}))}(t.Controls||(t.Controls={}))}(AppMagic||(AppMagic={}));
//# sourceMappingURL=GroupContainer.js.map