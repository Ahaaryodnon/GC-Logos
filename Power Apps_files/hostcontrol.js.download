/*! For license information please see HostControl.js.LICENSE.txt */
(function(){return this?this:window}())["@pa-client/hostcontrol"]=function(t){var e={};function r(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(n,o,function(e){return t[e]}.bind(null,o));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){t.exports=r(1)},function(t,e,r){"use strict";r.r(e);var n,o={};r.r(o),r.d(o,"HostControl",(function(){return y})),function(t){t.SharePointHostControlVariant="SharePointHostControlVariant",t.ModelDrivenFormHostControlVariant="ModelDrivenFormHostControlVariant",t.DynamicHostControlVariant="DynamicHostControlVariant",t.TeamsHostControlVariant="TeamsHostControlVariant",t.DefaultHostControlVariant="DefaultHostControlVariant"}(n||(n={}));var a=function(){return function(t){this._controlWidget=t}}(),i=function(t){function e(e){var r=t.call(this,e)||this;return r._controlWidget=e,e.control.readyAsync=r._readyAsync.bind(r),r}return __extends(e,t),e.prototype.initControlContext=function(t){this._controlWidget.setPropertyValue("BrowserUserAgent",navigator.userAgent)},e.prototype._readyAsync=function(){return __awaiter(this,void 0,Promise,(function(){var t,e,r,n,o,a,i,s,l=this;return __generator(this,(function(u){switch(u.label){case 0:return this._readyAsyncPromise?[3,2]:(t=Core.PromiseUtils.createCompletablePromise(),this._readyAsyncPromise=t.promise,e=AppMagic.AuthoringTool.Runtime.currentApp.appHostClient,r=e.tryGetAppMetadataAsync().then((function(t){var e,r;t?(l._controlWidget.setPropertyValue("SessionID",null!==(e=t.sessionId)&&void 0!==e?e:""),l._controlWidget.setPropertyValue("TenantID",null!==(r=t.tenantId)&&void 0!==r?r:"")):Core.Telemetry.Log.trackErrorEvent(Core.Telemetry.Strings.hostControlAsyncLoadError,{errorName:"tryGetAppMetadataAsync",errorMessage:"tryGetAppMetadataAsync returned null results"})})),n=function(){return __awaiter(l,void 0,void 0,(function(){var t,r,n,o,a,i=this;return __generator(this,(function(s){switch(s.label){case 0:return[4,e.tryGetHostMetadataAsync(navigator.userAgent)];case 1:return(t=s.sent())?(r=t.offlineEnabled,Core.Environment.isWebAuthoring()?[4,AppMagic.AuthoringTool.Runtime.currentApp.documentClient.properties.getAppPreviewFlagList()]:[3,3]):[3,4];case 2:n=s.sent(),r=n.indexOf(AppMagic.Authoring.Document.PreviewFlags.enableDataverseOffline)>=0,AppMagic.AuthoringTool.Runtime.appPreviewFlagSetEvent.addListener((function(t){t.name.toLowerCase()===AppMagic.Authoring.Document.PreviewFlags[AppMagic.Authoring.Document.PreviewFlags.enableDataverseOffline].toLowerCase()&&i._controlWidget.setPropertyValue("OfflineEnabled",t.status)})),s.label=3;case 3:return this._controlWidget.setPropertyValue("OSType",null!==(o=t.osType)&&void 0!==o?o:""),this._controlWidget.setPropertyValue("Version",null!==(a=t.version)&&void 0!==a?a:""),this._controlWidget.setPropertyValue("OfflineEnabled",r),[3,5];case 4:Core.Telemetry.Log.trackErrorEvent(Core.Telemetry.Strings.hostControlAsyncLoadError,{errorName:"tryGetHostMetadataAsync",errorMessage:"tryGetHostMetadataAsync returned null results"}),s.label=5;case 5:return[2]}}))}))},[4,Core.PromiseUtils.join([r,n()].map((function(t){return t.catch((function(t){return new Error(t)}))})))]);case 1:for(o=u.sent(),a=0,i=o;a<i.length;a++)(s=i[a])instanceof Error&&Core.Telemetry.Log.trackErrorEvent(Core.Telemetry.Strings.hostControlAsyncLoadError,{errorName:s.name,errorMessage:s.message});t.complete(),u.label=2;case 2:return[2,Core.PromiseUtils.preventCancel(this._readyAsyncPromise)]}}))}))},e}(a),s=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.onChangeHostData=function(t,e){var r=JSON.parse(t.newValue);this._controlWidget.setPropertyValue("Data",r)},e}(a),l=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.onChangeData=function(t,e){e&&e.behaviors.OnDataRefresh&&this._controlWidget.fireEvent("OnDataRefresh"),this._updateItemPropertyAsync(this._getItemIdFromDataProperty(e),e)},e.prototype.onChangeDataSource=function(t,e){this._updateItemPropertyAsync(this._getItemId(e),e)},e.prototype._updateItemPropertyAsync=function(t,e){var r;return __awaiter(this,void 0,void 0,(function(){var n,o;return __generator(this,(function(a){switch(a.label){case 0:return n=null,(o=this._controlWidget.getPropertyValue("DataSource",e.bindingContext))?AppMagic.AuthoringTool.Runtime.isAuthoring?AppMagic.Data.DataFlow.isQueriedTable(o)?[4,this._tryGetFirstRecordAsync(o)]:[3,2]:[3,4]:[3,6];case 1:return n=a.sent(),[3,3];case 2:n=AppMagic.Functions.first(Core.Diagnostics.createErrorContext({protocol:"local",operation:"updateItemPropertyAsync",dataSource:null===(r=AppMagic.Data.DataSourceValue.tryGetAppDataSource(o))||void 0===r?void 0:r.name}),o),a.label=3;case 3:return[3,6];case 4:return Core.Utility.isNonEmptyString(t)?[4,this._tryLookupRecordAsync(o,t)]:[3,6];case 5:n=a.sent(),a.label=6;case 6:return e.modelProperties.Item.setValue(n,!0),this._controlWidget.notifyOutputPropertyValueChanged("Item",e.bindingContext),[2]}}))}))},e.prototype._getItemId=function(t){var e=this._getItemIdFromQueryParam();return Core.Utility.isEmptyString(e)&&(e=this._getItemIdFromDataProperty(t)),e},e.prototype._getItemIdFromDataProperty=function(t){var e=this._controlWidget.getPropertyValue("Data",t.bindingContext),r="";return e&&e.length>0&&e[0].ItemId&&(r=e[0].ItemId),r},e.prototype._getItemIdFromQueryParam=function(){var t=Core.Loader.ObjectFactory.instance.getSingleton(Core.UrlHash.IUrlHashManagerSingletonKey),e="";return t&&(e=t.getParameterValue(Core.UrlHash.ParameterConstants.ItemIdParameter.name)),Core.Utility.isEmptyString(e)&&(e=AppMagic.Data.DataValue.errorValueToNull(AppMagic.Functions.param(Core.UrlHash.ParameterConstants.ItemIdParameter.name))),null===e?"":e},e.prototype._tryLookupRecordAsync=function(t,e){if(""!==e){var r=AppMagic.Data.DataSourceValue.tryGetAppDataSource(t);if(r){var n=r.tryGetTableMetadata();if(n&&n.keyColumns.length>0){var o=n.keyColumns[0].name,a=new AppMagic.Data.Query.Filter(AppMagic.Data.Query.FilterOperator.Equals,new AppMagic.Data.Query.PropertyOperand(o),new AppMagic.Data.Query.ValueOperand(e,AppMagic.Schema.TypeGuid)),i=new AppMagic.Data.Query.TableQueryOptions;return i.filter=a,this._tryGetSingleRecordAsync(r,i)}}}return null},e.prototype._tryGetFirstRecordAsync=function(t){var e=AppMagic.Data.DataSourceValue.tryGetAppDataSource(t);return e?this._tryGetSingleRecordAsync(e):null},e.prototype._tryGetSingleRecordAsync=function(t,e){return __awaiter(this,void 0,Promise,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return[4,t.queryTableAsync(e)];case 1:return[4,n.sent().getNextResultsAsync(null,1,!1)];case 2:return(r=n.sent())instanceof Array&&r.length>0?[2,r[0]]:[2,null]}}))}))},e}(a),u=function(t){function e(e){var r=t.call(this,e)||this;return r._controlWidget=e,r}return __extends(e,t),e.prototype.onChangeSelectedHidden=function(t,e){e.modelProperties.Selected.setValue(t.newValue,!0),this._controlWidget.notifyOutputPropertyValueChanged("Selected",e.bindingContext)},e}(a),c=function(t){function e(e){var r=t.call(this,e)||this;return r._controlWidget=e,r}return __extends(e,t),e}(a),p=function(){function t(){}return t.create=function(t){switch(t.variantName){case n.SharePointHostControlVariant:return new u(t);case n.ModelDrivenFormHostControlVariant:return new l(t);case n.DefaultHostControlVariant:return new i(t);case n.DynamicHostControlVariant:return new s(t);case n.TeamsHostControlVariant:return new c(t);default:throw new Core.NotSupportedError("HostControlVariantFactory.create","Unknown variant name: ".concat(t.variantName))}},t}(),y=function(){function t(){this._hostControlVariant=null}return t.prototype.onLoad=function(){this._hostControlVariant=p.create(this.OpenAjax)},t.prototype.onUnload=function(){this._hostControlVariant=null},t.prototype.initControlContext=function(t){var e,r;null===(r=(e=this._hostControlVariant).initControlContext)||void 0===r||r.call(e,t)},t.prototype.disposeControlContext=function(t){var e,r;null===(r=(e=this._hostControlVariant).disposeControlContext)||void 0===r||r.call(e,t)},t.prototype.onChange=function(t,e){var r=AppMagic.AuthoringTool.Runtime.currentApp,n=e.controlWidget.controlName;r.hostControlsController.notifyHostControlPropertyChanged(n,t);var o="onChange".concat(t.property.charAt(0).toUpperCase()).concat(t.property.slice(1));Core.Utility.isFunction(this._hostControlVariant[o])&&this._hostControlVariant[o](t,e)},t}();Core.exportToNamespace(["AppMagic","Controls"],o)}]);
//# sourceMappingURL=D:/a/_work/1/s/obj/Assets/js/HostControl/HostControl.js.map