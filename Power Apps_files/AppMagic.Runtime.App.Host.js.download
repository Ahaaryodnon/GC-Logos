/*! For license information please see AppMagic.Runtime.App.Host.js.LICENSE.txt */
(function(){return this?this:window}())["@pa-client/appmagic-runtime-app-host"]=function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=41)}([function(e,t,r){"use strict";var n,o,a,i,s,c,u,p,l;r.d(t,"c",(function(){return n})),r.d(t,"d",(function(){return o})),r.d(t,"n",(function(){return a})),r.d(t,"a",(function(){return i})),r.d(t,"b",(function(){return s})),r.d(t,"p",(function(){return c})),r.d(t,"o",(function(){return u})),r.d(t,"q",(function(){return p})),r.d(t,"r",(function(){return l})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&"string"==typeof e.Name&&e.Name.length>=1&&(null===e.DisplayName||void 0===e.DisplayName||"string"==typeof e.DisplayName&&e.DisplayName.length>=1)&&(null===e.Categories||void 0===e.Categories||Core.Utility.isArray(e.Categories)&&e.Categories.every((function(e){return null==e||"string"==typeof e&&e.length>=1})));return!r&&t&&Core.Log.warning("IConnectedDataset.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(n||(n={})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Core.Utility.isArray(e.value)&&e.value.every((function(e){return null==e||n.isValid(e)}));return!r&&t&&Core.Log.warning("IConnectedDatasetListMetadata.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(o||(o={})),function(e){function t(e,t){var r=!(null===e||"object"!=typeof e||Object.getPrototypeOf(e)!==Object.prototype||null!==e.licensedid&&void 0!==e.licensedid&&"string"!=typeof e.licensedid||null!==e.licensecode&&void 0!==e.licensecode&&"string"!=typeof e.licensecode||"string"!=typeof e.displayname||null!==e.serviceplanid&&void 0!==e.serviceplanid&&"string"!=typeof e.serviceplanid);return!r&&t&&Core.Log.warning("ILicense.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(a||(a={})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&"string"==typeof e.Name&&e.Name.length>=1&&(null===e.DisplayName||void 0===e.DisplayName||"string"==typeof e.DisplayName&&e.DisplayName.length>=1)&&(null===e.Categories||void 0===e.Categories||Core.Utility.isArray(e.Categories)&&e.Categories.every((function(e){return null==e||"string"==typeof e&&e.length>=1})))&&(null===e.licensesneeded||void 0===e.licensesneeded||Core.Utility.isArray(e.licensesneeded)&&e.licensesneeded.every((function(e){return null==e||a.isValid(e)})))&&(null===e.Type||void 0===e.Type||"string"==typeof e.Type);return!r&&t&&Core.Log.warning("IConnectedDataTable.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(i||(i={})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Core.Utility.isArray(e.value)&&e.value.every((function(e){return null==e||i.isValid(e)}));return!r&&t&&Core.Log.warning("IConnectedDataTableListMetadata.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(s||(s={})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&Core.Utility.isArray(e.value)&&e.value.every((function(e){return null==e||u.isValid(e)}));return!r&&t&&Core.Log.warning("ISurveyEntityTableList.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(c||(c={})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&"string"==typeof e.msfp_sourcesurveyidentifier&&"string"==typeof e.msfp_name;return!r&&t&&Core.Log.warning("ISurveyEntityTable.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(u||(u={})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&(null===e.DisplayName||void 0===e.DisplayName||l.isValid(e.DisplayName))&&"string"==typeof e.EntitySetName&&e.EntitySetName.length>=1;return!r&&t&&Core.Log.warning("IXrmEntityDefinitionTable.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(p||(p={})),function(e){function t(e,t){var r=null!==e&&"object"==typeof e&&Object.getPrototypeOf(e)===Object.prototype&&(null===e.UserLocalizedLabel||void 0===e.UserLocalizedLabel||null!==e.UserLocalizedLabel&&"object"==typeof e.UserLocalizedLabel&&Object.getPrototypeOf(e.UserLocalizedLabel)===Object.prototype&&(null===e.UserLocalizedLabel.Label||void 0===e.UserLocalizedLabel.Label||"string"==typeof e.UserLocalizedLabel.Label));return!r&&t&&Core.Log.warning("IXrmEntityDefinitionTableDisplayName.isValid","Invalid value."),r}e.safeCast=function(e){return t(e,!0)?e:null},e.isValid=function(e){return t(e,!1)}}(l||(l={}))},function(e,t,r){"use strict";var n;r.r(t),r.d(t,"ServicePaths",(function(){return n})),function(e){e.FoldersOrFolder=new Core.TypedUrlTemplate("datasets{/datasetName}/folders{/folderName}"),e.CopyFile=new Core.TypedUrlTemplate("datasets{/datasetName}/copyFile?source={source}&destination={destination}&overwrite={overwrite}"),e.ExtractFolder=new Core.TypedUrlTemplate("datasets{/datasetName}/extractFolderv2?source={source}&destination={destination}&overwrite={overwrite}"),e.DeleteFile=new Core.TypedUrlTemplate("datasets{/datasetName}/files{/fileId}"),e.Tables=new Core.TypedUrlTemplate("datasets{/datasetName}/tables"),e.AllTables=new Core.TypedUrlTemplate("datasets{/datasetName}/alltables"),e.TableMetadata=new Core.TypedUrlTemplate("$metadata.json/datasets{/datasetName}/tables{/tableName}"),e.Table=new Core.TypedUrlTemplate("datasets{/datasetName}/tables{/tableName}"),e.SqlStoredProcedures=new Core.TypedUrlTemplate("datasets{/datasetName}/procedures"),e.SqlStoredProcedureMetadata=new Core.TypedUrlTemplate("$metadata.json/datasets{/datasetName}/procedures{/storedProcedureName}")}(n||(n={}))},function(e,t,r){"use strict";r.r(t),r.d(t,"PreloadRequestError",(function(){return n}));var n=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Core.ApplicationError)},function(e,t,r){},function(e,t,r){"use strict";r.r(t);var n=function(){function e(e,t){void 0===t&&(t=Core.GuidGenerator.DefaultInstance),this._powerAppsClient=e,this._guidGenerator=t,this._connectionApiIdToAppAccessToken=HashTableUtility.create(),this._appApisByAppAccessToken=HashTableUtility.create(),this._connectionApiIdToAppAccessTokenPromise=HashTableUtility.create()}return e.prototype.getAppAccessTokenAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n,o,a;return __generator(this,(function(i){switch(i.label){case 0:return this._connectionApiIdToAppAccessToken[e]?[2,this._connectionApiIdToAppAccessToken[e]]:this._connectionApiIdToAppAccessTokenPromise[e]?[4,this._connectionApiIdToAppAccessTokenPromise[e]]:[3,2];case 1:return[2,i.sent()];case 2:return t=Core.PromiseUtils.createCompletablePromise(),this._connectionApiIdToAppAccessTokenPromise[e]=t.promise,[4,this._waitForConnectionsToLoadAsync()];case 3:return i.sent(),r=this._powerAppsClient.getApisInfo(),(n=HashTableUtility.tryGetValueIgnoreCase(r,e))?[3,5]:(o="Unable to find api with id ".concat(e),Core.Log.error("AppAuthority.getAppAccessTokenAsync",o),t.error(new s(o)),[4,t.promise]);case 4:return[2,i.sent()];case 5:return a=this._guidGenerator.generateGuid(),this._connectionApiIdToAppAccessToken[e]=a,this._appApisByAppAccessToken[a]=n,t.complete(a),[4,t.promise];case 6:return[2,i.sent()]}}))}))},e.prototype.getConnectionApiIdFromToken=function(e){var t=this._appApisByAppAccessToken[e];if(t)return t.id;throw new s("Unable to find mapping from token","getConnectionApiIdFromToken")},e.prototype.authorizeRequestAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r,n;return __generator(this,(function(o){switch(o.label){case 0:if(r=this._appApisByAppAccessToken[t],Core.Utility.isUndefined(r))throw new s("Unauthorized -- the app access token is invalid.");return[4,this._waitForConnectionsToLoadAsync()];case 1:if(o.sent(),!this._powerAppsClient.hasConnectionApiReference(r.id))throw new s("Unauthorized -- the app does not possess access to this API.");if(n=new Core.Url(e.url),!r.runtimeUrl.isBaseOf(n))throw new s("Unauthorized -- the request URL does not match any API runtime URL.");return AppMagic.Runtime.Client.addAuthorizationOptions(e.headers,{resource:AppMagic.Runtime.Client.ResourceNames.AppService}),AppMagic.Services.appendCustomHeadersOptions(e,{optInMSHeaders:!0,addCustomHeaders:!0}),[2]}}))}))},e.prototype._waitForConnectionsToLoadAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this._powerAppsClient.areAppConnectionsLoaded||!this._powerAppsClient.areAppConnectionsLoadedAsync?[3,2]:[4,this._powerAppsClient.areAppConnectionsLoadedAsync];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e}(),o=function(){function e(e,t,r,n,o){this._userService=e,this._powerAppsClient=t,this._powerBIProvider=r,this._formsProProvider=n,this._microsoftStreamProvider=o}return e.prototype.getPowerBIReadOnlyAccessTokenAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._powerAppsClient.waitForAuthConsentAsync(AppMagic.Runtime.Client.ResourceNames.PowerBI)];case 1:return e.sent()?[4,this._powerBIProvider.authenticateSilentAsync({emailAddress:this._userService.userProfile.email,objectId:this._userService.userProfile.objectId})]:[2,Core.PromiseUtils.throwAsync(new s("Unauthorized -- the app does not have PowerBI token access"))];case 2:return e.sent(),[2,this._powerBIProvider.store.accessToken]}}))}))},e.prototype.getFormsProReadOnlyAccessTokenAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._powerAppsClient.waitForAuthConsentAsync(AppMagic.Runtime.Client.ResourceNames.FormsPro)];case 1:return e.sent()?[4,this._formsProProvider.authenticateSilentAsync({emailAddress:this._userService.userProfile.email,objectId:this._userService.userProfile.objectId})]:[2,Core.PromiseUtils.throwAsync(new s("Unauthorized -- the app does not have FormsPro token access"))];case 2:return e.sent(),[2,this._formsProProvider.store.accessToken]}}))}))},e.prototype.getMicrosoftStreamAccessTokenAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._powerAppsClient.waitForAuthConsentAsync(AppMagic.Runtime.Client.ResourceNames.MicrosoftStream)];case 1:return e.sent()?[4,this._microsoftStreamProvider.authenticateSilentAsync({emailAddress:this._userService.userProfile.email,objectId:this._userService.userProfile.objectId})]:[2,Core.PromiseUtils.throwAsync(new s("Unauthorized -- the app does not have Microsoft Stream token access"))];case 2:return e.sent(),[2,this._microsoftStreamProvider.store.accessToken]}}))}))},e}(),a=function(){function e(){}return e.prototype.authorizeRequest=function(e){var t,r=e.headers[AppMagic.Services.HttpConstants.HeaderName.MsRtsAuthorizationRequestId];if(r===AppMagic.Services.Azure.Constants.AuthorizationRequest.EntityFormContainer.data)t=AppMagic.Runtime.Client.ResourceNames.RTSDataService;else{if(r!==AppMagic.Services.Azure.Constants.AuthorizationRequest.EntityFormContainer.metadata)throw new s("Unauthorized -- Invalid ".concat(AppMagic.Services.HttpConstants.HeaderName.MsRtsAuthorizationRequestId," header."));t=AppMagic.Runtime.Client.ResourceNames.PowerAppsService}delete e.headers[AppMagic.Services.HttpConstants.HeaderName.MsRtsAuthorizationRequestId],AppMagic.Runtime.Client.addAuthorizationOptions(e.headers,{resource:t}),AppMagic.Services.appendCustomHeadersOptions(e,{optInMSHeaders:!0,addCustomHeaders:!0})},e}(),i=function(){function e(e,t){void 0===t&&(t=Core.GuidGenerator.DefaultInstance),this._powerAppsClient=e,this._guidGenerator=t,this._resourceIdToAppAccessToken=HashTableUtility.create(),this._appAccessTokenToResourceId=HashTableUtility.create()}return e.prototype.getAppAccessTokenAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n;return __generator(this,(function(o){switch(o.label){case 0:return this._resourceIdToAppAccessToken[e]?[2,this._resourceIdToAppAccessToken[e]]:[4,this._waitForConnectionsToLoadAsync()];case 1:return o.sent(),[4,this._powerAppsClient.getAppDynamicResourceConfigsAsync()];case 2:if(t=o.sent(),!HashTableUtility.tryGetValueIgnoreCase(t,e))throw r="Unable to find dynamic resource with id ".concat(e),Core.Log.error("DynamicResourceAppAccessTokenManager.getAppAccessToken",r),new s(r);return n=this._guidGenerator.generateGuid(),this._resourceIdToAppAccessToken[e]=n,this._appAccessTokenToResourceId[n]=e,[2,n]}}))}))},e.prototype.getConnectionApiIdFromToken=function(e){return this._appAccessTokenToResourceId[e]},e.prototype.authorizeRequestAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r,n,o,a,i;return __generator(this,(function(c){switch(c.label){case 0:if(r=this._appAccessTokenToResourceId[t],Core.Utility.isUndefined(r))throw new s("Unauthorized -- the app access token is invalid.");return[4,this._waitForConnectionsToLoadAsync()];case 1:return c.sent(),a=(o=HashTableUtility).tryGetValueIgnoreCase,[4,this._powerAppsClient.getAppDynamicResourceConfigsAsync()];case 2:if(!(n=a.apply(o,[c.sent(),r])))throw new s("Unauthorized -- the app does not possess access to this dynamic resource.");if(i=new Core.Url(e.url),!n.url.isBaseOf(i))throw new s("Unauthorized -- the request URL does not match the resource's URL.");return AppMagic.Runtime.Client.addAuthorizationOptions(e.headers,{resource:n.resource,isDynamicResource:!0}),AppMagic.Services.appendCustomHeadersOptions(e,{optInMSHeaders:!0,addCustomHeaders:!0}),[2]}}))}))},e.prototype._waitForConnectionsToLoadAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this._powerAppsClient.areAppConnectionsLoaded||!this._powerAppsClient.areAppConnectionsLoadedAsync?[3,2]:[4,this._powerAppsClient.areAppConnectionsLoadedAsync];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))},e}();r.d(t,"AppAuthorityError",(function(){return s})),r.d(t,"AppAuthority",(function(){return c}));var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(Core.ApplicationError),c=function(){function e(e,t,r,s,c,u){void 0===u&&(u=Core.GuidGenerator.DefaultInstance),this._appServiceAccessTokenManagerLazy=new Core.Lazy((function(){return new n(c,u)})),this._dynamicResourceAccessTokenManagerLazy=new Core.Lazy((function(){return new i(c,u)})),this._readonlyServicesAppAccessTokenFetcherLazy=new Core.Lazy((function(){return new o(e,c,t,r,s)})),this._entityFormAppRequestAuthorizerLazy=new Core.Lazy((function(){return new a}))}return Object.defineProperty(e.prototype,"appServiceAppAccessTokenManager",{get:function(){return this._appServiceAccessTokenManagerLazy.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dynamicResourceAppAccessTokenManager",{get:function(){return this._dynamicResourceAccessTokenManagerLazy.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"readOnlyServicesAppAccessTokenManager",{get:function(){return this._readonlyServicesAppAccessTokenFetcherLazy.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"entityFormAppRequestAuthorizer",{get:function(){return this._entityFormAppRequestAuthorizerLazy.value},enumerable:!1,configurable:!0}),e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"DatasetService",(function(){return n}));var n=function(e){function t(t,r,n,o,a){var i=e.call(this,t,r,n,a)||this;return i._revisionInfo=o,null===i._revisionInfo?i._cdpInterfaceBaseUrl=i.connectionBaseUrl:i._cdpInterfaceBaseUrl=Core.UrlBuilder.composeUrlAppendToBase(i.connectionBaseUrl,i._revisionInfo.baseUrl),i}return __extends(t,e),Object.defineProperty(t.prototype,"revisionInfo",{get:function(){return this._revisionInfo},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cdpInterfaceBaseUrl",{get:function(){return this._cdpInterfaceBaseUrl},enumerable:!1,configurable:!0}),t.prototype.getDatasetsAsync=function(){var e=HashTableUtility.create();return e[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue,this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,"datasets"),headers:e,method:AppMagic.Services.HttpConstants.Method.GET},AppMagic.Data.ConnectedDatasetListMetadata.safeCast,"DataService.GetDatasets").then((function(e){return e.value.map((function(e){return{name:e.Name,displayName:e.DisplayName}}))}))},t}(r(19).ApiConnectionServiceBase)},function(e,t,r){"use strict";r.r(t),r.d(t,"PreloadRequestWriter",(function(){return n}));var n=function(){function e(e){this._localStorageProvider=e}return e.prototype.writeInitialRequestsToLocalStorage=function(e,t,r){r&&this.writePreloadRequestsToLocalStorage(e,t,r)},e.prototype.writePreloadRequestsToLocalStorage=function(e,t,r){if(r){Core.Telemetry.Log.trackActivityEvent("WritingPreloadRequests",{totalRequestsWritten:r.length}),this._localStorageProvider.setValue(e,r);for(var n=[],o=0;o<window.localStorage.length;o++){var a=window.localStorage.key(o);a.startsWith(t)&&a!==e&&n.push(a)}for(var i=0,s=n;i<s.length;i++){var c=s[i];this._localStorageProvider.removeValue(c)}}},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"PreloadRequestReader",(function(){return n}));var n=function(){function e(e){this._localStorageProvider=e}return e.prototype.tryGetAppPrefetchRequests=function(e){try{var t=this._localStorageProvider.getValue(e);if(t)return HashTableUtility.fromJsonObject(t)}catch(e){}return null},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"PreloadRequestAuthorizationHandler",(function(){return o}));var n=r(2),o=function(){function e(e){this._appAuthority=e,this._authSchemeHeaderKey="preload-data-request-auth-scheme",this._authApiKey="preload-data-request-connection-api"}return e.prototype.serializeRuntimeAuthorizationHeaderAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t=this;return __generator(this,(function(r){switch(r.label){case 0:return e?[4,HashTableUtility.forEachAsync(e,(function(r){return __awaiter(t,void 0,void 0,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this._updatePreloadedRequestAuthorizationHeaderAsync(r)];case 1:return n.sent(),[3,3];case 2:return t=n.sent(),Core.Telemetry.Log.trackErrorEvent("ErrorReadingPreloadAuthorization",{error:t}),delete e[HashTableUtility.tryGetKeyIgnoreCase(e,r.url)],[3,3];case 3:return[2]}}))}))}))]:[3,2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},e.prototype.parseHeaderForPreloadStorage=function(e){var t=this;e&&HashTableUtility.forEach(e,(function(r){try{t._addPreloadAuthHeaders(r)}catch(t){Core.Telemetry.Log.trackErrorEvent("ErrorSettingPreloadAuthorization",{error:t}),delete e[HashTableUtility.tryGetKeyIgnoreCase(e,r.url)]}}))},e.prototype._addPreloadAuthHeaders=function(e){var t=(null==e?void 0:e.headers)?null==e?void 0:e.headers.Authorization:null;if(t){var r=t.split(" ");if(r.length>0){var n="",o=void 0;r.length>1?(n=e.headers[this._authSchemeHeaderKey]=r[0],o=r[1]):o=r[0];var a=this._getConnectionApi(n,o);e.headers[this._authApiKey]=a,delete e.headers.Authorization}}},e.prototype._updatePreloadedRequestAuthorizationHeaderAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,o,a;return __generator(this,(function(i){switch(i.label){case 0:return(null==e?void 0:e.headers)&&(e.headers[this._authSchemeHeaderKey]||e.headers[this._authApiKey])?(t=e.headers[this._authSchemeHeaderKey],(r=e.headers[this._authApiKey])?[4,this._getTokenAsync(t,r)]:[3,2]):[3,3];case 1:return o=i.sent(),a="".concat(t," ").concat(o),e.headers.Authorization=a.trim(),delete e.headers[this._authSchemeHeaderKey],delete e.headers[this._authApiKey],[3,3];case 2:throw new n.PreloadRequestError("Preload Request needs api header","InvalidPreloadRequestParse");case 3:return[2]}}))}))},e.prototype._getTokenAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r;return __generator(this,(function(o){switch(o.label){case 0:switch(r="",e){case"paauth":return[3,1];case"dynamicauth":return[3,2]}return[3,4];case 1:return this._appAuthority.appServiceAppAccessTokenManager.getAppAccessTokenAsync(t).then((function(e){r=e}),(function(){throw new n.PreloadRequestError("Getting App Access token for Preload Request failed","PreloadAuthorizationFailed")})),[3,5];case 2:return[4,this._appAuthority.dynamicResourceAppAccessTokenManager.getAppAccessTokenAsync(t)];case 3:return r=o.sent(),[3,5];case 4:throw new n.PreloadRequestError("Unsupported Auth Type For Preload Request Replay","PreloadUnsupportedAuth");case 5:return[2,r]}}))}))},e.prototype._getConnectionApi=function(e,t){var r="";switch(e){case"paauth":r=this._appAuthority.appServiceAppAccessTokenManager.getConnectionApiIdFromToken(t);break;case"dynamicauth":r=this._appAuthority.dynamicResourceAppAccessTokenManager.getConnectionApiIdFromToken(t);break;default:throw new n.PreloadRequestError("Unsupported Auth Type For Preload Request Write","PreloadUnsupportedAuth")}return r},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ConnectorParameter",(function(){return n}));var n=function(){return function(e,t){this.index=e,this.parameterName=t}}()},function(e,t,r){"use strict";r.r(t),r.d(t,"TabularService",(function(){return o}));var n=r(1),o=function(e){function t(t,r,n,o,a,i){var s=e.call(this,t,r,n,o,a)||this;return s._encodeDataset=i,s}return __extends(t,e),t._generateDataServiceItemInfo=function(e){var t={name:e.Name,displayName:e.DisplayName};Core.Utility.isString(e.Type)&&(t.type=e.Type);var r=e.licensesneeded;return r&&r.length>0&&(t.licenses=[],r.forEach((function(e){var r={licensedId:e.licensedid,licenseCode:e.licensecode,displayName:e.displayname,servicePlanId:e.serviceplanid};t.licenses.push(r)}))),t},Object.defineProperty(t.prototype,"encodeDataset",{get:function(){return this._encodeDataset},enumerable:!1,configurable:!0}),t.prototype.getTablesAsync=function(e){return this._getTablesAsync(e,n.ServicePaths.Tables).then((function(e){return e.value.map((function(e){return t._generateDataServiceItemInfo(e)}))}))},t.prototype.getAllTablesAsync=function(e){return this._getTablesAsync(e,n.ServicePaths.AllTables).then((function(e){return e.value.map((function(e){return t._generateDataServiceItemInfo(e)}))}))},t.prototype.getRtsTablesAsync=function(e){return this._getTablesAsync(e,n.ServicePaths.Tables).then((function(e){return e.value.map((function(e){var r=t._generateDataServiceItemInfo(e);return r.categories=e.Categories,r}))}))},t.prototype._getTablesAsync=function(e,t){var r=HashTableUtility.create();r[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue;var n=t.expand({datasetName:this.getEncodedDatasetName(e)});return this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,n),headers:r,method:AppMagic.Services.HttpConstants.Method.GET},AppMagic.Data.ConnectedDataTableListMetadata.safeCast,"".concat(this.apiId,".GetTables"))},t.prototype.composeTableMetadataPath=function(e,t){var r=n.ServicePaths.TableMetadata.expand({datasetName:this.getEncodedDatasetName(e),tableName:Core.Url.encode(t)});return this.revisionInfo&&"/"!==this.revisionInfo.baseUrl.toString()?Core.UrlBuilder.composeUrlAppendToBase(this.revisionInfo.baseUrl,r):new Core.Url(r)},t.prototype.getTableMetadataAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r,o,a=this;return __generator(this,(function(i){switch(i.label){case 0:return(r=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue,o=Core.Diagnostics.createErrorContext({protocol:"cdp",operation:"getTableMetadata",dataSource:e,table:t}),Core.Diagnostics.addHeaders(r,o),[4,Core.Globalization.assertStringLoaderAndCast(AppMagic.Strings).loadingPromise()];case 1:return i.sent(),[2,this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,n.ServicePaths.TableMetadata.expand({datasetName:this.getEncodedDatasetName(e),tableName:Core.Url.encode(t)})),headers:r,method:AppMagic.Services.HttpConstants.Method.GET},(function(e){var r=AppMagic.Data.ConnectedDataDescription.safeCast(e);return a._validateTableName(r,t),r}),"".concat(this.apiId,".GetTableMetadata"))]}}))}))},t.prototype._validateTableName=function(e,t){if(!e)throw new Error(Core.Utility.formatString(AppMagic.Strings.InvalidDataDescriptionFormat,t));var r=t.trim().toLocaleLowerCase(),n=e.name.trim().toLocaleLowerCase();if(n!==r){if(decodeURI(n)===decodeURI(r))throw new Error(Core.Utility.formatString(AppMagic.Strings.TableMetadataEncodingMissMatch,n,r));throw new Error(Core.Utility.formatString(AppMagic.Strings.TableMetadataNameMissMatch,n,r))}},t.prototype.downloadNavigationEntitiesAsync=function(e,r,n){return void 0===n&&(n=null),__awaiter(this,void 0,Promise,(function(){var o,a,i;return __generator(this,(function(s){switch(s.label){case 0:return o=t._getTargetTablesForNavigationProperties(r),a=HashTableUtility.mapToArray(o,(function(e){return e})),n>=0&&(a=a.splice(0,n)),[4,this.downloadTableMetadataFromListAsync(e,a)];case 1:return i=s.sent(),Core.Telemetry.Log.trackEvent("TabularService.downloadNavigationEntitiesAsync",{datasetName:e,primaryTableName:r.name,totalFirstLevelNavigation:i.length,targetTableNames:JSON.stringify(o),totalTableDownloading:n}),i.push(r),[2,i]}}))}))},t._getTargetTablesForNavigationProperties=function(e){var t=HashTableUtility.create();return HashTableUtility.forEach(e.schema.items.properties,(function(e){var r=e["x-ms-navigation"];r&&(t[r.targetTable]=r.targetTable)})),t},t.prototype.tryGetTabularDatasetMetadataAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:(e=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue,t.label=1;case 1:return t.trys.push([1,3,,4]),[4,this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,"$metadata.json/datasets"),headers:e,method:AppMagic.Services.HttpConstants.Method.GET},AppMagic.ConnectionHub.TabularMetadata.safeCast,"DataService.GetTabularDatasetMetadata")];case 2:return[2,t.sent()];case 3:return t.sent(),Core.Log.warningEx("TabularSerevice.tryGetTabularDatasetMetadataAsync","Could not get or parse tabular dataset metadata for connector api: ".concat(this.apiId)),[2,null];case 4:return[2]}}))}))},t.prototype.createPrimaryKeyColumnAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r;return __generator(this,(function(n){return(r=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue,[2,this._sendHttpRequestIgnoreResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,e),headers:r,method:t},"DataService.CreatePrimaryKeyColumn")]}))}))},t.prototype.getListParameterAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r,n,o,a;return __generator(this,(function(i){switch(i.label){case 0:return(r=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue,n=e["x-ms-dynamic-values"]["value-path"],o=e["x-ms-dynamic-values"]["value-title"],a=e["x-ms-dynamic-values"]["value-collection"],[4,this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,t),headers:r,method:AppMagic.Services.HttpConstants.Method.GET},(function(e){return Core.Utility.isArray(e[a])?e[a]:null}),"DataService.GetListParameter")];case 1:return[2,i.sent().map((function(e){return{id:e[n],displayName:e[o]}}))]}}))}))},t.prototype.getFileParameterAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return(t=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue,[4,this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,e),headers:t,method:AppMagic.Services.HttpConstants.Method.GET},(function(e){return Core.Utility.isArray(e)?e:null}),"DataService.GetFileParameter")];case 1:return[2,r.sent().filter(AppMagic.ConnectionHub.FileServiceItem.isValid)]}}))}))},t.prototype.getEncodedDatasetName=function(e){return this._encodeDataset?Core.Url.encode(e):e},t.prototype.downloadTableMetadataFromListAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r,n,o,a,i,s=this;return __generator(this,(function(c){switch(c.label){case 0:r=5,n=[],o=0,c.label=1;case 1:return o<t.length?(a=t.slice(o,o+r),[4,Core.PromiseUtils.join(a.map((function(t){return __awaiter(s,void 0,void 0,(function(){var r;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.getTableMetadataAsync(e,t)];case 1:return[2,n.sent()];case 2:return r=n.sent(),Core.Utility.isCanceledError(r)||Core.Log.error("tabularService.downloadTableMetadataFromListAsync",r,"There was an error fetching metadata for relative table ".concat(t)),[2,null];case 3:return[2]}}))}))})))]):[3,4];case 2:i=c.sent(),n.push.apply(n,i.filter((function(e){return null!==e}))),c.label=3;case 3:return o+=r,[3,1];case 4:return[2,n]}}))}))},t.prototype.getSqlStoredProceduresAsync=function(e){return this._getSqlStoredProceduresAsync(e).then((function(e){return e.value.map((function(e){return{name:e.Name,displayName:e.DisplayName}}))}))},t.prototype._getSqlStoredProceduresAsync=function(e){var t=HashTableUtility.create();t[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue;var r=n.ServicePaths.SqlStoredProcedures.expand({datasetName:this.getEncodedDatasetName(e)});return this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,r),headers:t,method:AppMagic.Services.HttpConstants.Method.GET},AppMagic.Data.SqlStoredProcedureListMetadata.safeCast,"".concat(this.apiId,".GetSqlStoredProcedures"))},t.prototype.getSqlStoredProcedureMetadataAsync=function(e,t){var r=HashTableUtility.create();r[AppMagic.Services.HttpConstants.HeaderName.PowerAppsConnectorProtocolSemantics]=AppMagic.Services.HttpConstants.HeaderValue.PowerAppsConnectorProtocolSemanticsValue;var o=n.ServicePaths.SqlStoredProcedureMetadata.expand({datasetName:this.getEncodedDatasetName(e),storedProcedureName:Core.Url.encode(t)});return this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,o),headers:r,method:AppMagic.Services.HttpConstants.Method.GET},AppMagic.Data.SqlStoredProcedureMetadata.safeCast,"".concat(this.apiId,".GetSqlStoredProcedureMetadata"))},t}(r(5).DatasetService)},function(e,t,r){"use strict";r.r(t),r.d(t,"AppAuthenticationService",(function(){return n}));var n=function(){function e(e,t){this._appAuthority=e,this._userService=t}return e.prototype.getAccessTokenForResourceAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n,o;return __generator(this,(function(a){switch(a.label){case 0:return"appservice"!==e.resourceName?[3,2]:[4,this._appAuthority.appServiceAppAccessTokenManager.getAppAccessTokenAsync(e.apiId)];case 1:return[2,{tokenType:"paauth",accessToken:t=a.sent()}];case 2:return"dynamic"!==e.resourceName?[3,4]:[4,this._appAuthority.dynamicResourceAppAccessTokenManager.getAppAccessTokenAsync(e.resourceId)];case 3:return[2,{tokenType:"dynamicauth",accessToken:t=a.sent()}];case 4:r=Core.Telemetry.Log.startScenario(Core.Telemetry.ScenarioName.GetAccessTokenForAppResourceAsync,{resourceName:e.resourceName}),a.label=5;case 5:switch(a.trys.push([5,14,,15]),e.resourceName){case"powerbi-readonly":return[3,6];case"formspro-readonly":return[3,8];case"microsoftstream":return[3,10]}return[3,12];case 6:return[4,this._appAuthority.readOnlyServicesAppAccessTokenManager.getPowerBIReadOnlyAccessTokenAsync()];case 7:return t=a.sent(),n={tokenType:"bearer",accessToken:t},[3,13];case 8:return[4,this._appAuthority.readOnlyServicesAppAccessTokenManager.getFormsProReadOnlyAccessTokenAsync()];case 9:return t=a.sent(),n={tokenType:"bearer",accessToken:t},[3,13];case 10:return[4,this._appAuthority.readOnlyServicesAppAccessTokenManager.getMicrosoftStreamAccessTokenAsync()];case 11:return t=a.sent(),n={tokenType:"bearer",accessToken:t},[3,13];case 12:throw new Error('The resourceName "'.concat(e.resourceName,'" is not valid.'));case 13:return[3,15];case 14:throw o=a.sent(),Core.Telemetry.Log.failScenario(r,{error:o,customScenarioData:{resourceName:e.resourceName}}),o;case 15:return Core.Telemetry.Log.passScenario(r,{customScenarioData:{resourceName:e.resourceName}}),[2,n]}}))}))},e.prototype.tryGetCurrentUserAsyncV2=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return[4,this._userService.getUserProfileWithImageAsync(e)];case 1:return(t=r.sent())?[2,{fullName:t.fullName,email:t.email,imageUrl:t.imageUrl,objectId:t.objectId}]:[2,null]}}))}))},e.prototype.tryGetCurrentUserAsync=function(){return this.tryGetCurrentUserAsyncV2(!1)},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"BehaviorFunctionsAutomationClient",(function(){return n}));var n=function(e){function t(t){var r=e.call(this)||this;return r._commander=t,r._executors={},r._behaviorRequested=new EventObject,r._registerHostCommands(),r}return __extends(t,e),Object.defineProperty(t.prototype,"behaviorRequested",{get:function(){return this._behaviorRequested},enumerable:!1,configurable:!0}),t.prototype._registerHostCommands=function(){var e=this;this._commander.createAppToHostCommandRegisterer("behaviorFunctions.delegateLaunchUrl").register((function(t){return e._executeDelegateLaunchUrlCommand(t)})),this._commander.createAppToHostCommandRegisterer("behaviorFunctions.requestHide").register((function(t){return e._executeRequestHideCommand(t)}))},t.prototype._onBehaviorRequested=function(e){var t={behaviorName:e};this._behaviorRequested.dispatch(t)},t.prototype._executeDelegateLaunchUrlCommand=function(e){if(this._executors.delegateLaunchUrl){var t="sending host request in BehaviorFunctionsAutomationClient: {url: ".concat(e.url,"}");return Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.automationClientPlayerEvent,{message:t}),this._executors.delegateLaunchUrl(e.url)}},t.prototype.registerDelegateLaunchUrlExecutor=function(e){this._executors.delegateLaunchUrl=e},t.prototype._executeRequestHideCommand=function(e){if(Contracts.checkUndefined(e),this._onBehaviorRequested("requestHide"),this._executors.requestHide)return this._executors.requestHide()},t.prototype.registerRequestHideExecutor=function(e){this._executors.requestHide=e},t}(Core.Disposable)},function(e,t,r){"use strict";r.r(t),r.d(t,"HostControlsAutomationClient",(function(){return n}));var n=function(e){function t(t){var r=e.call(this)||this;return r._commander=t,r._propertyChanged=new EventObject,r._registerHostCommands(),r}return __extends(t,e),Object.defineProperty(t.prototype,"propertyChanged",{get:function(){return this._propertyChanged},enumerable:!1,configurable:!0}),t.prototype._registerHostCommands=function(){var e=this;this._commander.createAppToHostCommandRegisterer("appAutomater.hostControls.notifyPropertyChanged").register((function(t){return e._executeAppToHostCommandNotifyPropertyChanged(t)}))},t.prototype._executeAppToHostCommandNotifyPropertyChanged=function(e){Contracts.checkNonEmpty(e.hostTypeName),Contracts.checkNonEmpty(e.propertyName);var t={hostTypeName:e.hostTypeName,propertyName:e.propertyName};void 0!==e.newValue&&(t.newValue=e.newValue),this._propertyChanged.dispatch(t)},t.prototype.invokeBehaviorAsync=function(e,t){return this._commander.getHostToAppCommand("appAutomater.hostControls.invokeBehavior").executeAsync({hostTypeName:e,behaviorName:t})},t.prototype.getPropertyValueAsync=function(e,t){return this._commander.getHostToAppCommand("appAutomater.hostControls.getPropertyValue").executeAsync({hostTypeName:e,propertyName:t})},t.prototype.setPropertyValueAsync=function(e,t,r){return this._commander.getHostToAppCommand("appAutomater.hostControls.setPropertyValue").executeAsync({hostTypeName:e,propertyName:t,value:r})},t}(Core.Disposable)},function(e,t,r){"use strict";r.r(t),r.d(t,"AppHostSendHttpPipeline",(function(){return o}));var n=r(4),o=function(){function e(e,t,r){this._config=e,this._pipeline=t,this._appAuthority=r}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:e.headers||(e.headers=HashTableUtility.create()),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._authorizeRequestAsync(e)];case 2:return r.sent(),[3,4];case 3:if((t=r.sent())instanceof n.AppAuthorityError)throw new Core.SendHttpError(t.message);throw t;case 4:return[2,this._pipeline.sendHttpAsync(e)]}}))}))},e.prototype._authorizeRequestAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n,o,a,i;return __generator(this,(function(s){switch(s.label){case 0:if(!(t=e.headers[AppMagic.Services.HttpConstants.HeaderName.Authorization]))return[2];if(r=t.split(" ",2),n=r[0],o=r[1],AppMagic.Runtime.Client.isClientAuthorizationScheme(n))throw new Core.SendHttpError("App should not use the client authorization scheme. Request denied: ".concat(e.url));return n!==AppMagic.Services.Authentication.AppHttpClient.AuthorizationScheme&&n!==AppMagic.Services.Authentication.AppHttpClient.DynamicResourceAuthorizationScheme?[2]:(delete e.headers[AppMagic.Services.HttpConstants.HeaderName.Authorization],e.headers[AppMagic.Services.HttpConstants.HeaderName.MsRtsAuthorizationRequestId]?(this._appAuthority.entityFormAppRequestAuthorizer.authorizeRequest(e),[3,5]):[3,1]);case 1:return a=o,n!=AppMagic.Services.Authentication.AppHttpClient.DynamicResourceAuthorizationScheme?[3,3]:[4,this._appAuthority.dynamicResourceAppAccessTokenManager.authorizeRequestAsync(e,a)];case 2:return s.sent(),[3,5];case 3:return[4,this._appAuthority.appServiceAppAccessTokenManager.authorizeRequestAsync(e,a)];case 4:s.sent(),s.label=5;case 5:return i=this._config.getAppName(),e.headers[AppMagic.Services.HttpConstants.HeaderName.MsUserAgent]=AppMagic.PowerApps.PowerAppsUtility.getXMsUserAgentValueForApp(this._config.isHostPlayer,i),[2]}}))}))},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"UsedPreloadedRequestsCacheStrategy",(function(){return n}));var n=function(){function e(e){this._calledRequests=HashTableUtility.create(),this._initialRequestsCalledMapping=e}return e.prototype.checkRequestForLocalStorage=function(e){var t;if((null===(t=null==e?void 0:e.method)||void 0===t?void 0:t.toUpperCase())===AppMagic.Services.HttpConstants.Method.GET){var r=e.url.toLocaleLowerCase();this._initialRequestsCalledMapping[r]&&(this._calledRequests[r]=e)}},e.prototype.getRequestsForLocalStorageCache=function(){return this._calledRequests},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"AllRequestsCacheStrategy",(function(){return n}));var n=function(){function e(){this._allRequests=HashTableUtility.create()}return e.prototype.checkRequestForLocalStorage=function(e){(null==e?void 0:e.url)&&e.method.toUpperCase()===AppMagic.Services.HttpConstants.Method.GET&&(this._allRequests[e.url.toLocaleLowerCase()]=e)},e.prototype.getRequestsForLocalStorageCache=function(){return this._allRequests},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"CacheRequestsStrategy",(function(){return n}));var n=function(){function e(){this._allRequests=HashTableUtility.create(),this._preloadRequestLimit=50}return e.prototype.getStrategyName=function(){return"CacheRequestsStrategy"},e.prototype.getInitialRequestsFromLocalStorage=function(){return this._allRequests},e.prototype.getCalledRequests=function(){return this._allRequests},e.prototype.logCalledRequest=function(e){Object.keys(this._allRequests).length>=this._preloadRequestLimit?Core.Telemetry.Log.trackActivityEvent("PreloadRequestsForAppStart",{message:"Exceeded the preload limit (Max =".concat(this._preloadRequestLimit,"), skip current request for preloading.")}):(null==e?void 0:e.url)&&e.method.toUpperCase()===AppMagic.Services.HttpConstants.Method.GET&&(this._allRequests[e.url.toLocaleLowerCase()]=e)},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"PreloadRequestsStrategy",(function(){return n}));var n=function(){function e(e){this._calledRequests=HashTableUtility.create(),this._initialRequestsCalledMapping=e}return e.prototype.getStrategyName=function(){return"PreloadRequestsStrategy"},e.prototype.getInitialRequestsFromLocalStorage=function(){return this._initialRequestsCalledMapping},e.prototype.getCalledRequests=function(){return this._calledRequests},e.prototype.logCalledRequest=function(e){var t;if((null===(t=null==e?void 0:e.method)||void 0===t?void 0:t.toUpperCase())===AppMagic.Services.HttpConstants.Method.GET){var r=e.url.toLocaleLowerCase();this._calledRequests[r]=e}},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ApiConnectionServiceBase",(function(){return n}));var n=function(){function e(e,t,r,n){this._apiId=e,this._connectionBaseUrl=Core.UrlBuilder.composeUrlAppendToBase(t,Core.Url.encode(r)),this._httpClient=n}return Object.defineProperty(e.prototype,"apiId",{get:function(){return this._apiId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionBaseUrl",{get:function(){return this._connectionBaseUrl},enumerable:!1,configurable:!0}),e.prototype._authenticateRequestAsync=function(e){return e.headers||(e.headers=HashTableUtility.create()),AppMagic.Runtime.Client.addAuthorizationOptions(e.headers,{resource:AppMagic.Runtime.Client.ResourceNames.AppService}),AppMagic.Services.appendCustomHeadersOptions(e,{optInMSHeaders:!0}),Promise.resolve(e)},e.prototype._ensureCommonTelemetryEventData=function(e){return e||(e={}),e.apiId||(e.apiId=this._apiId),e},e.prototype._sendHttpRequestJsonResponseAsync=function(e,t,r,n){var o=this;return this._authenticateRequestAsync(e).then((function(e){return AppMagic.Services.addTelemetryOptions(e,{operationName:r}),AppMagic.Services.addTelemetryAdditionalData(e,o._ensureCommonTelemetryEventData(n)),AppMagic.Services.addServiceErrorOptions(e,{serviceType:AppMagic.Services.ServiceType.Connector}),AppMagic.Services.appendCustomHeadersOptions(e,{addCustomHeaders:!0}),o._httpClient.sendHttpJsonResponseAsync(e)})).then((function(e){var r=t(e);if(!r)throw new Error("Invalid response from service; the response failed safeCast validation.");return r}))},e.prototype._sendHttpRequestIgnoreResponseAsync=function(e,t,r){var n=this;return this._authenticateRequestAsync(e).then((function(e){return AppMagic.Services.addTelemetryOptions(e,{operationName:t}),AppMagic.Services.addTelemetryAdditionalData(e,n._ensureCommonTelemetryEventData(r)),AppMagic.Services.addServiceErrorOptions(e,{serviceType:AppMagic.Services.ServiceType.Connector}),AppMagic.Services.appendCustomHeadersOptions(e,{addCustomHeaders:!0}),n._httpClient.sendHttpIgnoreResponseAsync(e)}))},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"BlobService",(function(){return a}));var n=r(5),o=r(1),a=function(e){function t(t,r,n,o,a){return e.call(this,t,r,n,o,a)||this}return __extends(t,e),t.prototype.getFolderAsync=function(e,t){return this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,o.ServicePaths.FoldersOrFolder.expand({datasetName:Core.Url.encode(e),folderName:t?Core.Url.encode(t):null})),method:AppMagic.Services.HttpConstants.Method.GET},(function(e){return Core.Utility.isArray(e)?e:null}),"BlobService.GetFolder").then((function(e){return e.filter(AppMagic.ConnectionHub.FileServiceItem.isValid)}))},t.prototype.copyFileAsync=function(e,t,r,n){return this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,o.ServicePaths.CopyFile.expand({datasetName:Core.Url.encode(e),source:t,destination:r,overwrite:n.toString()})),method:AppMagic.Services.HttpConstants.Method.POST},AppMagic.ConnectionHub.FileServiceItem.safeCast,"BlobService.CopyFile")},t.prototype.extractFolderAsync=function(e,t,r,n){return this._sendHttpRequestJsonResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,o.ServicePaths.ExtractFolder.expand({datasetName:Core.Url.encode(e),source:t,destination:r,overwrite:n.toString()})),method:AppMagic.Services.HttpConstants.Method.POST},(function(e){return Core.Utility.isArray(e)?e:null}),"BlobService.ExtractFolder").then((function(e){return e.filter(AppMagic.ConnectionHub.FileServiceItem.isValid)}))},t.prototype.deleteFileAsync=function(e,t){return this._sendHttpRequestIgnoreResponseAsync({url:Core.UrlBuilder.composeUrlStringAppendToBase(this.cdpInterfaceBaseUrl,o.ServicePaths.DeleteFile.expand({datasetName:Core.Url.encode(e),fileId:Core.Url.encode(t)})),method:AppMagic.Services.HttpConstants.Method.DELETE},"BlobService.DeleteFile")},t}(n.DatasetService)},function(e,t,r){"use strict";r.r(t),r.d(t,"FileParameter",(function(){return n}));var n=function(e){function t(t,r,n,o){var a=this;return(a=e.call(this,r,t.name)||this).getOptionsAsync=n,a._parameterData=t,a._handleParameterSelected=o,a}return __extends(t,e),t.prototype.selectFile=function(e){return this._handleParameterSelected(e)},t}(r(9).ConnectorParameter)},function(e,t,r){"use strict";r.r(t),r.d(t,"ListParameter",(function(){return n}));var n=function(e){function t(t,r,n,o){var a=this;return(a=e.call(this,r,t.name)||this).getOptionsAsync=n,a._parameterData=t,a._handleParameterSelected=o,a}return __extends(t,e),t.prototype.selectParameter=function(e){return this._handleParameterSelected(e)},t}(r(9).ConnectorParameter)},function(e,t,r){"use strict";r.r(t),r.d(t,"CrossPlatformUrlLauncher",(function(){return n}));var n=function(){function e(){}return e.prototype.launchInNewWindowAsync=function(e,t){return AppMagic.UriUtility.isLaunchableUrl(e)?(AppMagic.UriUtility.urlHasProtocol(e)||(e="http://"+e),"_blank"!==t&&"_"===(null==t?void 0:t[0])&&(t="_system"),window.open(e,null!=t?t:"_system"),Promise.resolve(!0)):Promise.resolve(!1)},e.prototype.launchInNewWebViewAsync=function(e){return Promise.reject()},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"WindowsUrlLauncher",(function(){return n}));var n=function(){function e(){}return e.prototype.launchInNewWindowAsync=function(e){if(!AppMagic.UriUtility.isLaunchableUrl(e))return Promise.resolve(!1);try{var t=new Windows.Foundation.Uri(e);return Windows.System.Launcher.launchUriAsync(t)}catch(e){return Promise.resolve(!1)}},e.prototype.launchInNewWebViewAsync=function(e){return Promise.reject()},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ApiManager",(function(){return i}));var n=r(20),o=r(5),a=r(10),i=function(){function e(e,t,r){this._api=e,this._userService=t,this._httpClient=r}return Object.defineProperty(e.prototype,"api",{get:function(){return this._api},enumerable:!1,configurable:!0}),e.prototype.createDatasetsService=function(e,t){void 0===t&&(t=null);var r=this._getRevisionInfo(AppMagic.ConnectionHub.ApiInterfaceName.CDPTabular1,t);return new o.DatasetService(this._api.id,this._api.runtimeUrl,e,r,this._httpClient)},e.prototype.createTabularService=function(e,t,r){void 0===t&&(t=!0),void 0===r&&(r=null);var n=this._getRevisionInfo(AppMagic.ConnectionHub.ApiInterfaceName.CDPTabular1,r);return(Core.Utility.equalsIgnoreCase(this._api.id,AppMagic.ConnectionHub.Constants.ApiIds.AzureMySql)||Core.Utility.equalsIgnoreCase(this._api.id,AppMagic.ConnectionHub.Constants.ApiIds.AzureMySqlInt))&&(t=!1),new a.TabularService(this._api.id,this._api.runtimeUrl,e,n,this._httpClient,t)},e.prototype.createSqlTabularService=function(e,t){var r,n=this._api.tryGetLatestInterfaceRevisionNumber(AppMagic.ConnectionHub.ApiInterfaceName.CDPTabular1,((r={})[AppMagic.ConnectionHub.Constants.ApiIds.Sql]=t,r[AppMagic.ConnectionHub.Constants.ApiIds.SqlV2]=t,r[AppMagic.ConnectionHub.Constants.ApiIds.SqlGcc]=t,r[AppMagic.ConnectionHub.Constants.ApiIds.SqlWinNonShared]=t,r));return this.createTabularService(e,!1,n)},e.prototype.createCdsLatestTabularService=function(e){var t,r=this._api.tryGetLatestInterfaceRevisionNumber(AppMagic.ConnectionHub.ApiInterfaceName.CDPTabular1,((t={})[AppMagic.ConnectionHub.Constants.ApiIds.CommonDataService]=!0,t)),n=this._getRevisionInfo(AppMagic.ConnectionHub.ApiInterfaceName.CDPTabular1,r);return new a.TabularService(this._api.id,this._api.runtimeUrl,e,n,this._httpClient,!0)},e.prototype.createBlobService=function(e){var t=this._getRevisionInfo(AppMagic.ConnectionHub.ApiInterfaceName.CDPBlob1,null);return new n.BlobService(this._api.id,this._api.runtimeUrl,e,t,this._httpClient)},e.prototype._getRevisionInfo=function(e,t){if(null===t&&(t=this._api.tryGetLatestInterfaceRevisionNumber(e)),null===t)return Core.Log.warning("ApiManager._getRevisionInfo","Api '".concat(this._api.id,"' does not have a service interface revision defined for ").concat(e,".")),null;var r=this._api.tryGetInterfaceRevision(e,t);if(null===r)throw new AppMagic.ConnectionHub.ApiError(this._api.id,"The Api does not define a revision of '".concat(t,"' for the ").concat(e," service interface."));return r},e.prototype.getActionsConfigurationInfoAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:return Core.FallbackSwitch.isActivated("AppConnectivity.FallbackToWadlUrl")?[2,this.getActionsConfigurationInfoWithoutSwaggerInFlowAsync(e)]:[4,this._userService.getConnectionServiceAsync()];case 1:if(t=n.sent(),r=null,!this._api.wadlUrl)return[3,5];if(!Core.Utility.equalsIgnoreCase(this._api.id,AppMagic.ConnectionHub.Constants.ApiIds.FlowService))return[3,3];if(Core.Utility.isEmptyString(e))throw Core.Log.error("ApiManager.getActionsConfigurationInfoAsync","Invalid flow name"),new Error("Invalid flow name");return[4,t.getFlowApiWadlXmlAsync(e)];case 2:return[2,{wadlXml:r=n.sent()}];case 3:return[4,t.getApiWadlXml(this._api)];case 4:r=n.sent(),n.label=5;case 5:return[2,{swaggerJson:this._api.swaggerJson,wadlXml:r}]}}))}))},e.prototype.getActionsConfigurationInfoWithoutSwaggerInFlowAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:if(Core.Log.verbose("DocumentPowerAppManager: Retrieving the WADL for API: "+this._api.id),!this._api.wadlUrl)throw new AppMagic.ConnectionHub.ApiError(this._api.id,"No wadlUrl is specified for this Api. This usually indicates there was an error when converting the Swagger associated with this api to a WADL file.");return[4,this._userService.getConnectionServiceAsync()];case 1:return t=r.sent(),Core.Utility.equalsIgnoreCase(this._api.id,AppMagic.ConnectionHub.Constants.ApiIds.FlowService)?Core.Utility.isEmptyString(e)?[3,3]:[4,t.getFlowApiWadlXmlAsync(e)]:[3,4];case 2:return[2,{wadlXml:r.sent()}];case 3:throw Core.Log.error("ApiManager.getActionsConfigurationInfoAsync","Invalid flow name"),new Error("Invalid flow name");case 4:return[4,t.getApiWadlXml(this._api)];case 5:return[2,{wadlXml:r.sent(),swaggerJson:this._api.swaggerJson}]}}))}))},e}()},function(e,t,r){"use strict";r.r(t);var n=r(6),o=r(15),a=r(16),i=function(){function e(){}return e.prototype.getRequestStrategy=function(e,t){var r,n={preloadDataRequestStrategy:""},i=null==t?void 0:t.tryGetAppPrefetchRequests(e);return i?(n.preloadDataRequestStrategy="UsedPreloadedRequestsCacheStrategy",r=new o.UsedPreloadedRequestsCacheStrategy(i)):(n.preloadDataRequestStrategy="AllRequestsCacheStrategy",r=new a.AllRequestsCacheStrategy),Core.Telemetry.Log.trackActivityEvent("PreloadDataRequest.CacheStrategy",n),r},e}(),s=r(7),c=r(8),u=r(2);r.d(t,"PreloadAppHostSendHttpPipeline",(function(){return p}));var p=function(){function e(e,t,r){this._pipeline=t,this._totalRequestsInLocalStorage=0,this._requestsPreloaded=0,this._requestsHit=0,this._isPreloadDurationDone=!1,this._isPreloadingReady=!1,this._isPreloadingEnabled=!1,this._cacheKey="PAPreloadKey-".concat(e.appId,"-").concat(e.appVersion),this._keyPrefix="PAPreloadKey-".concat(e.appId,"-"),this._isPreloadingEnabled=Core.FeatureGates.webPlayer.preloadStartupRequests,this._isPreloadingEnabled||Core.Telemetry.Log.trackActivityEvent("PreloadOnStartRequestsOff",{message:"On start requests are not preloaded or stored in local storage"}),this._responseMapping=HashTableUtility.create(),this._preloadAuthorizationDecorator=new c.PreloadRequestAuthorizationHandler(r),this._preloadReader=new s.PreloadRequestReader(new Core.IO.SettingsProviders.LocalStorageSettingsProvider),this._cacheStrategy=(new i).getRequestStrategy(this._cacheKey,this._preloadReader),this._preloadWriter=new n.PreloadRequestWriter(new Core.IO.SettingsProviders.LocalStorageSettingsProvider)}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){return e.method.toUpperCase()===AppMagic.Services.HttpConstants.Method.GET&&this._isPreloadingEnabled&&!this._isPreloadDurationDone&&this._isPreloadingReady?[2,this.preloadSendHttpAsync(e)]:[2,this._pipeline.sendHttpAsync(e)]}))}))},e.prototype.onConnectionLoadedAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:if(!this._isPreloadingEnabled)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._preloadReader.tryGetAppPrefetchRequests(this._cacheKey),[4,this._preloadRequestResultsAsync(e)];case 2:return r.sent(),this._isPreloadingReady=!0,[3,4];case 3:return(t=r.sent())instanceof u.PreloadRequestError?this._isPreloadingReady=!t.isCritical:this._isPreloadingReady=!1,Core.Telemetry.Log.trackErrorEvent("ErrorAttemptingPreload",t),[3,4];case 4:return[2]}}))}))},e.prototype.stopPreloadRequestUse=function(e){var t=this;this._isPreloadingEnabled&&setTimeout((function(){t._isPreloadDurationDone=!0,t.logTelemetry(e);var r=t._cacheStrategy.getRequestsForLocalStorageCache();t._preloadAuthorizationDecorator.parseHeaderForPreloadStorage(r),t._preloadWriter.writeInitialRequestsToLocalStorage(t._cacheKey,t._keyPrefix,r)}),e)},e.prototype.preloadSendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n;return __generator(this,(function(o){switch(o.label){case 0:o.label=1;case 1:return o.trys.push([1,4,,5]),t=void 0,r=JSON.parse(JSON.stringify(e)),(t=this.getResponseForRequest(r))?[3,3]:[4,this._pipeline.sendHttpAsync(e)];case 2:t=o.sent(),o.label=3;case 3:return 200===(null==t?void 0:t.status)&&this._cacheStrategy.checkRequestForLocalStorage(r),[2,t];case 4:if((n=o.sent())instanceof u.PreloadRequestError)return Core.Telemetry.Log.trackErrorEvent("PreloadPipelineError",n),[2,this._pipeline.sendHttpAsync(e)];throw n;case 5:return[2]}}))}))},e.prototype._preloadRequestResultsAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r=this;return __generator(this,(function(n){switch(n.label){case 0:if(!e)return[3,5];this._totalRequestsInLocalStorage=HashTableUtility.getValues(e).length,n.label=1;case 1:return n.trys.push([1,4,,5]),[4,this._preloadAuthorizationDecorator.serializeRuntimeAuthorizationHeaderAsync(e)];case 2:return n.sent(),[4,HashTableUtility.forEachAsync(e,(function(e){return __awaiter(r,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){switch(n.label){case 0:return t=e.url,[4,this._pipeline.sendHttpAsync(e)];case 1:return(r=n.sent())&&r.status===AppMagic.Services.HttpConstants.HttpStatusCode.Ok&&(this._requestsPreloaded++,this._responseMapping[t]=r),[2]}}))}))}))];case 3:return n.sent(),[3,5];case 4:if(!((t=n.sent())instanceof u.PreloadRequestError))throw t;return Core.Telemetry.Log.trackErrorEvent("Error Preloading Request",t),[3,5];case 5:return[2]}}))}))},e.prototype.logTelemetry=function(e){var t=this._totalRequestsInLocalStorage>0,r={timeoutInMs:e,totalRequestsInLocalStorage:this._totalRequestsInLocalStorage,preloadedRequestsWithResponses:this._requestsPreloaded,preloadedRequestsUsed:this._requestsHit,PreloadRequestsSucceededPercentage:t?this._requestsPreloaded/this._totalRequestsInLocalStorage*100:100,PreloadRequestsHitPercentage:t?this._requestsHit/this._totalRequestsInLocalStorage*100:100};Core.Telemetry.Log.trackActivityEvent("PreloadRequestMetrics",r)},e.prototype.getResponseForRequest=function(e){var t=this._responseMapping[e.url];return t?(Core.Telemetry.Log.trackActivityEvent("PreloadRequestResponse",{message:"Response returned from Preloaded Responses",requestUrl:Core.Telemetry.Utility.scrubSensitiveDataSafe(e.url)}),e.responseType===AppMagic.Services.ResponseTypes.PABinary&&t.responseType!==AppMagic.Services.ResponseTypes.PABinary&&(t.response=Core.PABinary.createFromText(t.responseText),t.responseType=AppMagic.Services.ResponseTypes.PABinary),this._requestsHit++,t):null},e}()},function(e,t,r){"use strict";r.r(t);var n=r(6),o=r(17),a=r(18),i=function(){function e(){}return e.prototype.getRequestStrategy=function(e,t){var r,n={preloadStrategy:""},i=null==t?void 0:t.tryGetAppPrefetchRequests(e);return r=i?new a.PreloadRequestsStrategy(i):new o.CacheRequestsStrategy,n.preloadStrategy=r.getStrategyName(),Core.Telemetry.Log.trackActivityEvent("PreloadRequestsForAppStart",n),r},e}(),s=r(7),c=r(8),u=r(2);r.d(t,"PreloadAppHostSendHttpPipelineV2",(function(){return p}));var p=function(){function e(e,t,r){this._pipeline=t,this._isPreloadingEnabled=!0,this._isPreloadingStarted=!1,this._isPreloadingCompleted=!1,this._totalRequestsInLocalStorage=0,this._requestsPreloaded=0,this._requestsHit=0,this._isPreloadingEnabled?(this._keyPrefix="".concat("PAPreloadKeyV2","-").concat(e.appId),this._cacheKey="".concat(this._keyPrefix,"-").concat(e.appVersion),this._responseMapping=HashTableUtility.create(),this._preloadAuthorizationDecorator=new c.PreloadRequestAuthorizationHandler(r),this._preloadReader=new s.PreloadRequestReader(new Core.IO.SettingsProviders.LocalStorageSettingsProvider),this._preloadWriter=new n.PreloadRequestWriter(new Core.IO.SettingsProviders.LocalStorageSettingsProvider),this._preloadStrategy=(new i).getRequestStrategy(this._cacheKey,this._preloadReader)):Core.Telemetry.Log.trackActivityEvent("PreloadRequestsForAppStart",{message:"On start requests are not preloaded or stored in local storage"})}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){return[2,this.isPreloadingAvailable(e)?this.getPreloadedResponseAsync(e):this._pipeline.sendHttpAsync(e)]}))}))},e.prototype.isPreloadingAvailable=function(e){return this._isPreloadingEnabled&&this.isRequestPreloadable(e)&&this._isPreloadingStarted&&!this._isPreloadingCompleted},e.prototype.isRequestPreloadable=function(e){return e.method.toUpperCase()===AppMagic.Services.HttpConstants.Method.GET},e.prototype.getPreloadedResponseAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n;return __generator(this,(function(o){switch(o.label){case 0:o.label=1;case 1:return o.trys.push([1,5,,6]),t=JSON.parse(JSON.stringify(e)),[4,this.getResponseForRequest(t)];case 2:return(r=o.sent())?[3,4]:[4,this._pipeline.sendHttpAsync(e)];case 3:r=o.sent(),o.label=4;case 4:return(null==r?void 0:r.status)===AppMagic.Services.HttpConstants.HttpStatusCode.Ok&&this._preloadStrategy.logCalledRequest(t),[2,r];case 5:return(n=o.sent())instanceof u.PreloadRequestError?(Core.Telemetry.Log.trackErrorEvent("PreloadRequestsForAppStart",{stack:null==n?void 0:n.stack}),[2,this._pipeline.sendHttpAsync(e)]):[2,Promise.reject(n)];case 6:return[2]}}))}))},e.prototype.getResponseForRequest=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return this._responseMapping[e.url]?[4,this._responseMapping[e.url]]:[2,null];case 1:return t=r.sent(),Core.Telemetry.Log.trackActivityEvent("PreloadRequestsForAppStart",{message:"Response returned from Preloaded request",requestUrl:Core.Telemetry.Utility.scrubSensitiveDataSafe(e.url)}),this._requestsHit++,[2,t]}}))}))},e.prototype.onConnectionLoadedAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t;return __generator(this,(function(r){switch(r.label){case 0:if(!this._isPreloadingEnabled)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),e=this._preloadStrategy.getInitialRequestsFromLocalStorage(),[4,this._loadRequestsAsync(e)];case 2:return r.sent(),this._isPreloadingStarted=!0,[3,4];case 3:return t=r.sent(),this._isPreloadingEnabled=!1,this._isPreloadingStarted=!1,Core.Telemetry.Log.trackErrorEvent("PreloadRequestsForAppStart",{stack:null==t?void 0:t.stack}),[3,4];case 4:return[2]}}))}))},e.prototype._loadRequestsAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r=this;return __generator(this,(function(n){switch(n.label){case 0:if(!e)return[3,5];n.label=1;case 1:return n.trys.push([1,4,,5]),this._totalRequestsInLocalStorage=HashTableUtility.getValues(e).length,[4,this._preloadAuthorizationDecorator.serializeRuntimeAuthorizationHeaderAsync(e)];case 2:return n.sent(),[4,HashTableUtility.forEachAsync(e,(function(e){return __awaiter(r,void 0,void 0,(function(){var t,r;return __generator(this,(function(n){return(t=e.url)&&(r=this._pipeline.sendHttpAsync(e),this._responseMapping[t]=r,this._requestsPreloaded++),[2]}))}))}))];case 3:return n.sent(),[3,5];case 4:if(!((t=n.sent())instanceof u.PreloadRequestError))throw t;return Core.Telemetry.Log.trackErrorEvent("PreloadRequestsForAppStart",{stack:null==t?void 0:t.stack}),[3,5];case 5:return[2]}}))}))},e.prototype.stopPreloadRequestUse=function(e){var t=this;this._isPreloadingEnabled&&setTimeout((function(){t._isPreloadingCompleted=!0,t.logTelemetry(e);var r=t._preloadStrategy.getCalledRequests();t._preloadAuthorizationDecorator.parseHeaderForPreloadStorage(r),t._preloadWriter.writeInitialRequestsToLocalStorage(t._cacheKey,t._keyPrefix,r)}),e)},e.prototype.logTelemetry=function(e){var t=this._totalRequestsInLocalStorage>0,r={timeoutInMs:e,preloadStrategy:this._preloadStrategy.getStrategyName(),totalRequestsInLocalStorage:this._totalRequestsInLocalStorage,preloadedRequestsWithResponses:this._requestsPreloaded,preloadedRequestsUsed:this._requestsHit,preloadRequestsSucceededPercentage:t?this._requestsPreloaded/this._totalRequestsInLocalStorage*100:100,preloadRequestsHitPercentage:t?this._requestsHit/this._totalRequestsInLocalStorage*100:100};Core.Telemetry.Log.trackActivityEvent("PreloadRequestsForAppStartMetrics",r)},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"AppHostErrorHandler",(function(){return n}));var n=function(){function e(e,t){this._config=e,this._userService=t}return e.prototype.handleRuntimeErrorAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(r){return[2,this._config.handleAppRuntimeError(e,t)]}))}))},e.prototype.getIsHidePlayerErrorToastsEnabledAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._userService.userFeaturesManager.isHidePlayerErrorToastsEnabledAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.refreshAppConnectionsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._userService.getConnectionServiceAsync()];case 1:return[4,e.sent().getConnectionsAsync(null,!0)];case 2:return e.sent(),[2]}}))}))},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"AppHostService",(function(){return n}));var n=function(){function e(e){this._powerAppsClient=e}return Object.defineProperty(e.prototype,"appConnectionsChanged",{get:function(){return this._powerAppsClient.appConnectionsChanged},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appCdsDataSourcesChanged",{get:function(){return this._powerAppsClient.appCdsDataSourcesChanged},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"commandContext",{get:function(){return this._commandContext},set:function(e){this._commandContext=e},enumerable:!1,configurable:!0}),e.prototype.loadAppConnectionsAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this._powerAppsClient.identityService.hasIdentity?[4,this._powerAppsClient.loadAppConnectionsAsync(e,!1)]:[3,2];case 1:t.sent(),Core.FeatureGates.appHost.showRPMessageOnAppStartInPlayer&&this._powerAppsClient.tryGetAndShowRPMessagesAsync(),t.label=2;case 2:return[2]}}))}))},e.prototype.getAppDataSourceConfigsAsync=function(){var e;return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this._powerAppsClient.areAppConnectionsLoaded?[3,2]:[4,this.loadAppConnectionsAsync(!1)];case 1:t.sent(),t.label=2;case 2:return[4,this._powerAppsClient.getAppDataSourceConfigs(null===(e=this._commandContext)||void 0===e?void 0:e.appId)];case 3:return[2,t.sent()]}}))}))},e.prototype.getAppCdsDataSourceConfigsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._powerAppsClient.getAppCdsDataSourceConfigsAsync(this._commandContext)];case 1:return[2,e.sent()]}}))}))},e.prototype.getAppCdsDatabaseReferenceComponents=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._powerAppsClient.getAppCdsDatabaseReferenceComponents(this._commandContext)];case 1:return[2,e.sent()]}}))}))},e.prototype.getPcfUserIdFromCdsAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._powerAppsClient.getPcfUserIdFromCdsAsync(this._commandContext)];case 1:return[2,e.sent()]}}))}))},e.prototype.getAppMetadataAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._powerAppsClient.getAppMetadataAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype.loadNonCompositeConnectionsAsync=function(){var e;return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return this._powerAppsClient.areAppConnectionsLoaded?[3,2]:[4,this.loadAppConnectionsAsync(!0)];case 1:t.sent(),t.label=2;case 2:return[4,this._powerAppsClient.getAppDataSourceConfigs(null===(e=this._commandContext)||void 0===e?void 0:e.appId)];case 3:return[2,t.sent()]}}))}))},e.prototype.resolveCompositeConnectionsAsync=function(){var e;return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._powerAppsClient.loadCompositeConnectionsAsync()];case 1:return r.sent(),[3,3];case 2:return t=r.sent(),Core.Log.errorEx("AppHostService.resolveCompositeConnectionsAsync","Error thrown by client on loadCompositeConnectionsAsync",{error:t}),[3,3];case 3:return[4,this._powerAppsClient.getAppDataSourceConfigs(null===(e=this._commandContext)||void 0===e?void 0:e.appId)];case 4:return[2,r.sent()]}}))}))},e.prototype.getHostMetadataAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._powerAppsClient.getHostMetadataAsync(e)];case 1:return[2,t.sent()]}}))}))},e}()},function(e,t,r){"use strict";function n(e){return"pending"===e.status?"[".concat(e.operationName,"]: Pending..."):"failed"===e.status?"[".concat(e.operationName,"]: Failed. ").concat(e.error.message):void 0===e.returnValue?"[".concat(e.operationName,"] Finished."):"[".concat(e.operationName,"] Finished. Result: ").concat(JSON.stringify(e.returnValue))}r.r(t),r.d(t,"AutomationConsole",(function(){return o}));var o=function(e){function t(t){var r=e.call(this)||this;return r._hostTypeName=null,r._propertyChangedEventLog=[],r._operationsLog=[],r._behaviorsLog=[],r._automationClient=t,r._behaviorsLog=[],r.trackAnonymous(t.hostControls.propertyChanged.addListener(r._onHostControlPropertyChanged,r)),r.trackAnonymous(t.behaviorFunctions.behaviorRequested.addListener(r._onBehaviorRequested,r)),r}return __extends(t,e),Object.defineProperty(t.prototype,"hostTypeName",{get:function(){return this._hostTypeName},set:function(e){this._propertyChangedEventLog=[],this._hostTypeName=e},enumerable:!1,configurable:!0}),t.prototype.setHostTypeToSharePoint=function(){this.hostTypeName="sharepointforms"},t.prototype._onBehaviorRequested=function(e){this._behaviorsLog.push(e.behaviorName)},t.prototype._onHostControlPropertyChanged=function(e){e.hostTypeName===this._hostTypeName&&this._propertyChangedEventLog.push(e)},t.prototype.dumpPropertyChangeLog=function(){var e=this._propertyChangedEventLog;return this._propertyChangedEventLog=[],e.map((function(e){return"[".concat(e.hostTypeName,"].").concat(e.propertyName," = ").concat(e.newValue)}))},t.prototype.dumpBehaviorsLog=function(){var e=this._behaviorsLog;return this._behaviorsLog=[],e},t.prototype.dumpOperationsLog=function(){var e=this._operationsLog;return this._operationsLog=this._operationsLog.filter((function(e){return"pending"===e.status})),e.map(n)},t.prototype._startOperation=function(e,t){var r={operationName:e,status:"pending"};return Core.PromiseUtils.wrapFunctionCall(t).then((function(e){void 0!==e&&(r.returnValue=e),r.status="success"}),(function(e){r.status="failed",r.error=e})),this._operationsLog.push(r),r},t.prototype.invokeBehavior=function(e){var t=this;return this._hostTypeName?this._startOperation("invokeBehavior:"+e,(function(){return t._automationClient.hostControls.invokeBehaviorAsync(t._hostTypeName,e)})):"hostTypeName not set."},t.prototype.getPropertyValue=function(e){var t=this;return this._hostTypeName?this._startOperation("getPropertyValue:"+e,(function(){return t._automationClient.hostControls.getPropertyValueAsync(t._hostTypeName,e)})):"hostTypeName not set."},t.prototype.setPropertyValue=function(e,t){var r=this;return this._hostTypeName?this._startOperation("setPropertyValue:"+e,(function(){return r._automationClient.hostControls.setPropertyValueAsync(r._hostTypeName,e,t)})):"hostTypeName not set."},t}(Core.Disposable)},function(e,t,r){"use strict";r.r(t),r.d(t,"createAppHostHttpPipeline",(function(){return i})),r.d(t,"createPreloadingPipeline",(function(){return s}));var n=r(14),o=r(26),a=r(27);function i(e,t,r,o){return new n.AppHostSendHttpPipeline({isHostPlayer:r,getAppName:o},e,t)}function s(e,t,r,n,s,c,u){var p=i(e,t,r,n);return u?new a.PreloadAppHostSendHttpPipelineV2({appId:s,appVersion:c},p,t):new o.PreloadAppHostSendHttpPipeline({appId:s,appVersion:c},p,t)}},function(e,t,r){"use strict";r.r(t),r.d(t,"HostCommander",(function(){return n}));var n=function(){function e(e){this._hostToAppCommandExecutor=e,this._hostToAppCommands=HashTableUtility.create(),this._appToHostCommands=HashTableUtility.create()}return e.prototype.getHostToAppCommand=function(e){var t=this,r=this._hostToAppCommands[e];return r||(r={executeAsync:function(r){return t._hostToAppCommandExecutor.executeHostToAppCommandAsync(e,r)}},this._hostToAppCommands[e]=r),r},e.prototype.createAppToHostCommandRegisterer=function(e){var t=this;return{register:function(r){var n={execute:r};t._appToHostCommands[e]=n}}},e.prototype.tryGetAppToHostCommand=function(e){return this._appToHostCommands[e]||null},e}()},function(e,t,r){},function(e,t,r){"use strict";r.r(t),r.d(t,"CdsSurveyDataService",(function(){return n}));var n=function(){function e(e,t){this._userService=e,this._httpClient=t}return e.prototype.getSurveyEntityDataAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,r,n,o,a,i;return __generator(this,(function(s){switch(s.label){case 0:return[4,this._userService.getEnvironmentService().getFullCurrentEnvironmentAsync()];case 1:if(!(e=s.sent()).properties.linkedEnvironmentMetadata)return[2,[]];t=e.properties.linkedEnvironmentMetadata.instanceUrl,(r=new Core.UrlBuilder(t)).appendPath("api/data"),r.appendPath(AppMagic.PowerApps.Constants.CdsDefaultWebApiVersion),r.appendPath("msfp_surveies"),r.setQueryParam(AppMagic.Services.ODataConstants.QueryOption.Select,"msfp_name,msfp_sourcesurveyidentifier"),r.setQueryParam(AppMagic.Services.ODataConstants.QueryOption.Filter,"msfp_name ne null"),r.setQueryParam(AppMagic.Services.ODataConstants.QueryOption.OrderBy,"msfp_name"),n={url:r.toString(),method:AppMagic.Services.HttpConstants.Method.GET,headers:HashTableUtility.create()},AppMagic.Runtime.Client.addAuthorizationOptions(n.headers,{resource:t,isDynamicResource:!0}),AppMagic.Services.appendCustomHeadersOptions(n,{optInMSHeaders:!0}),s.label=2;case 2:return s.trys.push([2,4,,5]),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpJsonResponseAsync(this._httpClient,n,"CdsSurveyDataService.getSurveyEntityDataAsync",{resourceUrl:t})];case 3:return o=s.sent(),(a=AppMagic.Data.SurveyEntityTableList.safeCast(o))?[2,a.value.map((function(e){return{name:e&&e.msfp_name?e.msfp_name:"",id:e&&e.msfp_sourcesurveyidentifier?e.msfp_sourcesurveyidentifier:""}}))]:(Core.Log.error("CdsSurveyDataService.getSurveyEntityDataAsync","Invalid response from service; the response failed safeCast validation."),[2,[]]);case 4:return i=s.sent(),Core.Log.error("CdsSurveyDataService.getSurveyEntityDataAsync",i),[2,[]];case 5:return[2]}}))}))},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"ConnectorParameterManager",(function(){return a}));var n=r(21),o=r(22),a=function(){function e(e,t){this._metadata=e,this._parameters=new Array(this._metadata.parameters.length),this._parameterValueMap=HashTableUtility.create(),this._parameterIndexMap=HashTableUtility.create(),this._tabularService=t,this._loadParameters()}return Object.defineProperty(e.prototype,"currentParameter",{get:function(){return this._currentParameter},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return this._parameters},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shouldEncodeDataset",{get:function(){return"single"!==this._metadata.tabular.urlEncoding},enumerable:!1,configurable:!0}),e.prototype.getDataset=function(){var e=this._metadata.datasetFormat;return this._parseParameterPath(e,!0)},e.prototype._loadParameters=function(){var e=this;this._metadata.parameters.forEach((function(t,r){if(t["x-ms-dynamic-tree"]){var a=new n.FileParameter(t,r,(function(r){return e._getFileOptionsAsync(t,r)}),(function(r){return e._handleParameterSelected(t.name,r)}));e._parameters[r]=a}else{var i=new o.ListParameter(t,r,(function(){return e._getListParameterOptions(t)}),(function(r){return e._handleParameterSelected(t.name,r)}));e._parameters[r]=i}e._parameterIndexMap[t.name]=r}))},e.prototype._getFileOptionsAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r;return __generator(this,(function(n){return r=t?this._parseFileFolderPath(e["x-ms-dynamic-tree"].browse.path,t):this._parseParameterPath(e["x-ms-dynamic-tree"].open.path),[2,this._tabularService.getFileParameterAsync(r)]}))}))},e.prototype._getListParameterOptions=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r;return __generator(this,(function(n){return t=e["x-ms-dynamic-values"].path,r=this._parseParameterPath(t),[2,this._tabularService.getListParameterAsync(e,r)]}))}))},e.prototype._handleParameterSelected=function(e,t){this._parameterValueMap[e]=t},e.prototype._parseParameterPath=function(e,t){var r=this;void 0===t&&(t=!1);var n=e,o=e.match(/\{.*?\}/g);return null==o||o.forEach((function(e){var o=e.slice(1,-1),a=r._parameterIndexMap[o];if(void 0!==a){var i=r._parameterValueMap[o],s=r._metadata.parameters[a].urlEncoding;!t||"single"!==s&&"double"!==s||(i=Core.Url.encode(i)),"double"===s&&(i=Core.Url.encode(i));var c=new RegExp("{".concat(o,"}"),"g");n=n.replace(c,i)}})),n},e.prototype.parseCreateColumnPath=function(e,t){var r=this._metadata.noNaturalKeyColumnConnector.createKeyColumnPath,n=new RegExp("{table}","g");r=r.replace(n,e);var o=new RegExp("{PKColumnName}","g");return r=r.replace(o,"single"===this._metadata.noNaturalKeyColumnConnector.keyColumnNameUrlEncoding?t:Core.Url.encode(t)),this._parseParameterPath(r)},e.prototype._parseFileFolderPath=function(e,t){var r=new RegExp("{id}","g"),n=e.replace(r,Core.Url.encode(t));return this._parseParameterPath(n)},e}()},function(e,t,r){"use strict";r.r(t),r.d(t,"AppHostPowerAppsClient",(function(){return o}));var n=r(25),o=function(e){function t(){var t=e.call(this)||this;return t._apiManagersById=HashTableUtility.create(),t._consentDismissedByUser=!1,t}return __extends(t,e),Object.defineProperty(t.prototype,"consentDismissedByUser",{get:function(){return this._consentDismissedByUser},set:function(e){this._consentDismissedByUser=e},enumerable:!1,configurable:!0}),t.prototype._initializing=function(){var t=this;e.prototype._initializing.call(this),this._identityService.connectionStatusChangeEvent.addListener((function(){return t._onStateChanged()}))},t.prototype.registerAppOpenEvents=function(e,t,r){this._userService.getOperationsExecutor().registerAppOpenEvents(e,t,r)},t.prototype._onStateChanged=function(){Core.Log.verbose("AppHostPowerAppsClient._onStateChanged: State changed. Disposing cached api managers."),this._resetApiManager()},t.prototype._resetApiManager=function(){HashTableUtility.forEach(this._apiManagersById,(function(e){return e.dispose()})),this._apiManagersById=HashTableUtility.create()},t.prototype.resetApiManager=function(){Core.Telemetry.Log.trackActivityEvent("AppHostPowerAppsClient.resetApiManager",{message:"Reset the APIManager."}),this._resetApiManager()},t.prototype.waitForAuthConsentAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this.getAppAuthResourcesAsync()];case 1:return[2,t.sent().some((function(t){return t.resourceId===e}))]}}))}))},t.prototype.tryFixUnauthenticatedConnectionsAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n;return __generator(this,(function(o){switch(o.label){case 0:return o.trys.push([0,5,,6]),this._reConsentPromise?[3,2]:(this._reConsentPromise=this.getAppresourcesAndDisambiguate(),[4,this._reConsentPromise]);case 1:return o.sent(),this._reConsentPromise=null,[3,4];case 2:return[4,this._reConsentPromise];case 3:o.sent(),o.label=4;case 4:return[3,6];case 5:return o.sent(),Core.Log.warningEx("AppHostPowerAppsClient.tryFixUnauthenticatedConnectionsAsync","Could not load connections. DataSource: ".concat(e)),this._reConsentPromise=null,[2,null];case 6:return t=this.tryGetEntityConnectionReferenceMap(),r=t?HashTableUtility.tryGetValueIgnoreCase(t,e):null,(n=r?this.referenceStore.tryGet(r):null)?[2,this._appResources.connections.find((function(e){return Core.Utility.equalsIgnoreCase(e.id,n.connectionInstanceId)}))]:(Core.Log.warningEx("AppHostPowerAppsClient.tryFixUnauthenticatedConnectionsAsync","Could not get connection id after re-authentication attempt"),[2,null])}}))}))},t.prototype.getApiManagerAsync=function(e){var t=this,r=this._apiManagersById[e];return r||(this._apiManagersById[e]=r=new Core.AsyncLazy("AppHostPowerAppsClient._apiManagersById[apiId]",(function(){return t._userService.getConnectionServiceAsync().then((function(t){return t.getFullApiByIdAsync(e)})).then((function(e){return new n.ApiManager(e,t._userService,t._powerAppsService.httpClient)}),(function(e){return Core.Log.error("AppHostPowerAppsClient.CreateApiManager",e),Promise.reject(e)}))}))),r.valueAsync()},t.prototype.dispose=function(){HashTableUtility.forEach(this._apiManagersById,(function(e){return e.dispose()})),this._apiManagersById=null,e.prototype.dispose.call(this)},t}(AppMagic.PowerApps.PowerAppsClient)},function(e,t,r){"use strict";r.r(t),r.d(t,"RuntimeErrorHandler",(function(){return n}));var n=function(){function e(e,t,r,n,o){this._powerAppsClient=e,this._userService=t,this._appId=r,this._appAlreadyRunning=n,this._refreshDataSourcesAfterRefreshingConnectionsFnAsync=o,this._checkedUnauthenticatedConnections=HashTableUtility.create()}return e._tryGetToastTelemetryData=function(e){if(AppMagic.Services.errorHasHttpResponse(e)){var t=HashTableUtility.tryGetValueIgnoreCase(e.response.headers,AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId);if(t)return{clientRequestId:t}}return null},e.prototype.handleRuntimeErrorAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var r,n,o,a,i,s,c=this;return __generator(this,(function(u){switch(u.label){case 0:if(!t||!AppMagic.Services.errorHasHttpResponse(t)||t.response.status!==AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),[4,this._updateAndReturnConnectionsAsync()];case 2:return r=u.sent(),(n=r.filter((function(e){return!e.isAuthenticated&&!c._checkedUnauthenticatedConnections[e.id]}))).forEach((function(e){c._checkedUnauthenticatedConnections[e.id]=!0})),Core.Telemetry.Log.trackActivityEvent("RuntimeErrorHandler._handleAppRuntimeErrorAsync",{message:"Detected ".concat(n.length," connection(s) to authenticate.")}),0===n.length?[2,!0]:(o={fixUnauthenticatedConnections:function(){return c._fixUnauthenticatedConnectionsAsync(n)}},(a=AppMagic.PowerApps.PowerAppsErrorUtility.tryGetToastWithLinksMessageData(AppMagic.Services.ServiceType.Connector,t,o))?(Core.Telemetry.Log.trackActivityEvent("RuntimeErrorHandler.handleRuntimeErrorAsync",{message:"Handled error. Toast message data found.",error:JSON.stringify(t)}),this._showToast(t,a),[2,!0]):[3,4]);case 3:return i=u.sent(),Core.PromiseUtils.throwIfCanceled(i),Core.Log.error("RuntimeErrorHandler.handleRuntimeErrorAsync",i,"Error occurred while handling Unauthorized http error."),[3,4];case 4:return u.trys.push([4,6,,7]),[4,this._handleUnhandledErrorAsync(e,t)];case 5:return[2,u.sent()];case 6:return s=u.sent(),Core.PromiseUtils.throwIfCanceled(s),Core.Log.error("RuntimeErrorHandler.handleRuntimeErrorAsync",s,"Error occurred while processing the unhandled error."),[3,7];case 7:return[2,!1]}}))}))},e.prototype._fixUnauthenticatedConnectionsAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,r,n,o;return __generator(this,(function(a){switch(a.label){case 0:a.label=1;case 1:return a.trys.push([1,4,,5]),t=HashTableUtility.create(),r=HashTableUtility.create(),e.forEach((function(e){r[e.id]=e})),this._powerAppsClient.referenceStore.getAll().forEach((function(e){var n=r[e.connectionInstanceId];n&&(t[e.id]=n)})),[4,this._powerAppsClient.loadAppConnectionsAsync(!1,this._appAlreadyRunning)];case 2:return a.sent(),this._powerAppsClient.consentDismissedByUser?(this._powerAppsClient.consentDismissedByUser=!1,[2]):(n=this._powerAppsClient.getPreviouslyUnauthenticatedConnectionDataSources(t),[4,this._refreshDataSourcesAfterRefreshingConnectionsFnAsync(n)]);case 3:return a.sent()?(Core.Telemetry.Log.trackActivityEvent("RuntimeErrorHandler._fixUnauthenticatedConnectionsAsync",{message:"Successfully invoked a refresh for all fixed connections."}),[3,5]):(Core.Telemetry.Log.trackActivityEvent("RuntimeErrorHandler._fixUnauthenticatedConnectionsAsync",{message:"Could not invoke a refresh for all fixed connections. Showing a toast to inform user."}),[2,this._showRefreshToast()]);case 4:return o=a.sent(),Core.PromiseUtils.throwIfCanceled(o),Core.Log.error("RuntimeErrorHandler._fixUnauthenticatedConnectionsAsync",o),[3,5];case 5:return[2]}}))}))},e}()},function(e,t,r){"use strict";r.r(t);var n,o,a,i,s=r(12),c=r(13),u=r(39);!function(e){e.isValid=function(e){return e instanceof XMLHttpRequest||Object(u.isObject)(e)&&"number"==typeof e.DONE&&"number"==typeof e.readyState&&"number"==typeof e.status&&"string"==typeof e.responseType&&Object(u.isFunction)(e.getAllResponseHeaders)&&Object(u.isFunction)(e.getResponseHeader)&&("text"!==e.responseType||"string"==typeof e.responseText)}}(n||(n={})),function(e){e[e.Ok=200]="Ok",e[e.NotFound=404]="NotFound",e[e.TimeOut=408]="TimeOut",e[e.HostFunctionError=500]="HostFunctionError",e[e.SendTriggerNotRegistered=503]="SendTriggerNotRegistered",e[e.StringifyError=508]="StringifyError"}(o||(o={})),function(e){e[e.Picklist=0]="Picklist",e[e.State=1]="State",e[e.Status=2]="Status",e[e.Boolean=3]="Boolean"}(a||(a={})),function(e){e[e.MAIN_APPLICATION_VIEW=0]="MAIN_APPLICATION_VIEW",e[e.ADVANCED_SEARCH=1]="ADVANCED_SEARCH",e[e.SUB_GRID=2]="SUB_GRID",e[e.QUICKFIND_SEARCH=4]="QUICKFIND_SEARCH",e[e.REPORTING=8]="REPORTING",e[e.OFFLINE_FILTERS=16]="OFFLINE_FILTERS",e[e.MA_SEARCH=32]="MA_SEARCH",e[e.LOOKUP_VIEW=64]="LOOKUP_VIEW",e[e.SM_APPOINTMENTBOOK_VIEW=128]="SM_APPOINTMENTBOOK_VIEW",e[e.OUTLOOK_FILTERS=256]="OUTLOOK_FILTERS",e[e.ADDRESSBOOK_FILTERS=512]="ADDRESSBOOK_FILTERS",e[e.SAVEDQUERYTYPE_OTHER=2048]="SAVEDQUERYTYPE_OTHER",e[e.INTERACTIVE_WORKFLOW_VIEW=4096]="INTERACTIVE_WORKFLOW_VIEW",e[e.OFFLINE_TEMPLATE=8192]="OFFLINE_TEMPLATE",e[e.OUTLOOK_TEMPLATE=131072]="OUTLOOK_TEMPLATE",e[e.CUSTOM_DEFINED_VIEW=16384]="CUSTOM_DEFINED_VIEW"}(i||(i={}));var p=function(e){function t(t){var r=e.call(this)||this;return r._commander=t,r._executors={},r._registerHostCommands(),r}return __extends(t,e),t.prototype._registerHostCommands=function(){var e=this;this._commander.createAppToHostCommandRegisterer("hostFunctions.sendTrigger").register((function(t){return e._executeSendTriggerCommand(t)}))},t.prototype._executeSendTriggerCommand=function(e){if(this._executors.sendTrigger){var t=this.getSendTriggerCommandLogInfo(e.requestParameters);return Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.automationClientPlayerEvent,{message:t}),this._executors.sendTrigger(e.requestParameters)}return Promise.resolve({status:o.SendTriggerNotRegistered,data:"send trigger not registered"})},t.prototype.registerSendTriggerExecutor=function(e){this._executors.sendTrigger=e},t.prototype.getSendTriggerCommandLogInfo=function(e){var t=e.url,r=e.method;return"sending host request in AppToHostFunctionsAutomationClient: {url: ".concat(t,", method: ").concat(r," }")},t}(Core.Disposable),l=function(e){function t(t){var r=e.call(this)||this;return r._commander=t,r._executors={},r._registerHostCommands(),r}return __extends(t,e),t.prototype._registerHostCommands=function(){var e=this;this._commander.createAppToHostCommandRegisterer("telemetry.sendEvent").register((function(t){return e._executeSendEventCommand(t)}))},t.prototype._executeSendEventCommand=function(e){if(this._executors.sendEvent)return this._executors.sendEvent(e.message,e.data)},t.prototype.registerSendEventExecutor=function(e){this._executors.sendEvent=e},t}(Core.Disposable);r.d(t,"AppAutomationClient",(function(){return d}));var d=function(e){function t(t){var r=e.call(this)||this;return r.hostControls=r.trackAnonymous(new c.HostControlsAutomationClient(t)),r.behaviorFunctions=r.trackAnonymous(new s.BehaviorFunctionsAutomationClient(t)),r.appToHostFunctionsClient=r.trackAnonymous(new p(t)),r.appToHostTelemetryClient=r.trackAnonymous(new l(t)),r}return __extends(t,e),t}(Core.Disposable)},function(e,t){!function(){e.exports=function(){return this?this:window}()["@pa-client/core"]}()},function(e,t,r){},function(e,t,r){r(43),e.exports=r(42)},function(e,t,r){"use strict";r.r(t);var n=r(11);r.d(t,"AppAuthenticationService",(function(){return n.AppAuthenticationService})),r.d(t,"IAppAuthenticationServiceUserProfile",(function(){return n.IAppAuthenticationServiceUserProfile})),r.d(t,"IAppAuthenticationServiceUserService",(function(){return n.IAppAuthenticationServiceUserService}));var o=r(4);r.d(t,"AppAuthority",(function(){return o.AppAuthority})),r.d(t,"AppAuthorityError",(function(){return o.AppAuthorityError})),r.d(t,"IAppAuthorityConnectionService",(function(){return o.IAppAuthorityConnectionService})),r.d(t,"IAppAuthorityPowerAppsClient",(function(){return o.IAppAuthorityPowerAppsClient})),r.d(t,"IAppAuthorityUserService",(function(){return o.IAppAuthorityUserService}));var a=r(38);r.d(t,"AppAutomationClient",(function(){return a.AppAutomationClient}));var i=r(28);r.d(t,"AppHostErrorHandler",(function(){return i.AppHostErrorHandler})),r.d(t,"IAppHostErrorHandlerUserService",(function(){return i.IAppHostErrorHandlerUserService}));var s=r(14);r.d(t,"AppHostSendHttpPipeline",(function(){return s.AppHostSendHttpPipeline}));var c=r(29);r.d(t,"AppHostService",(function(){return c.AppHostService})),r.d(t,"IAppHostServicePowerAppsClient",(function(){return c.IAppHostServicePowerAppsClient}));var u=r(30);r.d(t,"AutomationConsole",(function(){return u.AutomationConsole})),r.d(t,"IOperationLogItem",(function(){return u.IOperationLogItem}));var p=r(12);r.d(t,"BehaviorFunctionsAutomationClient",(function(){return p.BehaviorFunctionsAutomationClient}));var l=r(19);r.d(t,"ApiConnectionServiceBase",(function(){return l.ApiConnectionServiceBase}));var d=r(20);r.d(t,"BlobService",(function(){return d.BlobService}));var h=r(34);r.d(t,"CdsSurveyDataService",(function(){return h.CdsSurveyDataService}));var f=r(5);r.d(t,"DatasetService",(function(){return f.DatasetService}));var y=r(9);r.d(t,"ConnectorParameter",(function(){return y.ConnectorParameter}));var A=r(35);r.d(t,"ConnectorParameterManager",(function(){return A.ConnectorParameterManager}));var m=r(21);r.d(t,"FileParameter",(function(){return m.FileParameter}));var g=r(22);r.d(t,"ListParameter",(function(){return g.ListParameter}));var v=r(1);r.d(t,"ServicePaths",(function(){return v.ServicePaths}));var _=r(10);r.d(t,"TabularService",(function(){return _.TabularService}));var C=r(23);r.d(t,"CrossPlatformUrlLauncher",(function(){return C.CrossPlatformUrlLauncher}));var S=r(31);r.d(t,"createAppHostHttpPipeline",(function(){return S.createAppHostHttpPipeline})),r.d(t,"createPreloadingPipeline",(function(){return S.createPreloadingPipeline}));var P=r(32);r.d(t,"HostCommander",(function(){return P.HostCommander})),r.d(t,"IHostToAppCommandDelegatedExecutor",(function(){return P.IHostToAppCommandDelegatedExecutor}));var T=r(13);r.d(t,"HostControlsAutomationClient",(function(){return T.HostControlsAutomationClient}));var b=r(3);r.d(t,"BehaviorName",(function(){return b.BehaviorName})),r.d(t,"IAppAutomationClient",(function(){return b.IAppAutomationClient})),r.d(t,"IAppHostErrorHandler",(function(){return b.IAppHostErrorHandler})),r.d(t,"IBehaviorFunctionsAutomaterClient",(function(){return b.IBehaviorFunctionsAutomaterClient})),r.d(t,"IBehaviorRequestedEventArgs",(function(){return b.IBehaviorRequestedEventArgs})),r.d(t,"IClientAppHost",(function(){return b.IClientAppHost})),r.d(t,"ICommandContext",(function(){return b.ICommandContext})),r.d(t,"IHostCommander",(function(){return b.IHostCommander})),r.d(t,"IHostControlsAutomationClient",(function(){return b.IHostControlsAutomationClient}));var w=r(25);r.d(t,"ApiManager",(function(){return w.ApiManager}));var R=r(36);r.d(t,"AppHostPowerAppsClient",(function(){return R.AppHostPowerAppsClient}));var H=r(33);r.d(t,"IActionsConfigurationInfo",(function(){return H.IActionsConfigurationInfo})),r.d(t,"IApiManager",(function(){return H.IApiManager}));var I=r(40);r.d(t,"IAppHostPowerAppsClient",(function(){return I.IAppHostPowerAppsClient}));var M=r(2);r.d(t,"IPreloadAppHostSendHttpPipeline",(function(){return M.IPreloadAppHostSendHttpPipeline}));var U=r(26);r.d(t,"PreloadAppHostSendHttpPipeline",(function(){return U.PreloadAppHostSendHttpPipeline}));var E=r(27);r.d(t,"PreloadAppHostSendHttpPipelineV2",(function(){return E.PreloadAppHostSendHttpPipelineV2}));var L=r(16);r.d(t,"AllRequestsCacheStrategy",(function(){return L.AllRequestsCacheStrategy}));var q=r(8);r.d(t,"PreloadRequestAuthorizationHandler",(function(){return q.PreloadRequestAuthorizationHandler}));var N=r(7);r.d(t,"PreloadRequestReader",(function(){return N.PreloadRequestReader}));var D=r(6);r.d(t,"PreloadRequestWriter",(function(){return D.PreloadRequestWriter}));var O=r(15);r.d(t,"UsedPreloadedRequestsCacheStrategy",(function(){return O.UsedPreloadedRequestsCacheStrategy}));var F=r(17);r.d(t,"CacheRequestsStrategy",(function(){return F.CacheRequestsStrategy}));var x=r(18);r.d(t,"PreloadRequestsStrategy",(function(){return x.PreloadRequestsStrategy}));var k=r(37);r.d(t,"RuntimeErrorHandler",(function(){return k.RuntimeErrorHandler}));var B=r(24);r.d(t,"WindowsUrlLauncher",(function(){return B.WindowsUrlLauncher}));var V=r(0);r.d(t,"ConnectedDataTable",(function(){return V.a})),r.d(t,"ConnectedDataTableListMetadata",(function(){return V.b})),r.d(t,"ConnectedDataset",(function(){return V.c})),r.d(t,"ConnectedDatasetListMetadata",(function(){return V.d})),r.d(t,"IConnectedDataTable",(function(){return V.IConnectedDataTable})),r.d(t,"IConnectedDataTableListMetadata",(function(){return V.IConnectedDataTableListMetadata})),r.d(t,"IConnectedDataset",(function(){return V.IConnectedDataset})),r.d(t,"IConnectedDatasetListMetadata",(function(){return V.IConnectedDatasetListMetadata})),r.d(t,"ILicense",(function(){return V.ILicense})),r.d(t,"ISurveyEntityTable",(function(){return V.ISurveyEntityTable})),r.d(t,"ISurveyEntityTableList",(function(){return V.ISurveyEntityTableList})),r.d(t,"IXrmEntityDefinitionTable",(function(){return V.IXrmEntityDefinitionTable})),r.d(t,"IXrmEntityDefinitionTableDisplayName",(function(){return V.IXrmEntityDefinitionTableDisplayName})),r.d(t,"License",(function(){return V.n})),r.d(t,"SurveyEntityTable",(function(){return V.o})),r.d(t,"SurveyEntityTableList",(function(){return V.p})),r.d(t,"XrmEntityDefinitionTable",(function(){return V.q})),r.d(t,"XrmEntityDefinitionTableDisplayName",(function(){return V.r}))},function(e,t,r){"use strict";r.r(t);var n=r(0);Core.exportToNamespace(["AppMagic","Data"],{ConnectedDataset:n.c,ConnectedDatasetListMetadata:n.d,ConnectedDataTable:n.a,ConnectedDataTableListMetadata:n.b,License:n.n,SurveyEntityTable:n.o,SurveyEntityTableList:n.p,XrmEntityDefinitionTable:n.q,XrmEntityDefinitionTableDisplayName:n.r});var o=r(11);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],o);var a=r(4);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],a);var i=r(38);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],i);var s=r(28);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],s);var c=r(14);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],c);var u=r(2);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],u);var p=r(26);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],p);var l=r(29);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],l);var d=r(6);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],d);var h=r(7);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],h);var f=r(16);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],f);var y=r(15);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],y);var A=r(8);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],A);var m=r(27);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],m);var g=r(17);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],g);var v=r(18);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],v);var _=r(30);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],_);var C=r(12);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],C);var S=r(1);Core.exportToNamespace(["AppMagic","ConnectionHub"],S);var P=r(19);Core.exportToNamespace(["AppMagic","ConnectionHub"],P);var T=r(20);Core.exportToNamespace(["AppMagic","ConnectionHub"],T);var b=r(5);Core.exportToNamespace(["AppMagic","ConnectionHub"],b);var w=r(10);Core.exportToNamespace(["AppMagic","ConnectionHub"],w);var R=r(34);Core.exportToNamespace(["AppMagic","ConnectionHub"],R);var H=r(9);Core.exportToNamespace(["AppMagic","ConnectionHub"],H);var I=r(35);Core.exportToNamespace(["AppMagic","ConnectionHub"],I);var M=r(21);Core.exportToNamespace(["AppMagic","ConnectionHub"],M);var U=r(22);Core.exportToNamespace(["AppMagic","ConnectionHub"],U);var E=r(23);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],E);var L=r(31);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],L);var q=r(32);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],q);var N=r(13);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],N);r(3);var D=r(24);!function(e){e.register(AppMagic.Runtime.App.IUrlLauncherSingletonKey,[],(function(){return!Core.Environment.isWebAuthoring()&&WinJS.Utilities.hasWinRT?new D.WindowsUrlLauncher:new E.CrossPlatformUrlLauncher}))}(Core.Loader.ObjectFactory.instance);var O=r(25);Core.exportToNamespace(["AppMagic","PowerApps"],O);var F=r(36);Core.exportToNamespace(["AppMagic","PowerApps"],F);r(33),r(40);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],D);var x=r(37);Core.exportToNamespace(["AppMagic","Runtime","App","Host"],x)}]);
//# sourceMappingURL=D:/a/_work/1/s/obj/Assets/js/AppMagic.Runtime.App.Host/AppMagic.Runtime.App.Host.js.map