/*! For license information please see AppMagic.Runtime.Client.js.LICENSE.txt */
(function(){return this?this:window}())["@pa-client/appmagic-runtime-client"]=function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=84)}([function(e,t,n){"use strict";var r;n.r(t),n.d(t,"ComponentKeys",(function(){return r})),function(e){e.SendHttpCore=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.SendHttpCoreSingleton"),e.ResourceTimingProvider=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.ResourceTimingProviderSingleton"),e.SettingsProvider=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.SettingsProviderSingleton"),e.UnencryptedSettingsProvider=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.UnencryptedSettingsProviderSingleton"),e.NonAuthenticatedHttpPipeline=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.NonAuthenticatedHttpPipelineSingleton"),e.AuthenticatedHttpPipeline=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.AuthenticatedHttpPipelineSingleton"),e.HttpClient=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.HttpClientSingleton"),e.AuthenticatedHttpClient=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.AuthenticatedHttpClientSingleton"),e.ClientAuthenticationRuntime=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.ClientAuthenticationRuntimeSingleton"),e.AuthenticationPluginCreator=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.AuthenticationPluginCreatorSingleton"),e.IdentityService=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.IdentityAppMagic.ServiceSingleton"),e.CacheSettingsProviderManager=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.Caching.ICacheSettingsProviderManagerSingleton"),e.clientSettingsSingletonKey=Core.Loader.TypeKey.createFromClass(AppMagic.Runtime.Client.ClientSettings),e.NetworkSettingsProvider=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.INetworkSettingsProviderSingleton"),e.EcsHelper=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.IEcsHelperSingleton"),e.EcsSettingsProvider=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.IEcsSettingsProvider")}(r||(r={}))},function(e,t,n){"use strict";var r;n.r(t),n.d(t,"SendHttpUtility",(function(){return r})),function(e){var t;function n(e,t){if("/"===t.charAt(t.length-1)&&(t=t.slice(0,t.length-1)),!t.startsWith(".")){if(t===e)return!0;t=".".concat(t)}var n=e.lastIndexOf(t);return n>=0&&n+t.length===e.length}function r(e){switch(e){case t.apim:return{baseUriSuffixes:[AppMagic.PowerApps.Constants.ApimBaseUrlSuffix,AppMagic.PowerApps.Constants.ApimBaseGccUrlSuffix,AppMagic.PowerApps.Constants.ApiHubBaseUrlSuffix],urlSegmentsToMatch:[AppMagic.PowerApps.Constants.ApimFirstSegment]};case t.bad:return{baseUriSuffixes:[AppMagic.PowerApps.Constants.BadRpBaseUrlSuffix]};case t.cds:return{baseUriSuffixes:AppMagic.Runtime.Client.AuthResource.CdsAuthResourceSuffixes};case t.rp:return{baseUriSuffixes:[AppMagic.PowerApps.Constants.PowerAppsRpBaseUrlSuffix,AppMagic.PowerApps.Constants.PowerAppsRpBaseGccUrlSuffix]};case t.powerplatform:return{baseUriSuffixes:[AppMagic.PowerApps.Constants.PowerPlatformBaseUrlSuffix,AppMagic.PowerApps.Constants.PowerPlatformGccBaseUrlSuffix]};default:return null}}function i(n,i){for(var o in t){var s=r(o);if(s&&(e.doesHostNameInUrlMatch(n,s.baseUriSuffixes)&&e.doSegmentsMatch(i,s.urlSegmentsToMatch)))return o}return null}!function(e){e.apim="apim",e.bad="bad",e.cds="cds",e.rp="rp",e.powerplatform="powerplatform"}(t=e.TargetServices||(e.TargetServices={})),e.updateClientRequestIdHeader=function(e){var t=Core.Utility.generate128BitUUID();e.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]&&(e.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]=t),e.headers[AppMagic.Services.HttpConstants.HeaderName.CdsNativeRequestId]&&(e.headers[AppMagic.Services.HttpConstants.HeaderName.CdsNativeRequestId]=t)},e.createRequestParamsWithClonedHeaders=function(e){var t;return{url:e.url,method:e.method,headers:HashTableUtility.clone(null!==(t=e.headers)&&void 0!==t?t:HashTableUtility.create()),retryable:e.retryable,bodyData:e.bodyData,responseType:e.responseType,requestSource:e.requestSource}},e.doesHostNameInUrlMatch=function(e,t){var r=e.split("/");if(r.length<3)return!1;var i=r[2];return t.some((function(e){return n(i,e)}))},e.doesHostNameMatch=n,e.doSegmentsMatch=function(e,t){if(!t||0===t.length)return!0;if(e.length<4)return!1;var n=3;return t.every((function(t){return!(!t||n>=e.length||!e[n])&&Core.Utility.equalsIgnoreCase(t,e[n++])}))},e.getTargetServiceFromUrl=function(e){var t=e;-1===t.indexOf("://")&&(t="https://"+t.replace(/^\/+|$/g,""));var n=t.split("/");return{serviceName:i(n[0]+"//"+n[2],n),split:n}},e.tryGetApimConnectionName=function(e){var t=new Core.Url(e),n=t.getSegments();if(n.length<3)return null;var r=t.host,i=n[1],o=n[2];return[AppMagic.PowerApps.Constants.ApimBaseUrlSuffix,AppMagic.PowerApps.Constants.ApiHubBaseUrlSuffix,AppMagic.PowerApps.Constants.ApimBaseGccUrlSuffix].some((function(e){var t=r.toLowerCase().lastIndexOf(e);return t>=0&&t+e.length===r.length}))&&Core.Utility.equalsIgnoreCase(i,i)?o:null}}(r||(r={}))},function(e,t,n){"use strict";n.r(t),n.d(t,"CacheType",(function(){return r})),n.d(t,"CacheManager",(function(){return a}));var r,i=n(14),o=n(26),s=n(52);!function(e){e[e.Api=0]="Api",e[e.Connection=1]="Connection",e[e.Environment=2]="Environment",e[e.Features=3]="Features",e[e.MyApps=4]="MyApps",e[e.OrgApps=5]="OrgApps",e[e.GlobalApps=6]="GlobalApps",e[e.AppResource=7]="AppResource",e[e.AppPreloadData=8]="AppPreloadData",e[e.ModelApps=9]="ModelApps",e[e.Tenants=10]="Tenants",e[e.CdsEnvironments=11]="CdsEnvironments",e[e.CuratedApps=12]="CuratedApps"}(r||(r={}));var a=function(e){function t(t,n,r,i,o){var s=this;return(s=e.call(this)||this)._cacheSettingsProviderManager=t,s._cacheIdToFileDetailsMap=n,s._cacheTable=HashTableUtility.create(),s._settingsProvider=r,s._operationsExecutor=i,s._promiseQueue=new Core.PromiseUtils.PromiseQueue("CacheManager"),s._networkSettingsProvider=o,s.trackAnonymous(s._cacheTable),s}return __extends(t,e),Object.defineProperty(t.prototype,"cacheIdToFileDetailsMap",{get:function(){return this._cacheIdToFileDetailsMap},enumerable:!1,configurable:!0}),t.prototype.getCache=function(e,n,r,i){var o=t._generateCacheId(e,i),s=this._cacheTable[o];return s||this._registerCache(o,n,r)},t.prototype._registerCache=function(e,t,n){var r,i,s=this;this._cacheIdToFileDetailsMap[e]?(r=this._cacheIdToFileDetailsMap[e].fileName,i=this._cacheIdToFileDetailsMap[e].lastFetchTimestamp||null):(r=Core.Utility.generate128BitUUID(),i=null),n.serializationOptions&&(n.serializationOptions.settingsProvider=this._cacheSettingsProviderManager.generate(r,!!n.serializationOptions.bypassEncryption),n.serializationOptions.lastFetchTimestamp=i,n.serializationOptions.updateLastFetchTimestampFn=function(t){s._cacheIdToFileDetailsMap[e].lastFetchTimestamp=t,s._updateSettingsProvider()});var a=new o.ServerItemCache(t,e,this._cacheSettingsProviderManager,this._networkSettingsProvider,this._operationsExecutor,n);return this._cacheTable[e]=a,this._cacheIdToFileDetailsMap[e]={fileName:r,lastFetchTimestamp:i},this._updateSettingsProvider(),a},t.prototype.getTimedCache=function(e,n){var r=t._generateCacheId(e,(function(){return"paginated"})),i=this._cacheTable[r];return i||this._registerTimedCache(r,n)},t.prototype._registerTimedCache=function(e,t){var n,r,i=this;this._cacheIdToFileDetailsMap[e]?(n=this._cacheIdToFileDetailsMap[e].fileName,r=this._cacheIdToFileDetailsMap[e].lastFetchTimestamp||null):(n=Core.Utility.generate128BitUUID(),r=null);t.settingsProvider=this._cacheSettingsProviderManager.generate(n,!1),t.updateLastSetTimestampFn=function(t){i._cacheIdToFileDetailsMap[e].lastFetchTimestamp=t,i._updateSettingsProvider()},t.lastSetTimestamp=r;var o=new s.TimedCache(e,this._cacheSettingsProviderManager,this._networkSettingsProvider,t);return this._cacheTable[e]=o,this._cacheIdToFileDetailsMap[e]={fileName:n,lastFetchTimestamp:r},this._updateSettingsProvider(),o},t.prototype.deleteCache=function(e,n){var r,i=t._generateCacheId(e,n);null===(r=this._cacheTable[i])||void 0===r||r.dispose(),delete this._cacheTable[i]},t.prototype.clearCache=function(e,n){var r,i=t._generateCacheId(e,n);null===(r=this._cacheTable[i])||void 0===r||r.clear()},t.prototype.unloadAsync=function(){return this._promiseQueue&&(this._promiseQueue.cancelAll(),this._promiseQueue=null),Core.PromiseUtils.join(HashTableUtility.mapToArray(this._cacheTable,(function(e){return e.unloadAsync()})))},t._generateCacheId=function(e,t){var n=r[e];return(t?"".concat(n,"-").concat(t()):n).toLowerCase()},t.prototype._updateSettingsProvider=function(){var e=this;this._promiseQueue.pushJob((function(){return e._settingsProvider.setValue(i.UserPropertyConstants.cacheMap,e._cacheIdToFileDetailsMap),e._settingsProvider.save()}))},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"isValidCacheVersion",(function(){return a})),n.d(t,"compareCacheVersion",(function(){return c})),n.d(t,"Version",(function(){return u})),n.d(t,"CacheSettings",(function(){return p}));var r=n(6),i=n(10),o=n(19),s=n(20);function a(e){return Core.Utility.isObject(e)&&Core.Utility.isNumber(e.major)&&Core.Utility.isNumber(e.minor)&&e.major>=1&&e.minor>=0}function c(e,t){return e.major===t.major?e.minor-t.minor:e.major-t.major}var p,u={major:3,minor:0};!function(e){var t=864e5,n=7*t;e.EnvironmentCacheSettings={disableInitialDataLoad:!0,serializationOptions:{deserializationFnAsync:AppMagic.PowerApps.Environment.tryDeserialize,staleInStorageAfterMS:1*n},clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,staleInMemoryAfterMS:3e5},e.ConnectionCacheSettings={disableInitialDataLoad:!0,serializationOptions:{deserializationFnAsync:AppMagic.ConnectionHub.Connection.deserialize,staleInStorageAfterMS:1*n},clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],refreshIntervalsMS:[12e4,3e5,6e5,18e5,36e5],refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,staleInMemoryAfterMS:3e5},e.ApiCacheSettings={disableInitialDataLoad:!0,serializationOptions:{deserializationFnAsync:AppMagic.ConnectionHub.Api.deserialize,staleInStorageAfterMS:1*n},clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],refreshIntervalsMS:[3e5,3e6],staleInMemoryAfterMS:3e5,refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground},e.FeaturesCacheSettings={serializationOptions:{deserializationFnAsync:i.UserFeature.tryDeserialize,staleInStorageAfterMS:1*n,bypassEncryption:!0},clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,staleInMemoryAfterMS:18e5,refreshIntervalsMS:[3e5,3e6],onCacheDataRefreshedCallback:function(e){var t=[];HashTableUtility.forEach(e,(function(e){t.push(e.name)})),Core.Telemetry.Log.trackActivityEvent("EnabledUserFeatures",{enabledFeatures:t.join(", ")})}},e.MyAppsCacheSettings={disableInitialDataLoad:!0,serializationOptions:{deserializationFnAsync:AppMagic.PowerApps.AppInfo.deserialize,staleInStorageAfterMS:1*n},refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,staleInMemoryAfterMS:12e4,clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],refreshIntervalsMS:[3e5]},e.OrgAppsCacheSettings={disableInitialDataLoad:!0,refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized]},e.GlobalAppsCacheSettings={disableInitialDataLoad:!0,refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized]},e.ModelAppsCacheSettings={disableInitialDataLoad:!0,refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized]},e.AppResourcesCacheSettings={disableInitialDataLoad:!0,refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnStaleDataWithoutRefresh,staleInMemoryAfterMS:6e4,clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Forbidden,AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],serializationOptions:{deserializationFnAsync:r.CacheableAppResources.deserialize,staleInStorageAfterMS:2*t}},e.UnifiedAppResourcesCacheSettings={disableInitialDataLoad:!0,refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,staleInMemoryAfterMS:1*t,clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Forbidden,AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],serializationOptions:{deserializationFnAsync:r.CacheableAppResources.deserialize,staleInStorageAfterMS:2*t}},e.AppPreloadDataCacheSettings={disableInitialDataLoad:!0,refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnStaleDataWithoutRefresh,staleInMemoryAfterMS:6e4,serializationOptions:{deserializationFnAsync:o.AppPreloadData.deserialize,staleInStorageAfterMS:2*t,bypassEncryption:!0}},e.TenantInfoCacheSettings={disableInitialDataLoad:!0,serializationOptions:{deserializationFnAsync:s.UserTenant.tryDeserialize,staleInStorageAfterMS:1*n},clearCacheOnHttpErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized],refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground,staleInMemoryAfterMS:72e5},e.MyAppsTimedCacheSettings={deserializeFn:AppMagic.PowerApps.AppInfo.deserialize,staleInStorageAfterMS:1*n,returnStaleDataOffline:!0,autoPersist:!1,suspend:!1},e.OrgAppsTimedCacheSettings={deserializeFn:AppMagic.PowerApps.AppInfo.deserialize,staleInStorageAfterMS:-1,returnStaleDataOffline:!0,autoPersist:!1,suspend:!1},e.CuratedAppsCacheSettings={deserializeFn:AppMagic.PowerApps.AppInfo.deserializeToCurated,staleInStorageAfterMS:-1,returnStaleDataOffline:!0,autoPersist:!0,suspend:!1}}(p||(p={}))},function(e,t,n){"use strict";var r;n.r(t),n.d(t,"UserPlanSource",(function(){return r})),n.d(t,"EnrollPropertiesManager",(function(){return i})),function(e){e[e.LocalReset=1]="LocalReset",e[e.LocalCache=2]="LocalCache",e[e.ServerError=3]="ServerError",e[e.Server=4]="Server"}(r||(r={}));var i=function(){function e(e){this._settingsProvider=e,this.resetProperties(!1)}return Object.defineProperty(e.prototype,"userPlanSource",{get:function(){return this._userPlan.source},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWhiteListed",{get:function(){return this._isWhiteListed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userDefaultCountryLocation",{get:function(){return this._userDefaultCountryLocation},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeUserPlans",{get:function(){return this._userPlan.properties.activeUserPlans},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userHasActivePlan",{get:function(){return this._userPlan.properties.userHasActivePlan},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userHasActivePremiumPlan",{get:function(){return this._userPlan.properties.userHasActivePremiumPlan},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userHasExpiredPremiumPlan",{get:function(){return this._userPlan.properties.userHasExpiredPremiumPlan},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"premiumFeaturesActivePlans",{get:function(){return this._userPlan.properties.premiumFeaturesActivePlans},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"premiumFeaturesExpiredPlans",{get:function(){return this._userPlan.properties.premiumFeaturesExpiredPlans},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"showOptInConsentDialog",{get:function(){return this._showOptInConsentDialog},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"oid",{get:function(){return this._userPlan.properties.oid},enumerable:!1,configurable:!0}),e.prototype.updateEnrollProperties=function(e,t,n){this._isWhiteListed=e.isWhiteListed,this._userDefaultCountryLocation=e.userDefaultCountryLocation,this._showOptInConsentDialog=e.showOptInConsentDialog,this.updatePlans(e,t,!1),n&&this.updateEnrollPropertiesCache(e)},e.prototype.updateEnrollPropertiesCache=function(e){var t={isWhiteListed:e.isWhiteListed,userDefaultCountryLocation:e.userDefaultCountryLocation};this._settingsProvider.setValue(AppMagic.Services.Azure.Constants.EnrollProperties.userProperties,t,!0),this._settingsProvider.setValue(AppMagic.Services.Azure.Constants.EnrollProperties.showOptInConsentDialog,e.showOptInConsentDialog?"true":"false",!0),this.updatePlansCache(e)},e.prototype.updatePlans=function(e,t,n){this._userPlan={properties:e,source:t},n&&this.updatePlansCache(e)},e.prototype.updatePlansCache=function(e){var t={userHasActivePlan:e.userHasActivePlan,userHasActivePremiumPlan:e.userHasActivePremiumPlan,userHasExpiredPremiumPlan:e.userHasExpiredPremiumPlan,premiumFeaturesActivePlans:e.premiumFeaturesActivePlans,premiumFeaturesExpiredPlans:e.premiumFeaturesExpiredPlans};this._settingsProvider.setValue(AppMagic.Services.Azure.Constants.EnrollProperties.userPlans,t,!0),this._settingsProvider.setValue(AppMagic.Services.Azure.Constants.EnrollProperties.oid,e.oid,!0)},e.prototype.updateShowUserConsentDialogCache=function(e){this._settingsProvider.setValue(AppMagic.Services.Azure.Constants.EnrollProperties.showOptInConsentDialog,e?"true":"false",!0)},e.prototype.loadAllFromCache=function(){var e=this._settingsProvider.getValue(AppMagic.Services.Azure.Constants.EnrollProperties.userProperties),t=AppMagic.Runtime.Client.EnrollPropertiesCache.UserProperties.safeCast(e);return!(!t||!this.loadPlansFromCache())&&(this._isWhiteListed=t.isWhiteListed,this._userDefaultCountryLocation=t.userDefaultCountryLocation,this._showOptInConsentDialog="true"===this._settingsProvider.getValue(AppMagic.Services.Azure.Constants.EnrollProperties.showOptInConsentDialog),!0)},e.prototype.loadPlansFromCache=function(){var e=this._settingsProvider.getValue(AppMagic.Services.Azure.Constants.EnrollProperties.oid),t=this._settingsProvider.getValue(AppMagic.Services.Azure.Constants.EnrollProperties.userPlans),n=AppMagic.Runtime.Client.EnrollPropertiesCache.UserPlans.safeCast(t);if(!e||!n)return!1;var i={oid:e,activeUserPlans:[],userHasActivePlan:n.userHasActivePremiumPlan,userHasActivePremiumPlan:n.userHasActivePremiumPlan,userHasExpiredPremiumPlan:n.userHasExpiredPremiumPlan,premiumFeaturesActivePlans:n.premiumFeaturesActivePlans,premiumFeaturesExpiredPlans:n.premiumFeaturesExpiredPlans};return this.updatePlans(i,r.LocalCache,!1),!0},e.prototype.clearCache=function(){this._settingsProvider.removeValue(AppMagic.Services.Azure.Constants.EnrollProperties.userProperties),this._settingsProvider.removeValue(AppMagic.Services.Azure.Constants.EnrollProperties.userPlans),this._settingsProvider.removeValue(AppMagic.Services.Azure.Constants.EnrollProperties.showOptInConsentDialog),this._settingsProvider.removeValue(AppMagic.Services.Azure.Constants.EnrollProperties.oid)},e.prototype.resetProperties=function(e){this.updateEnrollProperties({oid:"",isWhiteListed:!0,userDefaultCountryLocation:"",activeUserPlans:[],userHasActivePlan:!0,userHasActivePremiumPlan:!0,userHasExpiredPremiumPlan:!1,showOptInConsentDialog:!1,premiumFeaturesActivePlans:{premiumApis:!0,premiumApiIds:[],onPremGateway:!0,nonDefaultEnvironments:!0,customApi:!0},premiumFeaturesExpiredPlans:{premiumApis:!1,premiumApiIds:[],onPremGateway:!1,nonDefaultEnvironments:!1,customApi:!1}},r.LocalReset,e)},e.prototype.setPropertiesToUnblock=function(){this.resetProperties(!1)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"addConnectionAsync",(function(){return o})),n.d(t,"updateConnectionAsync",(function(){return s})),n.d(t,"getConnectionConsentAsync",(function(){return a})),n.d(t,"startAsyncOperationWithConsent",(function(){return c})),n.d(t,"filterAndSortAvailableConnections",(function(){return u})),n.d(t,"isConnectionAvailableForReference",(function(){return l})),n.d(t,"compareConnections",(function(){return d})),n.d(t,"getFullApiByIdAsync",(function(){return h})),n.d(t,"ensureConnectionExistsAsync",(function(){return g}));var r=n(0),i=n(8);function o(e,t,n,r,o,s,a,u){return function(e,t,n,r,o,s,a,u){return c((function(){return e.addConnectionAsync(t,n,r,o,s,a,!1,u)}),p(t,s,o)&&!r,Core.Loader.ObjectFactory.instance.getSingleton(i.IAuthenticationBrokerManagerFactorySingletonKey).getAzureBrokerManager())}(e,t,n,r,o,s,a,u).waitAsync()}function s(e,t,n,r,o,s,a,u){return function(e,t,n,r,o,s,a,u){var l=p(t,a,s)&&!o,d=Core.Loader.ObjectFactory.instance.getSingleton(i.IAuthenticationBrokerManagerFactorySingletonKey).getAzureBrokerManager();return c((function(){return e.updateConnectionAsync(t,n,r,o,s,a,u)}),l,d)}(e,t,n,r,o,s,a,u).waitAsync()}function a(e,t,n){return function(e,t,n){return c((function(){return e.getConnectionConsentAsync(t,n)}),p(t.api,t.multiAuthParametersSetName,n),Core.Loader.ObjectFactory.instance.getSingleton(i.IAuthenticationBrokerManagerFactorySingletonKey).getAzureBrokerManager())}(e,t,n).waitAsync()}function c(e,t,n){var r=new f;return r.start(e,t,n),r}function p(e,t,n){var i=Core.Loader.ObjectFactory.instance.getSingleton(r.ComponentKeys.clientSettingsSingletonKey);return(!(e.getIsFirstParty(t)&&i.singleSignOnEnabled)||!(!n||n.manualLoginSettings!==AppMagic.ConnectionHub.ManualLoginSettings.Force))&&e.getIsConsentRequired(t)}function u(e,t,n,r,i){var o=r||l,s=i||d,a=t.filter((function(t){return o(t,e)}));return a.sort(s.bind(this,e,n)),a}function l(e,t){if(t.sharedConnectionId)return e.id===t.sharedConnectionId;var n=e.apiId===t.id;return n?t.authenticationType?e.multiAuthParametersSetName===t.authenticationType:AppMagic.ConnectionHub.PowerAppsConnectionService.isSqlNonSharedConnectionReference(t)?e.multiAuthParametersSetName===AppMagic.ConnectionHub.Constants.MultiAuthConnectionParametersSetNames.AadAuth:e.isOnPremise===!!t.isOnPremiseConnection:n}function d(e,t,n,r){var i=e.sharedConnectionId;if(i){if(i===n.id)return-1;if(i===r.id)return 1}var o=e.gatewayObjectIdHint;if(o){var s=AppMagic.ConnectionHub.PowerAppsConnectionService.tryGetGatewayObjectId(n)===o,a=AppMagic.ConnectionHub.PowerAppsConnectionService.tryGetGatewayObjectId(r)===o;if(s&&!a)return-1;if(a&&!s)return 1}if(t){var c=AppMagic.ConnectionHub.PowerAppsConnectionService.userMatchesConnectionAccount(n,t),p=AppMagic.ConnectionHub.PowerAppsConnectionService.userMatchesConnectionAccount(r,t);if(c&&!p)return-1;if(p&&!c)return 1}return n.displayName&&r.displayName?n.displayName.localeCompare(r.displayName):n.id.localeCompare(r.id)}function h(e,t){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(n){return[2,e.getFullApiByIdAsync(t)]}))}))}function g(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return[4,e.tryGetConnectionAsync(t)];case 1:return(n=i.sent())?[2,n]:[4,e.getApiByIdAsync(t)];case 2:return r=i.sent(),[2,o(e,r)]}}))}))}var f=function(){function e(e){void 0===e&&(e=new AbortController),this._completablePromise=Core.PromiseUtils.createCancellablePromise(e),this._isDone=!1}return e.prototype.start=function(e,t,n){var r=this;if(t)try{this._showConsentDialogAsync(n)}catch(e){return void this._completablePromise.error(e)}Promise.resolve().then(e).then((function(e){return r._completablePromise.complete(e)}),(function(i){i instanceof AppMagic.Services.ConsentDialogNotInitializedError&&!t?r.start(e,!0,n):r._completablePromise.error(i)}))},Object.defineProperty(e.prototype,"isDisposed",{get:function(){return null===this._completablePromise},enumerable:!1,configurable:!0}),e.prototype.waitAsync=function(){return this._completablePromise.promise},e.prototype.cancel=function(){this._isDone||this._completablePromise.error(Core.Utility.throwInline(new Core.PromiseUtils.AsyncOperationCancelledError("ConsentOperation")))},e.prototype.dispose=function(){this.cancel(),this._completablePromise=null},e.prototype._showConsentDialogAsync=function(e){var t=this;e.prepareForAuthenticationSession(),this._completablePromise.promise.then((function(){return t._postCompletion(e)}),(function(){return t._postCompletion(e)}))},e.prototype._postCompletion=function(e){this._isDone=!0,e.cleanupAuthenticationSession()},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"CacheableAppResources",(function(){return r})),n.d(t,"parse",(function(){return i})),n.d(t,"tryParse",(function(){return o}));var r=function(e){function t(t,n,r,i,o){var s=this;return(s=e.call(this,t,n,r,i,o)||this).cacheItemIdOverride=null,s}return __extends(t,e),Object.defineProperty(t.prototype,"cacheItemId",{get:function(){return null!==this.cacheItemIdOverride?this.cacheItemIdOverride:this.appInfo.id},set:function(e){this.cacheItemIdOverride=e},enumerable:!1,configurable:!0}),t.prototype.serializeToJson=function(){return{apis:this.apis.map((function(e){return e.serializeToJson()})),connections:this.connections.map((function(e){return e.serializeToJson()})),appConnections:HashTableUtility.mapToArray(this.connectionUsages,(function(e){return AppMagic.ConnectionHub.UserConnectionForApp.serializeToJson(e)})),app:this.appInfo.serializeToJson(),listAppPackageOperationDetails:this.listAppPackageOperationDetails?this.listAppPackageOperationDetails.serializeToJson():void 0,cacheItemIdOverride:this.cacheItemIdOverride}},t.deserialize=function(e){return i(e)},t}(AppMagic.Runtime.Client.AppResources);function i(e){try{var t=AppMagic.Runtime.Client.LaunchAppServerResponse.safeCast(e);if(!t)throw new AppMagic.Services.SafeCastError("Services.LaunchAppResponse");var n=AppMagic.PowerApps.AppInfoParser.parseAppInfo(t.app,t.draftResources);if(!n)throw new Error("Invalid AppInfo returned as part of LaunchApp call.");var i=t.apis?t.apis.map((function(e){return AppMagic.ConnectionHub.Api.parse(e)})):[],o=[];t.connections&&(o=t.connections.map((function(e){var t=i.find((function(t){return Core.Utility.equalsIgnoreCase(t.id,e.properties.apiId)}));if(!t)throw new Error("Launch app response is missing the api ".concat(e.properties.apiId," for connection ").concat(e.id," in the app."));return AppMagic.ConnectionHub.Connection.parse(e,t)})));var s=t.appConnections?t.appConnections.map((function(e){return AppMagic.ConnectionHub.UserConnectionForApp.parse(e)})):[],a=HashTableUtility.create();s.forEach((function(e){a[e.reference]=e}));var c=void 0;t.listAppPackageOperationDetails&&(c=AppMagic.PowerApps.ListAppPackageOperationDetails.parse(t.listAppPackageOperationDetails));var p=new r(n,i,o,a,c);return p.cacheItemIdOverride=e.cacheItemIdOverride,p}catch(e){throw Core.Log.error("AppResources.parse",e,"Error parsing launchApp response."),e}}function o(e){try{return i(e)}catch(e){return null}}},function(e,t,n){"use strict";n.r(t),n.d(t,"IClientRuntimeSingletonKey",(function(){return r}));var r=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.IClientRuntime")},function(e,t,n){"use strict";n.r(t),n.d(t,"IAuthenticationBrokerManagerFactorySingletonKey",(function(){return r}));var r=Core.Loader.TypeKey.createForInterface("AppMagic.Runtime.Client.IAuthenticationBrokerManagerFactory")},function(e,t,n){"use strict";n.r(t),n.d(t,"UserService",(function(){return a}));var r=n(4),i=n(51),o=n(10),s=n(13),a=function(e){function t(t,n,o,a,c){var p=this;return(p=e.call(this)||this)._httpClient=t,p._identityService=n,p._userInstance=null,p._userProfileChangeEvent=new EventObject,p._userInstanceLoadedEvent=new EventObject,p._isLoaded=!1,p._userInfoUpdatedEvent=new EventObject,p._logOutPredicateArray=new Array,p._logOutCancelledHandlerArray=new Array,p._enrollPollingHandle=null,p._checkPlansPollingHandle=null,p._plansPromise=null,p._plansAbortController=null,p._enrollPropertiesManager=new r.EnrollPropertiesManager(o),p._createUserInstanceFn=a,p._userProfileClient=new s.UserProfileClient(t,n),p._options=c,p._userInstanceInitialLoadPromise=Core.PromiseUtils.createCompletablePromise(),p._planTelemetryLogger=new i.PlanDetailsTelemetryLogger,p._identityChangeListener=p._identityService.identityChangeEvent.addListener((function(){p._isLoaded&&p._onUserIdentityChangedAsync().catch((function(e){Core.Utility.isCanceledError(e)||Core.Log.error("UserService._onUserIdentityChangedAsync",e,"identityChangeEvent handler")}))})),p}return __extends(t,e),Object.defineProperty(t.prototype,"userProfile",{get:function(){return this._userProfileClient.tryGetUserProfile()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userProfileChangeEvent",{get:function(){return this._userProfileChangeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userInstanceLoadedEvent",{get:function(){return this._userInstanceLoadedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userHasActivePlan",{get:function(){return this._enrollPropertiesManager.userHasActivePlan},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userHasActivePremiumPlan",{get:function(){return this._enrollPropertiesManager.userHasActivePremiumPlan},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userHasExpiredPremiumPlan",{get:function(){return this._enrollPropertiesManager.userHasExpiredPremiumPlan},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"premiumFeaturesActivePlans",{get:function(){return this._enrollPropertiesManager.premiumFeaturesActivePlans},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"premiumFeaturesExpiredPlans",{get:function(){return this._enrollPropertiesManager.premiumFeaturesExpiredPlans},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"showOptInConsentDialog",{get:function(){return this._enrollPropertiesManager.showOptInConsentDialog},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userDefaultCountryLocation",{get:function(){return this._enrollPropertiesManager.userDefaultCountryLocation},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userFeaturesManager",{get:function(){return this._getUserInstance().userFeaturesManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userTenantsManager",{get:function(){return this._getUserInstance().userTenantsManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appsManager",{get:function(){return this._getUserInstance().appsManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appResourceManager",{get:function(){return this._getUserInstance().appResourceManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userInfoUpdatedEvent",{get:function(){return this._userInfoUpdatedEvent},enumerable:!1,configurable:!0}),t.prototype.tryGetUserFeaturesManager=function(){return this._identityService.hasIdentity?this.userFeaturesManager:void 0},t.getUserFeaturesFromServerAsync=function(e,n,r,i){return t._getUserFeaturesFromServerAsync(n,this.createUserFeaturesFromServerUrl(e,i),r,!0)},t.createUserFeaturesFromServerUrl=function(e,t){var n;if(AppMagic.ConnectionHub.PowerAppsConnectionService.IsPowerPlatformApiEnabled){if(!t)return void Core.Log.errorEx("UserService.getUserFeaturesFromServerAsync","Cannot get current tenantId to retrieve tenant name for PowerApps Api endpoint.");n=AppMagic.PowerApps.PowerAppsUtility.createPowerAppsTenantUrlBuilder(t)}else n=AppMagic.PowerApps.PowerAppsUtility.createPowerAppsObjectUrlBuilder(e);return n.appendPath(AppMagic.PowerApps.Constants.APIs.features),n},t.getUserEnvironmentFeaturesFromServerAsync=function(e,n,r){var i=t._createUserEnvironmentFeaturesUrlBuilder(e);return t._getUserFeaturesFromServerAsync(n,i,r)},t._createUserEnvironmentFeaturesUrlBuilder=function(e){var t;return Core.Environment.usePowerPlatformApi()?((t=AppMagic.PowerApps.PowerAppsUtility.createPowerPlatformPowerAppsUrlBuilder(e)).appendPath(AppMagic.PowerApps.Constants.APIs.features),t):((t=AppMagic.PowerApps.PowerAppsUtility.createPowerAppsProviderUrlBuilder()).appendPath(AppMagic.PowerApps.Constants.PowerAppEndpoints.environmentsValue),t.appendPath(e),t.appendPath(AppMagic.PowerApps.Constants.APIs.features),t)},t._getUserFeaturesFromServerAsync=function(e,t,n,r){void 0===r&&(r=!1),n&&t.setQueryParam(AppMagic.PowerApps.Constants.PowerAppEndpoints.pollQueryParam,"true");var i=new AppMagic.Services.BodilessHttpRequestBuilder;Core.Environment.usePowerPlatformApi()&&!r||AppMagic.ConnectionHub.PowerAppsConnectionService.IsPowerPlatformApiEnabled&&r?AppMagic.PowerApps.PowerAppsUtility.authorizeHttpBuilder(i,AppMagic.Services.HttpConstants.Method.GET,t.toUrl(),AppMagic.Runtime.Client.ResourceNames.PowerPlatformService,AppMagic.Services.Azure.Region.getCurrentRegion().powerPlatformRpApiVersion):AppMagic.PowerApps.PowerAppsUtility.authorizeHttpBuilder(i,AppMagic.Services.HttpConstants.Method.GET,t.toUrl(),AppMagic.Runtime.Client.ResourceNames.PowerAppsService);var s=i.generateSendHttpRequestParameters();return AppMagic.Services.appendCustomHeadersOptions(s,{addCustomHeaders:!0}),AppMagic.Services.PowerAppsHttpTelemetry.sendHttpJsonResponseAsync(e,s,"UserService.GetUserFeatures").then((function(e){var t=AppMagic.PowerApps.UserFeaturesResponse.safeCast(e);if(!t)throw new Error("There was an error parsing the user features response");var n=[];return t.value.forEach((function(e){var t=Object(o.parse)(e);if(!t)throw new Error("There was an error parsing the feature response: ".concat(JSON.stringify(e)));n.push(t)})),n}))},t.prototype.getUserInformation=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,i,o;return __generator(this,(function(s){switch(s.label){case 0:(n=this._buildGraphRequest("v1.0/users/"+e)).signal=t,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._httpClient.sendHttpJsonResponseAsync(n)];case 2:return r=s.sent(),[3,4];case 3:throw i=s.sent(),Core.Log.error("UserService.getUserInformation","Request failed. Error: ".concat(i.toString())),i;case 4:if(!(o=AppMagic.PowerApps.GraphUser.safeCast(r)))throw new Error("There was an error parsing the graph user response");return[2,o]}}))}))},t.prototype._buildGraphRequest=function(e){var t=HashTableUtility.create(),n=new Core.UrlBuilder(AppMagic.Services.Azure.Region.getCurrentRegion().microsoftGraphEndpoint);return n.appendPath(e),AppMagic.Runtime.Client.addAuthorizationOptions(t,{resource:AppMagic.Runtime.Client.ResourceNames.MicrosoftGraph}),{method:AppMagic.Services.HttpConstants.Method.GET,url:n.toString(),headers:t}},t._parseJsonResponse=function(e){var t;switch(e.responseType.toLowerCase()){case AppMagic.Services.ResponseTypes.Json:t=e.response;break;case AppMagic.Services.ResponseTypes.Text:try{t=Core.Utility.isEmptyString(e.responseText)?e.responseText:JSON.parse(e.responseText)}catch(t){throw new Core.SendHttpInvalidResponseError(AppMagic.Strings.RestResponseDataInvalid,e,Core.HttpResponseErrorKind.ResponseInvalidJson)}break;default:throw new Core.SendHttpInvalidResponseError(Core.Utility.formatString(AppMagic.Strings.XhrResponseTypeInvalid_Expected,AppMagic.Services.ResponseTypes.Json),e,Core.HttpResponseErrorKind.ResponseNotJsonNorText)}return t},t._hasPremiumPlan=function(e){return e.some((function(e){return e.properties.policies.accessPremiumApis}))},t._getPremiumFeaturesPlans=function(e){return{premiumApiIds:t._getAllowedPremiumApis(e),premiumApis:e.some((function(e){return e.properties.policies.accessPremiumApis})),onPremGateway:e.some((function(e){return e.properties.policies.accessOnPremGateway})),customApi:e.some((function(e){return e.properties.policies.canUseCustomApis})),nonDefaultEnvironments:e.some((function(e){return e.properties.policies.canAccessNonDefaultEnvironments}))}},t._getAllowedPremiumApis=function(e){for(var t=new Set,n=0,r=e;n<r.length;n++){var i=r[n];i.properties.policies.additionalAllowedPremiumApis&&i.properties.policies.additionalAllowedPremiumApis.forEach((function(e){return t.add(e)}))}var o=[];return t.forEach((function(e){return o.push(e)})),o},t._generatePremiumFeaturesPlans=function(e){return{premiumApis:e,premiumApiIds:[],onPremGateway:e,nonDefaultEnvironments:e,customApi:e}},t._appHasFeaturesRequirements=function(e){return e.premiumApis||e.onPremGateway||e.customApi||e.nonDefaultEnvironments},t._userHasPlanForAllRequiredFeatures=function(e,n){return{premiumApiFound:t._userHasPremiumApiAccess(e,n),onPremGatewayFound:!e.onPremGateway||n.onPremGateway,customAPIFound:!e.customApi||n.customApi,nonDefaultEnvironmentFound:!e.nonDefaultEnvironments||n.nonDefaultEnvironments}},t._userHasPremiumApiAccess=function(e,t){var n=!e.premiumApis||t.premiumApis;if(!n&&e.premiumApiIds.length>0&&t.premiumApiIds.length>0){var r=new Set;t.premiumApiIds.forEach((function(e){return r.add(e.toLowerCase())})),(n=e.premiumApiIds.every((function(e){return r.has(e.toLowerCase())})))||Core.Telemetry.Log.trackActivityEvent("UserService._userHasPremiumApiAccess",{message:"Not all premium apis used on app are whitelisted. Premium apis: ".concat(e.premiumApiIds)})}return n},t.prototype.dispose=function(){var t;this._enrollPollingHandle&&(this._enrollPollingHandle.dispose(),this._enrollPollingHandle=null),this._checkPlansPollingHandle&&(this._checkPlansPollingHandle.dispose(),this._checkPlansPollingHandle=null),this._plansPromise&&(Core.PromiseUtils.abortPromise(this._plansPromise,this._plansAbortController),this._plansPromise=null,this._plansAbortController=null),this._identityService.dispose(),this._identityChangeListener.dispose(),this._userProfileChangeEvent.dispose(),this._userInfoUpdatedEvent.dispose(),this._userInstanceLoadedEvent.dispose(),this._userProfileClient.dispose(),null===(t=this._userInstanceInitialLoadPromise)||void 0===t||t.error("User service was disposed"),this._userInstanceInitialLoadPromise=null,e.prototype.dispose.call(this)},t.prototype.waitForInitialUserInstanceLoadedAsync=function(){return this._userInstanceInitialLoadPromise?Core.PromiseUtils.preventCancel(this._userInstanceInitialLoadPromise.promise):Promise.resolve()},t.prototype.loadAsync=function(){var e=this;return Core.Log.verbose("UserService: Calling first IdentityChanged handler for silent login."),this._onUserIdentityChangedAsync().then((function(){e._isLoaded=!0}),(function(e){return Core.PromiseUtils.throwIfCanceled(e),Core.Log.error("UserService.loadAsync",e),Promise.reject(e)}))},t.prototype.registerLogOutPredicate=function(e,t){this._logOutPredicateArray.push(e),t&&this._logOutCancelledHandlerArray.push(t)},t.prototype.logInAsync=function(e){return this._identityService.logInAsync(e).catch((function(e){return Core.PromiseUtils.throwIfCanceled(e),Core.Log.error("UserService.logInAsync",e),Promise.reject(e)}))},t.prototype.logOutAsync=function(){var e=this,t=!0,n=Core.PromiseUtils.join(this._logOutPredicateArray.map((function(e){return e().then((function(e){return!!e||(t=!1)}))}))).then((function(){return t?[]:e._logOutCancelledHandlerArray.map((function(e){return e()}))})).then((function(e){return Core.PromiseUtils.join(e)})).then((function(){return!!t&&e._identityService.logOutAsync()}));return n.catch((function(e){Core.PromiseUtils.throwIfCanceled(e);Core.PromiseUtils.formatError(e);Core.Log.error("UserService.logOutAsync",e)})),n},t.prototype.switchTenantAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t=this;return __generator(this,(function(n){switch(n.label){case 0:return e=!0,[4,Core.PromiseUtils.join(this._logOutPredicateArray.map((function(n){return __awaiter(t,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,n()];case 1:return e=t.sent(),[2]}}))}))})))];case 1:return n.sent(),e?[4,Core.PromiseUtils.join(this._logOutCancelledHandlerArray.map((function(e){return __awaiter(t,void 0,void 0,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,e()];case 1:return t.sent(),[2]}}))}))})))]:[3,3];case 2:n.sent(),n.label=3;case 3:return this._identityService.switchTenant(),this._userProfileClient.unload(),[2,!0]}}))}))},t.prototype._getUserInstance=function(){if(!this._identityService.hasIdentity)throw new AppMagic.Services.Adal.AuthenticationError(AppMagic.Services.Adal.AuthenticationErrorKind.NotLoggedInError,"There is no signed in user");return this._userInstance},t.prototype.getOperationsExecutor=function(){return this._getUserInstance().operationsExecutor},t.prototype.getEnvironmentService=function(){return this._getUserInstance().environmentService},t.prototype.tryGetEnvironmentService=function(){try{return this.getEnvironmentService()}catch(e){return null}},t.prototype.getConnectionServiceAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this.waitForInitialUserInstanceLoadedAsync()];case 1:return e.sent(),[4,this._getUserInstance().getEnvironmentInstanceAsync()];case 2:return[2,e.sent().connectionService]}}))}))},t.prototype.tryGetConnectionService=function(){return this._userInstance&&this._userInstance.tryGetEnvironmentInstance()?this._userInstance.tryGetEnvironmentInstance().connectionService:null},t.prototype.validatePlanRequirementsAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return n=e.featuresRequirements,this._isUserPlansValidationBypassed(e.appOverrides)?(this._lastPlanValidationResultInfo={planValidationResult:AppMagic.Runtime.Client.PlanValidationResult.noMissingPlans,plansFound:{premiumApiFound:!0,onPremGatewayFound:!0,customAPIFound:!0,nonDefaultEnvironmentFound:!0},plansRequest:e.featuresRequirements,activeUserPlans:this._enrollPropertiesManager.activeUserPlans},[2,this._lastPlanValidationResultInfo]):this._planNeedsUpdate(n)?[4,this.updatePlansAsync(!1)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[4,this._validatePlanRequirementsAsync(n,t)];case 3:return r=i.sent(),this._logValidationResultTelemetry(r),[2,r]}}))}))},t.prototype.validatePlanRequirements=function(e){var t=e.featuresRequirements;if(this._isUserPlansValidationBypassed(e.appOverrides))return this._lastPlanValidationResultInfo={planValidationResult:AppMagic.Runtime.Client.PlanValidationResult.noMissingPlans,plansFound:{premiumApiFound:!0,onPremGatewayFound:!0,customAPIFound:!0,nonDefaultEnvironmentFound:!0},plansRequest:e.featuresRequirements,activeUserPlans:this._enrollPropertiesManager.activeUserPlans},this._lastPlanValidationResultInfo;this._planNeedsUpdate(t)&&Core.Log.error("UserService.validatePlanRequirements","User plan not updated.","Enroll or updatePlansAsync should be called before validating plans.");var n=this._validatePlanRequirements(t);return this._logValidationResultTelemetry(n),n},t.prototype._isUserPlansValidationBypassed=function(e){return!(!e||!e.bypassUserPlansValidation)&&(Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServicePlansValidationResult,{message:"User plans validation bypassed."}),!0)},t.prototype._planNeedsUpdate=function(e){var n=this._enrollPropertiesManager.userPlanSource,i=n===r.UserPlanSource.Server||n===r.UserPlanSource.ServerError||n===r.UserPlanSource.LocalCache;return t._appHasFeaturesRequirements(e)&&!i},t.prototype._validatePlanRequirementsAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:if((n=this._validatePlanRequirements(e)).planValidationResult==AppMagic.Runtime.Client.PlanValidationResult.noMissingPlans||!t)return[2,n];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.updatePlansAsync(!0)];case 2:return i.sent(),[3,4];case 3:return r=i.sent(),Core.Log.error("UserService.validatePlanRequirementsAsync",r,"UserService.updatePlansAsync returned an error. Return no missing plans."),[2,{planValidationResult:AppMagic.Runtime.Client.PlanValidationResult.noMissingPlans,plansFound:{premiumApiFound:!0,onPremGatewayFound:!0,customAPIFound:!0,nonDefaultEnvironmentFound:!0},plansRequest:e,activeUserPlans:this._enrollPropertiesManager.activeUserPlans}];case 4:return[2,this._validatePlanRequirements(e)]}}))}))},t.prototype._validatePlanRequirements=function(e){if(!t._appHasFeaturesRequirements(e))return{planValidationResult:AppMagic.Runtime.Client.PlanValidationResult.noMissingPlans,plansFound:{premiumApiFound:!0,onPremGatewayFound:!0,customAPIFound:!0,nonDefaultEnvironmentFound:!0},plansRequest:e,activeUserPlans:this._enrollPropertiesManager.activeUserPlans};var n=t._userHasPlanForAllRequiredFeatures(e,this.premiumFeaturesActivePlans);if(n.premiumApiFound&&n.onPremGatewayFound&&n.customAPIFound&&n.nonDefaultEnvironmentFound)return{planValidationResult:AppMagic.Runtime.Client.PlanValidationResult.noMissingPlans,plansFound:n,plansRequest:e,activeUserPlans:this._enrollPropertiesManager.activeUserPlans};var r=t._userHasPlanForAllRequiredFeatures(e,this.premiumFeaturesExpiredPlans);return r.premiumApiFound&&r.onPremGatewayFound&&r.customAPIFound&&r.nonDefaultEnvironmentFound?{planValidationResult:AppMagic.Runtime.Client.PlanValidationResult.expiredPlanFound,plansFound:r,plansRequest:e,activeUserPlans:this._enrollPropertiesManager.activeUserPlans}:{planValidationResult:AppMagic.Runtime.Client.PlanValidationResult.requiredPlansNotFound,plansFound:r,plansRequest:e,activeUserPlans:this._enrollPropertiesManager.activeUserPlans}},t.prototype._logValidationResultTelemetry=function(e){this._lastPlanValidationResultInfo&&e.planValidationResult==this._lastPlanValidationResultInfo.planValidationResult&&e.plansFound.premiumApiFound==this._lastPlanValidationResultInfo.plansFound.premiumApiFound&&e.plansFound.onPremGatewayFound==this._lastPlanValidationResultInfo.plansFound.onPremGatewayFound&&e.plansFound.customAPIFound==this._lastPlanValidationResultInfo.plansFound.customAPIFound&&e.plansFound.nonDefaultEnvironmentFound==this._lastPlanValidationResultInfo.plansFound.nonDefaultEnvironmentFound||(this._lastPlanValidationResultInfo=e,Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServicePlansValidationResult,{ValidationResult:e.planValidationResult==AppMagic.Runtime.Client.PlanValidationResult.noMissingPlans?"No Missing Plans":e.planValidationResult==AppMagic.Runtime.Client.PlanValidationResult.requiredPlansNotFound?"Required Plans not found":"Expired Plan found",premiumApiAllowed:e.plansFound.premiumApiFound,onPremGatewayAllowed:e.plansFound.onPremGatewayFound,customAPIAllowed:e.plansFound.customAPIFound,nonDefaultEnvironmentAllowed:e.plansFound.nonDefaultEnvironmentFound,premiumApiRequired:e.plansRequest.premiumApis,onPremGatewayRequired:e.plansRequest.onPremGateway,customAPIRequired:e.plansRequest.customApi,nonDefaultEnvironmentRequired:e.plansRequest.nonDefaultEnvironments}))},t.prototype.skipEnroll=function(){Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceSkipEnroll),this._enrollPropertiesManager.setPropertiesToUnblock(),this._checkPlansPollingHandle&&(this._checkPlansPollingHandle.cancel(),this._checkPlansPollingHandle=null),this._dispatchUserInfoUpdatedEvent()},t.prototype.enrollAsync=function(e){return void 0===e&&(e={}),(e.isAppSourceTrial||e.forceBlocking)&&this._resetEnrollProperties(),this._enrollCoreAsync(e)},t.prototype._tryGetEnrollmentFromPowerPlatformEmbedAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){return Core.Environment.isWebAuthoringEmbedded()?[2,AppMagic.PowerApps.EnvironmentService.getDataFromPowerPlatformEmbedAsync(AppMagic.AuthoringTool.GlobalEventBroker.EventBrokerId.PowerPlatformEmbed_RequestEnrollment,AppMagic.AuthoringTool.GlobalEventBroker.EventBrokerId.PowerPlatformEmbed_EnrollmentProvided,"UserService.PowerPlatformEmbed_RequestEnrollment",(function(e){var t=AppMagic.PowerApps.EnrollResponse.safeCast(e);return Core.Telemetry.Log.trackActivityEvent("UserService.PowerPlatformEmbed_EnrollmentProvided",{enrollmentProvided:!!t}),t}))]:[2,null]}))}))},t.prototype._enrollCoreAsync=function(e){var t=this;Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsync,e);var n=!!e.isAppSourceTrial;e.forceBlocking;if(!this._identityService.hasIdentity)return Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncActivity,{message:"Returning immediately due to no user being logged in."}),Promise.resolve(!1);if(this._enrollPollingHandle)return Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncActivity,{message:"Existing polling handle returned."}),this._enrollPollingHandle.waitAsync().then((function(){return t._enrollPropertiesManager.userHasActivePlan}),(function(e){return Core.PromiseUtils.throwIfCanceled(e),!0}));if(this._enrollPropertiesManager.loadAllFromCache())if(this.userProfile.objectId===this._enrollPropertiesManager.oid){if(this._enrollPropertiesManager.userHasActivePlan)return this._handleCachedUserAsync();Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncActivity,{message:"Cached enroll values exist, but user doesn't have an active plan. Making a blocking enroll call."})}else Core.Log.error("UserService._enrollCoreAsync",Core.Utility.formatString("Cached oid '{0}' should match the current user's oid. Clearing the cached values because they do not match.",this._enrollPropertiesManager.oid)),this._enrollPropertiesManager.clearCache();return this._handleUncachedUserAsync(n)},t.prototype._handleCachedUserAsync=function(){var e=this;return Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncActivity,{message:"Already enrolled. Using cached values."}),this._enrollPollingHandle=new Core.PromiseUtils.PollingHandle("UserService._handleCachedUserAsync.pollingHandle",(function(t){return e._enrollPollingFnAsync(t,!1,!1)}),(function(t){return e._enrollPollingRecursorFn(t)}),1e3),this._enrollPollingHandle.start(0),this._onEnrollCompleted({succeeded:!0,isBlocking:!1,isAppSourceTrial:!1}),Promise.resolve(this._enrollPropertiesManager.userHasActivePlan)},t.prototype._handleUncachedUserAsync=function(e){var t=this;return Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncBlockingEnrollStarted),this._enrollPollingHandle=new Core.PromiseUtils.PollingHandle("UserService._handleUncachedUserAsync.pollingHandle",(function(n){return t._enrollPollingFnAsync(n,!0,e)}),(function(e){return t._enrollPollingRecursorFn(e)}),1e3),this._enrollPollingHandle.start(3),this._enrollPollingHandle.waitAsync().then((function(){return Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncBlockingEnrollCompleted),t._onEnrollCompleted({succeeded:!0,isBlocking:!0,isAppSourceTrial:e}),t._enrollPropertiesManager.userHasActivePlan}),(function(n){if(Core.Utility.isCanceledError(n))throw Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncBlockingEnrollCanceled),n;var r={isBlocking:!0,isAppSourceTrial:e};return Core.Log.error("UserService._handleUncachedUserAsync",n,JSON.stringify(r)),Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceEnrollCoreAsyncBlockingEnrollFailed),t._enrollPropertiesManager.setPropertiesToUnblock(),t._onEnrollCompleted({succeeded:!1,isBlocking:!0,isAppSourceTrial:e}),t._enrollPropertiesManager.userHasActivePlan}))},t.prototype._enrollPollingFnAsync=function(e,t,n){return this._enrollAsync(t,n).then((function(){return{retryAttempts:0,succeeded:!0}}),(function(t){return Core.PromiseUtils.throwIfCanceled(t),{retryAttempts:--e,succeeded:!1}}))},t.prototype._enrollPollingRecursorFn=function(e){if(e.succeeded)return Core.PromiseUtils.Recursor.createTailEnd();if(e.retryAttempts>0)return Core.PromiseUtils.Recursor.createNext(e.retryAttempts);throw new Core.ApplicationError("Maximum number of retries to enroll user has been reached.")},t.prototype._enrollAsync=function(e,t){var n=this;return this._callEnrollAsync(e,t).then((function(t){return n._saveEnrollResponseValues(t,e),n._enrollPropertiesManager.userHasActivePlan}))},t.prototype._pollCheckPlansAsync=function(){var e=this;if(Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServicePollCheckPlansAsyncStarted),this._checkPlansPollingHandle)return Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServicePollCheckPlansAsyncActivity,{message:"Existing polling handle returned."}),this._checkPlansPollingHandle.waitAsync().then(Core.Utility.noOpFn);return this._checkPlansPollingHandle=new Core.PromiseUtils.PollingHandle("UserService._checkPlansPollingHandle",(function(){return e._checkPlansPollingFnAsync()}),(function(e){return e?Core.PromiseUtils.Recursor.createTailEnd():Core.PromiseUtils.Recursor.createNext(null)}),3e4),this._checkPlansPollingHandle.start(null),this._checkPlansPollingHandle.waitAsync().then((function(e){Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServicePollCheckPlansAsyncCompleted,{hasActivePlan:e})}),(function(e){if(Core.Utility.isCanceledError(e))throw Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServicePollCheckPlansAsyncCanceled),e;Core.Log.error("UserService._pollCheckPlansAsync",e),Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServicePollCheckPlansAsyncFailed)}))},t.prototype._checkPlansPollingFnAsync=function(){var e=this,n=this._identityService.hasIdentity,i=this._enrollPropertiesManager.isWhiteListed;return n&&i?this._callCheckPlansAsync(this._identityService.identity.objectId).then((function(n){var i,o,s,a;n.value&&n.value.length>0?(e._planTelemetryLogger.logTelemetry("UserService._checkPlansPollingFnAsync",n.value),i=n.value,o=!0,s=t._hasPremiumPlan(n.value),a=t._getPremiumFeaturesPlans(n.value)):(i=[],o=!1,s=!1,a=t._generatePremiumFeaturesPlans(!1));var c={oid:e.userProfile.objectId,activeUserPlans:i,userHasActivePlan:o,userHasActivePremiumPlan:s,userHasExpiredPremiumPlan:e._enrollPropertiesManager.userHasExpiredPremiumPlan,premiumFeaturesActivePlans:a,premiumFeaturesExpiredPlans:e._enrollPropertiesManager.premiumFeaturesExpiredPlans};return e._enrollPropertiesManager.updatePlans(c,r.UserPlanSource.Server,!0),e._dispatchUserInfoUpdatedEvent(),e._enrollPropertiesManager.userHasActivePlan})).catch((function(n){Core.PromiseUtils.throwIfCanceled(n);var i={oid:e.userProfile.objectId,activeUserPlans:[],userHasActivePlan:!0,userHasActivePremiumPlan:!0,userHasExpiredPremiumPlan:!1,premiumFeaturesActivePlans:t._generatePremiumFeaturesPlans(!0),premiumFeaturesExpiredPlans:t._generatePremiumFeaturesPlans(!1)};return e._enrollPropertiesManager.updatePlans(i,r.UserPlanSource.ServerError,!1),e._dispatchUserInfoUpdatedEvent(),Core.Log.error("UserService._checkPlansPollingFnAsync",n),!0})):(Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceCheckPlansPollingFnAsyncEarlyReturn,{hasIdentity:n,isWhiteListed:i}),this._enrollPropertiesManager.resetProperties(!1),this._dispatchUserInfoUpdatedEvent(),Promise.resolve(!1))},t.prototype._callEnrollAsync=function(e,n){return __awaiter(this,void 0,Promise,(function(){var r,i,o,s,a=this;return __generator(this,(function(c){switch(c.label){case 0:return[4,this._tryGetEnrollmentFromPowerPlatformEmbedAsync()];case 1:return(r=c.sent())?[2,r]:((i=Core.Environment.usePowerPlatformApi()?AppMagic.PowerApps.PowerAppsUtility.createPowerAppsTenantUrlBuilder(this._identityService.identity.tenantId):AppMagic.PowerApps.PowerAppsUtility.createPowerAppsProviderUrlBuilder()).appendPath("enroll"),n&&i.setQueryParam(AppMagic.PowerApps.Constants.PowerAppEndpoints.actionQueryParam,AppMagic.PowerApps.Constants.PowerAppEndpoints.appSourceTrialQueryParamValue),i.setQueryParam(AppMagic.PowerApps.Constants.PowerAppEndpoints.blockingEnrollCallQueryParam,e?"true":"false"),i.setQueryParam(AppMagic.PowerApps.Constants.PowerAppEndpoints.apiVersionKey,Core.Environment.usePowerPlatformApi()?AppMagic.Services.Azure.Region.getCurrentRegion().powerPlatformRpApiVersion:AppMagic.Services.Azure.Region.getCurrentRegion().powerAppsApiVersion),(o=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.Accept]=AppMagic.Services.HttpConstants.MediaType.ApplicationJson,s={method:AppMagic.Services.HttpConstants.Method.POST,headers:o,url:i.toString()},AppMagic.Services.appendCustomHeadersOptions(s,{addCustomHeaders:!0}),[2,this._authenticateRequestAsync(s,!0).then((function(){return AppMagic.Services.PowerAppsHttpTelemetry.sendHttpAsync(a._httpClient,s,"Azure.EnrollUserInPowerApps")})).then((function(e){var n=t._parseJsonResponse(e),r=AppMagic.PowerApps.EnrollResponse.safeCast(n);if(null===r)throw new AppMagic.Services.SafeCastError("IEnrollResponse");return a._planTelemetryLogger.logTelemetry("UserService._callEnrollAsync.activeUserPlans",r.activeUserPlans),a._planTelemetryLogger.logTelemetry("UserService._callEnrollAsync.expiredUserPlans",r.expiredUserPlans),r}))])}}))}))},t.prototype._callCheckPlansAsync=function(e){var n=this,r=Core.Environment.usePowerPlatformApi()?AppMagic.PowerApps.PowerAppsUtility.createPowerAppsTenantUrlBuilder(this._identityService.identity.tenantId):AppMagic.PowerApps.PowerAppsUtility.createPowerAppsObjectUrlBuilder(e);r.appendPath(AppMagic.PowerApps.Constants.APIs.checkPlans);var i=AppMagic.PowerApps.PowerAppsUtility.getPowerAppsApiVersion();r.setQueryParam(AppMagic.PowerApps.Constants.PowerAppEndpoints.apiVersionKey,i);var o=HashTableUtility.create();o[AppMagic.Services.HttpConstants.HeaderName.Accept]=AppMagic.Services.HttpConstants.MediaType.ApplicationJson;var s={method:AppMagic.Services.HttpConstants.Method.POST,headers:o,url:r.toString()};return AppMagic.Services.appendCustomHeadersOptions(s,{addCustomHeaders:!0}),this._authenticateRequestAsync(s,!0).then((function(){return AppMagic.Services.PowerAppsHttpTelemetry.sendHttpAsync(n._httpClient,s,"Azure.CheckPlans")})).then((function(e){var n=t._parseJsonResponse(e),r=AppMagic.PowerApps.CheckPlansResponse.safeCast(n);if(null===r)throw new AppMagic.Services.SafeCastError("ICheckPlansResponse");return r}))},t.prototype.updatePlansAsync=function(e){return void 0===e&&(e=!1),__awaiter(this,void 0,Promise,(function(){var t,n,r=this;return __generator(this,(function(i){switch(i.label){case 0:return this._identityService.hasIdentity||Core.Telemetry.Log.trackActivityEvent("UserService.updatePlansAsync",{message:"Returning immediately due to no user being logged in."}),t="UserService.updatePlansAsync",Core.Telemetry.Log.trackActivityEvent(t,{message:"Plans call started.",forceRefresh:e}),e&&this._plansPromise&&(Core.Telemetry.Log.trackActivityEvent(t,{message:"Canceling existing plans promise due to requested forceRefresh."}),Core.PromiseUtils.abortPromise(this._plansPromise,this._plansAbortController),this._plansPromise=null,this._plansAbortController=null),this._plansPromise?(Core.Telemetry.Log.trackActivityEvent(t,{message:"Returning existing plans promise."}),[4,this._plansPromise]):[3,2];case 1:return[2,i.sent()];case 2:!e&&this._enrollPropertiesManager.loadPlansFromCache()&&(Core.Telemetry.Log.trackActivityEvent(t,{message:"Using plans found in cache."}),this.getOperationsExecutor().run("UserService.Plans",(function(){return r._updatePlansAsync(!1,!0).then(Core.Utility.noOpFn)}))),Core.Telemetry.Log.trackActivityEvent(t,{message:"New Plans call being made."}),i.label=3;case 3:return i.trys.push([3,5,,6]),this._plansAbortController=new AbortController,this._plansPromise=this._updatePlansAsync(e,!1),[4,this._plansPromise];case 4:return[2,i.sent()];case 5:if(n=i.sent(),Core.Utility.isCanceledError(n))throw Core.Telemetry.Log.trackActivityEvent(t,{message:"Plans call canceled."}),n;throw Core.Log.errorEx(t,{error:n,eventData:{forceRefresh:e}}),n;case 6:return[2]}}))}))},t.prototype._updatePlansAsync=function(e,n){return __awaiter(this,void 0,Promise,(function(){var i,o,s,a,c;return __generator(this,(function(p){switch(p.label){case 0:return[4,this._callPlansAsync(this._identityService.identity.objectId,e)];case 1:return i=p.sent(),this._planTelemetryLogger.logTelemetry("UserService._updatePlansAsync",i.value),o=[],s=[],i.value.forEach((function(e){e.properties.capabilityStatus===AppMagic.PowerApps.Constants.CapabilityStatus.Enabled?o.push(e):e.properties.capabilityStatus===AppMagic.PowerApps.Constants.CapabilityStatus.Expired&&s.push(e)})),a=o.length>0,c={oid:this.userProfile.objectId,activeUserPlans:o,userHasActivePlan:a,userHasActivePremiumPlan:t._hasPremiumPlan(o),userHasExpiredPremiumPlan:t._hasPremiumPlan(s),premiumFeaturesActivePlans:t._getPremiumFeaturesPlans(o),premiumFeaturesExpiredPlans:t._getPremiumFeaturesPlans(s)},n||this._enrollPropertiesManager.updatePlans(c,r.UserPlanSource.Server,!1),this._enrollPropertiesManager.updatePlansCache(c),this._dispatchUserInfoUpdatedEvent(),[2]}}))}))},t.prototype._callPlansAsync=function(e,n){return __awaiter(this,void 0,Promise,(function(){var r,i,o,s,a,c;return __generator(this,(function(p){switch(p.label){case 0:return(r=AppMagic.PowerApps.PowerAppsUtility.createPowerAppsObjectUrlBuilder(e)).appendPath(AppMagic.PowerApps.Constants.APIs.plans),r.setQueryParam(AppMagic.PowerApps.Constants.PowerAppEndpoints.apiVersionKey,AppMagic.Services.Azure.Region.getCurrentRegion().powerAppsApiVersion),n&&r.setQueryParam(AppMagic.PowerApps.Constants.PowerAppEndpoints.refreshCacheQueryParam,"true"),(i=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.Accept]=AppMagic.Services.HttpConstants.MediaType.ApplicationJson,o={method:AppMagic.Services.HttpConstants.Method.GET,headers:i,url:r.toString(),signal:this._plansAbortController},AppMagic.Services.appendCustomHeadersOptions(o,{addCustomHeaders:!0}),[4,this._authenticateRequestAsync(o)];case 1:return p.sent(),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpAsync(this._httpClient,o,"Azure.Plans")];case 2:if(s=p.sent(),a=t._parseJsonResponse(s),null===(c=AppMagic.PowerApps.PlansResponse.safeCast(a)))throw new AppMagic.Services.SafeCastError("IPlansResponse");return[2,c]}}))}))},t.prototype._saveEnrollResponseValues=function(e,n){var i={oid:this.userProfile.objectId,isWhiteListed:e.tenant.isTenantWhitelisted,activeUserPlans:e.activeUserPlans,userHasActivePlan:e.activeUserPlans&&e.activeUserPlans.length>0,userHasActivePremiumPlan:t._hasPremiumPlan(e.activeUserPlans),userHasExpiredPremiumPlan:t._hasPremiumPlan(e.expiredUserPlans),premiumFeaturesActivePlans:t._getPremiumFeaturesPlans(e.activeUserPlans),premiumFeaturesExpiredPlans:t._getPremiumFeaturesPlans(e.expiredUserPlans),showOptInConsentDialog:this._isUserConsentNeeded(e),userDefaultCountryLocation:this._getUserDefaultCountryLocation(e)};n&&this._enrollPropertiesManager.updateEnrollProperties(i,r.UserPlanSource.Server,!1),this._enrollPropertiesManager.updateEnrollPropertiesCache(i)},t.prototype.upgradeOrRenewPlanAsync=function(){var e=this;return this._callPostServicePlansAsync().then((function(n){e._planTelemetryLogger.logTelemetry("UserService.upgradeOrRenewPlanAsync",[n]),e._enrollPropertiesManager.activeUserPlans.push(n);var i={oid:e.userProfile.objectId,activeUserPlans:e._enrollPropertiesManager.activeUserPlans,userHasActivePlan:!0,userHasActivePremiumPlan:!0,userHasExpiredPremiumPlan:!1,premiumFeaturesActivePlans:t._generatePremiumFeaturesPlans(!0),premiumFeaturesExpiredPlans:t._generatePremiumFeaturesPlans(!1)};e._enrollPropertiesManager.updatePlans(i,r.UserPlanSource.Server,!0),e._dispatchUserInfoUpdatedEvent()}))},t.prototype.getUserProfileWithImageAsync=function(e){return void 0===e&&(e=!1),this._userProfileClient.getUserProfileWithImageAsync(e)},t.prototype.updateShowUserConsentDialogCacheValue=function(e){this._enrollPropertiesManager.updateShowUserConsentDialogCache(e)},t.prototype._callPostServicePlansAsync=function(){var e=this,t=AppMagic.PowerApps.BapUtility.createBapProviderUrlBuilder();t.appendPath("serviceplans"),t.setQueryParam(AppMagic.PowerApps.Constants.BapEndpoints.apiVersionKey,AppMagic.Services.Azure.Region.getCurrentRegion().bapApiVersion);var n=HashTableUtility.create();n[AppMagic.Services.HttpConstants.HeaderName.ContentType]=AppMagic.Services.HttpConstants.MediaType.ApplicationJson;var r={licenseId:AppMagic.PowerApps.Constants.PowerAppsP2TrialInternalGuid},i={method:AppMagic.Services.HttpConstants.Method.POST,headers:n,url:t.toString(),bodyData:JSON.stringify(r),signal:this._plansAbortController};return AppMagic.Services.addTelemetryOptions(i,{operationName:"Azure.Bap.PostServicePlans"}),AppMagic.Services.appendCustomHeadersOptions(i,{addCustomHeaders:!0}),this._authenticateRequestAsync(i).then((function(){return e._httpClient.sendHttpJsonResponseAsync(i)})).then((function(e){var t=AppMagic.PowerApps.EnrollResponsePlanDetails.safeCast(e);if(null===t)throw new AppMagic.Services.SafeCastError("IEnrollResponsePlanDetails");return t}))},t.prototype.getTenantSettingsAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n,r,i,o=this;return __generator(this,(function(s){switch(s.label){case 0:(e=AppMagic.PowerApps.BapUtility.createBapProviderUrlBuilder()).appendPath("listTenantSettings"),e.setQueryParam(AppMagic.PowerApps.Constants.BapEndpoints.apiVersionKey,AppMagic.Services.Azure.Region.getCurrentRegion().bapApiVersion),(t=HashTableUtility.create())[AppMagic.Services.HttpConstants.HeaderName.ContentType]=AppMagic.Services.HttpConstants.MediaType.ApplicationJson,n={method:AppMagic.Services.HttpConstants.Method.POST,headers:t,url:e.toString()},AppMagic.Services.addTelemetryOptions(n,{operationName:"Azure.Bap.ListTenantSettings"}),AppMagic.Services.appendCustomHeadersOptions(n,{addCustomHeaders:!0}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,this._authenticateRequestAsync(n).then((function(){return o._httpClient.sendHttpJsonResponseAsync(n)})).then((function(e){return e}))];case 2:return r=s.sent(),[3,4];case 3:return i=s.sent(),Core.Log.error("UserService.getTenantSettingsAsync","Request failed. Error: ".concat(i.toString())),[3,4];case 4:return[2,r]}}))}))},t.prototype._isUserConsentNeeded=function(e){return!!e.enrollmentOptions&&"NotSpecified"===e.enrollmentOptions.powerApps.promotionalEmailOption},t.prototype._getUserDefaultCountryLocation=function(e){return e.graphTenantDetails?e.graphTenantDetails[0].countryLetterCode:null},t.prototype._onUserIdentityChangedAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n=this;return __generator(this,(function(r){switch(r.label){case 0:return this._userInstanceInitialLoadPromise||(this._userInstanceInitialLoadPromise=Core.PromiseUtils.createCompletablePromise()),this._identityService.hasIdentity?(Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceOnUserIdentityChangedAsyncActivity,{message:"User is logged in."}),this._userInstance=this._createUserInstanceFn(),this._userProfileChangeEvent.dispatch(this._userProfileClient.tryGetUserProfile()),this._options.skipLoadUserImage?Core.Telemetry.Log.trackActivityEvent("UserService._onUserIdentityChangedAsync",{message:"Skipping loading user image since WebPlayer."}):this._userProfileClient.getUserProfileWithImageAsync().then((function(e){return n._userProfileChangeEvent.dispatch(e)})),t=Promise.resolve(),Core.Telemetry.Log.addEventToAllScenarios(Core.Telemetry.EventMessage.IdentityChangedLogin),this._options.skipEnroll?Core.Telemetry.Log.trackActivityEvent("UserService._onUserIdentityChangedAsync",{message:"Skipping enrollAsync since WebPlayer."}):t=this.enrollAsync().then((function(){n._enrollPropertiesManager.userHasActivePlan||n._pollCheckPlansAsync().catch((function(e){Core.PromiseUtils.throwIfCanceled(e)}))})),this.trackAnonymous(t),[4,this._userInstance.loadAsync()]):(Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceOnUserIdentityChangedAsyncActivity,{message:"No user is logged in."}),e=void 0,e=this._userInstance?this._userInstance.unloadAsync().then((function(){return n._userInstance.dispose()})):Promise.resolve(),Core.Telemetry.Log.addEventToAllScenarios(Core.Telemetry.EventMessage.IdentityChangedLogout),[2,e.then((function(){n._userInstance=null,n._userProfileClient.unload(),n._resetEnrollProperties(),n._userProfileChangeEvent.dispatch(n._userProfileClient.tryGetUserProfile()),n._dispatchUserInfoUpdatedEvent()}))]);case 1:return r.sent(),this._userInstanceLoadedEvent.dispatch(),this._userInstanceInitialLoadPromise.complete(),this._userInstanceInitialLoadPromise=null,[2]}}))}))},t.prototype._onEnrollCompleted=function(e){var t=Core.Utility.combineObjectProperties({succeeded:e.succeeded,isBlocking:e.isBlocking,isAppSourceTrial:e.isAppSourceTrial},this._getUserInfoTelemetryData());Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceOnEnrollCompleted,t),this._dispatchUserInfoUpdatedEvent()},t.prototype._authenticateRequestAsync=function(e,t){return void 0===t&&(t=!1),__awaiter(this,void 0,Promise,(function(){return __generator(this,(function(n){return Core.Environment.usePowerPlatformApi()&&t?AppMagic.Runtime.Client.addAuthorizationOptions(e.headers,{resource:AppMagic.Runtime.Client.ResourceNames.PowerPlatformService}):AppMagic.Runtime.Client.addAuthorizationOptions(e.headers,{resource:AppMagic.Runtime.Client.ResourceNames.PowerAppsService}),AppMagic.Services.appendCustomHeadersOptions(e,{optInMSHeaders:!0}),[2]}))}))},t.prototype._resetEnrollProperties=function(){this._enrollPollingHandle&&(this._enrollPollingHandle.cancel(),this._enrollPollingHandle=null),this._checkPlansPollingHandle&&(this._checkPlansPollingHandle.cancel(),this._checkPlansPollingHandle=null),this._plansPromise&&(Core.PromiseUtils.abortPromise(this._plansPromise,this._plansAbortController),this._plansPromise=null,this._plansAbortController=null),this._enrollPropertiesManager.resetProperties(!1),this._enrollPropertiesManager.clearCache(),Core.Telemetry.Log.trackActivityEvent("UserService._resetEnrollProperties",this._getUserInfoTelemetryData())},t.prototype._dispatchUserInfoUpdatedEvent=function(){Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userServiceDispatchUserInfoUpdatedEvent,this._getUserInfoTelemetryData()),this._userInfoUpdatedEvent.dispatch()},t.prototype._getUserInfoTelemetryData=function(){return{isWhiteListed:this._enrollPropertiesManager.isWhiteListed,showOptInConsentDialog:this._enrollPropertiesManager.showOptInConsentDialog,userDefaultCountryLocation:this._enrollPropertiesManager.userDefaultCountryLocation,userHasActivePlan:this._enrollPropertiesManager.userHasActivePlan,userHasActivePremiumPlan:this._enrollPropertiesManager.userHasActivePremiumPlan,userHasExpiredPremiumPlan:this._enrollPropertiesManager.userHasExpiredPremiumPlan,activeUserPlans:this._enrollPropertiesManager.activeUserPlans.map((function(e){return e.name||"<undefined>"}))}},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"UserFeature",(function(){return r})),n.d(t,"parse",(function(){return i}));var r=function(){function e(e,t,n,r){this._id=e,this._name=t,this._type=n,this._rawServerRepresentation=r}return Object.defineProperty(e.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cacheItemId",{get:function(){return this._id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype.serializeToJson=function(){return this._rawServerRepresentation},e.tryDeserialize=function(e){var t=AppMagic.PowerApps.UserFeatureResponse.safeCast(e);return t?i(t):null},e}();function i(e){return new r(e.id,e.name,e.type,e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ChannelRegistrar",(function(){return r}));var r=function(){function e(e,t,n){this._settingsProvider=e,this._httpClient=t,this._powerAppsRegistrar=new AppMagic.Services.RemoteNotification.PowerAppsChannelRegistrar(this._httpClient,n),this._playerType=this._settingsProvider.getValue("playerType")}return e.prototype.notifyRegistrationAsync=function(e,t,n){var r=this._getPushNotificationIdentity(e,n);return null===r?Promise.resolve(!1):t?this._notifyNewSetupAsync(r,null):this._notifyRenewalAsync(r)},e.prototype.notifyUnregisterAsync=function(e){var t=this;return Core.Log.verbose("Starting notifying unregistration."),this._loadNotificationIdentityAsync().then((function(e){if(null===e)return!1;var n=t._createPowerAppsUnregisterRequest(e);return t._powerAppsRegistrar.unregisterDeviceAsync(n)}))},e.prototype._getPushNotificationIdentity=function(e,t){return Core.Utility.isNonEmptyString(e.registrationId)?this._createPushNotificationIdentity(t.objectId,e.registrationId):(Core.Log.error("ChannelRegistrar._getPushNotificationIdentity","RegistrationInfo is invalid."),null)},e.prototype._createPushNotificationIdentity=function(e,t){return{objectId:e,pushNotificationIdentity:t,timeStamp:Date.now()}},e.prototype._notifyNewSetupAsync=function(e,t){var n=this;Core.Log.verbose("Starting notifying a new notification setup.");var r=null;return null===t?this._loadNotificationIdentityAsync().then((function(t){return t&&t.pushNotificationIdentity!==e.pushNotificationIdentity&&(r=t.pushNotificationIdentity),n._saveNotificationIdentityAsync(e).then((function(t){if(!t)return!1;var i=n._createPowerAppsRegistrationRequest(e,r);return n._powerAppsRegistrar.registerDeviceAsync(i).then((function(e){return e||n._deleteNotificationIdentityAsync().then((function(){return e}))}))}))})):(t.pushNotificationIdentity!==e.pushNotificationIdentity&&(r=t.pushNotificationIdentity),this._saveNotificationIdentityAsync(e).then((function(t){if(!t)return!1;var i=n._createPowerAppsRegistrationRequest(e,r);return n._powerAppsRegistrar.registerDeviceAsync(i).then((function(e){return e||n._deleteNotificationIdentityAsync().then((function(){return e}))}))})))},e.prototype._notifyRenewalAsync=function(t){var n=this;return Core.Log.verbose("Starting notifyRenewalAsync."),this._loadNotificationIdentityAsync().then((function(r){return e._isCurrentNotificationIdentityValid(r,t)?(Core.Log.verbose("If notification identity hasn't change, we don't make a call to PowerApps since the already have the latest."),!0):(Core.Log.verbose("Push Notification Service identity is changed, starting newSetupAsync."),n._notifyNewSetupAsync(t,r))}))},e._isCurrentNotificationIdentityValid=function(t,n){return e._areEqual(t,n)&&t.timeStamp+e.MillisecondsIn24Hours>n.timeStamp},e.prototype._saveNotificationIdentityAsync=function(t){return Core.Log.verbose("Start saving notification identity."),this._settingsProvider.setValue(e.RegistrationIdKey,t),this._settingsProvider.save()},e.prototype._deleteNotificationIdentityAsync=function(){var t=this;return Core.Log.verbose("removing notification identity."),this._settingsProvider.load().then((function(n){return n?(t._settingsProvider.setValue(e.RegistrationIdKey,null),t._settingsProvider.save()):(Core.Log.error("ChannelRegistrar._deleteNotificationIdentityAsync","Loading settingProvider failed."),!1)}))},e.prototype._loadNotificationIdentityAsync=function(){var t=this;return Core.Log.verbose("Start loading notification identity."),this._settingsProvider.load().then((function(n){return n?t._settingsProvider.getValue(e.RegistrationIdKey):(Core.Log.verbose("Loading setting provider failed."),null)}))},e._areEqual=function(e,t){return null===e?null===t:null!==t&&(e.objectId===t.objectId&&e.pushNotificationIdentity===t.pushNotificationIdentity)},e.RegistrationIdKey="NotificationRegistrationId",e.MillisecondsIn24Hours=864e5,e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"CdsLanguageProvisionHelper",(function(){return r}));var r=function(){function e(){}return e.checkEnvironmentSupportsProvisionLanguage=function(e,t){return!(!Core.Utility.isString(e)||!Core.Utility.isString(t))&&(Core.Utility.compareSemanticVersions(e,"9.1.0.24007")>=0&&"Teams"==t)},e.provisionLanguageForUserInCdsLiteAsync=function(t,n,r){return __awaiter(this,void 0,Promise,(function(){var i,o,s,a,c,p,u;return __generator(this,(function(l){switch(l.label){case 0:i="ProvisionLanguageForUser",o="00000000-0000-0000-0000-000000000000",l.label=1;case 1:return l.trys.push([1,3,,4]),s=e._langageIdToLcid(r),(a=new Core.UrlBuilder(n)).appendPath("api/data"),a.appendPath(AppMagic.PowerApps.Constants.CdsDefaultWebApiVersion),a.appendPath(i),(c=HashTableUtility.create())["Content-Type"]="application/json",p={url:a.toString(),method:AppMagic.Services.HttpConstants.Method.POST,headers:c,bodyData:JSON.stringify({Lcid:s.toString(),UserId:o})},AppMagic.Runtime.Client.addAuthorizationOptions(p.headers,{resource:n,isDynamicResource:!0}),AppMagic.Services.appendCustomHeadersOptions(p,{optInMSHeaders:!0}),Core.Telemetry.Log.trackActivityEvent("CdsLanguageProvisionHelper.provisionLanguageForUserInCdsLite",{message:"Provisioning language for user",lcid:s}),[4,t.sendHttpJsonResponseAsync(p)];case 2:return l.sent(),[3,4];case 3:return u=l.sent(),Core.Log.errorEx("CdsLanguageProvisionHelper.provisionLanguageForUserInCdsLiteAsync",{message:"Failed to set user language in CDS",error:u}),[3,4];case 4:return[2]}}))}))},e._langageIdToLcid=function(e){var t={"GL-ES":1110,"HI-IN":1081,"KK-KZ":1087,"SV-SE":1053,"ES-CO":9226,"SR-LATN-BA":6170,FA:41,"IT-CH":2064,"FR-CH":4108,"TRP-IN":4096,"FI-SE":4096,"UK-UA":1058,"DE-LU":4103,"HR-BA":4122,"FR-IT":15372,"FR-BE":2060,"TR-GR":4096,"TE-IN":1098,"BN-IN":1093,"ES-AR":11274,"HE-IL":1037,"AR-BH":15361,"AR-SA":1025,"UK-PL":4096,"IT-HR":4096,"PL-DE":4096,"EN-GB":2057,"FR-IN":15372,"EN-AU":3081,"SK-SK":1051,"EN-AE":4096,"ID-ID":1057,"EL-GR":1032,"ZH-HK":3076,"SR-LATN-CS":2074,"DA-DK":1030,"RU-EE":4096,"RO-RS":4096,"RU-LT":4096,"IT-RO":4096,"BG-BG":1026,"DE-SI":4096,MS:62,"HU-RS":4096,"DE-RO":4096,"ES-ES_TRADNL":1034,"LUS-IN":4096,"DE-BE":4096,"AR-EG":3073,"SK-RS":4096,"EN-MY":17417,"FR-LU":5132,"DE-DE":1031,"IT-IT":1040,"TR-BG":4096,"CS-CZ":1029,"AR-QA":16385,"EN-US":1033,"MAI-IN":4096,"AR-AE":14337,"NL-BE":2067,"KU-TR":4096,"RU-US":4096,"FR-HT":15372,"ET-EE":1061,"PT-PT":2070,"NN-NO":2068,"MR-IN":1102,"ZH-CN":2052,"SL-SI":1060,"CA-ES":1027,"EU-ES":1069,"ES-PR":20490,"DE-DK":4096,"MS-MY":1086,"SR-LATN-RS":9242,"BS-LATN-BA":5146,"TH-TH":1054,"ES-CR":5130,"DE-PL":4096,"ES-ES":3082,"RU-IL":4096,"OR-IN":1096,"ES-PE":10250,"AR-KW":13313,"ZH-SG":4100,"KO-KR":1042,"NE-IN":2145,"RU-LV":4096,"AF-ZA":1078,"RO-RO":1048,"EN-NZ":5129,"KOK-IN":1111,MT:1082,"HR-RS":4096,"UR-IN":2080,"ES-CL":13322,"PT-FR":4096,"NL-NL":1043,CY:1106,"EN-SG":18441,"HR-HR":1050,"EN-HK":15369,"ES-US":21514,"BRX-IN":4096,"HT-HT":4096,"BE-PL":4096,"SAT-IN":4096,"LT-LT":1063,"BG-RS":4096,"EN-PR":4096,"DE-CZ":4096,"PA-IN":1094,"SV-FI":2077,"EN-IE":6153,"ES-VE":8202,"DE-SK":4096,"BE-BY":1059,"FR-FR":1036,"AR-IL":4096,"KN-IN":1099,"PT-BR":1046,"ES-PH":4096,"SR-CYRL-RS":10266,"DE-HU":4096,"MWW-VN":4096,"RU-UA":4096,"FI-RU":4096,"SL-IT":4096,"EN-PH":13321,"ES-MX":2058,"FR-CA":3084,"AR-OM":8193,"RU-RU":1049,"EN-CA":4105,"LV-LV":1062,"HU-HU":1038,"FI-FI":1035,"EN-ZA":7177,"TA-IN":1097,"EL-CY":4096,"NB-NO":1044,"ES-UY":14346,"AR-IN":1101,"PL-PL":1045,"RU-BY":4096,"KHA-IN":4096,"EN-IN":16393,"ML-IN":1100,"ZH-TW":1028,"SL-AT":4096,"DE-IT":4096,"KS-IN":1120,"SR-CYRL-BA":7194,"ZH-MY":4096,"TR-RO":4096,"JA-JP":1041,"TR-TR":1055,"VI-VN":1066,"GU-IN":1095,"DE-AT":3079,"IT-FR":4096,"BS-CYRL-BA":8218,"SR-CYRL-CS":3098,"DE-CH":2055,"MNI-IN":4096,"DA-DE":4096,"TR-CY":4096}[e.toUpperCase()];if(Core.Utility.isUndefined(t))throw Error("No mapping found for ".concat(e));return t},e}()},function(e,t,n){"use strict";var r;function i(e){return e.givenName&&!Core.Utility.isEmptyString(e.givenName)?e.surname&&!Core.Utility.isEmptyString(e.surname)?e.givenName+" "+e.surname:e.givenName:e.surname&&!Core.Utility.isEmptyString(e.surname)?e.surname:""}n.r(t),n.d(t,"GraphResourcePath",(function(){return r})),n.d(t,"getUserFullNameFromGraphUser",(function(){return i})),n.d(t,"UserProfileClient",(function(){return o})),function(e){e.currentUserDetails="v1.0/me",e.currentUserProfilePicture="v1.0/me/photo/$value"}(r||(r={}));var o=function(){function e(e,t){this._userProfile=null,this._httpClient=e,this._identityService=t}return e.prototype.tryGetUserProfile=function(){if(!this._userProfile&&this._identityService.hasIdentity){var e=this._identityService.identity;this._userProfile={fullName:e.fullName,email:e.email,imageUrl:AppMagic.Runtime.Client.Constants.SampleUserProfile.imageUrl,isGuest:e.isGuest,isPersonalAccount:e.isPersonalAccount,tenantId:e.tenantId,objectId:e.objectId}}return this._userProfile},e.prototype.getUserProfileWithImageAsync=function(e){return void 0===e&&(e=!1),e?Promise.resolve(this._userProfile):(this._getProfileDataFromGraphPromise||(this._getProfileImageAbortController=new AbortController,this._getProfileDataFromGraphPromise=this._getProfileDataFromGraphAsync()),this._getProfileDataFromGraphPromise)},e.prototype._getProfileDataFromGraphAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,Core.PromiseUtils.join([this._tryGetProfileDataAsync(),this._tryGetProfilePhotoDataAsync()])];case 1:return e.sent(),[2,this._userProfile]}}))}))},e.prototype._tryGetProfileDataAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n;return __generator(this,(function(r){switch(r.label){case 0:r.label=1;case 1:return r.trys.push([1,3,,4]),[4,this._getProfileDataAsync()];case 2:return(e=r.sent())&&(t=i(e))&&(this._userProfile.fullName=t),[3,4];case 3:return n=r.sent(),this._handleGraphError(n,"UserService._getProfileDataAsync",(function(){return!1})),[3,4];case 4:return[2]}}))}))},e.prototype._tryGetProfilePhotoDataAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this._getProfilePhotoDataUrlAsync()];case 2:return e=n.sent(),this._userProfile.imageUrl=e,[3,4];case 3:return t=n.sent(),this._handleGraphError(t,"UserService._getProfilePhotoDataUrlAsync",(function(e){return 404===e.response.status})),[3,4];case 4:return[2]}}))}))},e.prototype._handleGraphError=function(e,t,n){if(Core.Utility.isCanceledError(e))throw this._getProfileDataFromGraphPromise=null,this._getProfileImageAbortController=null,e;AppMagic.Services.errorHasHttpResponse(e)&&(401===e.response.status&&this._userProfile.isGuest||n(e))||Core.Log.errorEx(t,{error:e})},e.prototype._getProfileDataAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n;return __generator(this,(function(i){switch(i.label){case 0:return e=this._buildGraphRequest(r.currentUserDetails),AppMagic.Services.addTelemetryOptions(e,{operationName:"UserProfileClient.GetProfileDataAsync"}),[4,this._httpClient.sendHttpJsonResponseAsync(e)];case 1:if(t=i.sent(),!(n=AppMagic.PowerApps.GraphUser.safeCast(t)))throw new Error("There was an error parsing the graph user response");return[2,n]}}))}))},e.prototype._getProfilePhotoDataUrlAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n;return __generator(this,(function(i){switch(i.label){case 0:return e=this._buildGraphRequest(r.currentUserProfilePicture),AppMagic.Services.addTelemetryOptions(e,{operationName:"UserProfileClient.GetProfilePhotoDataUrl"}),[4,this._httpClient.sendHttpBlobResponseAsync(e)];case 1:return t=i.sent(),[4,Core.IO.Utility.Conversion.convertBlobToDataUriAsync(t)];case 2:return n=i.sent(),[2,n.toString()]}}))}))},e.prototype._buildGraphRequest=function(e){var t=HashTableUtility.create(),n=new Core.UrlBuilder(AppMagic.Services.Azure.Region.getCurrentRegion().microsoftGraphEndpoint);return n.appendPath(e),AppMagic.Runtime.Client.addAuthorizationOptions(t,{resource:AppMagic.Runtime.Client.ResourceNames.MicrosoftGraph}),{method:AppMagic.Services.HttpConstants.Method.GET,url:n.toString(),headers:t,signal:this._getProfileImageAbortController}},e.prototype.unload=function(){this._userProfile=null,this.dispose()},e.prototype.dispose=function(){this._getProfileDataFromGraphPromise&&(Core.PromiseUtils.abortPromise(this._getProfileDataFromGraphPromise,this._getProfileImageAbortController),this._getProfileDataFromGraphPromise=null,this._getProfileImageAbortController=null)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"UserPropertyConstants",(function(){return r})),n.d(t,"UserInstance",(function(){return g}));var r,i=n(3),o=n(25),s=n(49),a=n(2),c=n(0),p=n(50),u=n(18),l=n(31),d=n(9),h=n(32);!function(e){e.oid="oid",e.locale="locale",e.clientVersion="clientVersion",e.powerAppsApiVersion="powerAppsApiVersion",e.cacheMap="cacheMap",e.userPropertiesFileName="userProperties",e.cacheVersion="cacheVersion"}(r||(r={}));var g=function(e){function t(t,n,r,o,s,a){var p=e.call(this)||this;return p._httpClient=n,p._cacheSettingsProviderManager=r,p._brokerManager=o,p._featuresCacheSettings=s,p._promiseQueue=new Core.PromiseUtils.PromiseQueue("UserInstance"),p._initializeFirstEnvironmentInstancePromise=Core.PromiseUtils.createCompletablePromise(),p._userProperties={cacheVersion:i.Version,oid:t.objectId,locale:Core.Globalization.currentCulture().currentLocaleName,clientVersion:Core.Environment.Version.VERSION_NUMBER,powerAppsApiVersion:AppMagic.Services.Azure.Region.getCurrentRegion().powerAppsApiVersion},p._cacheManager=null,p._environmentInstance=null,p._isInitialized=!1,p._userIdentity=t,p._networkSettingsProvider=a,p._ecsHelper=Core.Loader.ObjectFactory.instance.getSingleton(c.ComponentKeys.EcsHelper),p}return __extends(t,e),Object.defineProperty(t.prototype,"operationsExecutor",{get:function(){return this._operationsExecutor||(this._operationsExecutor=u.OperationsExecutorFactory.getOperationsExecutor()),this._operationsExecutor},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"environmentService",{get:function(){return this._environmentService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userFeaturesManager",{get:function(){return this._userFeaturesManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userTenantsManager",{get:function(){return this._userTenantsManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appsManager",{get:function(){return this._appsManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"appResourceManager",{get:function(){return this._appResourceManager},enumerable:!1,configurable:!0}),t.prototype.tryGetEnvironmentInstance=function(){return this._environmentInstance},t.prototype.getEnvironmentInstanceAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return this._environmentInstance?[2,this._environmentInstance]:(this._environmentService.initializeEnvironment(),[4,this._initializeFirstEnvironmentInstancePromise.promise]);case 1:return[2,e.sent()]}}))}))},t.prototype.loadAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[4,this._validateAndLoadExistingCacheMapAsync()];case 1:return e=t.sent(),this._cacheManager=new a.CacheManager(this._cacheSettingsProviderManager,e,this._settingsProvider,this.operationsExecutor,this._networkSettingsProvider),Core.Environment.isWebAuthoring()||this._initializeUserFeaturesManager(),this._initializeEnvironmentService(),this._initializeAppManager(),this._initializeAppResourceManager(),Core.FeatureGates.playerUI.enableGuestUser&&this._initializeUserTenantManager(),this._isInitialized=!0,[2]}}))}))},t.prototype.unloadAsync=function(){var e=this;return this._cacheManager.unloadAsync().then((function(){return e._cacheSettingsProviderManager.unloadAsync(e._settingsProvider)})).then((function(){return e._promiseQueue.pushJob((function(){return e._cacheSettingsProviderManager.purgeCacheDataAsync(e._settingsProvider)}))})).then((function(){return e._settingsProvider=null})).catch((function(e){Core.PromiseUtils.throwIfCanceled(e),Core.Log.error("UserInstance.unloadAsync",e)}))},t.prototype.dispose=function(){this._environmentService.resetState(),this._environmentService=null,this._environmentInstance&&(this._environmentInstance.dispose(),this._environmentInstance=null),this._operationsExecutor.dispose(),this._operationsExecutor=null,this._userFeaturesManager&&(this._userFeaturesManager.dispose(),this._userFeaturesManager=null),this._userTenantsManager&&(this._userTenantsManager.dispose(),this._userTenantsManager=null,this._cacheManager.deleteCache(a.CacheType.Tenants)),this._cacheManager.deleteCache(a.CacheType.Features),this._cacheManager.deleteCache(a.CacheType.Environment),this._cacheManager.deleteCache(a.CacheType.MyApps),this._cacheManager.deleteCache(a.CacheType.OrgApps),this._cacheManager.deleteCache(a.CacheType.GlobalApps),this._appsManager.dispose(),this._cacheManager.dispose(),this._cacheManager=null,this._promiseQueue&&(this._promiseQueue.cancelAll(),this._promiseQueue=null),this._ecsHelper.dispose(),e.prototype.dispose.call(this),this._isInitialized=!1},t.prototype._validateAndLoadExistingCacheMapCoreAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n,o,s,a,c,p,u=this;return __generator(this,(function(l){switch(l.label){case 0:if(e=this._settingsProvider.getValue(r.cacheVersion),t=this._settingsProvider.getValue(r.oid),n=this._settingsProvider.getValue(r.locale),o=this._settingsProvider.getValue(r.clientVersion),s=this._settingsProvider.getValue(r.powerAppsApiVersion),!t)return a=HashTableUtility.create(),this._resetUserSettingsInSettingsProvider(a),[2,a];if(t!==this._userProperties.oid)throw new Error("User object id in the settings file does not match the current user object id. Value in file: ".concat(t));return i.isValidCacheVersion(e)&&0===i.compareCacheVersion(this._userProperties.cacheVersion,e)&&n===this._userProperties.locale&&s===this._userProperties.powerAppsApiVersion?[3,2]:(Core.Log.verbose("UserInstance._validateAndLoadExistingCacheMapAsync: User settings mismatch, deleting all the cache files."),c={currentUserSettings:JSON.stringify(this._userProperties),userSettingsFromFile:JSON.stringify({oid:t,locale:n,clientVersion:o,powerAppsApiVersion:s,cacheVersion:e})},Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.userInstanceUserSettingsMismatchDeleteCacheEvent,c),[4,this._promiseQueue.pushJob((function(){return u._cacheSettingsProviderManager.purgeCacheDataAsync(u._settingsProvider)}))]);case 1:return l.sent(),a=HashTableUtility.create(),this._resetUserSettingsInSettingsProvider(a),[2,a];case 2:return p=this._settingsProvider.getValue(r.cacheMap),a=this._parseCacheMapFromSettingsProvider(p),Core.Log.verbose("UserInstance._validateAndLoadExistingCacheMapAsync: cache map is loaded from settings for user."),[2,a]}}))}))},t.prototype._resetUserSettingsInSettingsProvider=function(e){this._settingsProvider.setValue(r.cacheVersion,this._userProperties.cacheVersion),this._settingsProvider.setValue(r.oid,this._userProperties.oid),this._settingsProvider.setValue(r.locale,this._userProperties.locale),this._settingsProvider.setValue(r.clientVersion,this._userProperties.clientVersion),this._settingsProvider.setValue(r.powerAppsApiVersion,this._userProperties.powerAppsApiVersion),this._settingsProvider.setValue(r.cacheMap,e)},t.prototype._parseCacheMapFromSettingsProvider=function(e){if(!Core.Utility.isJsonHashTable(e))throw new Error("Cache map in the settings provider is invalid");return HashTableUtility.forEach(e,(function(e,t){if(!(Core.Utility.isNonEmptyNonWhitespaceString(t)&&Core.Utility.isJsonObject(e)&&Core.Utility.isNonEmptyNonWhitespaceString(e.fileName)&&Core.Utility.isNumberOrNull(e.lastFetchTimestamp)))throw new Error("Cache map values in the settings provider are invalid")})),HashTableUtility.fromJsonObject(e)},t.prototype._validateAndLoadExistingCacheMapAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n=this;return __generator(this,(function(i){switch(i.label){case 0:this._settingsProvider=this._cacheSettingsProviderManager.generate(r.userPropertiesFileName,!0),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,this._cacheSettingsProviderManager.loadAsync(this._settingsProvider)];case 2:return i.sent(),[4,this._validateAndLoadExistingCacheMapCoreAsync()];case 3:return e=i.sent(),[3,6];case 4:return t=i.sent(),Core.Log.error("UserInstance._validateAndLoadExistingCacheMapAsync",t,"Failed to read root-level properties for user"),[4,this._promiseQueue.pushJob((function(){return n._cacheSettingsProviderManager.purgeCacheDataAsync(n._settingsProvider)}))];case 5:return i.sent(),e=HashTableUtility.create(),this._resetUserSettingsInSettingsProvider(e),[3,6];case 6:return[2,e]}}))}))},t.prototype._onEnvironmentChanged=function(e){var t,n;return __awaiter(this,void 0,Promise,(function(){var r,i;return __generator(this,(function(o){switch(o.label){case 0:return this._environmentInstance&&this._environmentInstance.dispose(),Core.Environment.isWebAuthoring()&&this._createOrUpdateUserFeaturesManager(e),[4,this._ecsHelper.setupFallbackSwitchesAsync({environmentId:e.name,objectId:null===(t=this._userIdentity)||void 0===t?void 0:t.objectId,tenantId:null===(n=this._userIdentity)||void 0===n?void 0:n.tenantId})];case 1:return o.sent(),[4,this._userFeaturesManager.isParseInstallConnectionObjectEnabled()];case 2:return r=o.sent(),[4,this._userFeaturesManager.isSkipTestConnectionEnabledAsync()];case 3:return i=o.sent(),this._environmentInstance=new p.EnvironmentInstance(e,this._cacheManager,this._brokerManager,this._httpClient,this._userIdentity,r,i),this._initializeFirstEnvironmentInstancePromise.complete(this._environmentInstance),Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.AuthoringTool.GlobalEventBroker.ShellEventBroker.singletonKey).publishEvent(AppMagic.AuthoringTool.GlobalEventBroker.EventBrokerId.Runtime_EnvironmentChanged,e),[2]}}))}))},t.prototype._initializeEnvironmentService=function(){var e=this,t=this._cacheManager.getCache(a.CacheType.Environment,(function(t){var n;return AppMagic.PowerApps.EnvironmentService.getEnvironmentsFromServerAsync(e._httpClient,t,null===(n=e._userIdentity)||void 0===n?void 0:n.tenantId)}),i.CacheSettings.EnvironmentCacheSettings),n=this._cacheManager.getCache(a.CacheType.CdsEnvironments,(function(){return AppMagic.PowerApps.EnvironmentService.getAllEnvironmentsFromBAPServerAsync(e._httpClient)}),i.CacheSettings.EnvironmentCacheSettings);this._environmentService=new AppMagic.PowerApps.EnvironmentService(this._userProperties.oid,t,Core.Loader.ObjectFactory.instance.getSingleton(c.ComponentKeys.SettingsProvider),n),this.trackAnonymous(this._environmentService.environmentChangedEvent.addListener((function(t){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._onEnvironmentChanged(t)];case 1:return[2,e.sent()]}}))}))})))},t.prototype._initializeUserFeaturesManager=function(){var e=this,t=this._cacheManager.getCache(a.CacheType.Features,(function(t){var n;return d.UserService.getUserFeaturesFromServerAsync(e._userProperties.oid,e._httpClient,t,null===(n=e._userIdentity)||void 0===n?void 0:n.tenantId)}),this._featuresCacheSettings);this._userFeaturesManager=new l.UserFeaturesManager(t)},t.prototype._createOrUpdateUserFeaturesManager=function(e){var t=this;this._cacheManager.deleteCache(a.CacheType.Features);var n=this._cacheManager.getCache(a.CacheType.Features,(function(n){return d.UserService.getUserEnvironmentFeaturesFromServerAsync(e.name,t._httpClient,n)}),this._featuresCacheSettings);this._userFeaturesManager=new l.UserFeaturesManager(n)},t.prototype._initializeUserTenantManager=function(){var e=this,t=this._cacheManager.getCache(a.CacheType.Tenants,(function(){return h.UserTenantsManager.getUserTenantsFromServerAsync(e._httpClient)}),AppMagic.Runtime.Client.Caching.CacheSettings.TenantInfoCacheSettings);this._userTenantsManager=new h.UserTenantsManager(t)},t.prototype._initializeAppResourceManager=function(){this._appResourceManager=new o.AppResourceManager(this._httpClient,this._cacheManager,this._networkSettingsProvider,this._userIdentity)},t.prototype._initializeAppManager=function(){var e=this,t=this._cacheManager.getCache(a.CacheType.MyApps,(function(t,n){return AppMagic.PowerApps.PowerAppsAppService.getAppsFromServerAsync(e._httpClient,AppMagic.PowerApps.GetAppsClassificationFilter.MyApps,!0,t,null==n?void 0:n.useUnifiedAppsEndpoint,e._userIdentity.tenantId)}),i.CacheSettings.MyAppsCacheSettings),n=this._cacheManager.getCache(a.CacheType.OrgApps,(function(t,n){return AppMagic.PowerApps.PowerAppsAppService.getAppsFromServerAsync(e._httpClient,AppMagic.PowerApps.GetAppsClassificationFilter.OrgGalleryApps,!0,t,null==n?void 0:n.useUnifiedAppsEndpoint,e._userIdentity.tenantId)}),i.CacheSettings.OrgAppsCacheSettings),r=this._cacheManager.getCache(a.CacheType.GlobalApps,(function(t){return AppMagic.PowerApps.PowerAppsAppService.getGlobalAppsFromServerAsync(e._httpClient,t,e._userIdentity.tenantId)}),i.CacheSettings.GlobalAppsCacheSettings),o=this._cacheManager.getCache(a.CacheType.ModelApps,(function(t){return AppMagic.PowerApps.PowerAppsAppService.getModelAppsFromServerAsync(e._httpClient)}),i.CacheSettings.ModelAppsCacheSettings),c=this._cacheManager.getTimedCache(a.CacheType.CuratedApps,i.CacheSettings.CuratedAppsCacheSettings),p=this._cacheManager.getTimedCache(a.CacheType.MyApps,i.CacheSettings.MyAppsTimedCacheSettings),u=this._cacheManager.getTimedCache(a.CacheType.OrgApps,i.CacheSettings.OrgAppsTimedCacheSettings);this._appsManager=new s.AppsManager(t,n,r,o,p,u,c)},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"tryGetTelemetryOptions",(function(){return o})),n.d(t,"getTelemetryAdditionalData",(function(){return s})),n.d(t,"TelemetrySendHttpPipeline",(function(){return c}));var r=n(1);function i(e,t){e.httpStatus=t.status,e.contentLength=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.ContentLength)||"",e.correlationRequestId=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.MsCorrelationRequestId)||"",e.serverRequestId=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.MsRequestId)||"",e.serverRoutingRequestId=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.MsRoutingRequestId)||"",e.responseContentTypeHeader=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.ContentType)||"",e.failureCauseHeader=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.MsFailureCause)||"",e.responseResponseType=t.responseType,e.responseBodyType=a(t.response),e.responseTextType=typeof t.responseText,e.errorTypeHeader=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.MsErrorType)||"",e.serverCodeRepoName=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.ServerCodeRepoName)||"";var n=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.MsDavExtendedError);n&&(e.msDavExtendedError=n);var r=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.SharePointRequestId);r&&(e.sharePointRequestId=r);var i=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.ExecRestrictionsValidatedVer);i&&(e.execRestrictionsValidatedVer=i);var o=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.WorkflowId);o&&(e.workflowId=o);var s=HashTableUtility.tryGetValueIgnoreCase(t.headers,AppMagic.Services.HttpConstants.HeaderName.WorkflowName);s&&(e.workflowName=s),t.batchCount&&(e.batchCount=t.batchCount,e.duration=t.batchCount>0?e.duration/t.batchCount:e.duration),t.performanceInformation&&(e.performance=JSON.stringify(t.performanceInformation)),t.proxyInfo&&(e.proxyCorrelationRequestId=HashTableUtility.tryGetValueIgnoreCase(t.proxyInfo.proxyHeaders,AppMagic.Services.HttpConstants.HeaderName.MsCorrelationRequestId)||""),t.throttleDuration&&(e.isThrottled=!0,e.throttleDuration=t.throttleDuration),t.requestRetryInfo&&(e.isRetried=!0,e.retryCount=t.requestRetryInfo.retryCount,e.retriedClientRequestIds=t.requestRetryInfo.retriedClientRequestIds)}function o(e){var t=e.headers&&e.headers[AppMagic.Services.HttpConstants.HeaderName.TelemetryOptions];if(t&&t.substr(0,AppMagic.Services.TelemetryScheme.length)===AppMagic.Services.TelemetryScheme){var n=Core.Utility.tryParseJson(t.substr(AppMagic.Services.TelemetrySchemeWithSpace.length));if(n)return AppMagic.Services.TelemetryOptions.safeCast(n)}return null}function s(e){var t=e.headers&&e.headers[AppMagic.Services.HttpConstants.HeaderName.TelemetryAdditionalData];if(t){var n=Core.Utility.tryParseJson(t);if(n)return n}return{}}function a(e){return Core.Utility.isValue(e)?Core.Utility.isPABinary(e)?"PABinary(sourceType=".concat(e.source.sourceType,",contentType=").concat(e.contentType,",size=").concat(e.size,")"):Core.Utility.isBlob(e)?"Blob(type=".concat(e.type||"",",size=").concat(e.size,")"):Core.Utility.isString(e)?"text":Core.Utility.isArrayBuffer(e)?"ArrayBuffer":"unknown":""}var c=function(){function e(e,t){this._resourceTimingProvider=t,this._sendHttpPipeline=e}return e.prototype.sendHttpAsync=function(e){var t;return __awaiter(this,void 0,Promise,(function(){var n,c,p,u,l,d,h,g,f,m,y,v,C,A,_,P;return __generator(this,(function(S){switch(S.label){case 0:n=Core.Telemetry.Utility.scrubSensitiveDataSafe(e.url),c=e.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId],p={url:n,httpMethod:e.method,duration:null,cancelled:!1,isRetried:!1,isThrottled:!1,clientRequestId:c,responseTypeRequested:e.responseType||AppMagic.Services.ResponseTypes.Text,requestAuthorizationHeaderLength:e.headers[AppMagic.Services.HttpConstants.HeaderName.Authorization]?e.headers[AppMagic.Services.HttpConstants.HeaderName.Authorization].length:0},e.bodyData&&(p.requestContentTypeHeader=e.headers[AppMagic.Services.HttpConstants.HeaderName.ContentType],p.requestBodyType=a(e.bodyData)),e.headers&&e.headers[AppMagic.Services.HttpConstants.HeaderName.SharedConnectionId]&&(p.sharedConnectionId=e.headers[AppMagic.Services.HttpConstants.HeaderName.SharedConnectionId]),u=o(e),delete e.headers[AppMagic.Services.HttpConstants.HeaderName.TelemetryOptions],l=u&&u.operationName||null,d=s(e),delete e.headers[AppMagic.Services.HttpConstants.HeaderName.TelemetryAdditionalData],Core.Utility.insertObjectProperties(p,d),this._resourceTimingProvider&&this._resourceTimingProvider.validateBuffer(),h=Core.Utility.generateNonDashedUUID(),Core.PerformanceTracker.enterScope(h),Core.PerformanceRecorder.instance.startPerfMarker("sendHttpAsyncAggregate,sendHttpAsync_".concat(h));try{Core.FallbackSwitch.isActivated("AppConnectivity.sqlIsOnPremiseInTelemetry")||(g=r.SendHttpUtility.tryGetApimConnectionName(e.url),f=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.PowerApps.IPowerAppsClientSingletonKey),g&&f&&(null==(m=f.getConnectionFromCache(g))?void 0:m.isOnPremise)&&(p.isOnPremise=m.isOnPremise))}catch(e){Core.Log.warningEx("TelemetrySendHttpPipeline.sendHttpAsync",e)}y=null,S.label=1;case 1:S.trys.push([1,6,,7]),S.label=2;case 2:return S.trys.push([2,,4,5]),[4,this._sendHttpPipeline.sendHttpAsync(e)];case 3:return v=S.sent(),[3,5];case 4:return Core.PerformanceRecorder.instance.endPerfMarker("sendHttpAsyncAggregate,sendHttpAsync_".concat(h)),C=Core.PerformanceTracker.exitScopeAndGetTimingData(h),p.duration=C.duration,p.wasSuspended=C.wasSuspended,this._resourceTimingProvider&&(A=null!==(t=null==v?void 0:v.batchUrl)&&void 0!==t?t:e.url,y=this._resourceTimingProvider.getPerformanceByUrl(A)),[7];case 5:return[3,7];case 6:if(_=S.sent(),p.succeeded=!1,"boolean"==typeof _.isOnline&&(p.isOnline=_.isOnline),"number"==typeof _.readyState&&(p.readyState=_.readyState),Core.Utility.isObject(_.retryTelemetry)&&Core.Utility.isNumber(_.retryTelemetry.retryCount)&&_.retryTelemetry.retryCount>0&&(p.isRetried=!0,p.retryCount=_.retryTelemetry.retryCount,p.retriedClientRequestIds=_.retryTelemetry.retriedClientRequestIds),Core.Utility.isCanceledError(_))throw p.cancelled=!0,Core.Telemetry.Log.trackHttpRequestEvent(l,p),_;throw AppMagic.Services.errorHasHttpResponse(_)&&(_.response.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]=c,_.response.duration=p.duration,y&&(_.response.performanceInformation=y),i(p,_.response)),P=Core.PromiseUtils.formatErrorMessage(_)||"-- No error message available --",p.errorMessage=Core.Telemetry.Utility.scrubSensitiveDataSafe(P),Core.Telemetry.Log.trackHttpRequestEvent(l,p),_;case 7:return v.duration=p.duration,y&&(v.performanceInformation=y),v.sendHttpPipelinePerf&&(v.sendHttpPipelinePerf.transferSize=null==y?void 0:y.transferSize,v.sendHttpPipelinePerf.clientRequestId=c),p.succeeded=!0,i(p,v),Core.Telemetry.Log.trackHttpRequestEvent(l,p),[2,v]}}))}))},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"LaunchAppService",(function(){return c}));var r,i,o=n(6),s=n(25),a=n(12);!function(e){e.launchAppCall="LaunchAppService.LaunchApp",e.draftLaunchAppCall="LaunchAppService.DraftLaunchApp",e.launchDraftAppCall="LaunchAppService.LaunchDraftApp"}(r||(r={})),function(e){e.UserConsent="consent",e.Environment="environment"}(i||(i={}));var c=function(){function e(){}return e.launchAppAsync=function(t,n,c,p,u){var l,d,h;return void 0===p&&(p=AppMagic.Runtime.Client.AppPackageType.PlayerPackage),void 0===u&&(u=!1),__awaiter(this,void 0,Promise,(function(){var p,g,f,m,y,v,C,A,_,P,S,b,I;return __generator(this,(function(w){switch(w.label){case 0:p=new AppMagic.Services.BodilessHttpRequestBuilder,g=e._powerAppsAppLaunchUrl(n),f=AppMagic.PowerApps.PowerAppsUtility.tryGetDocumentServerEndpointHeader(),m=null,f&&(p.addHeader(f.headerName,f.value),m={docServerEndPointHeaderName:f.headerName,docServerEndPointValue:f.value}),Core.Environment.isWebPlayer()||Core.Environment.isReactNativePlayer()?e._authorizeHttpBuilderWithApiVersion(p,AppMagic.Services.HttpConstants.Method.POST,g,u):AppMagic.PowerApps.PowerAppsUtility.authorizeHttpBuilder(p,AppMagic.Services.HttpConstants.Method.POST,g,AppMagic.Runtime.Client.ResourceNames.PowerAppsService),p.addQueryParameter(AppMagic.Services.ODataConstants.QueryOption.Expand,"".concat(i.UserConsent,",").concat(i.Environment)),c&&(y=c,Core.Utility.isNumber(y.sasKeyDebugDuration)&&y.sasKeyDebugDuration>=0&&p.addHeader(AppMagic.Services.HttpConstants.HeaderName.MsSasDuration,"".concat(y.sasKeyDebugDuration)),y.recordLastOpened&&p.addQueryParameter("record","true"),y.bypassRpCache&&p.addQueryParameter("bypass-cache","true"),y.lastKnownGoodPublishedVersion&&p.addQueryParameter("lastKnownGoodPublishedVersion","true"),p.addQueryParameter("_blocking",y.isBlocking?"true":"false")),w.label=1;case 1:return w.trys.push([1,3,,4]),v=p.generateSendHttpRequestParameters(),AppMagic.Services.appendCustomHeadersOptions(v,{addCustomHeaders:!0}),C=Core.Diagnostics.createErrorContext({protocol:"rest",operation:"LaunchApp",operationName:r.launchAppCall}),Core.Diagnostics.addHeaders(v.headers,C),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpJsonResponseAsync(t,v,r.launchAppCall,m)];case 2:return A=w.sent(),_=Object(o.parse)(A),P=null===(d=null===(l=null==_?void 0:_.appInfo)||void 0===l?void 0:l.environment)||void 0===d?void 0:d.properties,Core.Telemetry.Log.setEnvironmentSku(null==P?void 0:P.environmentSku),a.CdsLanguageProvisionHelper.checkEnvironmentSupportsProvisionLanguage(null===(h=null==P?void 0:P.linkedEnvironmentMetadata)||void 0===h?void 0:h.version,null==P?void 0:P.environmentSku)&&(S=P.linkedEnvironmentMetadata.instanceUrl,b=Core.Globalization.currentCulture().currentLocaleName,a.CdsLanguageProvisionHelper.provisionLanguageForUserInCdsLiteAsync(t,S,b)),_.cacheItemId=s.AppResourceManager.getAppIdCacheKey(n),[2,_];case 3:throw I=w.sent(),Core.PromiseUtils.throwIfCanceled(I),Core.Log.error("LaunchAppService.LaunchAppAsync",I),I;case 4:return[2]}}))}))},e.draftLaunchAppAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var i,s,a;return __generator(this,(function(c){switch(c.label){case 0:i={url:"".concat(n,"/draft/launchApp/").concat(t,"/"),method:AppMagic.Services.HttpConstants.Method.GET},AppMagic.Services.appendCustomHeadersOptions(i,{optInMSHeaders:!0}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpJsonResponseAsync(e,i,r.draftLaunchAppCall)];case 2:return s=c.sent(),[2,Object(o.parse)(s)];case 3:throw a=c.sent(),Core.PromiseUtils.throwIfCanceled(a),Core.Log.error("LaunchAppService.draftLaunchAppAsync",a),a;case 4:return[2]}}))}))},e._powerAppsAppLaunchUrl=function(e){var t,n="string"==typeof e?e.replace(Core.Utility.Constants.PowerAppIdPrefix,""):e.appLogicalName,r=AppMagic.PowerApps.PowerAppsUtility.tryGetPowerPlatformLaunchServiceUrl(n);return r?((t=new Core.UrlBuilder(r)).appendPath("launch"),t.toUrl()):((t="string"==typeof e?new Core.UrlBuilder(AppMagic.PowerApps.PowerAppsUtility.getPowerAppsAppUrl(AppMagic.PowerApps.PowerAppsUtility.parseAppNameFromAppId(e))):new Core.UrlBuilder(AppMagic.PowerApps.PowerAppsUtility.getUnifiedPowerAppsAppUrl(e.environmentId,e.appLogicalName))).appendPath("launchApp"),t.toUrl())},e.launchDraftAppAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var i,s,a,c;return __generator(this,(function(p){switch(p.label){case 0:return i=new AppMagic.Services.JsonHttpRequestBuilder,s="string"==typeof t?t.replace(Core.Utility.Constants.PowerAppIdPrefix,""):t.appLogicalName,this._authorizeHttpBuilderWithApiVersion(i,AppMagic.Services.HttpConstants.Method.POST,this._getLaunchServiceRootUrlPPAPI(s,"launchDraftApp").toUrl(),!1,"2",AppMagic.Runtime.Client.ResourceNames.PowerPlatformService),i.setJsonValue("",n),a=i.generateSendHttpRequestParameters(),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpJsonResponseAsync(e,a,r.launchDraftAppCall)];case 1:return c=p.sent(),[2,Object(o.parse)(c)]}}))}))},e._getLaunchServiceRootUrlPPAPI=function(e,t){var n=AppMagic.PowerApps.PowerAppsUtility.getPowerPlatformRpBaseUrl(),r=new Core.UrlBuilder(n);return r.appendPath("powerapps"),r.appendPath("apps"),r.appendPath(e),r.appendPath(t),r},e._authorizeHttpBuilderWithApiVersion=function(e,t,n,r,i,o){if(e.setBaseUrl(n),e.setMethod(t),o||(o=AppMagic.PowerApps.PowerAppsUtility.getPowerAppsResourceName()),AppMagic.Runtime.Client.addAuthorizationOptionsToBuilder(e,{resource:o}),AppMagic.Services.addCustomHeadersOptionsToBuilder(e,{optInMSHeaders:!0}),Core.Environment.getWebPlayerEmbedderOrigin()&&Core.Environment.getWebPlayerEmbedderOrigin().length>0&&e.addHeader(AppMagic.Services.HttpConstants.HeaderName.PowerAppsOrigin,Core.Environment.getWebPlayerEmbedderOrigin()),r){e.addQueryParameter("hint","trialsignup")}i||(i=Core.Environment.usePowerPlatformApi()?AppMagic.PowerApps.PowerAppsUtility.getPowerPlatformApiVersion():AppMagic.PowerApps.PowerAppsUtility.getApiVersion()),e.addQueryParameter(AppMagic.PowerApps.Constants.PowerAppEndpoints.apiVersionKey,i)},e}()},function(e,t,n){"use strict";(function(e){function n(e){return null!=e&&"function"==typeof e.then}function r(e){return null!=e&&"function"==typeof e.cancel}function i(e,n){if(!t.config.catchExceptions)return e();try{return e()}catch(e){return n(e)}}Object.defineProperty(t,"__esModule",{value:!0}),t.config={exceptionsToConsole:!0,catchExceptions:!0,traceEnabled:!1,exceptionHandler:void 0,unhandledErrorHandler:function(e){throw e}},t.fromThenable=function(e){var t=u();return e.then((function(e){t.resolve(e)}),(function(e){t.reject(e)})),t.promise().thenAsync((function(e){return e}))};var o,s=[],a=void 0!==e;function c(t){s.push(t),1===s.length&&(a?e(p):setTimeout(p,0))}function p(){var e=s;s=[];for(var t=0;t<e.length;t++)e[t]()}function u(){return new o.SyncTask}function l(e){return(new o.SyncTask).resolve(e).promise()}function d(e){var t=u(),i=!1;return t.onCancel((function(t){e.forEach((function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)}))})),e.forEach((function(e){n(e)?e.then((function(e){i||(i=!0,t.resolve(e))}),(function(e){i||(i=!0,t.reject(e))})):i||(i=!0,t.resolve(e))})),t.promise()}t.asyncCallback=c,function(e){var o=function(){function e(){this._completedSuccess=!1,this._completedFail=!1,this._traceEnabled=!1,this._cancelCallbacks=[],this._wasCanceled=!1,this._wasExplicitlyCanceled=!1,this._resolving=!1,this._storedCallbackSets=[],this._mustHandleError=!0}return e.prototype._addCallbackSet=function(t,n){var r=this,i=new e;return i.onCancel((function(e){t.wasCanceled=!0,t.cancelContext=e,r._cancelInternal(e)})),t.task=i,this._storedCallbackSets.push(t),n?this._mustHandleError=!1:i._mustHandleError=!1,this._resolving||(this._completedSuccess?this._resolveSuccesses():this._completedFail&&this._resolveFailures()),i.promise()},e.prototype.onCancel=function(e){return this._completedSuccess||this._completedFail||(this._wasCanceled?e(this._cancelContext):this._cancelCallbacks.push(e)),this},e.prototype.then=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t},!0)},e.prototype.thenAsync=function(e,t){return this._addCallbackSet({successFunc:e,failFunc:t,asyncCallback:!0},!0)},e.prototype.catch=function(e){return this._addCallbackSet({failFunc:e},!0)},e.prototype.always=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!0)},e.prototype.setTracingEnabled=function(e){return this._traceEnabled=e,this},e.prototype.finally=function(e){return this._addCallbackSet({successFunc:e,failFunc:e},!1),this},e.prototype.done=function(e){return this._addCallbackSet({successFunc:e},!1),this},e.prototype.fail=function(e){return this._addCallbackSet({failFunc:e},!1),this},e.prototype.resolve=function(e){return this._checkState(!0),this._completedSuccess=!0,this._storedResolution=e,this._cancelCallbacks=[],this._resolveSuccesses(),this},e.prototype.reject=function(t){return this._checkState(!1),this._completedFail=!0,this._storedErrResolution=t,this._cancelCallbacks=[],this._resolveFailures(),e._enforceErrorHandled(this),this},e.prototype._checkState=function(e){if(this._completedSuccess||this._completedFail){this._completeStack&&console.error(this._completeStack.message,this._completeStack.stack);var n="Failed to "+(e?"resolve":"reject")+": the task is already "+(this._completedSuccess?"resolved":"rejected");throw new Error(n)}(t.config.traceEnabled||this._traceEnabled)&&(this._completeStack=new Error("resolve"))},e._enforceErrorHandled=function(n){n._mustHandleError&&(e._rejectedTasks.push(n),e._enforceErrorHandledTimer||(e._enforceErrorHandledTimer=setTimeout((function(){e._enforceErrorHandledTimer=void 0;var n=e._rejectedTasks;e._rejectedTasks=[],n.forEach((function(e,n){e._mustHandleError&&t.config.unhandledErrorHandler(e._storedErrResolution)}))}),0)))},e.prototype.cancel=function(e){if(this._wasExplicitlyCanceled)throw new Error("Already Canceled");this._wasExplicitlyCanceled=!0,this._cancelInternal(e)},e.prototype._cancelInternal=function(e){var t=this;if(!this._wasCanceled){this._wasCanceled=!0,this._cancelContext=e;var n=this._cancelCallbacks;this._cancelCallbacks=[],n.length>0&&n.forEach((function(e){t._completedSuccess||t._completedFail||e(t._cancelContext)}))}},e.cancelOtherInternal=function(e,t){var n=e;n._storedCallbackSets&&n._cancelInternal?n._cancelInternal(t):e.cancel(t)},e.prototype.promise=function(){return this},e.prototype._resolveSuccesses=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?c((function(){return e._resolveSuccessCallback(t)})):e._resolveSuccessCallback(t)}))}this._resolving=!1},e.prototype._resolveSuccessCallback=function(t){var o=this;t.successFunc?i((function(){var i=t.successFunc(o._storedResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(i,t)}))),n(i)?i.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(i)}),(function(e){o._handleException(e,"SyncTask caught exception in success block: "+e.toString()),t.task.reject(e)})):t.task.resolve(this._storedResolution)},e.prototype._resolveFailures=function(){var e=this;for(this._resolving=!0;this._storedCallbackSets.length;){var t=this._storedCallbackSets;this._storedCallbackSets=[],t.forEach((function(t){t.asyncCallback?c((function(){return e._resolveFailureCallback(t)})):e._resolveFailureCallback(t)}))}this._resolving=!1},e.prototype._resolveFailureCallback=function(t){var o=this;t.failFunc?i((function(){var i=t.failFunc(o._storedErrResolution);r(i)&&(t.wasCanceled?e.cancelOtherInternal(i,t.cancelContext):t.task.onCancel((function(t){return e.cancelOtherInternal(i,t)}))),n(i)?i.then((function(e){t.task.resolve(e)}),(function(e){t.task.reject(e)})):t.task.resolve(i)}),(function(e){o._handleException(e,"SyncTask caught exception in failure block: "+e.toString()),t.task.reject(e)})):t.task.reject(this._storedErrResolution)},e.prototype._handleException=function(e,n){t.config.exceptionsToConsole&&console.error(n),t.config.exceptionHandler&&t.config.exceptionHandler(e)},e.prototype.toEs6Promise=function(){var e=this;return new Promise((function(t,n){return e.then(t,n)}))},e._rejectedTasks=[],e}();e.SyncTask=o}(o||(o={})),t.all=function(e){if(0===e.length)return l([]);var t,i=u(),s=e.length,a=Array(e.length);i.onCancel((function(t){e.forEach((function(e){r(e)&&o.SyncTask.cancelOtherInternal(e,t)}))}));var c=function(){0==--s&&(void 0!==t?i.reject(t):i.resolve(a))};return e.forEach((function(e,r){n(e)?e.then((function(e){a[r]=e,c()}),(function(e){void 0===t&&(t=void 0===e||e),c()})):(a[r]=e,c())})),i.promise()},t.Defer=u,t.Resolved=l,t.Rejected=function(e){return(new o.SyncTask).reject(e).promise()},t.race=d,t.raceTimer=function(e,t){var n=u(),r=setTimeout((function(){n.resolve({timedOut:!0})}),t);return d([e.then((function(e){return clearTimeout(r),{timedOut:!1,result:e}})),n.promise()])}}).call(this,n(79).setImmediate)},function(e,t,n){"use strict";n.r(t),n.d(t,"OperationsExecutorFactory",(function(){return r})),n.d(t,"ImmediateOperationsExecutor",(function(){return i})),n.d(t,"PostAppOpenOperationsExecutor",(function(){return o}));var r=function(){function e(){}return e.getOperationsExecutor=function(){return Core.Environment.isWebPlayer()||Core.Environment.isWebPlayerAppHost()?new o:new i},e}(),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.run=function(e,t){Core.Telemetry.Log.trackActivityEvent("ImmediateOperationsExecutor.run",{name:e}),this.trackAnonymous(t())},t.prototype.registerAppOpenEvents=function(e,t,n){},t}(Core.Disposable),o=function(e){function t(t,n){void 0===t&&(t=1e3),void 0===n&&(n=1e3);var r=e.call(this)||this;return r._startupDelayMS=t,r._normalOperationStaggerDelayMS=n,r._currentAppLoadedEventListener=null,r._currentAppFailedEventListener=null,r._operationsReadyToRun=!1,r._criticalOperations=HashTableUtility.create(),r._normalOperations=HashTableUtility.create(),r}return __extends(t,e),t.prototype.run=function(e,t,n){void 0===n&&(n=AppMagic.Runtime.Client.OperationPriority.Normal),Core.Telemetry.Log.trackActivityEvent("PostAppOpenOperationsExecutor.run",{name:e,priority:AppMagic.Runtime.Client.OperationPriority[n]}),this._operationsReadyToRun?this.trackAnonymous(t()):n===AppMagic.Runtime.Client.OperationPriority.Critical?this._criticalOperations[e]=t:this._normalOperations[e]=t},t.prototype.registerAppOpenEvents=function(e,t,n){var r=this;Core.Telemetry.Log.trackActivityEvent("PostAppOpenOperationsExecutor.registerAppOpenEvents",{appId:e}),this._operationsReadyToRun=!1,this._currentAppLoadedEventListener=t.addListener((function(){return r._onAppOpened(e,!0)})),this._currentAppFailedEventListener=n.addListener((function(){return r._onAppOpened(e,!1)}))},t.prototype._onAppOpened=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,i=this;return __generator(this,(function(o){switch(o.label){case 0:return n=HashTableUtility.mapToArray(this._criticalOperations,(function(e,t){return t})),r=HashTableUtility.mapToArray(this._normalOperations,(function(e,t){return t})),Core.Telemetry.Log.trackActivityEvent("PostAppOpenOperationsExecutor._onAppOpened.Started",{appId:e,criticalOpNames:n,normalOpNames:r}),[4,Core.PromiseUtils.timeout(this._startupDelayMS)];case 1:return o.sent(),this._operationsReadyToRun=!0,HashTableUtility.forEach(this._criticalOperations,(function(n,r){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(i){switch(i.label){case 0:return Core.Telemetry.Log.trackActivityEvent("PostAppOpenOperationsExecutor._onAppOpened.CriticalOperation",{appId:e,name:r,appLoadSuccess:t}),[4,this.trackAnonymous(n())];case 1:return i.sent(),delete this._criticalOperations[r],[2]}}))}))})),[4,Core.PromiseUtils.reduceHashTableToChainAsync(this._normalOperations,(function(n,r){return __awaiter(i,void 0,void 0,(function(){return __generator(this,(function(i){switch(i.label){case 0:return Core.Telemetry.Log.trackActivityEvent("PostAppOpenOperationsExecutor._onAppOpened.NormalOperation",{appId:e,name:r,appLoadSuccess:t}),[4,this.trackAnonymous(n())];case 1:return i.sent(),delete this._normalOperations[r],[4,Core.PromiseUtils.timeout(this._normalOperationStaggerDelayMS)];case 2:return i.sent(),[2]}}))}))}))];case 2:return o.sent(),Core.Telemetry.Log.trackActivityEvent("PostAppOpenOperationsExecutor._onAppOpened.Completed",{appId:e}),this._cleanup(),[2]}}))}))},t.prototype.dispose=function(){this._cleanup(),e.prototype.dispose.call(this)},t.prototype._cleanup=function(){var e,t;null===(e=this._currentAppLoadedEventListener)||void 0===e||e.dispose(),null===(t=this._currentAppFailedEventListener)||void 0===t||t.dispose(),this._currentAppLoadedEventListener=null,this._currentAppFailedEventListener=null},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"AppPreloadData",(function(){return r}));var r=function(){function e(e){this._appPreloadData=e,this.cacheItemIdOverride=null}return Object.defineProperty(e.prototype,"contractVersion",{get:function(){return this._appPreloadData.contractVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cacheItemId",{get:function(){var e;return null!==(e=this.cacheItemIdOverride)&&void 0!==e?e:this._appPreloadData.id},set:function(e){this.cacheItemIdOverride=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this._appPreloadData.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appName",{get:function(){return this._appPreloadData.appName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appType",{get:function(){return this._appPreloadData.appType},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this._appPreloadData.displayName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"imageUrl",{get:function(){return this._appPreloadData.imageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundColor",{get:function(){return this._appPreloadData.backgroundColor},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"packageProperties",{get:function(){return this._appPreloadData.packageProperties},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appPackageResourcesKind",{get:function(){return this._appPreloadData.appPackageResourcesKind},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"unauthenticatedWebPackageUrl",{get:function(){return this._appPreloadData.unauthenticatedWebPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webPackageUrl",{get:function(){return this._appPreloadData.webPackageUrl},set:function(e){this._appPreloadData.webPackageUrl=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webReadOnlyPackageUrl",{get:function(){return this._appPreloadData.webReadOnlyPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerPackageUrl",{get:function(){return this._appPreloadData.playerPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"playerReadOnlyPackageUrl",{get:function(){return this._appPreloadData.playerReadOnlyPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"minimumRequiredApiVersion",{get:function(){return this._appPreloadData.minimumRequiredApiVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"environment",{get:function(){return this._appPreloadData.environment},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionReferences",{get:function(){return this._appPreloadData.connectionReferences},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"databaseReferences",{get:function(){return this._appPreloadData.databaseReferences},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"featuresRequirements",{get:function(){return this._appPreloadData.featuresRequirements},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastModifiedDate",{get:function(){return this._appPreloadData.lastModifiedDate},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"documentServerVersion",{get:function(){return this._appPreloadData.documentServerVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appVersion",{get:function(){return this._appPreloadData.appVersion},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appConnectionUsages",{get:function(){return this._appPreloadData.appConnectionUsages},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"authResources",{get:function(){return this._appPreloadData.authResources},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userConsents",{get:function(){return this._appPreloadData.userConsents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"deviceCapabilities",{get:function(){return this._appPreloadData.deviceCapabilities},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connectionIds",{get:function(){return this._appPreloadData.connectionIds},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"draftWebPackageUrl",{get:function(){return this._appPreloadData.draftWebPackageUrl},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appOverrides",{get:function(){return this._appPreloadData.appOverrides},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bypassConsent",{get:function(){return this._appPreloadData.bypassConsent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"appDocumentComplexity",{get:function(){return this._appPreloadData.appDocumentComplexity},enumerable:!1,configurable:!0}),e.prototype.serializeToJson=function(){var e=this._appPreloadData;return e.cacheItemIdOverride=this.cacheItemIdOverride,e},e.deserialize=function(t){var n=t;n.appConnectionUsages=HashTableUtility.create(n.appConnectionUsages),n.connectionReferences=HashTableUtility.create(n.connectionReferences),n.databaseReferences=HashTableUtility.create(n.databaseReferences);var r=new e(n);return r.cacheItemIdOverride=t.cacheItemIdOverride,r},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"UserTenant",(function(){return r})),n.d(t,"parseTenant",(function(){return i}));var r=function(){function e(e,t,n,r,i,o,s){this._tenantId=e,this._isHomeTenant=t,this._countryCode=n,this._displayName=r,this._defaultDomain=i,this._tenantType=o,this._rawServerRepresentation=s}return Object.defineProperty(e.prototype,"tenantId",{get:function(){return this._tenantId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isHomeTenant",{get:function(){return this._isHomeTenant},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"countryCode",{get:function(){return this._countryCode},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"displayName",{get:function(){return this._displayName},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cacheItemId",{get:function(){return this._tenantId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"defaultDomain",{get:function(){return this._defaultDomain},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"tenantType",{get:function(){return this._tenantType},enumerable:!1,configurable:!0}),e.prototype.serializeToJson=function(){return this._rawServerRepresentation},e.tryDeserialize=function(e){var t=AppMagic.Runtime.Client.Tenant.safeCast(e);return t?i(t):null},e}();function i(e){return new r(e.tenantId,e.isHomeTenant,e.countryCode,e.displayName,e.defaultDomain,e.tenantType,e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"AuthenticationSendHttpPipeline",(function(){return i})),n.d(t,"tryGetAuthorizationOptions",(function(){return o}));var r=n(1),i=function(){function e(e,t,n){this._authenticationManager=e,this._identityService=t,this._sendHttpPipeline=n}return e.prototype._beforeRequestAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,s,a,c,p;return __generator(this,(function(u){switch(u.label){case 0:if(!(t=e.headers&&HashTableUtility.tryGetValueIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.Authorization))||t.substr(0,AppMagic.Runtime.Client.AuthorizationScheme.length)!==AppMagic.Runtime.Client.AuthorizationScheme)return[2,e];if(delete e.headers[AppMagic.Services.HttpConstants.HeaderName.Authorization],!(n=o(t)))throw new Core.SendHttpError("Invalid authorizationOptionsValue. AuthorizationOptions: ".concat(t));if(!this._identityService.hasIdentity)throw new Core.SendHttpError("Invalid use of authorization pipeline. No user is logged in.");r={emailAddress:this._identityService.identity.email,objectId:this._identityService.identity.objectId},i=this._getProviderForResourceName(n),u.label=1;case 1:return u.trys.push([1,3,,13]),[4,i.authenticateSilentAsync(r)];case 2:return u.sent(),[3,13];case 3:if(s=u.sent(),Core.PromiseUtils.throwIfCanceled(s),this.shouldAttemptLogin(s)||(n.preventAuthPopUp=!0,Core.Telemetry.Log.trackActivityEvent("AuthenticationSendHttpPipeline._beforeRequestAsync",{message:"Preventing Auth Pop Up due to shouldInteractiveAuthOnRefreshTokenOnly"})),a={emailAddress:this._identityService.identity.email,objectId:this._identityService.identity.objectId},!0===n.preventAuthPopUp)throw Core.Log.error("AuthenticationSendHttpPipeline._beforeRequestAsync",s),new Core.SendHttpError("Authentication failed. No retry with popUp. Inner Exception: ".concat(Core.PromiseUtils.formatErrorMessage(s)));Core.Telemetry.Log.trackActivityEvent("AuthenticationSendHttpPipeline._beforeRequestAsync",{message:"Error trying to get a token silently, attempting login.",error:s}),u.label=4;case 4:return u.trys.push([4,7,,12]),[4,this._authenticationManager.logInProvider.authenticateAsync(a)];case 5:return u.sent(),[4,i.authenticateSilentAsync(r)];case 6:return u.sent(),[3,12];case 7:c=u.sent(),Core.PromiseUtils.throwIfCanceled(c),u.label=8;case 8:return u.trys.push([8,10,,11]),[4,i.authenticateAsync(a)];case 9:return u.sent(),[3,11];case 10:throw p=u.sent(),Core.PromiseUtils.throwIfCanceled(p),Core.Log.error("AuthenticationSendHttpPipeline._beforeRequestAsync",p),new Core.SendHttpError("Authentication with non-silent apis failed. Inner Exception: ".concat(Core.PromiseUtils.formatErrorMessage(p)),{rawError:p instanceof AppMagic.Services.Adal.AuthenticationError?p.rawError:p});case 11:return[3,12];case 12:return[3,13];case 13:if(this._identityService.isConnected||this._identityService.loadAsync().catch((function(e){Core.Log.error("AuthenticationSendHttpPipeline._beforeRequestAsync",e,"Error when loading identity service on reconnect.")})),AppMagic.Services.addTelemetryAdditionalData(e,{resourceUrl:n.resource,tokenExpiresOn:i.store.expiresOn?i.store.expiresOn.toString():"Null expiry time"}),n.sendAsBody){if(e.bodyData)throw new Core.SendHttpError("Body should be undefined if using sendAsBody configuration is set.");e.bodyData=JSON.stringify({accessToken:i.store.accessToken})}else e.headers[AppMagic.Services.HttpConstants.HeaderName.Authorization]="Bearer "+i.store.accessToken;return[2,e]}}))}))},e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,this._xhrWithReauthenticate(e,0)];case 1:return[2,t.sent()]}}))}))},e.prototype._xhrWithReauthenticate=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,i,s,a,c,p,u,l,d;return __generator(this,(function(h){switch(h.label){case 0:return n=3,i=r.SendHttpUtility.createRequestParamsWithClonedHeaders(e),s=e.headers&&HashTableUtility.tryGetValueIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.Authorization),[4,this._beforeRequestAsync(e)];case 1:return a=h.sent(),AppMagic.Services.addTelemetryAdditionalData(a,{reauthRetryCount:t,reauthIsLastTry:t>=n}),s?[3,3]:[4,this._sendHttpPipeline.sendHttpAsync(a)];case 2:return[2,h.sent()];case 3:return h.trys.push([3,5,,16]),[4,this._sendHttpPipeline.sendHttpAsync(a)];case 4:return[2,h.sent()];case 5:if(c=h.sent(),Core.PromiseUtils.throwIfCanceled(c),!(t<n))return[3,15];if(!(p=o(s)))throw c;return u=this._getProviderForResourceName(p),l=this._tryGetClaims(c),Core.Utility.isNullOrUndefined(u.store.accessToken)?t<1?(d={emailAddress:this._identityService.identity.email,objectId:this._identityService.identity.objectId,bypassCache:!0},[4,u.authenticateAsync(d)]):[3,8]:[3,9];case 6:return h.sent(),r.SendHttpUtility.updateClientRequestIdHeader(i),[4,this._xhrWithReauthenticate(i,++t)];case 7:return[2,h.sent()];case 8:throw Core.Log.errorEx("AuthenticationSendHttpPipeline._xhrWithReauthenticate","Invalid access token"),new Error("Invalid access token");case 9:return l?(d={emailAddress:this._identityService.identity.email,objectId:this._identityService.identity.objectId,claims:l},[4,u.authenticateAsync(d)]):[3,12];case 10:return h.sent(),r.SendHttpUtility.updateClientRequestIdHeader(i),[4,this._xhrWithReauthenticate(i,++t)];case 11:return[2,h.sent()];case 12:return AppMagic.Services.errorHasHttpResponse(c)&&c.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized&&u.store.fromCache?(d={emailAddress:this._identityService.identity.email,objectId:this._identityService.identity.objectId,bypassCache:!0},[4,u.authenticateAsync(d)]):[3,15];case 13:return h.sent(),r.SendHttpUtility.updateClientRequestIdHeader(i),[4,this._xhrWithReauthenticate(i,++t)];case 14:return[2,h.sent()];case 15:throw c;case 16:return[2]}}))}))},e.prototype._tryGetClaims=function(e){if(AppMagic.Services.errorHasHttpResponse(e)&&e.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.Forbidden){var t=AppMagic.Services.Adal.AuthenticationErrorResponse.tryParse(e.response.response);if(t&&"interaction_required"===t.error&&t.claims)return Core.Telemetry.Log.trackActivityEvent("AuthenticationSendHttpPipeline._tryGetClaims",{message:"authentication requested claims"}),t.claims}else if(AppMagic.Services.errorHasHttpResponse(e)&&e.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized){if(!e.response.headers[AppMagic.Services.HttpConstants.HeaderName.WwwAuthHeader])return null;var n=e.response.headers[AppMagic.Services.HttpConstants.HeaderName.WwwAuthHeader],r="Bearer ".length;if(n.startsWith("Bearer ")){var i=this._parseChallenges(n.substring(r)),o=null==i?void 0:i.authorizationUri,s=null==i?void 0:i.error;if(Core.Utility.equalsIgnoreCase(s,"insufficient_claims")){var a=null==i?void 0:i.claims;if(void 0!==a){var c=atob(a);return Core.Telemetry.Log.trackActivityEvent("AuthenticationSendHttpPipeline._tryGetClaims",{message:"www-authenticate returned with challenge",error:s,claims:c,authorizationUri:o}),c}Core.Telemetry.Log.trackWarningEvent("AuthenticationSendHttpPipeline._tryGetClaims",{message:"www-authenticate returned with challenge but containing undefined claims",error:s,challengeClaims:a,authorizationUri:o})}else Core.Telemetry.Log.trackActivityEvent("AuthenticationSendHttpPipeline._tryGetClaims",{message:"www-authenticate returned for other errors and it is not for claims challenge",error:s,authorizationUri:o})}}return null},e.prototype._parseChallenges=function(e){var t=e.indexOf(" "),n=e.substr(t+1).split(","),r={};return n.forEach((function(e){var t=e.split("="),n=t[0],i=t[1];r[n.trim()]=unescape(i.replace(/['"]+/g,"")).trim()})),r},e.prototype._getProviderForResourceName=function(e){var t=this._authenticationManager,n=e.resource;if(e.isDynamicResource)return t.getProviderForResourceUrl(n,!0);switch(n){case AppMagic.Runtime.Client.ResourceNames.AppService:return t.appServiceProvider;case AppMagic.Runtime.Client.ResourceNames.ConsentServer:return t.consentServerProvider;case AppMagic.Runtime.Client.ResourceNames.Flows:return t.flowsProvider;case AppMagic.Runtime.Client.ResourceNames.PowerAppsService:return t.powerAppsServiceProvider;case AppMagic.Runtime.Client.ResourceNames.PowerPlatformService:return t.powerPlatformServiceProvider;case AppMagic.Runtime.Client.ResourceNames.PowerBI:return t.powerBIServiceProvider;case AppMagic.Runtime.Client.ResourceNames.FormsPro:return t.formsProServiceProvider;case AppMagic.Runtime.Client.ResourceNames.MicrosoftStream:return t.microsoftStreamServiceProvider;case AppMagic.Runtime.Client.ResourceNames.RTSDataService:return t.rtsDataServiceProvider;case AppMagic.Runtime.Client.ResourceNames.MicrosoftGraph:return t.microsoftGraphProvider;default:throw new Core.SendHttpError("Invalid resource specified. Resource name: ".concat(n))}},e.prototype.shouldAttemptLogin=function(e){return Core.Environment.isReactNativePlayer()&&e instanceof AppMagic.Services.Adal.AuthenticationError&&e.requiresLogin()||Core.Environment.isWebPlayer()},e}();function o(e){var t=e.substr(AppMagic.Runtime.Client.AuthorizationSchemeWithSpace.length),n=Core.Utility.tryParseJson(t);return n?AppMagic.Runtime.Client.AuthorizationOptions.safeCast(n):null}},function(e,t,n){"use strict";n.r(t),n.d(t,"getInstance",(function(){return i})),n.d(t,"setInstance",(function(){return o}));var r=null;function i(){return r}function o(e){r=e}},function(e,t,n){"use strict";n.r(t),n.d(t,"setIsDisableInvokePatternEnabledForUnitTests",(function(){return c})),n.d(t,"InvokeSendHttpPipeline",(function(){return l}));var r=n(7),i=n(1),o=[{targetService:i.SendHttpUtility.TargetServices.apim,addExtraEncoding:!1,invokeUriPath:AppMagic.PowerApps.Constants.ApimInvokeUrlPath,originalMethodHeaderNameForInvokedPostRequest:AppMagic.PowerApps.Constants.ApimInvokeRequestMethodHeader,methodDefinition:{methodType:"header",headerName:AppMagic.PowerApps.Constants.ApimInvokeHeader}}];Core.Environment.usePowerPlatformApi()||o.unshift({targetService:i.SendHttpUtility.TargetServices.rp,addExtraEncoding:!0,invokeUriPath:AppMagic.Services.Azure.Region.getCurrentRegion().paRpInvokeUrl,methodDefinition:{methodType:"header",headerName:AppMagic.PowerApps.Constants.PowerAppsRpInvokeHeader}});var s=void 0;function a(){return void 0===s?(function(){__awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,Core.Loader.ObjectFactory.instance.getSingleton(r.IClientRuntimeSingletonKey).userService.userFeaturesManager.isDisableInvokePatternEnabledAsync()];case 1:return s=e.sent(),Core.Telemetry.Log.trackActivityEvent("InvokeSendHttpPipeline.isDisableInvokePatternEnabledAsync",{isDisableInvokePatternEnabled:s}),[2]}}))}))}(),!1):s}function c(e){s=e}function p(e,t,n){e.headers||(e.headers=HashTableUtility.create()),e.headers[t.headerName]=n}function u(e,t){e.headers||(e.headers=HashTableUtility.create()),e.headers[t]=e.method,e.method=AppMagic.Services.HttpConstants.Method.POST}var l=function(){function e(e){this._sendHttpPipeline=e}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return function(e){var t=i.SendHttpUtility.getTargetServiceFromUrl(e.url);if(t.serviceName){try{if(t.serviceName===i.SendHttpUtility.TargetServices.apim&&a())return}catch(e){Core.Log.warningEx("InvokeSendHttpPipeline.isDisableInvokePatternEnabledError",{error:e})}for(var n=t.split[0]+"//"+t.split[2],r=0,s=o.length;r<s;r++){var c=o[r];if(t.serviceName===c.targetService){var l=e.url.substring(n.length);if(c.addExtraEncoding&&(l=encodeURI(l)),c.originalMethodHeaderNameForInvokedPostRequest&&u(e,c.originalMethodHeaderNameForInvokedPostRequest),"header"!==c.methodDefinition.methodType)return;p(e,c.methodDefinition,l);var d=new Core.UrlBuilder(n);return d.appendPath(c.invokeUriPath),void(e.url=d.doneToString())}}}}(e),[4,this._sendHttpPipeline.sendHttpAsync(e)];case 1:return[2,t.sent()]}}))}))},e}()},function(e,t,n){"use strict";function r(e){var t=e.headers&&e.headers[AppMagic.Services.HttpConstants.HeaderName.ServiceErrorOptions];if(t){var n=Core.Utility.tryParseJson(t);if(n)return AppMagic.Services.ServiceErrorOptions.safeCast(n)}return null}n.r(t),n.d(t,"tryGetServiceErrorOptions",(function(){return r})),n.d(t,"ServiceErrorSendHttpPipeline",(function(){return i}));var i=function(){function e(e){this._sendHttpPipeline=e}return e.prototype.sendHttpAsync=function(e){var t=r(e);e.headers&&delete e.headers[AppMagic.Services.HttpConstants.HeaderName.ServiceErrorOptions];var n=AppMagic.Services.ServiceType.Other;if(t&&t.serviceType){var i=t.serviceType;AppMagic.Services.ServiceType.isValid(i)&&(n=i)}return this._sendHttpPipeline.sendHttpAsync(e).catch((function(e){throw Core.PromiseUtils.throwIfCanceled(e),AppMagic.Services.ServiceError.createServiceError(e,n)}))},e}()},function(e,t,n){"use strict";n.r(t);var r,i,o,s,a,c,p,u,l,d,h=n(19),g=n(75);!function(e){e.galleryIdKey="galleryId",e.versionKey="version",e.gallerySourceKey="gallerySource",e.instanceIdKey="instanceId"}(r||(r={})),function(e){e.sienaAppType="SienaApp",e.powerAppType="PowerApp"}(i||(i={})),function(e){e.getApiVersion=function(){return Object(g.isWebPlayer)()||Object(g.isReactNativePlayer)()||Object(g.isWebAuthoring)()?"2020-06-01":"2018-10-01"},e.getEnvironmentPermissionExpandQueryParam=function(e){return e>="2019-05-01"?"properties.permissions":"Permissions"},e.getCdmRpApiVersion=function(){return"2016-11-01"},e.getCuratedApiVersion=function(){return"2021-02-01"},e.powerPlatformApiVersion="1",e.powerPlatformSafePublishApiVersion="3",e.paRpInvokeUrl="api/invoke",e.appVersionKey="versionstring",e.providers="providers/Microsoft.PowerApps",e.generateTransientStorageValue="generateTransientStorage",e.generateResourceStorageValue="generateResourceStorage",e.apiVersionKey="api-version",e.objectIdsValue="objectIds",e.appsValue="apps",e.unifiedAppsValue="unifiedApps",e.sessions="sessions",e.displayName="displayName",e.updateDisplayName="updateDisplayName",e.validateAppDisplayName="validateAppDisplayName",e.versions="versions",e.globalAppsValue="globalApps",e.curatedAppsValue="curatedApps",e.entitiesFolderName="entities",e.listPackageValue="listPackage",e.roleAssignmentsValue="roleAssignments",e.noCacheKey="nc",e.retrieveConsentLinks="listLoginUris",e.listApplicationCategoriesValue="listApplicationCategories",e.appPermission="permissions",e.serverSession="initiateDocumentServerSession",e.refreshServerSession="refreshDocumentServerSession",e.tenantPrefix="tenant-",e.trialConsentPath="trial",e.redirectQueryParam="redirect",e.authoringRedirectQueryValue="authoring",e.playerRedirectQueryValue="player",e.blockingEnrollCallQueryParam="_blocking",e.actionQueryParam="action",e.appSourceTrialQueryParamValue="AppSourceTrial",e.pollQueryParam="_poll",e.refreshCacheQueryParam="refreshCache",e.environmentsValue="environments",e.instancesValue="instances",e.solutionsValue="solutions",e.componentsValue="components",e.organizationSettingsValue="organizationsettings",e.apiConsumptionInterval=3e5,e.checkPrivileges="checkPrivileges",e.excludeQueryParam="exclude",e.excludeSolutionFlowQueryParamValue="excludeSolutionCloudFlows",function(e){e.publishValue="publish",e.packageValue="package",e.setFavoriteValue="setFavorite",e.unsetFavoriteValue="unsetFavorite",e.clientMetadata="clientinfo/clientmetadata",e.acquireLeaseValue="acquireLease",e.releaseLeaseValue="releaseLease",e.healthCheck="healthcheck",e.portalHome="home",e.customBrandingAssets="customAssets/default",e.checkComponentUpdates="checkComponentUpdates",e.makeSolutionAware="makeSolutionAware",e.componentDependencies="componentDependencies",e.startSession="startSession",e.endSession="endSession",e.refreshSession="refreshSession",e.getSessions="sessions",e.getAppExtendedMetadata="getAppExtendedMetadata"}(e.UrlPaths||(e.UrlPaths={}))}(o||(o={})),function(e){e.author="",e.appVersion="1.0.0.0",e.sienaVersion="0000",e.publisherVersion="0.0.0",e.minimumRequiredApiVersion="0.0.0",e.backgroundImageUrl="https://sienatestappgallery.blob.core.windows.net/backgroundimagegallery/0f94216f-6b09-410e-a6c3-3f5a73aaccd6_1701458968_V1.0.1.png",e.backgroundColor="RGBA(0, 176, 240, 1)",e.blobDocumentName="document.msapp",e.blobPackageName="player.msappk",e.blobAssetsName="assets.zip",e.blobLogoSmallName="logoSmallFile",e.blobStableControlIdentityName="identity.json",e.blobWebPlayerRootFolder="web-player/",e.blobWebPlayerIndexFile="index.web.html",e.blobWebPlayerManifestFile="manifest.json",e.galleryItemSource="https://www.microsoft.com"}(s||(s={})),function(e){e.parametersKey="parameters",e.descriptionJsonPointer="/properties/description",e.documentUriJsonPointer="/properties/outputs/documentUri/value",e.playerPackageUriJsonPointer="/properties/outputs/playerPackageUri/value",e.wadlUrisJsonPointer="/properties/outputs/wadlUris/value"}(a||(a={})),function(e){e.backgroundColor="backgroundColor",e.displayName="displayName",e.publisher="publisher",e.sienaVersion="sienaVersion",e.publisherVersion="publisherVersion",e.minimumRequiredApiVersion="minimumRequiredApiVersion",e.deviceCapabilities="deviceCapabilities",e.hasComponent="hasComponent",e.hasUnlockedComponent="hasUnlockedComponent",e.isHidden="isHidden",e.isUnifiedRootApp="isUnifiedRootApp",e.templateId="templateId",e.optimizedForTeamsMeeting="optimizedForTeamsMeeting",e.coauthoringEnabled="coauthoringEnabled",e.imageUrl="imageUrl",e.originalImageUrl="originalImageUrl",e.supportsPortrait="supportsPortrait",e.supportsLandscape="supportsLandscape",e.primaryDeviceWidth="primaryDeviceWidth",e.primaryDeviceHeight="primaryDeviceHeight",e.primaryFormFactor="primaryFormFactor",e.localConnectionReferencesJSON="localConnectionReferencesJSON",e.sharePointSiteId="sp-site-id",e.sharePointListId="sp-list-id",e.iconSetting="iconSetting",e.backgroundFillSetting="backgroundFillSetting",e.offlineProfileId="offlineProfileId",e.offlineLargeFilesSupport="offlineLargeFilesSupport",e.showStatusBar="showStatusBar"}(c||(c={})),function(e){e.ChannelAvailability="ChannelAvailability",e.LaunchNativeExperience="LaunchNativeExperience"}(p||(p={})),function(e){e.defaultPackageFileName="player.msappk",e.defaultDocumentFileName="doc.msapp",e.defaultAssetsFileName="assets.zip",e.defaultLogoSmallFileName="powerAppLogoSmall"}(u||(u={})),function(e){e.docDownloadUrlKey="docDownloadUrl"}(l||(l={})),function(e){!function(e){e.gcmSenderId="233986630110"}(e.Prod||(e.Prod={})),function(e){e.gcmSenderId="845762260408"}(e.TestInProd1||(e.TestInProd1={})),function(e){e.gcmSenderId="845762260408"}(e.TestInProd2||(e.TestInProd2={})),function(e){e.gcmSenderId="845762260408"}(e.WebAuthTest||(e.WebAuthTest={})),function(e){e.gcmSenderId="233986630110"}(e.WebAuthProd||(e.WebAuthProd={})),e.registerDeviceApi="registerDeviceNotifications",e.registerDevicePowerPlatformApi="pushNotifications/register",e.unregisterDeviceApi="unregisterDeviceNotifications",e.unregisterDevicePowerPlatformApi="pushNotifications/unregister",e.sendTestNotification="sendTestNotification"}(d||(d={}));var f,m,y,v;!function(e){e.EnvironmentDisplayName="environment.DisplayName",e.UnpublishedAppDefinition="unpublishedAppDefinition",e.UserConsent="consent"}(f||(f={})),function(e){e.Metadata="metadata",e.Environment="environment"}(m||(m={})),function(e){e.SupportsMobileCapability="supportsMobileCapability eq 'true'",e.ClassificationFilterUnformatted="classification eq '{0}'"}(y||(y={})),function(e){e.ClassicCanvasApp="ClassicCanvasApp",e.AppComponentLibrary="AppComponentLibrary",e.CustomCanvasPage="CustomCanvasPage",e.UnifiedApp="UnifiedApp"}(v||(v={}));var C,A;v.ClassicCanvasApp,v.AppComponentLibrary,v.CustomCanvasPage,v.UnifiedApp;!function(e){e.CanvasApp="CanvasApp",e.AppModule="AppModule"}(C||(C={})),function(e){e.msFlowWorkflowName="workflowName",e.msWorkflowEntityId="workflowEntityId",e.msWorkflowDisplayName="workflowDisplayName"}(A||(A={}));var _;!function(e){e.checkPlans="checkPlans",e.plans="plans",e.features="features",e.tenants="tenants"}(_||(_={}));var P,S,b;!function(e){e.ConnectorMoreInfoDefaultLink="https://go.microsoft.com/fwlink/?linkid=851284"}(P||(P={})),function(e){e.SharepointFormApp="SharepointFormApp",e.TeamsApp="TeamsApp"}(S||(S={})),function(e){e.Enabled="Enabled",e.Expired="Expired"}(b||(b={}));var I,w;!function(e){e.Environment="Environment",e.Solution="Solution",e.NotSpecified="NotSpecified"}(I||(I={})),function(e){e.Read="providers/PowerPlatform.Governance/Operations/Read",e.Write="providers/PowerPlatform.Governance/Operations/Write",e.Delete="providers/PowerPlatform.Governance/Operations/Delete"}(w||(w={}));var T=n(2),M=n(3),R=n(0),E=n(16);function U(e){return Core.Utility.isString(e)?e.length>0:null!==e.environmentId&&0!==e.environmentId.length}n.d(t,"debugAppIdentifier",(function(){return U})),n.d(t,"AppResourceManager",(function(){return H}));var H=function(e){function t(t,n,r,i){var o=this;return(o=e.call(this)||this)._httpClient=t,o._cacheManager=n,o._networkSettingsProvider=r,o._compositeAppIdMap={},o._ecsHelper=Core.Loader.ObjectFactory.instance.getSingleton(R.ComponentKeys.EcsHelper),o._userIdentity=i,o.appResourceManagerEvents=new EventObject,o}return __extends(t,e),t.prototype._getCompositeAppIdIfExist=function(e){return Core.Utility.isString(e)&&this._compositeAppIdMap[e]?this._compositeAppIdMap[e]:e},t.prototype._setCompositeAppIdIfNotExist=function(e,t){var n;if(e&&e instanceof AppMagic.Runtime.Client.UnifiedAppIdentifier&&(null===(n=null==t?void 0:t.appInfo)||void 0===n?void 0:n.appType)==v.UnifiedApp){var r=t.appInfo.id;r&&!this._compositeAppIdMap[r]&&(this._compositeAppIdMap[r]=e)}},t.prototype.getAppResourcesAsync=function(e,t,n,r,i,o,s,a,c,p){var u,l,d,h,g;return void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=AppMagic.Runtime.Client.AppPackageType.PlayerPackage),void 0===o&&(o=null),void 0===s&&(s=!1),void 0===a&&(a=!1),void 0===c&&(c=!1),__awaiter(this,void 0,Promise,(function(){var f;return __generator(this,(function(m){switch(m.label){case 0:return[4,this._getAppResourcesAsync(e,t,n,r,i,o,s,a,c,p)];case 1:return f=m.sent(),this._setCompositeAppIdIfNotExist(e,f),[4,this._ecsHelper.setupFallbackSwitchesAsync({environmentId:null===(l=null===(u=null==f?void 0:f.appInfo)||void 0===u?void 0:u.environment)||void 0===l?void 0:l.name,objectId:null===(d=this._userIdentity)||void 0===d?void 0:d.objectId,tenantId:null===(h=this._userIdentity)||void 0===h?void 0:h.tenantId,appVersion:null===(g=null==f?void 0:f.appInfo)||void 0===g?void 0:g.publisherVersion})];case 2:return m.sent(),[2,f]}}))}))},t.prototype.setConnectionAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,i;return __generator(this,(function(o){switch(o.label){case 0:n=this._getCompositeAppIdIfExist(e),r=null,o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this._getAppResourcesAsync(n)];case 2:return r=o.sent(),this._setCompositeAppIdIfNotExist(n,r),[3,4];case 3:return i=o.sent(),Core.Log.error("AppResourceManager.setConnectionAsync",i),[2];case 4:return r.upsertConnection(t),[2]}}))}))},t.prototype._getAppResourcesAsync=function(e,n,r,i,o,s,a,c,p,u){return void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=AppMagic.Runtime.Client.AppPackageType.PlayerPackage),void 0===s&&(s=null),void 0===a&&(a=!1),void 0===c&&(c=!1),void 0===p&&(p=!1),__awaiter(this,void 0,Promise,(function(){var l,d,h,g,f;return __generator(this,(function(m){switch(m.label){case 0:return l={recordLastOpened:r,sasKeyDebugDuration:s,isBlocking:i,bypassAppResourcesCache:n,bypassRpCache:c,lastKnownGoodPublishedVersion:p},e=this._getCompositeAppIdIfExist(e),[4,(d=this._getAppResourcesCache(e,l,o)).getItemAsync(t.getAppIdCacheKey(e),t._getCacheRefreshOption(n),l)];case 1:return h=m.sent(),a?(Core.Telemetry.Log.trackActivityEvent("AppResourceManager._getAppResourcesAsync",{message:"Skipping package update check."}),[2,h]):t._isPackageMissing(o,h.appInfo.webPackageUrl,h.appInfo.playerPackageUrl)?(Core.Telemetry.Log.trackActivityEvent("AppResourceManager._getAppResourcesAsync",{message:"App package is missing. Calling ListPackage as a fall-back."}),this.appResourceManagerEvents.dispatch({EventType:"app-package-missing",appVersion:h.appInfo.appVersion,cachedAppMetadataVersion:u,unifiedAppMetadataVersion:h.appInfo.unifiedAppMetadataVersion}),g=h.appInfo.appType==v.UnifiedApp,[4,new AppMagic.Runtime.Client.ListPackageClient(e,this._httpClient).listPackageAsync()]):[3,3];case 2:if((f=m.sent()).status===AppMagic.Runtime.Client.ListAppPackageResultStatus.Empty&&g)return[2,h];if(f.status!==AppMagic.Runtime.Client.ListAppPackageResultStatus.Ready)throw f.error?f.error:new Error("Error calling list package: Response status: ".concat(AppMagic.Runtime.Client.ListAppPackageResultStatus[f.status]));return h.appInfo.appPackageResourcesKind=f.result.appPackageResourcesKind,h.appInfo.webPackageUrl=f.result.webPackageUri.value,h.appInfo.webReadOnlyPackageUrl=f.result.webPackageUri.readonlyValue||null,h.appInfo.playerPackageUrl=f.result.playerPackageUri.value,h.appInfo.playerReadOnlyPackageUrl=f.result.playerPackageUri.readonlyValue||null,f.result.appPackageMetadata&&h.appInfo.updateAppPackageMetadata(f.result.appPackageMetadata),[3,6];case 3:return t._isPackageUpdateNeeded(o,h.appInfo.webPackageUrl,h.appInfo.playerPackageUrl)?this._networkSettingsProvider.isDeviceOnline()?(Core.Telemetry.Log.trackActivityEvent("AppResourceManager._getAppResourcesAsync",{message:"App package has expired. Force-refreshing the cache."}),[4,d.getItemAsync(t.getAppIdCacheKey(e),t._getCacheRefreshOption(!0),l)]):[3,5]:[3,6];case 4:return h=m.sent(),[3,6];case 5:Core.Telemetry.Log.trackActivityEvent("AppResourceManager._getAppResourcesAsync",{message:"App package has expired and device offline. Reusing the exist cache."}),m.label=6;case 6:return[2,h]}}))}))},t.prototype.getAppPreloadDataAsync=function(e,n,r,i,o,s){return void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===i&&(i=!1),void 0===o&&(o=AppMagic.Runtime.Client.AppPackageType.PlayerPackage),void 0===s&&(s=null),__awaiter(this,void 0,Promise,(function(){var a,c,p,u,l;return __generator(this,(function(d){switch(d.label){case 0:return a=this._getCompositeAppIdIfExist(e),c={recordLastOpened:r,sasKeyDebugDuration:s,isBlocking:i,bypassAppResourcesCache:n},[4,this._getAppPreloadDataCache(a,o).getItemAsync(t.getAppIdCacheKey(a),t._getCacheRefreshOption(n),c)];case 1:return p=d.sent(),u=this.getAppResourcesAsync(a,Core.Environment.shouldBypassAppLoadCache(),r,i,o,null,!1),t._isPackageMissing(o,p.webPackageUrl,p.playerPackageUrl)||t._isPackageUpdateNeeded(o,p.webPackageUrl,p.playerPackageUrl)||t._isAppPreloadDataContractVersionUpdateNeeded(p.contractVersion)?(Core.Telemetry.Log.trackActivityEvent("AppResourceManager.getAppPreloadDataAsync",{message:"App package is missing or expired or contract version is not the lastest one. Refreshing from app resources."}),[4,u]):[3,3];case 2:l=d.sent(),p=this._getAppPreloadDataFromAppInfo(a,l,AppMagic.Runtime.Client.AppPreloadDataContractVersion),d.label=3;case 3:return[2,{appPreloadData:p,getAppResourcesPromise:u}]}}))}))},t.prototype.getUnifiedAppPreloadDataAsync=function(e,n,r,i){return __awaiter(this,void 0,Promise,(function(){var r,o,s,a,c,p,u,l,d,h,g,f;return __generator(this,(function(m){switch(m.label){case 0:return r=new AppMagic.Runtime.Client.UnifiedAppIdentifier(e,n),s=AppMagic.Runtime.Client.AppPackageType.WebPlayer,i?[3,2]:(p={recordLastOpened:!0,sasKeyDebugDuration:null,isBlocking:!1,bypassAppResourcesCache:!1},[4,(u=this._getAppResourcesCache(this._getCompositeAppIdIfExist(r),p,s)).itemsLoadedFromStoragePromise]);case 1:m.sent(),(o=u.tryGetItem(t.getAppIdCacheKey(this._getCompositeAppIdIfExist(r))))&&(c=o.appInfo.unifiedAppMetadataVersion,a=this._getAppPreloadDataFromAppInfo(r,o,AppMagic.Runtime.Client.AppPreloadDataContractVersion)),m.label=2;case 2:return l=this.getAppResourcesAsync(r,!0,!0,!1,AppMagic.Runtime.Client.AppPackageType.PlayerPackage,null,!1,!1,!1,c),d=t._isPackageMissing(s,null==a?void 0:a.webPackageUrl,null==a?void 0:a.playerPackageUrl),h=!d&&t._isPackageUpdateNeeded(s,null==a?void 0:a.webPackageUrl,null==a?void 0:a.playerPackageUrl),g=t._isAppPreloadDataContractVersionUpdateNeeded(null==a?void 0:a.contractVersion),!a||!o||d||h||g?(Core.Telemetry.Log.trackActivityEvent("AppResourceManager.getUnifiedAppPreloadDataAsync",{message:"App package is missing or expired or contract version is not the lastest one. Refreshing from app resources.",isPackageMissing:d,isPackageUpdateNeeded:h,isVersionUpdateNeeded:g}),[4,l]):[3,4];case 3:return o=m.sent(),a=this._getAppPreloadDataFromAppInfo(r,o,AppMagic.Runtime.Client.AppPreloadDataContractVersion),[3,5];case 4:f=null==o?void 0:o.appInfo.unifiedAppMetadataVersion,this._fireBackgroundAppResourcesRequest(r,l,f),m.label=5;case 5:return this._setCompositeAppIdIfNotExist(r,o),[2,{appPreloadData:a,getAppResourcesPromise:l}]}}))}))},t.prototype._fireBackgroundAppResourcesRequest=function(e,t,n){return __awaiter(this,void 0,void 0,(function(){var r,i,o,s,a;return __generator(this,(function(c){switch(c.label){case 0:return c.trys.push([0,4,,5]),[4,t];case 1:return(null==(r=c.sent())?void 0:r.appInfo.unifiedAppMetadataVersion)===n?[3,3]:(i={recordLastOpened:!1,sasKeyDebugDuration:null,isBlocking:!1,bypassAppResourcesCache:!0},o=this._getAppResourcesCache(e,i,AppMagic.Runtime.Client.AppPackageType.PlayerPackage),Core.Utility.formatString(AppMagic.Strings.NewAppVersionAvailable,n,null==r?void 0:r.appInfo.unifiedAppMetadataVersion),s={message:"Cached vs RP App version mismatch - ".concat(n," vs ").concat(null==r?void 0:r.appInfo.unifiedAppMetadataVersion)},Core.Telemetry.Log.trackActivityEvent("AppResourceManager.getUnifiedAppPreloadDataAsync.measureCachedVersionMismatchCount",s),[4,Core.PromiseUtils.join([o.refreshCachePromise,o.persistToStoragePromise])]);case 2:c.sent(),this.appResourceManagerEvents.dispatch({EventType:"app-new-version-available"}),Core.Telemetry.Log.trackActivityEvent("AppResourceManager._fireBackgroundAppResourcesRequest",{NewUnifiedAppMetadataVersion:null==r?void 0:r.appInfo.unifiedAppMetadataVersion,NewAppVersion:null==r?void 0:r.appInfo.appVersion,CachedAppMetadataVersion:n}),c.label=3;case 3:return[3,5];case 4:return a=c.sent(),Core.Log.error("AppResourceManager.getUnifiedAppPreloadDataAsync.measureCachedVersionMismatchCount",a),[3,5];case 5:return[2]}}))}))},t.prototype._getAppPreloadDataCache=function(e,n){var r=this,i=M.CacheSettings.AppPreloadDataCacheSettings;return this._cacheManager.getCache(T.CacheType.AppPreloadData,(function(i,o){return __awaiter(r,void 0,Promise,(function(){var r;return __generator(this,(function(i){switch(i.label){case 0:return[4,this._getAppResourcesCache(e,o,n).getItemAsync(t.getAppIdCacheKey(e),t._getCacheRefreshOption(o.bypassAppResourcesCache),o)];case 1:return r=i.sent(),[2,[this._getAppPreloadDataFromAppInfo(e,r,AppMagic.Runtime.Client.AppPreloadDataContractVersion)]]}}))}))}),i,(function(){return t.getAppIdCacheKey(e)}))},t.prototype._getAppResourcesCache=function(e,n,r){var i=this,o=!Core.Utility.isString(e);Core.Telemetry.Log.trackActivityEvent("AppResourceManager._getAppResourcesCache",{message:"appId type: ".concat(o?"Composite":"Non Composite",", IsSharedAppHost: ").concat(Core.Environment.isSharedAppHost())});var s=o?M.CacheSettings.UnifiedAppResourcesCacheSettings:M.CacheSettings.AppResourcesCacheSettings;return s.onCacheDataRefreshedCallback=function(t,o){n.bypassAppResourcesCache=!1;var s=i._getAppPreloadDataCache(e,r);o?s.clear():s.getItemsAsync(!0,n)},this._cacheManager.getCache(T.CacheType.AppResource,(function(t,n){return __awaiter(i,void 0,Promise,(function(){return __generator(this,(function(t){switch(t.label){case 0:return[4,E.LaunchAppService.launchAppAsync(this._httpClient,e,n,r)];case 1:return[2,[t.sent()]]}}))}))}),s,(function(){return t.getAppIdCacheKey(e)}))},t._getCacheRefreshOption=function(e){return e?AppMagic.Runtime.Client.Caching.FindFirstItemOptions.BypassCache:AppMagic.Runtime.Client.Caching.FindFirstItemOptions.UseOnlyCache},t.prototype.getAppPreloadDataFromAppInfo=function(e,t){return this._getAppPreloadDataFromAppInfo(e,t,AppMagic.Runtime.Client.AppPreloadDataContractVersion)},t.prototype.clearResourcesAndPreloadDataCache=function(e){this._cacheManager.clearCache(T.CacheType.AppPreloadData,(function(){return t.getAppIdCacheKey(e)})),this._cacheManager.clearCache(T.CacheType.AppResource,(function(){return t.getAppIdCacheKey(e)}))},t.prototype._getAppPreloadDataFromAppInfo=function(e,n,r){var i=n.appInfo,o=n.connections.map((function(e){return e.id})),s={contractVersion:r,id:i.id,appName:i.name,displayName:i.displayName,imageUrl:i.imageUrl,backgroundColor:i.backgroundColor,packageProperties:i.packageProperties,appPackageResourcesKind:i.appPackageResourcesKind,unauthenticatedWebPackageUrl:i.unauthenticatedWebPackageUrl,webPackageUrl:i.webPackageUrl,webReadOnlyPackageUrl:i.webReadOnlyPackageUrl,playerPackageUrl:i.playerPackageUrl,playerReadOnlyPackageUrl:i.playerReadOnlyPackageUrl,minimumRequiredApiVersion:i.minimumRequiredApiVersion,environment:i.environment,connectionReferences:i.connectionReferences,databaseReferences:i.databaseReferences,featuresRequirements:i.featuresRequirements,lastModifiedDate:i.lastModifiedDate,documentServerVersion:i.documentServerVersion,authResources:i.authResources,userConsents:i.userConsents,deviceCapabilities:i.deviceCapabilities,appConnectionUsages:AppMagic.Runtime.Client.generatePreloadConnectionUsages(n),connectionIds:o,draftWebPackageUrl:i.draftWebPackageUrl,appOverrides:i.appOverrides,appVersion:i.appVersion,appType:i.appType,bypassConsent:i.bypassConsent,appDocumentComplexity:i.appInfoProperties.appDocumentComplexity};Core.Telemetry.Log.setAppVersion(i.appVersion);var a=new h.AppPreloadData(s);return a.cacheItemId=t.getAppIdCacheKey(e),a},t.prototype.getDraftAppDataAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r;return __generator(this,(function(i){switch(i.label){case 0:return[4,n=E.LaunchAppService.draftLaunchAppAsync(this._httpClient,e,t)];case 1:return r=i.sent(),[2,{appPreloadData:this._getAppPreloadDataFromAppInfo(r.appInfo.id,r,AppMagic.Runtime.Client.AppPreloadDataContractVersion),getAppResourcesPromise:n}]}}))}))},t.prototype.getDraftAppResourcesAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,this._getDraftAppResourcesAsync(e,t)];case 1:return[2,n.sent()]}}))}))},t.prototype._getDraftAppResourcesAsync=function(e,t,n){return void 0===n&&(n=!1),__awaiter(this,void 0,Promise,(function(){var r,i,o,s,a,c,p;return __generator(this,(function(u){switch(u.label){case 0:return[4,E.LaunchAppService.launchDraftAppAsync(this._httpClient,e,t)];case 1:if(r=u.sent(),i=r.listAppPackageOperationDetails,o=i.packageStatus,s=i.packageReturnUri,a=i.retryAfter,c=i.error,o!==AppMagic.PowerApps.PackageStatus.InProgress)return[3,3];if(!s)throw Core.Log.errorEx("AppResourceManager._getDraftAppResourcesAsync","packageReturnUri is undefined. Cannot poll for packaging progress"),new Error("packageReturnUri is undefined. Cannot poll for packaging progress");return[4,this._listPackageWithUriAsync(e,s,a)];case 2:return u.sent(),[2,this._getDraftAppResourcesAsync(e,t)];case 3:return o!==AppMagic.PowerApps.PackageStatus.Error||n?[3,5]:(Core.Log.errorEx("AppResourceManager._getDraftAppResourcesAsync",c),[4,this._getDraftAppResourcesAsync(e,t,!0)]);case 4:if(r=u.sent(),p=r.listAppPackageOperationDetails.error)throw p;u.label=5;case 5:return[2,r]}}))}))},t.prototype._listPackageWithUriAsync=function(e,t,n){return void 0===n&&(n=10),__awaiter(this,void 0,Promise,(function(){return __generator(this,(function(r){switch(r.label){case 0:return[4,new AppMagic.Runtime.Client.ListPackageClient(e,this._httpClient).listPackageWithUriAsync(t,1e3*n)];case 1:return r.sent(),[2]}}))}))},t._isPackageMissing=function(e,t,n){var r=Core.Utility.isNullOrUndefined(t);return r||e!==AppMagic.Runtime.Client.AppPackageType.PlayerPackage||(r=Core.Utility.isNullOrUndefined(n)),r},t._isPackageUpdateNeeded=function(e,n,r){var i=t.isSASKeyCloseToOrAlreadyExpired(n);return i||e!==AppMagic.Runtime.Client.AppPackageType.PlayerPackage||(i=t.isSASKeyCloseToOrAlreadyExpired(r)),i},t._isAppPreloadDataContractVersionUpdateNeeded=function(e){return!e||e<AppMagic.Runtime.Client.AppPreloadDataContractVersion},t.isSASKeyCloseToOrAlreadyExpired=function(e){var t=Core.Environment.getSASKeyExpiryDate(e),n=new Date;return n.setMinutes(n.getMinutes()+15),n.getTime()>t.getTime()},t.getAppIdCacheKey=function(e){var t;return"string"==typeof e?null!==(t=AppMagic.PowerApps.PowerAppsUtility.parseAppNameFromAppId(e))&&void 0!==t?t:e:"".concat(e.environmentId,"/").concat(e.appLogicalName)},t.prototype.sendAppAccessRequestAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i;return __generator(this,(function(o){switch(o.label){case 0:if(!(t=AppMagic.PowerApps.PowerAppsUtility.parseAppNameFromAppId(e)))throw new Error("Invalid app Id: ".concat(e));return n=new AppMagic.Services.BodilessHttpRequestBuilder,(r=Core.Environment.usePowerPlatformApi()?AppMagic.PowerApps.PowerAppsUtility.createPowerPlatformAppUrlBuilder(t):new Core.UrlBuilder(AppMagic.PowerApps.PowerAppsUtility.getPowerAppsAppUrl(t))).appendPath("requestAppAccess"),AppMagic.PowerApps.PowerAppsUtility.authorizeHttpBuilder(n,AppMagic.Services.HttpConstants.Method.POST,r.toUrl(),AppMagic.PowerApps.PowerAppsUtility.getPowerAppsResourceName(),AppMagic.PowerApps.PowerAppsUtility.getPowerAppsApiVersion()),i=n.generateSendHttpRequestParameters(),AppMagic.Services.appendCustomHeadersOptions(i,{addCustomHeaders:!0}),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpIgnoreResponseAsync(this._httpClient,i,"AppResourceManager.RequestAppAccess")];case 1:return[2,o.sent()]}}))}))},t}(Core.Disposable)},function(e,t,n){"use strict";var r;n.r(t),n.d(t,"ServerItemCache",(function(){return s})),function(e){e.serverItemCacheLoadFromStorageSuccess="ServerItemCache.LoadFromStorage.Success",e.serverItemCacheLoadFromStorageStale="ServerItemCache.LoadFromStorage.Stale",e.serverItemCacheLoadFromStorageNotStale="ServerItemCache.LoadFromStorage.NotStale",e.serverItemCacheLoadFromStorageNotExist="ServerItemCache.LoadFromStorage.NotExist",e.serverItemCacheLoadFromStorageInvalid="ServerItemCache.LoadFromStorage.Invalid",e.serverItemCacheLoadFromStorageOffline="ServerItemCache.LoadFromStorage.Offline",e.serverItemCacheGetItemsHit="ServerItemCache.GetItems.Hit",e.serverItemCacheGetItemsFromServer="ServerItemCache.GetItems.GetFromServer",e.serverItemCacheGetItemsStaleInMemoryRefreshBackground="ServerItemCache.GetItems.StaleInMemory.RefreshBackground",e.serverItemCacheGetItemsStaleInMemoryReturnWithoutRefresh="ServerItemCache.GetItems.StaleInMemory.ReturnWithoutRefresh",e.serverItemCacheGetItemsStaleInMemoryRefreshBlocking="ServerItemCache.GetItems.StaleInMemory.RefreshBlocking",e.serverItemCacheRefreshIntervalReset="ServerItemCache.RefreshIntervalReset",e.serverItemCacheClear="ServerItemCache.Clear",e.serverItemCacheDispose="ServerItemCache.Dispose"}(r||(r={}));var i=0,o=HashTableUtility.create(),s=function(e){function t(t,n,r,s,a,c){void 0===a&&(a=new AppMagic.Runtime.Client.ImmediateOperationsExecutor),void 0===c&&(c={});var p=e.call(this)||this;return p._instanceId=i++,o[p._instanceId]=Contracts._sourceFromStacktrace(),p._fetchFromServerFnAsync=t,p._cacheId=n,p._cacheSettingsProviderManager=r,p._operationsExecutor=a,p._updateLastFetchTimestampFn=c.serializationOptions&&c.serializationOptions.updateLastFetchTimestampFn?c.serializationOptions.updateLastFetchTimestampFn:Core.Utility.noOpFn,p._refreshIntervalsMS=c.refreshIntervalsMS,p._resetRefreshIntervals(),p._disableInitialDataLoad=c.disableInitialDataLoad,p._shouldPersistToStorage=Core.Utility.isDefined(c.serializationOptions)||!1,p._isRefreshing=!1,p._staleInMemoryAfterMS=Core.Utility.isUndefined(c.staleInMemoryAfterMS)?-1:c.staleInMemoryAfterMS,p._staleInStorageAfterMS=c.serializationOptions?c.serializationOptions.staleInStorageAfterMS:-1,p._settingsProvider=c.serializationOptions?c.serializationOptions.settingsProvider:void 0,p._deserializeFn=c.serializationOptions?c.serializationOptions.deserializationFnAsync:null,p._refreshLogic=Core.Utility.isDefined(c.refreshLogic)?c.refreshLogic:AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.BlockIfStaleAndUpdate,p._clearCacheOnHttpErrorCodes=c.clearCacheOnHttpErrorCodes?c.clearCacheOnHttpErrorCodes:null,p._onCacheDataRefreshedCallback=c.onCacheDataRefreshedCallback,p._networkSettingsProvider=s,p._itemsLoadedFromStorage=p._initializeAsync(c.serializationOptions&&c.serializationOptions.lastFetchTimestamp?c.serializationOptions.lastFetchTimestamp:null),p}return __extends(t,e),Object.defineProperty(t.prototype,"cacheId",{get:function(){return this._cacheId},enumerable:!1,configurable:!0}),t.getNonDisposedInstanceStacks=function(){return HashTableUtility.clone(o)},Object.defineProperty(t.prototype,"isLoaded",{get:function(){return this._isLoaded},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"itemsLoadedFromStoragePromise",{get:function(){return this._itemsLoadedFromStorage},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"persistToStoragePromise",{get:function(){return this._persistToStoragePromise},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"refreshCachePromise",{get:function(){return this._refreshCachePromise},enumerable:!1,configurable:!0}),t.prototype.tryGetItem=function(e){return this._items[e]||null},t.prototype.tryGetItemAsync=function(e,t,n){void 0===t&&(t=!1);var r=t?AppMagic.Runtime.Client.Caching.FindFirstItemOptions.BypassCache:AppMagic.Runtime.Client.Caching.FindFirstItemOptions.RefreshFromServerIfCacheMiss;return this.tryFindFirstItemAsync((function(t){return Core.Utility.equalsIgnoreCase(t.cacheItemId,e)}),r,n)},t.prototype.getItemAsync=function(e,t,n){return void 0===t&&(t=AppMagic.Runtime.Client.Caching.FindFirstItemOptions.RefreshFromServerIfCacheMiss),this.findFirstItemAsync((function(t){return Core.Utility.equalsIgnoreCase(t.cacheItemId,e)}),t,n)},t.prototype._initializeAsync=function(e){var t=this;return this._items=HashTableUtility.create(),this._refreshTimer=null,this._isDirty=!1,this._isLoaded=!1,this._isRefreshedFromServer=!1,this._lastFetchTimestamp=null,this._refreshCachePromise=null,this._refreshCacheAbortController=null,this._isRefreshing=!1,this._resetRefreshIntervals(),this._promiseQueue=new Core.PromiseUtils.PromiseQueue("ServerItemCache_initialize"),this._logMessage("Cache is initialized and attempting to load initial data."),this._populateItemsFromStorageAsync(e).then((function(){t._disableInitialDataLoad?t._logMessage("Skipping loading data from server due to cache setting. DisableInitialDataLoad: ".concat(t._disableInitialDataLoad)):(t._isLoaded&&t._setupNextAutoRefresh(),t._validateItems())}))},t.prototype.getItems=function(){return this._getItems()},t.prototype._getItems=function(){return this._items},t.prototype.setItem=function(e,t){this._items[e]=t,this._isDirty=!0,this._logMessage("Adding item to the local cache.")},t.prototype.deleteItem=function(e){delete this._items[e],this._isDirty=!0,this._logMessage("Deleting item from cache.")},t.prototype.getItemsAsync=function(e,t,n){var r=this;return void 0===e&&(e=!1),this._promiseQueue.pushJob((function(n){return r._getItemsAsync(e,t,n).catch((function(e){return Core.PromiseUtils.throwIfCanceled(e),r._logError("ServerItemCache.getItemsAsync",e),Promise.reject(e)}))}),n)},t.prototype._isDataStaleInMemory=function(){if(!this.isLoaded||this._staleInMemoryAfterMS<0)return!1;var e=(new Date).getTime();return this._lastFetchTimestamp+this._staleInMemoryAfterMS<e},t.prototype._isDataStaleInStorage=function(e){if(this._staleInStorageAfterMS<0)return!1;var t=(new Date).getTime();return e+this._staleInStorageAfterMS<t},t.prototype._refreshInBackground=function(e,t){var n=this;if(!this._isRefreshing){var r=function(){return __awaiter(n,void 0,void 0,(function(){var n;return __generator(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this._getItemsFromServerAsync(e,t)];case 1:return r.sent(),[3,3];case 2:return n=r.sent(),Core.PromiseUtils.throwIfCanceled(n),this._logError("ServerItemCache.refreshInBackground",n),[3,3];case 3:return[2]}}))}))};e?this.trackAnonymous(r()):this._operationsExecutor.run("ServerItemCache.RefreshInBackground.".concat(this._cacheId),r)}},t.prototype._getItemsAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(i){return!this.isLoaded||e||this._isDirty||!this._isRefreshedFromServer&&HashTableUtility.isEmpty(this._getItems())?(this._logTelemetryActivityEvent(r.serverItemCacheGetItemsFromServer),this._resetRefreshIntervals(),[2,this._getItemsFromServerAsync(!1,t,n)]):this._isDataStaleInMemory()?this._refreshLogic===AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.BlockIfStaleAndUpdate?(this._logTelemetryActivityEvent(r.serverItemCacheGetItemsStaleInMemoryRefreshBlocking),this._resetRefreshIntervals(),[2,this._getItemsFromServerAsync(!1,t,n)]):(this._refreshLogic===AppMagic.Runtime.Client.Caching.ServerItemCacheRefreshLogic.ReturnAndRefreshInBackground?(this._logTelemetryActivityEvent(r.serverItemCacheGetItemsStaleInMemoryRefreshBackground),t&&(t.isBlocking=!1),this._refreshInBackground(!1,t)):this._logTelemetryActivityEvent(r.serverItemCacheGetItemsStaleInMemoryReturnWithoutRefresh),[2,this._getItems()]):(this._logTelemetryActivityEvent(r.serverItemCacheGetItemsHit),[2,this._getItems()])}))}))},t.prototype._getItemsFromServerAsync=function(e,t,n){var r=this;return this._isRefreshing=!0,this._refreshCacheAbortController=null!=n?n:new AbortController,this._refreshCachePromise=Promise.resolve().then((function(){return r._fetchFromServerFnAsync(e,t,r._refreshCacheAbortController)})).then((function(e){var t=HashTableUtility.create();return e.forEach((function(e){return t[e.cacheItemId]=e})),r._items=t,r._lastFetchTimestamp=(new Date).getTime(),r._logMessage("Cache is updated from server."),r._persistToStoragePromise=r._persistToStorageAsync(),r._onCacheDataRefreshed(),t})).catch((function(e){return r._clearCacheOnHttpErrorCodes&&AppMagic.Services.errorHasHttpResponse(e)&&r._clearCacheOnHttpErrorCodes.indexOf(e.response.status)>=0&&(r._logTelemetryActivityEvent("ServerItemCache._getItemsFromServerAsync.ClearCacheOnHttpError"),r._items=HashTableUtility.create(),r._persistToStoragePromise=r._persistToStorageAsync(),r._onCacheDataRefreshed(e)),Promise.reject(e)})),Core.PromiseUtils.wrapWithFinally(this._refreshCachePromise,(function(){r._isRefreshing=!1,r._isRefreshedFromServer=!0,r._setupNextAutoRefresh()}))},t.prototype.searchItemsAsync=function(e,t,n){var r=this;return void 0===t&&(t=!1),this._promiseQueue.pushJob((function(){return r._searchItemsAsync(e,t,n).catch((function(e){return Core.PromiseUtils.throwIfCanceled(e),r._logError("ServerItemCache.searchItemsAsync",e),Promise.reject(e)}))}))},t.prototype._searchItemsAsync=function(e,t,n){var r=this;return Promise.resolve().then((function(){return r._getItemsAsync(t,n)})).then((function(t){return HashTableUtility.map(t,(function(t){if(e(t))return t}))}))},t.prototype.tryFindFirstItemAsync=function(e,t,n){return void 0===t&&(t=AppMagic.Runtime.Client.Caching.FindFirstItemOptions.UseOnlyCache),this.findFirstItemAsync(e,t,n).catch((function(e){return Core.Telemetry.Log.trackActivityEvent("ServerItemCache.tryFindFirstItemAsync",{message:Core.PromiseUtils.formatErrorMessage(e)}),null}))},t.prototype.findFirstItemAsync=function(e,t,n){var r=this;void 0===t&&(t=AppMagic.Runtime.Client.Caching.FindFirstItemOptions.UseOnlyCache);var i=this.isLoaded;return this._findFirstItemAsync(e,t===AppMagic.Runtime.Client.Caching.FindFirstItemOptions.BypassCache,n).then((function(o){if(o)return o;if(t===AppMagic.Runtime.Client.Caching.FindFirstItemOptions.RefreshFromServerIfCacheMiss&&i)return r._findFirstItemAsync(e,!0,n).then((function(e){if(e)return e;throw new Error("Item was not found in the cache")}));throw new Error("Item was not found in the cache")}))},t.prototype.containsItemAsync=function(e,t){return void 0===t&&(t=AppMagic.Runtime.Client.Caching.FindFirstItemOptions.UseOnlyCache),this.tryFindFirstItemAsync(e,t).then((function(e){return!!e}))},t.prototype.containsItem=function(e){return HashTableUtility.some(this._getItems(),e)},t.prototype._findFirstItemAsync=function(e,t,n){return this.searchItemsAsync(e,t,n).then((function(e){for(var t in e)return e[t];return null}))},t.prototype._setupNextAutoRefresh=function(){var e=this;if(this._refreshIntervalsMS){this._currentRefreshIntervalIndex+1<this._refreshIntervalsMS.length&&this._currentRefreshIntervalIndex++;var t=this._refreshIntervalsMS[this._currentRefreshIntervalIndex];this._logMessage("Cache is set to refresh in ".concat(t," milliseconds")),clearTimeout(this._refreshTimer),this._refreshTimer=setTimeout((function(){return e._refreshInBackground(!0)}),t)}},t.prototype._resetRefreshIntervals=function(){this._currentRefreshIntervalIndex=-1},t.prototype._populateItemsFromStorageAsync=function(e){var t=this;if(!this._shouldPersistToStorage)return Promise.resolve();if(null===e)return this._logTelemetryActivityEvent(r.serverItemCacheLoadFromStorageNotExist),Promise.resolve();if(this._isDataStaleInStorage(e)){if(this._networkSettingsProvider&&this._networkSettingsProvider.isDeviceOnline())return this._logTelemetryActivityEvent(r.serverItemCacheLoadFromStorageStale,{lastFetchTimestampInFile:e}),Promise.resolve();this._logTelemetryActivityEvent(r.serverItemCacheLoadFromStorageOffline,{lastFetchTimestampInFile:e})}this._logTelemetryActivityEvent(r.serverItemCacheLoadFromStorageNotStale,{lastFetchTimestampInFile:e});var n=this._cacheSettingsProviderManager.loadAsync(this._settingsProvider).then((function(){t._lastFetchTimestamp=e;var n=t._settingsProvider.getValue("items"),i=HashTableUtility.create();n&&HashTableUtility.forEach(n,(function(e){var n=t._deserializeFn(e);if(!n)throw new Error("Parsing item from storage failed.");i[n.cacheItemId]=n})),t._items=i,t._logTelemetryActivityEvent(r.serverItemCacheLoadFromStorageSuccess),t._onCacheDataRefreshed()})).catch((function(e){Core.PromiseUtils.throwIfCanceled(e),t._logTelemetryActivityEvent(r.serverItemCacheLoadFromStorageInvalid),t._logError("ServerItemCache._populateItemsFromStorageAsync",e)}));return this._promiseQueue.pushJob((function(){return n}))},t.prototype._persistToStorageAsync=function(){var e=this;if(this._shouldPersistToStorage&&this._lastFetchTimestamp){var t=HashTableUtility.map(this._items,(function(e){return e.serializeToJson()}));return this._settingsProvider.setValue("items",t),this._settingsProvider.setValue("lastFetchTimestamp",this._lastFetchTimestamp),this._settingsProvider.save().then((function(t){if(!t)throw new Error("Persisting cache to storage failed.");e._updateLastFetchTimestampFn(e._lastFetchTimestamp)})).catch((function(t){Core.PromiseUtils.throwIfCanceled(t),e._logError("ServerItemCache._persistToStorageAsync",t)}))}},t.prototype._validateItems=function(){this.getItemsAsync().catch((function(e){}))},t.prototype.clear=function(){this._logTelemetryActivityEvent(r.serverItemCacheClear),this._items=HashTableUtility.create(),this._persistToStoragePromise=this._persistToStorageAsync()},t.prototype.unloadAsync=function(){var e=this;return this._settingsProvider&&this._isLoaded?this._cacheSettingsProviderManager.unloadAsync(this._settingsProvider).then((function(){return e._settingsProvider=null})).catch((function(e){Core.PromiseUtils.throwIfCanceled(e),Core.Log.error("ServerItemCache.unloadAsync",e)})):Promise.resolve()},t.prototype.dispose=function(){this._logTelemetryActivityEvent(r.serverItemCacheDispose),delete o[this._instanceId],this._items=null,this._refreshTimer&&(clearTimeout(this._refreshTimer),this._refreshTimer=null),this._isDirty=!1,this._isLoaded=!1,this._isRefreshedFromServer=!1,this._lastFetchTimestamp=null,this._refreshCachePromise&&(Core.PromiseUtils.abortPromise(this._refreshCachePromise,this._refreshCacheAbortController),this._refreshCachePromise=null,this._refreshCacheAbortController=null),this._isRefreshing=!1,this._resetRefreshIntervals(),this._promiseQueue&&(this._promiseQueue.cancelAll(),this._promiseQueue=null),this._refreshIntervalsMS=null,e.prototype.dispose.call(this)},t.prototype._logMessage=function(e){Core.Log.verbose(Core.Utility.formatString("[ServerItemCache] {0} Id: {1}",e,this._cacheId))},t.prototype._logTelemetryActivityEvent=function(e,t){this._logMessage(e);var n={cacheId:this._cacheId},r=t?Core.Utility.combineObjectProperties(t,n):n;Core.Telemetry.Log.trackActivityEvent(e,r)},t.prototype._onCacheDataRefreshed=function(e){this._isLoaded=!0,this._isDirty=!1,this._onCacheDataRefreshedCallback&&this._onCacheDataRefreshedCallback(this.getItems(),e)},t.prototype._logError=function(e,t){Core.Log.errorEx(e,{error:t,eventData:{cacheId:this._cacheId}})},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"ApimConnectionSendHttpPipeline",(function(){return s}));var r=n(7),i=n(1),o=[AppMagic.Services.HttpConstants.HttpStatusCode.Forbidden,AppMagic.Services.HttpConstants.HttpStatusCode.NotFound],s=function(){function e(e,t){void 0===t&&(t={maxCacheItemDurationMS:5e3,maxCacheSize:50,retryAfterBufferMS:500}),this._sendHttpPipeline=e,this._authPromises=HashTableUtility.create(),this._maxCacheItemDurationMS=t.maxCacheItemDurationMS,this._retryAfterBufferMS=t.retryAfterBufferMS,this._requestCache=new AppMagic.Runtime.Client.ApimHttpRequestCache({maxSize:t.maxCacheSize})}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,o,s,a,c,p;return __generator(this,(function(u){switch(u.label){case 0:return t=null,e.headers&&e.headers[AppMagic.Services.HttpConstants.HeaderName.ServiceNamespace]&&(t=e.headers[AppMagic.Services.HttpConstants.HeaderName.ServiceNamespace],delete e.headers[AppMagic.Services.HttpConstants.HeaderName.ServiceNamespace]),(n=i.SendHttpUtility.tryGetApimConnectionName(e.url))?[3,2]:[4,this._sendHttpPipeline.sendHttpAsync(e)];case 1:return[2,u.sent()];case 2:r=i.SendHttpUtility.createRequestParamsWithClonedHeaders(e),u.label=3;case 3:return u.trys.push([3,10,,12]),(o=this._authPromises[n])?[4,o]:[3,5];case 4:u.sent(),u.label=5;case 5:return[4,this._handleRequestAsync(n,r)];case 6:return null==(s=u.sent())?[3,7]:(a=s,[3,9]);case 7:return[4,this._handlePendingResponseAsync(n,e,r)];case 8:a=u.sent(),u.label=9;case 9:return[2,a];case 10:return c=u.sent(),Core.PromiseUtils.throwIfCanceled(c),[4,this._retryIfUnauthenticatedConnectionErrorAsync(c,n,r,t)];case 11:if(p=u.sent())return[2,p];throw c;case 12:return[2]}}))}))},e.prototype._retryIfUnauthenticatedConnectionErrorAsync=function(e,t,n,r){return __awaiter(this,void 0,Promise,(function(){var o,s,a,c,p,u,l,d,h,g,f;return __generator(this,(function(m){switch(m.label){case 0:return o=function(e){if(AppMagic.Services.errorHasHttpResponse(e)){var t=e;if(e.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.NotFound)if(HashTableUtility.tryGetValueIgnoreCase(t.response.headers,AppMagic.Services.HttpConstants.HeaderName.MsFailureCause)===AppMagic.Services.HttpConstants.FailureCauses.ApiHubTokenExchange)return!0}return!1}(e),function(e){return AppMagic.Services.errorHasHttpResponse(e)&&e.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized}(e)||o?(s=this._authPromises[t])?[4,s]:[3,4]:[3,25];case 1:return m.sent()?(Core.Diagnostics.trace(Core.Diagnostics.CategoryNames.Connection,"ReauthenticationSucceeded",{info:AppMagic.Strings.ConnectionReauthenticationSucceeded,requestUrl:n.url,originalClientRequestId:n.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]}),i.SendHttpUtility.updateClientRequestIdHeader(n),[4,this._sendHttpPipeline.sendHttpAsync(n)]):[3,3];case 2:return[2,m.sent()];case 3:return[3,25];case 4:a=Core.PromiseUtils.createCompletablePromise(),this._authPromises[t]=a.promise,c=!1,m.label=5;case 5:return m.trys.push([5,24,,25]),[4,this._getConnectionServiceAsync()];case 6:p=m.sent(),u=void 0,l=void 0;try{u=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.PowerApps.IPowerAppsClientSingletonKey)}catch(e){return Core.Log.errorEx("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"PowerAppsClient singleton not registered."}),a.complete(!1),[2,null]}return(l=null==u?void 0:u.getConnectionFromCache(t))?[3,8]:(Core.Log.warningEx("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"Connection not found in the PowerAppsClient. Using listConnection"}),[4,p.getConnectionsAsync()]);case 7:d=m.sent(),(l=d?d.find((function(e){return Core.Utility.equalsIgnoreCase(e.name,t)})):null)||Core.Log.errorEx("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"Connection not found after ListConnections"}),m.label=8;case 8:return h=!1,(null==l?void 0:l.apiId)&&AppMagic.ConnectionHub.Api.isMsFlowApi(l.apiId)&&l instanceof AppMagic.ConnectionHub.CompositeConnection?(Core.Telemetry.Log.trackActivityEvent("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"Re-installing composite connection",connectionName:t}),[4,null==u?void 0:u.tryResetCompositeConnectionAsync(l)]):[3,10];case 9:return(l=m.sent())&&(n.url=n.url.replace(t,l.name),h=!0),[3,20];case 10:if(!(null==l?void 0:l.isApiFirstParty)||!p.isSsoAuthValid(l)||o)return[3,16];Core.Diagnostics.trace(Core.Diagnostics.CategoryNames.Connection,"AttemptingToReauthenticate",{info:AppMagic.Strings.AttemptingToReauthenticate,requestUrl:n.url,connectionId:l.id,originalClientRequestId:n.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]}),Core.Telemetry.Log.trackActivityEvent("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"Re-authenticating SSO connection",connectionName:t}),m.label=11;case 11:return m.trys.push([11,13,,15]),[4,this._authenticateConnection(p,l)];case 12:return m.sent(),[3,15];case 13:return m.sent(),Core.Telemetry.Log.trackActivityEvent("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"Fallback to consent dialog",connectionName:t}),Core.Diagnostics.trace(Core.Diagnostics.CategoryNames.Connection,"AttemptingToReauthenticateWithConsent",{info:AppMagic.Strings.AttemptingToReauthenticateWithConsent,requestUrl:n.url,originalClientRequestId:n.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]}),[4,u.tryFixUnauthenticatedConnectionsAsync(r)];case 14:return(null==(l=m.sent())?void 0:l.status.isAuthenticated)&&(n.url=n.url.replace(t,l.name),h=!0),[3,15];case 15:return h=!0,[3,20];case 16:if(!r)return[3,20];Core.Telemetry.Log.trackActivityEvent("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"Re-authenticating standard connection",connectionName:t}),m.label=17;case 17:return m.trys.push([17,19,,20]),Core.Diagnostics.trace(Core.Diagnostics.CategoryNames.Connection,"AttemptingToReauthenticateWithConsent",{info:AppMagic.Strings.AttemptingToReauthenticateWithConsent,requestUrl:n.url,originalClientRequestId:n.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]}),[4,u.tryFixUnauthenticatedConnectionsAsync(r)];case 18:return(null==(l=m.sent())?void 0:l.status.isAuthenticated)&&(n.url=n.url.replace(t,l.name),h=!0),[3,20];case 19:return m.sent(),Core.Telemetry.Log.trackActivityEvent("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",{message:"Re-authentication failed",connectionName:t}),[3,20];case 20:return h?(Core.Diagnostics.trace(Core.Diagnostics.CategoryNames.Connection,"ReauthenticationSucceeded",{info:AppMagic.Strings.ConnectionReauthenticationSucceeded,requestUrl:n.url,originalClientRequestId:n.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]}),c=!0,i.SendHttpUtility.updateClientRequestIdHeader(n),[4,this._sendHttpPipeline.sendHttpAsync(n)]):[3,22];case 21:return g=m.sent(),a.complete(!0),delete this._authPromises[t],[2,g];case 22:a.complete(!1),m.label=23;case 23:return[3,25];case 24:if(f=m.sent(),Core.Diagnostics.trace(Core.Diagnostics.CategoryNames.Connection,"ReauthenticationFailed",{info:AppMagic.Strings.ConnectionReauthenticationFailed,requestUrl:n.url,originalClientRequestId:n.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId],authenticationError:f,originalError:e}),Core.Log.error("ApimConnectionSendHttpPipeline._retryIfUnauthenticatedConnectionErrorAsync",f,"Failed to re-auth connection: "+t),a.complete(!1),c)throw f;return[3,25];case 25:return[2,null]}}))}))},e.prototype._getConnectionServiceAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,Core.Loader.ObjectFactory.instance.getSingleton(r.IClientRuntimeSingletonKey).userService.getConnectionServiceAsync()];case 1:return[2,e.sent()]}}))}))},e.prototype._authenticateConnection=function(e,t){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(n){switch(n.label){case 0:return[4,AppMagic.Runtime.Client.ConnectionOperations.getConnectionConsentAsync(e,t,{manualLoginSettings:AppMagic.ConnectionHub.ManualLoginSettings.Disable})];case 1:return n.sent(),[2]}}))}))},e.prototype._completeRequestIfExists=function(t){var n=this._requestCache.tryGetValue(e._getCacheKeyForRequest(t));n&&!n.completed&&(n.completed=!0)},e.prototype._getUpdatedRetryTime=function(e){var t=(new Date).getTime()-e.timestamp;return e.retryAfter-t>0?Math.ceil((e.retryAfter-t)/1e3):0},e.prototype._createUpdatedRetryErrorAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,i,o;return __generator(this,(function(s){switch(s.label){case 0:s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.promise];case 2:return n=s.sent(),r="Cached item contains a ".concat(n.status," success status. Expected cached item promise to cache only errors."),Core.Log.errorEx("ApimConnectionSendHttpPipeline._createUpdatedRetryErrorAsync",{message:r,eventData:{connectionName:t}}),[2,new Error(r)];case 3:return i=s.sent(),o=this._getUpdatedRetryTime(e),i.response.message=Core.Utility.formatString(AppMagic.Strings.RetryAfterErrorMessage,o),[2,i];case 4:return[2]}}))}))},e.prototype._getRetryAfterTime=function(e){var t=HashTableUtility.tryGetValueIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.RetryAfter),n=t&&1e3*parseInt(t);return n>0?n:5e3},e.prototype._isValidCacheItemAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i;return __generator(this,(function(o){switch(o.label){case 0:if(!e)return[2,!1];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.promise];case 2:return o.sent(),[3,4];case 3:return n=o.sent(),t=n.response.status,[3,4];case 4:return r=(new Date).getTime(),t===AppMagic.Services.HttpConstants.HttpStatusCode.TooManyRequests?(i=e.retryAfter,[2,r-e.timestamp<i+this._retryAfterBufferMS]):[2,r-e.timestamp<=this._maxCacheItemDurationMS]}}))}))},e.prototype._handleRequestAsync=function(t,n){return __awaiter(this,void 0,Promise,(function(){var r,i,o;return __generator(this,(function(s){switch(s.label){case 0:return r=this._requestCache.tryGetValue(t),(i=r)?[4,this._isValidCacheItemAsync(r)]:[3,2];case 1:i=s.sent(),s.label=2;case 2:return i?[4,this._createUpdatedRetryErrorAsync(r,t)]:[3,4];case 3:throw s.sent();case 4:return!(r=this._requestCache.tryGetValue(e._getCacheKeyForRequest(n)))||n.method!==AppMagic.Services.HttpConstants.Method.GET||(new Date).getTime()-r.timestamp>1e4?[2,null]:r.completed||r.responseType!==n.responseType?[3,6]:(Core.Telemetry.Log.trackActivityEvent("ApimConnectionSendHttpPipeline._handleRequestAsync",{message:"Previous request has not completed. Awaiting on previous request and directly returning the cached response",url:Core.Telemetry.Utility.scrubSensitiveDataSafe(n.url),requestId:r.requestId}),[4,r.promise]);case 5:return[2,s.sent()];case 6:return(o=r.completed)?[4,this._isValidCacheItemAsync(r)]:[3,8];case 7:o=s.sent(),s.label=8;case 8:return o?(Core.Telemetry.Log.trackActivityEvent("ApimConnectionSendHttpPipeline._handleRequestAsync",{message:"GET request blocked because the same request failed recently",url:Core.Telemetry.Utility.scrubSensitiveDataSafe(n.url),requestId:r.requestId}),[4,r.promise]):[3,10];case 9:return[2,s.sent()];case 10:return[2,null]}}))}))},e.prototype._handlePendingResponseAsync=function(t,n,r){return __awaiter(this,void 0,Promise,(function(){var i,s,a,c;return __generator(this,(function(p){switch(p.label){case 0:return i=HashTableUtility.tryGetValueIgnoreCase(r.headers,AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId),s=this._sendHttpPipeline.sendHttpAsync(n),[4,this._sendAndHandleNewRequestAsync(r,s,i)];case 1:return function(e){return e.status===AppMagic.Services.HttpConstants.HttpStatusCode.TooManyRequests}(a=p.sent())?(c=this._getRetryAfterTime(a),this._requestCache.removeItemIfExists(e._getCacheKeyForRequest(r)),this._requestCache.upsertItem(t,{timestamp:(new Date).getTime(),completed:!0,promise:s,responseType:r.responseType,retryAfter:c,requestId:i}),[4,s]):[3,3];case 2:return[2,p.sent()];case 3:return r.method===AppMagic.Services.HttpConstants.Method.GET&&function(e){return o.indexOf(e.status)>-1&&!function(e){if(e.status===AppMagic.Services.HttpConstants.HttpStatusCode.Forbidden){var t=AppMagic.Services.Adal.AuthenticationErrorResponse.tryParse(e.response);if(t&&"interaction_required"===t.error)return!0}return!1}(e)}(a)?this._completeRequestIfExists(r):this._requestCache.removeItemIfExists(e._getCacheKeyForRequest(r)),[4,s];case 4:return[2,p.sent()]}}))}))},e.prototype._sendAndHandleNewRequestAsync=function(t,n,r){return __awaiter(this,void 0,Promise,(function(){var i,o;return __generator(this,(function(s){switch(s.label){case 0:t.method===AppMagic.Services.HttpConstants.Method.GET&&this._requestCache.upsertItem(e._getCacheKeyForRequest(t),{timestamp:(new Date).getTime(),completed:!1,responseType:t.responseType,promise:n,requestId:r}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n];case 2:return i=s.sent(),[3,4];case 3:if(o=s.sent(),!AppMagic.Services.errorHasHttpResponse(o))throw this._requestCache.removeItemIfExists(e._getCacheKeyForRequest(t)),o;return i=o.response,[3,4];case 4:return[2,i]}}))}))},e._getCacheKeyForRequest=function(e){var t=JSON.parse(JSON.stringify({url:e.url.toLowerCase(),headers:e.headers}));return t.headers&&(delete t.headers[AppMagic.Services.HttpConstants.HeaderName.Accept],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.AcceptLanguage],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.Authorization],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.CacheControl],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientEnvironmentId],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientObjectId],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.MsClientSessionId],delete t.headers[AppMagic.Services.HttpConstants.HeaderName.MsUserAgent],delete t.headers[AppMagic.PowerApps.Constants.ApimInvokeRequestMethodHeader],delete t.headers[AppMagic.PowerApps.Constants.ApimInvokeHeader]),JSON.stringify(t)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"CacheSettingsProviderManager",(function(){return r}));var r=function(){function e(){}return e.prototype.generate=function(e,t){if(void 0===t&&(t=!1),Core.Environment.isWebPlayer()){if(t){var n=Core.Loader.ObjectFactory.instance.getSingleton(Core.IO.IAsyncSettingsProviderKey);return new Core.IO.SettingsProviders.LocalForageSettingsProviderBySetting(e,n)}return Core.Environment.isWebPlayerEncryptedStorageEnabled()?new Core.IO.SettingsProviders.EncryptedWebSettingsProvider(e,Core.Loader.ObjectFactory.instance.getSingleton(Core.IO.IEncryptedStorageKey)):new Core.IO.SettingsProviders.MemorySettingsProvider}return Core.Environment.isWebAuthoring()||Core.Environment.isTestMode()?new Core.IO.SettingsProviders.MemorySettingsProvider:new Core.IO.SettingsProviders.FileSettingsProvider(e,!0)},e.prototype.unloadAsync=function(e){return e instanceof Core.IO.SettingsProviders.FileSettingsProvider?e.deleteSettingsFileAsync():(Core.Environment.isWebPlayerEncryptedStorageEnabled()&&e.clear(),Promise.resolve())},e.prototype.loadAsync=function(e){return(e instanceof Core.IO.SettingsProviders.FileSettingsProvider?this._getUserCacheFolderAsync().then((function(t){return e.load(t)})):e.load()).then((function(e){if(!e)throw new Error("Loading settings provider failed")}))},e.prototype.purgeCacheDataAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:n.label=1;case 1:return n.trys.push([1,7,,8]),e instanceof Core.IO.SettingsProviders.FileSettingsProvider?[4,this._getUserCacheFolderAsync()]:[3,4];case 2:return[4,n.sent().deleteAsync()];case 3:return n.sent(),[3,6];case 4:return Core.Environment.isWebPlayerEncryptedStorageEnabled()?[4,e.clear()]:[3,6];case 5:n.sent(),n.label=6;case 6:return[3,8];case 7:return t=n.sent(),Core.PromiseUtils.throwIfCanceled(t),Core.Log.error("CacheSettingsProviderManager.purgeCacheDataAsync",t,"Error cleaning up cache folder"),[3,8];case 8:return[2]}}))}))},e.prototype._getUserCacheFolderAsync=function(){return Core.IO.FileSystem.getAppDataFolderAsync().then((function(e){return e.getOrCreateFolder("UserCache")}))},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"SendHttpCore",(function(){return r}));var r=function(){function e(e,t){void 0===t&&(t={}),this._xhrFn=e,Core.Utility.isNumber(t.requestTimeout)?this._customRequestInitializerFn=function(e){e.timeout=t.requestTimeout}:this._customRequestInitializerFn=null}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,s,a,c,p,u,l,d,h;return __generator(this,(function(g){switch(g.label){case 0:t=Date.now(),n=Date.now(),e.headers||(e.headers=HashTableUtility.create()),r=e.responseType||AppMagic.Services.ResponseTypes.Text,i=this._createXhrOptions(e),g.label=1;case 1:return g.trys.push([1,3,,5]),s=this._getAuthorizationHeaderLength(i),[4,this._xhrFn(i)];case 2:if(a=g.sent(),n=Date.now(),a&&0===a.status)throw Core.Telemetry.Log.trackActivityEvent("SendHttpCore.sendHttpAsync",{message:"WinJS.xhr() returned success with status of 0. Converting to error channel."}),a;return o=AppMagic.Services.ServiceUtility.createSendHttpPipelineResponseFromXMLHttpRequest(a),[3,5];case 3:return c=g.sent(),[4,AppMagic.Services.ServiceUtility.createNormalizedErrorFromWinJSXhrErrorAsync(c,e.url)];case 4:throw p=g.sent(),AppMagic.Services.errorHasHttpResponse(p)&&p.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.Unauthorized&&(u=this._getAuthorizationHeaderLength(i),(s<8||u<8)&&(l=HashTableUtility.tryGetValueIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId),Core.Telemetry.Log.trackActivityEvent("SendHttpCore.sendHttpAsync.authorization",{message:"401 response with invalid Authentication header.",authHeaderLengthBefore:s,authHeaderLengthAfter:u,clientRequestId:l}))),p;case 5:if("json"===r&&"json"!==o.responseType){if("text"!==o.responseType)throw new Core.SendHttpInvalidResponseError(Core.Utility.formatString(AppMagic.Strings.XhrResponseTypeInvalid_Expected,AppMagic.Services.ResponseTypes.Json,e.url),o,Core.HttpResponseErrorKind.ResponseNotJsonNorText);d=AppMagic.Services.ServiceUtility.parseTextResponseToJsonWithStandardErrors(o,e.url),o.responseType="json",o.response=d,delete o.responseText}else"pabinary"===r&&(o.response instanceof Blob?(h=AppMagic.Services.ServiceUtility.tryGetMimeTypeFromRequestOrResponse(o),o.response=Core.PABinary.createFromBlob(o.response,h&&h!==o.response.type?h:void 0)):delete o.response,o.responseType="pabinary");return AppMagic.Services.ServiceUtility.addSendHttpPipelinePerf("SendHttpCore",o,t,n,Date.now()),[2,o]}}))}))},e.prototype._getAuthorizationHeaderLength=function(e){return(e.headers&&HashTableUtility.tryGetValueIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.Authorization)||"").length},e.prototype._createXhrOptions=function(e){var t;t=e.responseType===AppMagic.Services.ResponseTypes.PABinary?AppMagic.Services.ResponseTypes.Blob:e.responseType===AppMagic.Services.ResponseTypes.Json?AppMagic.Services.ResponseTypes.Text:e.responseType||AppMagic.Services.ResponseTypes.Text;var n={type:e.method,url:e.url,headers:e.headers,data:null,responseType:t,customRequestInitializer:this._customRequestInitializerFn};if(void 0!==e.bodyData&&null!==e.bodyData){var r=null;if(e.bodyData instanceof Core.PABinary)switch(e.bodyData.source.sourceType){case"arrayBuffer":r=e.bodyData.source.buffer;break;case"base64String":r=Core.IO.Utility.Conversion.base64ToArrayBuffer(e.bodyData.source.base64);break;case"blob":r=e.bodyData.source.blob;break;case"invalid":throw Core.PABinary.createErrorFromInvalid(e.bodyData);default:throw new Core.NotSupportedError("SendHttpCore._createXhrOptions","Request bodyData is a PABinary, but the sourceType is not yet supported: ".concat(e.bodyData.source.sourceType))}else r=e.bodyData;n.data=r}return n},e.prototype._isValidCacheControlHeader=function(e){var t=e.url,n=e.headers;return!t||![".azure-apim.net/",".powerapps.com/","fakewebauth.example.net:",".powerplatform.com/"].find((function(e){return-1!==t.indexOf(e)}))||n[AppMagic.Services.HttpConstants.HeaderName.CacheControl]===AppMagic.Services.HttpConstants.HeaderValue.NoCacheNoStore},e}()},function(e,t,n){"use strict";n.r(t);var r=n(56),i=n(35),o=n(57),s=n(58),a=n(59),c=function(){function e(){}return e.prototype.processNotification=function(e){var t=a.PushNotificationParser.parsePushNotificationWindows(e);return null===t?(Core.Log.error("PushNotificationProcessorWindows.processNotification","Unsupported notification format."),null):(Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.receivedRemoteNotification,{category:AppMagic.Services.RemoteNotification.NotificationCategory[t.category],subcategory:AppMagic.Services.RemoteNotification.NotificationSubcategory[t.subcategory],appId:Core.Utility.getGuidFromAppId(t.uri),correlationId:t.correlationId}),t)},e}();n.d(t,"Context",(function(){return u})),n.d(t,"NoOpContext",(function(){return l}));var p=Core.Environment.CordovaPlatformId,u=function(){function e(e,t,n){this._httpClient=t,this._isDisposed=!1,this._pushChannelManager=null,this._settingsProvider=e,this._avoidNewNotifications=!1,this._identityServiceFn=n}return e.create=function(t,n,r){return Core.Environment.isWebAuthoring()||Core.Environment.isWebPlayer()||Core.Environment.isTestMode()||!this._hasCordova()?new l(n,r):new e(t,n,r)},e.prototype.registerNotificationHandlerCreator=function(e){this._handlerCreator=e},e.prototype.dispose=function(){this._isDisposed=!0,null!==this._pushChannelManager&&this._pushChannelManager.dispose()},e.prototype.setupPushNotification=function(e){this._avoidNewNotifications?Core.Log.warning("Context.setupPushNotification","A notification handler was not registered for handling notifications since avoidNewNotifications flag is set to "+this._avoidNewNotifications):null===this._pushChannelManager&&(this._pushChannelManager=this._createPushNotificationManager(),null===this._pushChannelManager)||this._startListening(e)},e.prototype.renewPushNotificationRegistration=function(e){if(this._avoidNewNotifications)Core.Log.warning("Context.renewPushNotificationRegistration","A notification handler was not registered for renewing notification handling since avoidNewNotifications flag is set to "+this._avoidNewNotifications);else{if(null!==e)return null===this._pushChannelManager?this.setupPushNotification(e):void this._pushChannelManager.renewPushNotificationRegistration(e);Core.Log.error("Context.renewPushNotificationRegistration","UserIdentity was null, we cannot renew notification with no UserIdentity.")}},e.prototype.stopPushNotificationAsync=function(e){return null===this._pushChannelManager?Promise.resolve():this._pushChannelManager.stopListeningAsync(e)},e.prototype.avoidNewNotification=function(e){Core.Log.verbose("[Notification.Context] Setting avoid new notifications to {0}.",e),this._avoidNewNotifications=e},e.prototype._startListening=function(e){(this._pushChannelManager.startListening(e),this._handlerCreator)&&this._handlerCreator.create().begin(this._pushChannelManager)},e.prototype._createPushNotificationManager=function(){var e=this._getChannelRegistrar();if(null===e)return null;var t=this._getNotificationProcessor();return new r.ChannelManager(e,t)},e.prototype._getNotificationProcessor=function(){switch(Core.Environment.getCordovaPlatformId()){case p.Windows:case p.NotCordova:return new c;default:return Core.Log.warning("Context._getNotificationProcessor","We have received notification, but we don't have processor for it. Platform is not supported at this time."),null}},e.prototype._getChannelRegistrar=function(){switch(Core.Environment.getCordovaPlatformId()){case p.Windows:return new i.WnsChannelRegistrar(this._settingsProvider,this._httpClient,this._identityServiceFn);case p.iOS:return new o.ApnsChannelRegistrar(this._settingsProvider,this._httpClient,this._identityServiceFn);case p.Android:return new s.GcmChannelRegistrar(this._settingsProvider,this._httpClient,this._identityServiceFn);case p.NotCordova:return new i.WnsChannelRegistrar(this._settingsProvider,this._httpClient,this._identityServiceFn);default:return Core.Log.error("Context._getChannelRegistrar","Cannot build registrar. Device is not supported."),null}},e._hasCordova=function(){return"undefined"!=typeof window&&!!window.cordova},e}(),l=function(e){function t(t,n){var r=new d;return e.call(this,r,t,n)||this}return __extends(t,e),t.prototype.registerNotificationHandlerCreator=function(e){},t.prototype.dispose=function(){},t.prototype.setupPushNotification=function(e){},t.prototype.renewPushNotificationRegistration=function(e){},t.prototype.stopPushNotificationAsync=function(e){return Promise.resolve()},t.prototype.avoidNewNotification=function(e){},t}(u),d=function(){function e(){}return e.prototype.load=function(){return Promise.resolve(!0)},e.prototype.save=function(){return Promise.resolve(!0)},e.prototype.getValue=function(e){return{}},e.prototype.removeValue=function(e){return{}},e.prototype.setValue=function(e,t){return{}},e.prototype.clear=function(){},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"UserFeaturesManager",(function(){return r}));var r=function(e){function t(t){var n=this;return(n=e.call(this)||this)._userFeaturesCache=t,n}return __extends(t,e),t.prototype.getEnabledFeaturesAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n,r,i;return __generator(this,(function(o){switch(o.label){case 0:return[4,this._userFeaturesCache.getItemsAsync()];case 1:for(e=o.sent(),t=new Set,n=0,r=Object.keys(e);n<r.length;n++)i=r[n],t.add(e[i].name);return[2,t]}}))}))},t.prototype.isFeatureEnabledAsync=function(e){return this._userFeaturesCache.containsItemAsync((function(t){return t.name===e}))},t.prototype.isRuntimeServiceAvailableAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.DataRuntimeServiceFeatureFlag}))},t.prototype.isDebugMenuAvailableAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.ShowDebugUIFeatureFlag}))},t.prototype.isHidePlayerErrorToastsEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.HidePlayerErrorToastsFlag}))},t.prototype.isLinkedInControlAvailable=function(){return this._userFeaturesCache.containsItem((function(e){return e.name===t.LinkedInControlFeatureFlag}))},t.prototype.isAppPackageResourceSplitEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableAppPackageResourceSplitFlag}))},t.prototype.isPinchToZoomEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnablePinchToZoomFeatureFlag}))},t.prototype.isConvergedPlayerUxEnabled=function(){return this._userFeaturesCache.containsItem((function(e){return e.name===t.EnableConvergedPlayerUxFeatureFlag}))},t.prototype.isAppModulesFavoritesEnabled=function(){return this._userFeaturesCache.containsItem((function(e){return e.name===t.EnableAppModulesFavoritesFeatureFlag}))},t.prototype.isShowExternalMessageUIEnabled=function(){return this._userFeaturesCache.containsItem((function(e){return e.name===t.ShowExternalMessageUIFeatureFlag}))},t.prototype.isKillSwitchForStudioSerivceWorkerEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableKillSwitchForStudioSerivceWorker}))},t.prototype.isUpdatedAppListUXDisabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.UpdatedAppListUXFlag}))},t.prototype.canUseCustomBrandingAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.CanUseCustomBranding}))},t.prototype.isOneAuthEnabledAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,n;return __generator(this,(function(r){switch(r.label){case 0:return[4,this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableOneAuthFlag||e.name===t.EnableOneAuthGAFlag}))];case 1:return e=r.sent(),n=!1,!0!==e?[3,3]:[4,this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.ForceDisableOneAuthFlag}))];case 2:n=r.sent(),r.label=3;case 3:return[2,e&&!n]}}))}))},t.prototype.forceLogoutEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.ForceLogoutFlag}))},t.prototype.isGPT3SmartFormulaDataReviewEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableGPT3SmartFormulaDataReviewFlag}))},t.prototype.isParseInstallConnectionObjectEnabled=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.ParseInstallConnectionObject}))},t.prototype.isPayGoEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnablePayGoGAFeatures}))},t.prototype.isCanvasComponentsALMEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableCanvasComponentsALM}))},t.prototype.isCanvasComponentsInTeamsEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableCanvasComponentsInTeams}))},t.prototype.isPostFlowUsagesEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.PostFlowUsages}))},t.prototype.isSkipTestConnectionEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.ClientSkipTestConnection}))},t.prototype.isDisableInvokePatternEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.DisableInvokePattern}))},t.prototype.isEnableAppDescriptionGenerationEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableAppDescriptionGeneration}))},t.prototype.isEnableAppDescriptionAutoGenerationEnabledAsync=function(){return this._userFeaturesCache.containsItemAsync((function(e){return e.name===t.EnableAppDescriptionAutoGeneration}))},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.CanUseCustomBranding="CanUseCustomBranding",t.DataRuntimeServiceFeatureFlag="DataRuntimeService",t.EnableAppModulesFavoritesFeatureFlag="EnableAppModulesFavorites",t.EnableAppPackageResourceSplitFlag="EnableAppPackageResourceSplit",t.EnableCanvasComponentsALM="EnableCanvasComponentsALM",t.EnableCanvasComponentsInTeams="EnableCanvasComponentsInTeams",t.EnableConvergedPlayerUxFeatureFlag="EnableConvergedPlayerUx",t.EnableGPT3SmartFormulaDataReviewFlag="EnableGPT3SmartFormulaDataReview",t.EnableKillSwitchForStudioSerivceWorker="EnableKillSwitchForStudioSerivceWorker",t.EnableOneAuthFlag="EnableOneAuthFlighting",t.EnableOneAuthGAFlag="EnableOneAuthGA",t.EnablePayGoGAFeatures="EnablePayGoGAFeatures",t.EnablePinchToZoomFeatureFlag="EnablePinchToZoom",t.ForceDisableOneAuthFlag="ForceDisableOneAuth",t.ForceLogoutFlag="ForceLogout",t.HidePlayerErrorToastsFlag="HidePlayerErrorToasts",t.LinkedInControlFeatureFlag="ShowLinkedInControl",t.ParseInstallConnectionObject="InstallFlowExpandConnection",t.ShowDebugUIFeatureFlag="ShowDebugUI",t.ShowExternalMessageUIFeatureFlag="ShowExternalMessageUI",t.UpdatedAppListUXFlag="IsUpdatedAppListUXDisabled",t.PostFlowUsages="PostFlowUsages",t.ClientSkipTestConnection="ClientSkipTestConnection",t.DisableInvokePattern="DisableInvokePattern",t.EnableAppDescriptionGeneration="EnableAppDescriptionGeneration",t.EnableAppDescriptionAutoGeneration="EnableAppDescriptionAutoGeneration",t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"UserTenantsManager",(function(){return i}));var r=n(20),i=function(e){function t(t){var n=this;return(n=e.call(this)||this)._userTenantCache=t,n}return __extends(t,e),t.prototype.getUserTenantsAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return[],[4,this._userTenantCache.getItemsAsync()];case 1:return e=t.sent(),[2,HashTableUtility.getValues(e)]}}))}))},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t.getUserTenantsFromServerAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,i,o,s;return __generator(this,(function(a){switch(a.label){case 0:return(t=AppMagic.PowerApps.BapUtility.createBapProviderUrlBuilder()).appendPath(AppMagic.PowerApps.Constants.APIs.tenants),t.setQueryParam(AppMagic.PowerApps.Constants.BapEndpoints.apiVersionKey,AppMagic.Services.Azure.Region.getCurrentRegion().bapApiVersion),n={method:AppMagic.Services.HttpConstants.Method.GET,headers:HashTableUtility.create(),url:t.toString()},AppMagic.Runtime.Client.addAuthorizationOptions(n.headers,{resource:AppMagic.Runtime.Client.ResourceNames.PowerAppsService}),AppMagic.Services.appendCustomHeadersOptions(n,{addCustomHeaders:!0}),[4,AppMagic.Services.PowerAppsHttpTelemetry.sendHttpJsonResponseAsync(e,n,"UserService.GetUserTenants")];case 1:if(i=a.sent(),!(o=AppMagic.Runtime.Client.Tenants.safeCast(i)))throw new Error("There was an error parsing the user tenants response");return s=[],o.value.forEach((function(e){var t=Object(r.parseTenant)(e);if(!t)throw new Error("There was an error parsing the tenant response: ".concat(JSON.stringify(e)));s.push(t)})),[2,s]}}))}))},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"AuthenticationBrokerManager",(function(){return r}));var r=function(e){function t(t){return e.call(this,t)||this}return __extends(t,e),t.prototype.prepareForAuthenticationSession=function(){this._broker.prepareForAuthentication()},t.prototype.cleanupAuthenticationSession=function(){this._broker.cleanup()},t}(AppMagic.Services.AuthenticationBrokerManager)},function(e,t,n){"use strict";n.r(t),n.d(t,"AuthenticationBrokerManagerFactory",(function(){return i}));var r=n(33),i=function(){function e(e,t){this._defaultBrokerManager=new r.AuthenticationBrokerManager(e),this._azureBrokerManager=t?new r.AuthenticationBrokerManager(t):this._defaultBrokerManager}return e.prototype.getBrokerManager=function(){return this._defaultBrokerManager},e.prototype.getAzureBrokerManager=function(){return this._azureBrokerManager},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"WnsChannelRegistrar",(function(){return r}));var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getRegistrationOptions=function(){return{windows:{}}},t.prototype._createPowerAppsRegistrationRequest=function(e,n){return{pushNotificationIdentity:e.pushNotificationIdentity,oldPushNotificationIdentity:n,notificationService:t.notificationService,locale:Core.Environment.getCurrentLocale(),playerType:this._playerType}},t.prototype._createPowerAppsUnregisterRequest=function(e){return{notificationService:t.notificationService,pushNotificationIdentity:e.pushNotificationIdentity,playerType:this._playerType}},t.notificationService="windows",t}(n(11).ChannelRegistrar)},function(e,t,n){"use strict";n.r(t),n.d(t,"CustomHeadersSendHttpPipeline",(function(){return l}));var r,i=n(1),o=["onyx.azure.net"],s=AppMagic.PowerApps.Constants.PowerAppsPackageDefaultValues,a=((r={})[AppMagic.Services.HttpConstants.HeaderName.CacheControl]=AppMagic.Services.HttpConstants.HeaderValue.NoCacheNoStore,r);function c(e){var t,n,r,c,l=function(e){var t=e.headers[AppMagic.Services.HttpConstants.HeaderName.CustomHeadersOptions];if(t){var n=JSON.parse(t);return AppMagic.Services.CustomHeadersOptions.safeCast(n)}return null}(e),d=!(!l||!l.optInMSHeaders),h=!(!l||!l.addCustomHeaders),g=null==l?void 0:l.headersToRemove;delete e.headers[AppMagic.Services.HttpConstants.HeaderName.CustomHeadersOptions];var f=e.headers;if(!function(e){return o.some((function(t){return e.indexOf(t)>=0}))}(e.url)&&d){Core.Telemetry.Log.sessionId&&p(f,AppMagic.Services.HttpConstants.HeaderName.MsClientSessionId,Core.Telemetry.Log.sessionId),p(f,AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId,Core.Utility.generate128BitUUID()),p(f,AppMagic.Services.HttpConstants.HeaderName.MsUserAgent,AppMagic.PowerApps.PowerAppsUtility.getXMsUserAgentValue());var m=i.SendHttpUtility.getTargetServiceFromUrl(e.url);if((null==m?void 0:m.serviceName)===i.SendHttpUtility.TargetServices.cds){p(f,AppMagic.Services.HttpConstants.HeaderName.CdsNativeRequestId,f[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId]),p(f,AppMagic.Services.HttpConstants.HeaderName.CdsNativeClientSessionId,Core.Telemetry.Log.sessionId),(y=Core.Telemetry.Log.getAppId())&&(y.indexOf("/")>-1&&(y=y.split("/").slice(-1)[0]),p(f,AppMagic.Services.HttpConstants.HeaderName.CdsNativeAppId,y))}else{var y,v=Core.Telemetry.Log.getEnvironmentId();v&&p(f,AppMagic.Services.HttpConstants.HeaderName.MsClientEnvironmentId,v),(y=Core.Telemetry.Log.getAppId())&&p(f,AppMagic.Services.HttpConstants.HeaderName.MsClientAppId,y);var C=Core.Telemetry.Log.getAppVersion();!C||Core.Environment.isWebAuthoring()&&!Core.Environment.isTestMode()||p(f,AppMagic.Services.HttpConstants.HeaderName.MsClientAppVersion,C);var A=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.IClientRuntimeSingletonKey);if(null==A?void 0:A.identityService.hasIdentity){var _=null===(n=null===(t=null==A?void 0:A.identityService)||void 0===t?void 0:t.identity)||void 0===n?void 0:n.tenantId;_&&p(f,AppMagic.Services.HttpConstants.HeaderName.MsClientTenantId,_);var P=null===(c=null===(r=null==A?void 0:A.identityService)||void 0===r?void 0:r.identity)||void 0===c?void 0:c.objectId;P&&p(f,AppMagic.Services.HttpConstants.HeaderName.MsClientObjectId,P)}}}if(-1===e.url.indexOf(s.blobWebPlayerIndexFile)&&-1===e.url.indexOf(s.blobWebPlayerManifestFile)&&(p(f,AppMagic.Services.HttpConstants.HeaderName.AcceptLanguage,Core.Globalization.currentCulture().language),p(f,AppMagic.Services.HttpConstants.HeaderName.Accept,AppMagic.Services.HttpConstants.MediaType.All)),h)for(var S in a)u(f,S,a[S]);if(g)for(var b=0,I=g;b<I.length;b++){delete f[I[b]]}}function p(e,t,n){Core.Utility.isNonEmptyNonWhitespaceString(e[t])||(e[t]=n)}function u(e,t,n){e[t]=n}var l=function(){function e(e){this._sendHttpPipeline=e}return e.prototype.sendHttpAsync=function(e){return e.headers=e.headers||HashTableUtility.create(),c(e),this._sendHttpPipeline.sendHttpAsync(e)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"ThrottleAndRetrySendHttpPipeline",(function(){return i}));var r=n(1),i=function(){function e(e,t){this._sendHttpPipeline=e,this._perConnectionThrottler=new Map,this._maxConcurrent=t}return e.prototype._getOrCreatePipelineForUrl=function(e){var t=r.SendHttpUtility.getTargetServiceFromUrl(e),n=t.serviceName===r.SendHttpUtility.TargetServices.apim,i=t.serviceName===r.SendHttpUtility.TargetServices.cds,a=n||i?t.split.slice(2,5).join("/"):null;if(!a)return new s(this._sendHttpPipeline);var c=this._perConnectionThrottler.get(a);if(!c){var p=this._maxConcurrent;i&&!Core.FallbackSwitch.isActivated("AppConnectivity.ReduceCDSMaxConcurrent")&&(p=Core.Utility.isNullOrUndefined(p)||p<=0?50:Math.min(p,50)),c=new o(this._sendHttpPipeline,p),this._perConnectionThrottler.set(a,c)}return c},e.prototype.sendHttpAsync=function(e){return this._getOrCreatePipelineForUrl(e.url).sendHttpAsync(e)},e}(),o=function(){function e(t,n){var r=this;this._concurrentCallCount=0,this._totalCallCount=0,this._sendHttpPipeline=new s(t,this),this._waitPromise=new Promise((function(e){return r._resolveCallback=e})),this._maxConcurrentCalls=n||e.defaultMaxConcurrentCalls}return e.prototype._waitAndClaimSlotAsync=function(e){var t,n;return __awaiter(this,void 0,Promise,(function(){var r,i,o,s,a;return __generator(this,(function(c){switch(c.label){case 0:i=!1,this._totalCallCount++,this._concurrentCallCount>=this._maxConcurrentCalls&&(i=!0,Core.Telemetry.Log.trackActivityEvent("PerEndpointConcurrentThrottler._waitAndClaimSlot",{message:"Request throttled",clientRequestId:null!==(n=null===(t=e.headers)||void 0===t?void 0:t[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId])&&void 0!==n?n:"",totalCallCount:this._totalCallCount,url:Core.Telemetry.Utility.scrubSensitiveDataSafe(e.url)})),o=performance.now(),c.label=1;case 1:return this._concurrentCallCount>=this._maxConcurrentCalls?[4,this._waitPromise]:[3,3];case 2:return c.sent(),[3,1];case 3:return s=performance.now(),a=s-o,r={throttleDuration:i?a:void 0},this._concurrentCallCount++,[2,r]}}))}))},e.prototype._notifyWaiters=function(){var e=this,t=this._resolveCallback;this._waitPromise=new Promise((function(t){return e._resolveCallback=t})),this._totalCallCount--,this._concurrentCallCount--,t()},e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){switch(r.label){case 0:return[4,this._waitAndClaimSlotAsync(e)];case 1:t=r.sent(),r.label=2;case 2:return r.trys.push([2,,4,5]),[4,this._sendHttpPipeline.sendHttpAsync(e)];case 3:return(n=r.sent()).throttleDuration=t.throttleDuration,[2,n];case 4:return this._notifyWaiters(),[7];case 5:return[2]}}))}))},e.prototype.on429Received=function(){this._maxConcurrentCalls=Math.max(e.minimumMaxConcurrentCalls,this._maxConcurrentCalls-1)},e.defaultMaxConcurrentCalls=100,e.minimumMaxConcurrentCalls=5,e}(),s=function(){function e(e,t){this._waitPromise=Promise.resolve(),this._waitExpires=Date.now(),this._sendHttpPipeline=e,this._parentThrottlingPipeline=t}return e.prototype.sendHttpAsync=function(e){return this._setRetryable(e),this._xhrWithRetryAsync(e,e,0)},e.prototype._setRetryable=function(t){var n,r,i,o=e._isEndpointRetryable(t)?e._getBaseRetryCodesForRequest(t):[],s=null===(n=t.retryable)||void 0===n?void 0:n.maxRetries,a=null!==(i=null===(r=t.retryable)||void 0===r?void 0:r.statusCodes)&&void 0!==i?i:[];t.retryable={maxRetries:Core.Utility.isNumber(s)?s:e._defaultMaxRetries,statusCodes:o.concat(a)}},e._getBaseRetryCodesForRequest=function(t){var n=t.method===AppMagic.Services.HttpConstants.Method.GET?AppMagic.Services.HttpConstants.HttpStatusCode.CommonRetryableErrorCodes:[AppMagic.Services.HttpConstants.HttpStatusCode.TooManyRequests],i=r.SendHttpUtility.getTargetServiceFromUrl(t.url);return e._canRetry520Failure(null==i?void 0:i.serviceName)&&n.push(AppMagic.Services.HttpConstants.HttpStatusCode.ApiHubTokenExchangeError),e._canRetryIncompleteRequestForNonGet(t,null==i?void 0:i.serviceName)&&n.push(AppMagic.Services.HttpConstants.HttpStatusCode.XhrRequestIncomplete),n},e._isEndpointRetryable=function(e){var t=r.SendHttpUtility.getTargetServiceFromUrl(e.url);return t.serviceName===r.SendHttpUtility.TargetServices.apim||t.serviceName===r.SendHttpUtility.TargetServices.cds||t.serviceName===r.SendHttpUtility.TargetServices.rp||t.serviceName===r.SendHttpUtility.TargetServices.powerplatform},e._canRetry520Failure=function(e){return!Core.FallbackSwitch.isActivated("AppConnectivity.Disable520Retry")&&(e&&e===r.SendHttpUtility.TargetServices.apim)},e._canRetryIncompleteRequestForNonGet=function(e,t){return!Core.FallbackSwitch.isActivated("AppConnectivity.DisableRetryIncompleteLaunchAppRequest")&&t===(r.SendHttpUtility.TargetServices.rp||r.SendHttpUtility.TargetServices.powerplatform)&&e.method===AppMagic.Services.HttpConstants.Method.POST&&e.url.indexOf("launchApp")>-1},e.prototype._xhrWithRetryAsync=function(t,n,i,o){var s,a,c,p,u,l,d,h,g;return void 0===o&&(o=[]),__awaiter(this,void 0,Promise,(function(){var f,m,y,v,C,A,_,P,S;return __generator(this,(function(b){switch(b.label){case 0:b.label=1;case 1:return this._waitExpires>Date.now()?[4,this._waitPromise]:[3,3];case 2:return b.sent(),[3,1];case 3:m=r.SendHttpUtility.createRequestParamsWithClonedHeaders(n),Core.FallbackSwitch.isActivated("AppConnectivity.DisableRetryBatchAndInvoke")||(y=m.method,v=m.retryable.maxRetries,C=m.retryable.statusCodes,m.headers[AppMagic.Services.HttpConstants.HeaderName.BatchedRequestMethod]&&(y=m.headers[AppMagic.Services.HttpConstants.HeaderName.BatchedRequestMethod],delete n.headers[AppMagic.Services.HttpConstants.HeaderName.BatchedRequestMethod])),b.label=4;case 4:return b.trys.push([4,6,,7]),[4,this._sendHttpPipeline.sendHttpAsync(n)];case 5:return A=b.sent(),o.length>0&&i>0&&(f={retryCount:i,retriedClientRequestIds:o},A.requestRetryInfo=f),[2,A];case 6:if(_=b.sent(),Core.PromiseUtils.throwIfCanceled(_),Core.FallbackSwitch.isActivated("AppConnectivity.DisableRetryBatchAndInvoke")&&(y=n.method,v=n.retryable.maxRetries,C=n.retryable.statusCodes),e._isRequestRetriable({method:y,maxRetries:v,retryableStatusCodes:C},i,_))return _.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.TooManyRequests&&(null===(s=this._parentThrottlingPipeline)||void 0===s||s.on429Received()),P=e._getRetryDelayInMilliseconds(_,i),(S=Date.now()+P)>this._waitExpires&&(this._waitExpires=S,this._waitPromise=Core.PromiseUtils.timeout(P)),r.SendHttpUtility.updateClientRequestIdHeader(m),Core.Telemetry.Log.trackActivityEvent("PerEndpointRetryPipeline._xhrWithRetryAsync",{message:"Request failed, issuing retry",retryCount:i,url:Core.Telemetry.Utility.scrubSensitiveDataSafe(m.url),clientRequestId:null!==(c=null===(a=m.headers)||void 0===a?void 0:a[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId])&&void 0!==c?c:"",originalClientRequestId:null!==(u=null===(p=t.headers)||void 0===p?void 0:p[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId])&&void 0!==u?u:"",httpErrorCode:null!==(d=null===(l=null==_?void 0:_.response)||void 0===l?void 0:l.status)&&void 0!==d?d:""}),o.push(null!==(g=null===(h=m.headers)||void 0===h?void 0:h[AppMagic.Services.HttpConstants.HeaderName.MsClientRequestId])&&void 0!==g?g:""),[2,this._xhrWithRetryAsync(t,m,++i,o)];throw _.retryTelemetry={retryCount:i,retriedClientRequestIds:o},_;case 7:return[2]}}))}))},e._isRequestRetriable=function(t,n,r){return n<t.maxRetries&&AppMagic.Services.errorHasHttpResponse(r)&&e._isRetryableErrorCode(r,t)},e._isRetryableErrorCode=function(e,t){return t.method===AppMagic.Services.HttpConstants.Method.GET&&e.response.status===AppMagic.Services.HttpConstants.HttpStatusCode.XhrRequestIncomplete||t.retryableStatusCodes.indexOf(e.response.status)>-1},e._getRetryDelayInMilliseconds=function(t,n){if(e._retryAfterCodes.indexOf(t.response.status)>-1&&t.response.headers[AppMagic.Services.HttpConstants.HeaderName.RetryAfter]){var r=t.response.headers[AppMagic.Services.HttpConstants.HeaderName.RetryAfter];if(Core.Utility.isIntegerString(r))return 1e3*parseInt(r);var i=e._tryParseHttpDate(r);if(i){var o=new Date;return Math.max(i.getTime()-o.getTime(),0)}}if(Core.Utility.isBoolean(t.isOnline)&&!t.isOnline)return 8e3;switch(n){case 0:return 200;case 1:return 1500;default:return 8e3}},e._tryParseHttpDate=function(e){try{return new Date(e)}catch(e){return null}},e._defaultMaxRetries=3,e._retryAfterCodes=[AppMagic.Services.HttpConstants.HttpStatusCode.TooManyRequests,AppMagic.Services.HttpConstants.HttpStatusCode.ServiceUnavailable],e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"NormalizeRequestSendHttpPipeline",(function(){return r}));var r=function(){function e(e){this._sendHttpPipeline=e}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,s;return __generator(this,(function(a){switch(a.label){case 0:return t=null,(n=e.headers?HashTableUtility.tryGetKeyIgnoreCase(e.headers,AppMagic.Services.HttpConstants.HeaderName.ContentType):null)&&(t=e.headers[n],delete e.headers[n]),r=this._getNormalizedBody(e),i=r.requestBody,o=r.bodyContentType,null!==i&&(s=AppMagic.Services.ServiceUtility.computeNormalizedRequestContentType(e.url,t,i,o),e.headers||(e.headers=HashTableUtility.create()),e.headers[AppMagic.Services.HttpConstants.HeaderName.ContentType]=s),[4,this._sendHttpPipeline.sendHttpAsync(e)];case 1:return[2,a.sent()]}}))}))},e.prototype._getNormalizedBody=function(e){var t,n;return void 0===e.bodyData||null===e.bodyData?t=null:e.bodyData instanceof Core.PABinary?n=(t=e.bodyData).contentType:e.bodyData instanceof Blob?n=(t=e.bodyData).type:t=e.bodyData,{requestBody:t,bodyContentType:n}},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"OnlineCheckSendHttpPipeline",(function(){return r}));var r=function(){function e(e){this._sendHttpPipeline=e,this._cacheExpiryMS=3e3}return e.prototype.sendHttpAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){switch(r.label){case 0:r.label=1;case 1:return r.trys.push([1,3,,6]),[4,this._sendHttpPipeline.sendHttpAsync(e)];case 2:return[2,r.sent()];case 3:return t=r.sent(),AppMagic.Services.errorHasHttpResponse(t)&&!(t.response.status<100)||void 0!==t.isOnline?[3,5]:((!this._cachedItem||(new Date).getTime()-this._cachedItem.timestamp>=this._cacheExpiryMS)&&(this._cachedItem={timestamp:(new Date).getTime(),promise:AppMagic.PowerApps.PowerAppsUtility.isOnlineAsync()}),n=t,[4,this._cachedItem.promise]);case 4:n.isOnline=r.sent(),r.label=5;case 5:throw t;case 6:return[2]}}))}))},e}()},function(e,t,n){"use strict";var r;n.r(t),n.d(t,"ResourceTimingProvider",(function(){return i})),function(e){e.BufferSize=500,e.SafeRegionSize=100,e.WarningBufferSize=e.BufferSize-e.SafeRegionSize}(r||(r={}));var i=function(){function e(e){this._performanceObject=e,this._performanceObject.setResourceTimingBufferSize(r.BufferSize)}return e.isCapabilitySupported=function(e){return e&&e.setResourceTimingBufferSize&&e.clearResourceTimings&&e.getEntriesByType&&e.getEntries&&Core.Utility.isDefined(e.getEntries().length)},e.prototype.validateBuffer=function(){this._performanceObject.getEntries().length>=r.WarningBufferSize&&this._performanceObject.clearResourceTimings()},e.prototype.getPerformanceByUrl=function(e){var t=this._performanceObject.getEntriesByType("resource").filter((function(t){return t.name.indexOf(e)>-1})).pop();return t&&{startTime:t.startTime,name:Core.Telemetry.Utility.scrubSensitiveDataSafe(t.name),redirectStart:t.redirectStart,redirectEnd:t.redirectEnd,fetchStart:t.fetchStart,domainLookupStart:t.domainLookupStart,domainLookupEnd:t.domainLookupEnd,connectStart:t.connectStart,connectEnd:t.connectEnd,secureConnectionStart:t.secureConnectionStart,requestStart:t.requestStart,responseStart:t.responseStart,responseEnd:t.responseEnd,transferSize:t.transferSize,nextHopProtocol:t.nextHopProtocol}},e}()},function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){void 0===e&&(e=window),void 0===t&&(t=!0),this._window=e,this._autoIncludeSameSiteNone=t,this._allowSameSiteNone=function(e){if(void 0===e&&(e=window.navigator.userAgent),!e)return!1;var t=function(t){return-1!==e.indexOf(t)};return!(t("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) GearGame UnrealEngine/4.11.2-0   depot UE4-Releases 4.9 Safari/537.36")||t("Mozilla/5.0 (Unknown; Linux x86_64) AppleWebKit/534.34 (KHTML, like Gecko) PingdomTMS/0.8.5 Safari/534.34")||t("Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.75 Safari/537.36"))&&(!t("CPU iPhone OS 12")&&!t("iPad; CPU OS 12")&&(!(t("Macintosh; Intel Mac OS X 10_14")&&t("Version/")&&t("Safari"))&&!(t("Chrome/49")||t("Chrome/5")||t("Chrome/6"))))}(this._window.navigator.userAgent)}return e.prototype.getCookie=function(e){for(var t="".concat(e.trim(),"="),n=this._window.document.cookie.split(";"),r=0;r<n.length;r++){var i=n[r],o=i.indexOf(t);if(-1!==o){var s=o+t.length;return i.substring(s,i.length)}}return""},e.prototype.createCookie=function(e,t,n){void 0===n&&(n={});var r=[];r.push("".concat(e,"=").concat(encodeURI(t))),n.path&&r.push("path=".concat(n.path)),n.domain&&r.push("domain=".concat(n.domain)),n.maxAge&&r.push("max-age=".concat(n.maxAge)),n.expires&&r.push("expires=".concat(n.expires.toUTCString()));var i="",o=n.secure?"secure":"";n.samesite?"none"===n.samesite&&this._allowSameSiteNone?(i="samesite=".concat(n.samesite),o="secure"):"none"!==n.samesite&&(i="samesite=".concat(n.samesite)):this._autoIncludeSameSiteNone&&this._allowSameSiteNone&&(i="samesite=none",o="secure"),i&&r.push(i),o&&r.push(o),this._window.document.cookie=r.join(";")},e.prototype.deleteCookie=function(e,t,n){this.createCookie(e,"",{expires:new Date(0),path:t,domain:n}),n&&this.createCookie(e,"",{expires:new Date(0),path:t})},e.prototype.areCookiesEnabled=function(){if(this._window.navigator.cookieEnabled)try{if(this._window.document.cookie)return!0;this.createCookie("testcookie","1",{expires:new Date(Date.now()+6e4)});var e=!!this.getCookie("testcookie");return this.deleteCookie("testcookie"),e}catch(e){console.log("Error thrown in areCookiesEnabled - ".concat(e.message))}return!1},e}();n.d(t,"WebCookieManager",(function(){return i}));var i=function(){function e(e){void 0===e&&(e=window),this._window=e,this._cookieManager=new r(e)}return e.prototype.deleteCookies=function(e){throw"deleteCookies is not implemented for WebCookieManager"},e.prototype.getCookies=function(e){return this._window.document.cookie.split(";").map((function(e){return e.trim()}))},e.prototype.getCookie=function(e){return this._cookieManager.getCookie(e)},e.prototype.createCookie=function(e,t,n,r,i){this._cookieManager.createCookie(e,t,{expires:n,path:r,domain:i})},e.prototype.deleteCookie=function(e,t,n){this._cookieManager.deleteCookie(e,t,n)},e.prototype.checkCookiesEnabled=function(){return this._cookieManager.areCookiesEnabled()},e}()},function(e,t,n){"use strict";function r(e){var t="".concat(e.method," ").concat(e.subUrl," HTTP/1.1\r\n");return HashTableUtility.forEach(e.additionalHeaders,(function(e,n){t+="".concat(n,": ").concat(e,"\r\n")})),e.method!==AppMagic.Services.HttpConstants.Method.POST&&e.method!==AppMagic.Services.HttpConstants.Method.PATCH&&e.method!==AppMagic.Services.HttpConstants.Method.PUT||!e.body||(t+="\r\n".concat(e.body)),t}function i(e,t){if(!t)return[];var n="--"+e+"\r\n";0===t.indexOf(n)||(n="--"+e+"\n");var r=t.split(n);if(r.splice(0,1),r.length>0){var i=r[r.length-1],o=i.indexOf("--"+e);r[r.length-1]=i.substring(0,o)}return r}function o(e){var t=-1!==e.indexOf("\r\n\r\n"),n=e.trim().split(t?"\r\n\r\n":"\n\n"),r=null,i=HashTableUtility.create(),o=null,s=null;if(n.length>0){var a=null;n.length>1&&(a=n[1].split(t?"\r\n":"\n"));var c=null;null!==a&&(c=a.slice(1),o=/(HTTP\/\d\.\d) (\d+) (.*)/gi.exec(a[0]));var p=n[0].split(t?"\r\n":"\n");if(null!==p)for(var u=0,l=p;u<l.length;u++){var d=l[u];0===d.toLowerCase().indexOf("content-id:")&&c.push(d)}0===(r=o&&o.length>=3?Number(o[2]):0)&&Core.Log.warning("BatchResponseParser._formResponseLikeObjectFromText","HTTP Status Code Missing in Batch Response Body. Returning Status 0."),c&&c.forEach((function(e){var t=e.indexOf(":");if(t>=0){var n=e.substring(0,t),r=e.substring(t+1).trim();i[n]=r}})),n.length>1&&(s=n[2])}return{headers:i,responseType:"text",status:r,response:s,responseText:s,responseSize:s&&s.length||0}}n.r(t),n.d(t,"BatchRequestHandler",(function(){return s})),n.d(t,"BatchSendHttpPipeline",(function(){return a}));var s=function(){function e(e,t,n,r){this._sendHttpPipeline=e,this._binaryResolver=t,this._baseUrl=n,this._batchId=r,this.batchedRequests=[]}return Object.defineProperty(e.prototype,"numberOfRequestsEnqueued",{get:function(){return this.batchedRequests.length},enumerable:!1,configurable:!0}),e.prototype.enqueBatchRequestAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,i;return __generator(this,(function(o){return i=new Promise((function(e,t){n=e,r=t})),this.batchedRequests.push({param:{requestParameters:e,batchInfo:t},promiseResolve:n,promiseReject:r}),[2,i]}))}))},e.prototype.submitBatchAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t,n,s,a,c,p,u,l,d,h,g,f,m,y,v,C,A,_,P,S,b;return __generator(this,(function(I){switch(I.label){case 0:e=[],t=this.batchedRequests[0].param.requestParameters,n=this._baseUrl,S=0,I.label=1;case 1:return S<this.batchedRequests.length?(s=this.batchedRequests[S].param.requestParameters,a=this.batchedRequests[S].param.batchInfo,(c=s.url.replace(n,"")).startsWith("/")&&(c=c.substr(1,c.length)),p={method:s.method,subUrl:c,additionalHeaders:a.headers},s.bodyData?s.bodyData instanceof Core.PABinary?(u=p,[4,this._binaryResolver.getAsTextAsync(s.bodyData)]):[3,3]:[3,5]):[3,7];case 2:return u.body=I.sent(),[3,5];case 3:return s.bodyData instanceof Blob?(l=p,[4,Core.IO.Utility.Conversion.blobToString(s.bodyData)]):[3,5];case 4:l.body=I.sent(),I.label=5;case 5:e.push(p),I.label=6;case 6:return S++,[3,1];case 7:d=function(e,t){for(var n="",i=0,o=e;i<o.length;i++){n+="--"+t+"\n",n+="Content-Type: application/http\r\nContent-Transfer-Encoding: binary\r\n",n+="\n",n+=r(o[i]),n+="\n"}return n+="--".concat(t,"--\r\n\0"),{subUrl:"$batch",additionalHeaders:{"Content-Type":"multipart/mixed;boundary=".concat(t),Accept:"application/json",Prefer:"odata.continue-on-error"},body:n,method:AppMagic.Services.HttpConstants.Method.POST}}(e,this._batchId),(h=new Core.UrlBuilder(n)).appendPath(d.subUrl),g=h.doneToString(),f={url:g,method:d.method,headers:t.headers,responseType:"text",bodyData:Core.PABinary.createFromText(d.body)},HashTableUtility.forEach(d.additionalHeaders,(function(e,t){f.headers[t]=e})),Core.FallbackSwitch.isActivated("AppConnectivity.DisableRetryBatchAndInvoke")||(f.headers[AppMagic.Services.HttpConstants.HeaderName.BatchedRequestMethod]=t.method),m=this.batchedRequests.length,I.label=8;case 8:return I.trys.push([8,16,,17]),Core.Log.verbose("Requests batched: ".concat(m)),[4,this._sendHttpPipeline.sendHttpAsync(f)];case 9:return"pabinary"!==(y=I.sent()).responseType?[3,11]:(v=y,[4,this._binaryResolver.getAsTextAsync(y.response)]);case 10:v.response=I.sent(),I.label=11;case 11:C=function(e){var t,n=e.response,r=[];if(e.headers){var s=/boundary=(.*)/,a=e.headers["Content-Type"];t=s.test(a)?a.match(s)[1]:""}if(!t){var c=n.indexOf("batchresponse"),p=n.indexOf("\r\n"),u=n.indexOf("\n");p>c?t=n.substring(c,p):u>c&&(t=n.substring(c,u))}t||Core.Log.errorEx("BatchResponseParser.ParseBatchResponse","batchResponseBoundary is missing.");for(var l=0,d=i(t,n);l<d.length;l++){var h=d[l],g=/^\s*Content-Type: .*boundary=(.*)\r?\n/gi.exec(h);if(g){var f=g[1],m=h.indexOf("--"+f),y=i(f,h.slice(m)).map(o);r.push.apply(r,y)}else{var v=o(h);r.push(v)}}return r}(y),A=function(e,t){var n,r,i,o,s;return __generator(this,(function(t){switch(t.label){case 0:return(n=C[e])||(Core.Log.errorEx("BatchRequestHandler.submitBatchAsync","Batch response body parse error. It is empty or not formatted correctly. Will use the outer response.",{eventData:{isEmptyResponse:!Core.Utility.isNonEmptyNonWhitespaceString(y.response)}}),n=y),n.batchCount=m,n.batchUrl=g,n.throttleDuration=y.throttleDuration,n.requestRetryInfo=y.requestRetryInfo,n.sendHttpPipelinePerf=y.sendHttpPipelinePerf,HashTableUtility.forEach(y.headers,(function(e,t){n.headers[t]||(n.headers[t]=e)})),n.status>=200&&n.status<=299?(r=_.batchedRequests[e].param.requestParameters.responseType,n.response?(i=Core.PABinary.createFromText(n.response,n.headers&&n.headers[AppMagic.Services.HttpConstants.HeaderName.ContentType]),"arraybuffer"!==r?[3,2]:(o=n,[4,_._binaryResolver.getAsArrayBufferAsync(i)])):[3,3]):[3,4];case 1:return o.response=t.sent(),[3,3];case 2:n.response=i,t.label=3;case 3:return n.responseText=void 0,n.responseType=r,_.batchedRequests[e].promiseResolve(n),[3,6];case 4:return[4,AppMagic.Services.ServiceUtility.createSendHttpErrorWithResponseAsync(n,_.batchedRequests[e].param.requestParameters.url)];case 5:s=t.sent(),_.batchedRequests[e].promiseReject(s),t.label=6;case 6:return[2]}}))},_=this,S=0,b=m,I.label=12;case 12:return S<b?[5,A(S,b)]:[3,15];case 13:I.sent(),I.label=14;case 14:return S++,[3,12];case 15:return[3,17];case 16:for(P=I.sent(),Core.Log.warning("BatchRequestHandler.submitBatchAsync","Batch operation containing ".concat(m," requests failed. Rejecting individual promises.")),P&&P.response&&(P.response.batchCount=m,P.response.batchUrl=g),S=0,b=m;S<b;S++)this.batchedRequests[S].promiseReject(P);return[3,17];case 17:return[2]}}))}))},e}(),a=function(){function e(e,t){this._sendHttpPipeline=e,this._binaryResolver=t,this._batchRequestHandlerMap=new Map,this._timeOutHandlerMap=new Map,this._batchIdCounter=new Map}return e.prototype._tryGetOrCreateBatchRequestHandlerForBatchInfo=function(e){var t=this._batchRequestHandlerMap.get(e.batchId);return t||(t=new s(this._sendHttpPipeline,this._binaryResolver,e.baseUrl,e.batchId),this._batchRequestHandlerMap.set(e.batchId,t)),t},e.prototype._clearTimeOutHander=function(e){var t=this._timeOutHandlerMap.get(e);t&&(clearTimeout(t),this._timeOutHandlerMap.delete(e))},e.prototype.sendHttpAsync=function(e){var t=this;if(Core.Environment.isReactNativePlayer()||!(Core.FeatureGates.services.enableOdataBatch&&e.headers&&e.headers.BatchInfo))return e.headers&&e.headers.BatchInfo&&delete e.headers.BatchInfo,this._sendHttpPipeline.sendHttpAsync(e);var n=JSON.parse(e.headers.BatchInfo);delete e.headers.BatchInfo;var r=n.batchId,i=n.totalRequests;if(!r||!i){var o=new s(this._sendHttpPipeline,this._binaryResolver,n.baseUrl,"batch_".concat(Core.Utility.generate128BitUUID())),a=o.enqueBatchRequestAsync(e,n);return o.submitBatchAsync(),a}var c=this._tryGetOrCreateBatchRequestHandlerForBatchInfo(n),p=c.enqueBatchRequestAsync(e,n);this._clearTimeOutHander(r);var u=(this._batchIdCounter.get(r)||0)+1,l=i-u==0;return l?this._batchIdCounter.delete(r):this._batchIdCounter.set(r,u),l||10===c.numberOfRequestsEnqueued?(this._batchRequestHandlerMap.delete(r),c.submitBatchAsync()):this._timeOutHandlerMap.set(r,setTimeout((function(){t._batchRequestHandlerMap.delete(r),t._batchIdCounter.delete(r),t._clearTimeOutHander(r),c.submitBatchAsync()}),100)),p},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"ApimHttpRequestCache",(function(){return r}));var r=function(){function e(e){this._maxSize=e.maxSize,this._currentSize=0,this._requestCache=HashTableUtility.create()}return e.prototype.removeItemIfExists=function(e){this._requestCache[e]&&(delete this._requestCache[e],--this._currentSize)},e.prototype._evictOldestItem=function(){if(this._currentSize<=0)Core.Log.error("ApimHttpRequestCache._evictOldestItem","attempting to evict an item from an empty cache");else{var e,t=(new Date).getTime();HashTableUtility.forEach(this._requestCache,(function(n,r){n.timestamp<=t&&(t=n.timestamp,e=r)})),this.removeItemIfExists(e),Core.Telemetry.Log.trackActivityEvent("ApimHttpRequestCache._evictOldestItem",{message:"least used item evicted from the cache.",itemKey:Core.Telemetry.Utility.scrubSensitiveDataSafe(e),oldestTimestamp:t})}},e.prototype.upsertItem=function(e,t){this._requestCache[e]?this._requestCache[e]=t:(this._currentSize>=this._maxSize&&this._evictOldestItem(),this._requestCache[e]=t,++this._currentSize)},e.prototype.tryGetValue=function(e){return this._requestCache[e]?this._requestCache[e]:null},e}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.Default=0]="Default",e[e.User=1]="User"}(t.EcsConfigType||(t.EcsConfigType={}))},function(e,t,n){"use strict";n.r(t),n.d(t,"NullAuthenticationPlugin",(function(){return r}));var r=function(){function e(){}return Object.defineProperty(e.prototype,"name",{get:function(){return"NullAuthenticationPlugin"},enumerable:!1,configurable:!0}),e.prototype.loadConfigurationAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){return[2]}))}))},e.prototype.acquireTokenAsync=function(e,t,n,r){return this.acquireTokenSilentAsync(e,t)},e.prototype.acquireTokenSilentAsync=function(e,t){return Promise.resolve(null)},e.prototype.clearAsync=function(){return Promise.resolve()},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"TokenUtil",(function(){return r}));var r=function(){function e(){}return e.isTokenExpiring=function(e,t){return void 0===t&&(t=0),!e||this.getExpiresIn(e)<=t},e.getExpiresWhen=function(t){var n=e.tokenExpirationTable[t];n||(n=1e3*e.getRawAuthToken(t).exp,e.tokenExpirationTable[t]=n);return n},e.getExpiresIn=function(t){var n=this.getExpiresWhen(t);return Math.abs(n)-Math.abs(Date.now()-e.deviceTimeDiff)},e.getRawAuthToken=function(e){var t=AppMagic.Services.Authentication.JsonWebToken.tryParse(e),n=t.payload,r=Core.Utility.isJsonObject(n)&&Core.Utility.isString(n.aud)&&Core.Utility.isNumber(n.exp)&&Core.Utility.isString(n.iss)&&Core.Utility.isNumber(n.nbf);return null!==t&&t.payload&&r?n:""},e.deviceTimeDiff=0,e.tokenExpirationTable={},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"NullCookieManager",(function(){return r}));var r=function(){function e(){}return e.prototype.deleteCookies=function(e){},e.prototype.getCookies=function(e){return[]},e.prototype.getCookie=function(e){return""},e.prototype.createCookie=function(e,t,n){},e.prototype.deleteCookie=function(e){},e}()},function(e,t,n){"use strict";n.r(t),function(e){n.d(t,"WebViewAuthenticationBroker",(function(){return r}));var r=function(){function t(){this._dialog=null,this._isDisposed=!1}return Object.defineProperty(t.prototype,"appCallbackUri",{get:function(){return null},enumerable:!1,configurable:!0}),t.prototype.prepareForAuthentication=function(){},t.prototype.cleanup=function(){},t.prototype.authenticateAsync=function(t,n,r,i){var o=this,s=Core.PromiseUtils.createCompletablePromise(),a=!1;return null==i||i.addEventListener("abort",(function(){var e;null===(e=o._dialog)||void 0===e||e.cancel(),s.error(Core.PromiseUtils.createCanceledError())})),e((function(){a||(o._dialog=new Core.UI.Popups.AuthenticationDialog(t,n),o._dialog.showAsync().then((function(){Core.Log.verbose("Successfully displayed auth dialog in WebViewAuthenticationBroker."),s.complete(o._dialog.authenticationResult),o._dialog.dispose(),o._dialog=null}),(function(e){Core.Log.warning("WebViewAuthenticationBroker.authenticateAsync",e,"Error when showing auth dialog."),o._dialog.dispose(),o._dialog=null,s.error(e)})))})),s.promise.catch((function(e){throw a=!0,e}))},t.prototype.dispose=function(){null!==this._dialog&&this._dialog.cancel(),this._isDisposed=!0},t}()}.call(this,n(79).setImmediate)},function(e,t,n){"use strict";n.r(t),n.d(t,"AppsManager",(function(){return r}));var r=function(e){function t(t,n,r,i,o,s,a){var c=this;return(c=e.call(this)||this)._myAppsCache=t,c._orgAppsCache=n,c._globalAppsCache=r,c._modelAppsCache=i,c._myAppsTimedCache=o,c._orgAppsTimedCache=s,c._curatedAppsCache=a,c._myAppsTimedCacheOnFly=[],c._orgAppsTimedCacheOnFly=[],c}return __extends(t,e),t.prototype.getAppsForPage=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var r,i,o,s,a,c,p,u;return __generator(this,(function(l){switch(l.label){case 0:switch(e){case AppMagic.Runtime.Client.AppListType.MyApps:r=this._myAppsTimedCache,i=AppMagic.PowerApps.GetAppsClassificationFilter.MyApps;break;case AppMagic.Runtime.Client.AppListType.OrgApps:r=this._orgAppsTimedCache,i=AppMagic.PowerApps.GetAppsClassificationFilter.OrgGalleryApps;break;default:throw new Error("Unsupported app list type provided")}l.label=1;case 1:return l.trys.push([1,5,,6]),n||t?[3,3]:(a=(s=HashTableUtility).getValues,[4,r.getItemsAsync()]);case 2:if((o=a.apply(s,[l.sent()])).length>0)return[2,{appInfos:o,nextLink:null,isLoadedFromCache:!0}];l.label=3;case 3:return n||(e===AppMagic.Runtime.Client.AppListType.MyApps?this._myAppsTimedCacheOnFly=[]:this._orgAppsTimedCacheOnFly=[]),c=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.IClientRuntimeSingletonKey),[4,AppMagic.PowerApps.PowerAppsAppService.getAppPageAndLinkFromServerAsync(c.httpClient,i,t,n,!0,c.identityService.identity.tenantId)];case 4:return p=l.sent(),e===AppMagic.Runtime.Client.AppListType.MyApps?this._myAppsTimedCacheOnFly=this._myAppsTimedCacheOnFly.concat(p.appInfos):this._orgAppsTimedCacheOnFly=this._orgAppsTimedCacheOnFly.concat(p.appInfos),p.nextLink||(r.clear(),e===AppMagic.Runtime.Client.AppListType.MyApps?(r.setItems(this._myAppsTimedCacheOnFly),this._myAppsTimedCacheOnFly=[]):(r.setItems(this._orgAppsTimedCacheOnFly),this._orgAppsTimedCacheOnFly=[]),r.persist()),p.isLoadedFromCache=!1,[2,p];case 5:throw u=l.sent(),Core.PromiseUtils.throwIfCanceled(u),Core.Log.error("AppsManager.getAppsForPage",u,"forceRefresh: "+t+" type: "+AppMagic.Runtime.Client.AppListType[e]),u;case 6:return[2]}}))}))},t.prototype.getCuratedApps=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o,s,a;return __generator(this,(function(c){switch(c.label){case 0:t=this._curatedAppsCache,c.label=1;case 1:return c.trys.push([1,5,,6]),e?[3,3]:(i=(r=HashTableUtility).getValues,[4,t.getItemsAsync()]);case 2:if((n=i.apply(r,[c.sent()])).length>0)return[2,{appInfos:n,isLoadedFromCache:!0}];c.label=3;case 3:return o=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Runtime.Client.IClientRuntimeSingletonKey),[4,AppMagic.PowerApps.PowerAppsAppService.getCuratedAppsFromServerAsync(o.httpClient,o.identityService.identity.tenantId)];case 4:return s=c.sent(),t.clear(),t.setItems(s),[2,{appInfos:s,isLoadedFromCache:!1}];case 5:throw a=c.sent(),Core.PromiseUtils.throwIfCanceled(a),Core.Log.error("AppsManager.getCuratedApps",a,"forceRefresh: "+e+" type: "+AppMagic.Runtime.Client.AppListType.CuratedApps),a;case 6:return[2]}}))}))},t.prototype.getAppsAsync=function(e,t,n,r){return void 0===t&&(t=!1),void 0===n&&(n=null),void 0===r&&(r=!1),__awaiter(this,void 0,Promise,(function(){var i,o,s;return __generator(this,(function(a){switch(a.label){case 0:switch(e){case AppMagic.Runtime.Client.AppListType.MyApps:i=this._myAppsCache;break;case AppMagic.Runtime.Client.AppListType.OrgApps:i=this._orgAppsCache;break;case AppMagic.Runtime.Client.AppListType.GlobalApps:i=this._globalAppsCache;break;case AppMagic.Runtime.Client.AppListType.ModelApps:i=this._modelAppsCache;break;default:throw new Error("Unsupported app list type provided")}a.label=1;case 1:return a.trys.push([1,3,,4]),[4,i.getItemsAsync(t,{useUnifiedAppsEndpoint:r})];case 2:return o=a.sent(),n&&(o=HashTableUtility.filter(o,(function(e){return e.environment.name===n}))),[2,HashTableUtility.getValues(o)];case 3:throw s=a.sent(),Core.PromiseUtils.throwIfCanceled(s),Core.Log.error("AppsManager.getAppsAsync",s,"bypassCache: "+t+" type: "+AppMagic.Runtime.Client.AppListType[e]),s;case 4:return[2]}}))}))},t.prototype.dispose=function(){e.prototype.dispose.call(this)},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"EnvironmentInstance",(function(){return s}));var r=n(2),i=n(3),o=n(0),s=function(e){function t(t,n,r,i,s,a,c){var p=this;(p=e.call(this)||this)._environment=t,p._cacheManager=n,p._httpClient=i,p._userIdentity=s;var u=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.clientSettingsSingletonKey);return p._connectionService=new AppMagic.ConnectionHub.PowerAppsConnectionService(p._environment,p._getConnectionsCache(),p._getApiCache(),r,i,u,p._userIdentity,a,c),p}return __extends(t,e),Object.defineProperty(t.prototype,"connectionService",{get:function(){return this._connectionService},enumerable:!1,configurable:!0}),t.prototype._getConnectionsCache=function(){var e=this;return this._cacheManager.getCache(r.CacheType.Connection,(function(t){return AppMagic.ConnectionHub.PowerAppsConnectionService.getConnectionsFromServerAsync(e._environment,e._httpClient,t)}),i.CacheSettings.ConnectionCacheSettings,(function(){return e._environment.name}))},t.prototype._getApiCache=function(){var e=this;return this._cacheManager.getCache(r.CacheType.Api,(function(t){return AppMagic.ConnectionHub.PowerAppsConnectionService.getApisFromServerAsync(e._environment,e._httpClient,t)}),i.CacheSettings.ApiCacheSettings,(function(){return e._environment.name}))},t.prototype.dispose=function(){var t=this;this._cacheManager.deleteCache(r.CacheType.Connection,(function(){return t._environment.name})),this._cacheManager.deleteCache(r.CacheType.Api,(function(){return t._environment.name})),e.prototype.dispose.call(this)},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"PlanDetailsTelemetryLogger",(function(){return r}));var r=function(){function e(){this._loggedSources=[]}return e.prototype.logTelemetry=function(e,t){if(t&&-1==this._loggedSources.indexOf(e)){this._loggedSources.push(e);var n="Source = ".concat(e,". ");t.length>0?t.forEach((function(e){n+="Name: ".concat(e.properties.licenseName,", Sku: ").concat(e.properties.licenseSku,", isTrail: ").concat(e.properties.isTrial,", Status: ").concat(e.properties.capabilityStatus);var t=e.properties.policies.additionalAllowedPremiumApis,r=!!t&&t.length>0;n+=r?", AdditionalAllowedPremiumApis found. ":". "})):n+="No plan details were found.",Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.planDetailsTelemetryLogged,{message:n})}},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"TimedCache",(function(){return o}));var r=0,i=HashTableUtility.create(),o=function(e){function t(t,n,o,s){void 0===s&&(s={});var a,c,p,u,l,d=this;return(d=e.call(this)||this)._instanceId=r++,i[d._instanceId]=Contracts._sourceFromStacktrace(),d._cacheId=t,d._cacheSettingsProviderManager=n,d._updateLastSetTimestampFn=null!==(a=null==s?void 0:s.updateLastSetTimestampFn)&&void 0!==a?a:Core.Utility.noOpFn,d._staleInStorageAfterMS=null!==(c=null==s?void 0:s.staleInStorageAfterMS)&&void 0!==c?c:-1,d._settingsProvider=null!==(p=null==s?void 0:s.settingsProvider)&&void 0!==p?p:void 0,d._deserializeFn=null!==(u=null==s?void 0:s.deserializeFn)&&void 0!==u?u:null,d._networkSettingsProvider=o,d._returnStaleDataOffline=!!(null==s?void 0:s.returnStaleDataOffline),d._autoPersist=!!(null==s?void 0:s.autoPersist),d._suspend=!!(null==s?void 0:s.suspend),d._lastSetTimestamp=null!==(l=null==s?void 0:s.lastSetTimestamp)&&void 0!==l?l:null,d._initialize(),d}return __extends(t,e),Object.defineProperty(t.prototype,"cacheId",{get:function(){return this._cacheId},enumerable:!1,configurable:!0}),t.getNonDisposedInstanceStacks=function(){return HashTableUtility.clone(i)},t.prototype._initialize=function(){this._logMessage("initialize","Initializing TimedCache.",{suspend:this._suspend}),this._items=HashTableUtility.create(),this._promiseQueue=new Core.PromiseUtils.PromiseQueue("TimedCache_initialize"),this._suspend||(this._logMessage("initialize","Auto recovering cache from storage."),this.recover())},t.prototype.tryGetItem=function(e){return this._items[e]||null},t.prototype.getItemsAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e=this;return __generator(this,(function(t){return[2,this._promiseQueue.pushJob((function(){return __awaiter(e,void 0,void 0,(function(){return __generator(this,(function(e){return[2,this.getItems()]}))}))})).catch((function(t){return e._logError("getItemsAsync","Get item async failed.",t),Promise.reject(t)}))]}))}))},t.prototype.getItems=function(){return this._logMessage("getItems","Getting all items.",HashTableUtility.count(this._items)),this._items},t.prototype.setItem=function(e,t){this._suspend||(this._items[e]=t,this._lastSetTimestamp=(new Date).getTime(),this._autoPersist&&this.persist())},t.prototype.setItems=function(e){var t=this;this._suspend||(this._logMessage("setItems","Batch adding items.",e.length),e.forEach((function(e){t._items[e.cacheItemId]=e})),this._lastSetTimestamp=(new Date).getTime(),this._autoPersist&&this.persist())},t.prototype.deleteItem=function(e){this._suspend||(this._logMessage("deleteItem","Deleting item from cache."),delete this._items[e],this._autoPersist&&this.persist())},t.prototype._isDataStaleInStorage=function(e){if(this._staleInStorageAfterMS<0)return!1;var t=(new Date).getTime();return e+this._staleInStorageAfterMS<t},t.prototype.recover=function(){var e=this;if(!this._suspend){var t=this._networkSettingsProvider&&this._networkSettingsProvider.isDeviceOnline();if(null===this._lastSetTimestamp||this._isDataStaleInStorage(this._lastSetTimestamp)&&(t||!this._returnStaleDataOffline))this._logMessage("recover","Skip recovering.");else{var n=this._cacheSettingsProviderManager.loadAsync(this._settingsProvider).then((function(){var t=e._settingsProvider.getValue("items"),n=HashTableUtility.create();t&&HashTableUtility.forEach(t,(function(t){var r=e._deserializeFn(t);if(!r)throw new Error("Parsing item from storage failed.");n[r.cacheItemId]=r})),e._logMessage("recover","Loaded items from storage.",HashTableUtility.count(n)),e._items=n})).catch((function(t){Core.PromiseUtils.throwIfCanceled(t),e._logError("recover","Loading from storage failed.",t)}));this._promiseQueue.pushJob((function(){return n}))}}},t.prototype.persist=function(){var e=this;if(!this._suspend){this._logMessage("persist","Persisting to storage.",HashTableUtility.count(this._items));var t=HashTableUtility.map(this._items,(function(e){return e.serializeToJson()}));this._settingsProvider.setValue("items",t),this._settingsProvider.setValue("lastSetTimestamp",this._lastSetTimestamp);var n=this._settingsProvider.save().then((function(t){if(!t)throw new Error("Persisting cache to storage failed.");e._updateLastSetTimestampFn(e._lastSetTimestamp),e._logMessage("persist","Persisting to storage succeeded.")})).catch((function(t){Core.PromiseUtils.throwIfCanceled(t),e._logError("persist","Failed to persist to storage.",t)}));this.trackAnonymous(n)}},t.prototype.clear=function(){this._suspend||(this._logMessage("clear","Clearing cache."),this._items=HashTableUtility.create(),this._lastSetTimestamp=(new Date).getTime(),this.persist())},t.prototype.unloadAsync=function(){var e=this;return this._settingsProvider?this._cacheSettingsProviderManager.unloadAsync(this._settingsProvider).then((function(){return e._settingsProvider=null})).catch((function(e){Core.PromiseUtils.throwIfCanceled(e),Core.Log.error("TimedCache.unloadAsync",e)})):Promise.resolve()},t.prototype.dispose=function(){this._logMessage("dispose","Disposing TimedCache"),delete i[this._instanceId],this._items=null,this._promiseQueue&&(this._promiseQueue.cancelAll(),this._promiseQueue=null),e.prototype.dispose.call(this)},t.prototype._logMessage=function(e,t,n){Core.Telemetry.Log.trackActivityEvent("TimedCache.".concat(e),{instanceId:this._instanceId,cacheId:this._cacheId,message:t,data:n})},t.prototype._logError=function(e,t,n){Core.Log.errorEx("TimedCache.".concat(e),{error:n,eventData:{instanceId:this._instanceId,cacheId:this._cacheId,message:t}})},t}(Core.Disposable)},function(e,t,n){"use strict";n.r(t),n.d(t,"ClientAuthenticationRuntime",(function(){return r}));var r=function(){function e(e){this._pluginCreatorFn=e}return Object.defineProperty(e.prototype,"azureAuthenticationManager",{get:function(){return this._azureAuthenticationManager||(this._azureAuthenticationManager=new AppMagic.Services.Azure.AuthenticationManager(this._pluginCreatorFn)),this._azureAuthenticationManager},enumerable:!1,configurable:!0}),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"ClientConfigurationLoader",(function(){return r}));var r=function(e){function t(t){var n=e.call(this)||this;return n._httpClient=t,n}return __extends(t,e),Object.defineProperty(t.prototype,"configuration",{get:function(){var e=AppMagic.Services.Azure.Region.getCurrentRegion();return{appFromTemplateUseExtendedGallery:e.appFromTemplateUseExtendedGallery,documentServerEndpoint:e.docServerEndpoint.toString(),playerResourcesEndpoint:e.playerResourcesEndpoint.toString()}},enumerable:!1,configurable:!0}),t.prototype._loadingAsync=function(){return e.prototype._loadingAsync.call(this).then((function(){return Core.PromiseUtils.timeout(0)}))},t.PlayerResourcesBlobUrlTest="https://paplayercdn-test.azureedge.net/",t.PlayerResourcesBlobUrlInt="https://paplayerintcdn.azureedge.net/",t.PlayerResourcesBlobUrlPreProd="https://paplayercdn-pp.azureedge.net/",t.PlayerResourcesBlobUrlProd="https://paplayercdn.azureedge.net/",t}(Core.LifeCycleComponent)},function(e,t,n){"use strict";n.r(t),n.d(t,"ClientRuntime",(function(){return d}));var r=n(3),i=n(54),o=n(0),s=n(8),a=n(30),c=n(14),p=n(9),u=n(60),l=n(12),d=function(e){function t(){var t=e.call(this)||this;return t._isWebAuthoring=!1,t._provisionLanguageCalled=!1,Core.PerformanceRecorder.instance.setGlobalMarker("ClientRuntime.constructor"),t.internalName="ClientRuntime",t._isWebAuthoring=Core.Environment.isWebAuthoring(),t}return __extends(t,e),Object.defineProperty(t.prototype,"npsService",{get:function(){return this._npsService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"authenticationRuntime",{get:function(){return this._authenticationRuntime||(this._authenticationRuntime=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.ClientAuthenticationRuntime)),this._authenticationRuntime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clientConfiguration",{get:function(){return this._clientConfigurationLoader.configuration},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"remoteNotificationContext",{get:function(){return this._remoteNotificationContext},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"clientConfigurationLoader",{get:function(){return this._clientConfigurationLoader},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"brokerManagerFactory",{get:function(){return this._brokerManagerFactory||(this._brokerManagerFactory=Core.Loader.ObjectFactory.instance.getSingleton(s.IAuthenticationBrokerManagerFactorySingletonKey)),this._brokerManagerFactory},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"deviceCapabilityConsentSerializer",{get:function(){return this._deviceCapabilityConsentSerializer||(this._deviceCapabilityConsentSerializer=new AppMagic.Utility.DeviceCapabilityConsentSerializer(this.settingsProvider)),this._deviceCapabilityConsentSerializer},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"settingsProvider",{get:function(){return this._settingsProvider||(Core.Environment.isWebPlayer()?this._settingsProvider=new Core.IO.SettingsProviders.MemorySettingsProvider:this._settingsProvider=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.SettingsProvider)),this._settingsProvider},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"networkSettingsProvider",{get:function(){return this._networkSettingsProvider||(this._networkSettingsProvider=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.NetworkSettingsProvider)),this._networkSettingsProvider},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cookieManager",{get:function(){return this._cookieManager||(this._cookieManager=Core.Loader.ObjectFactory.instance.getSingleton(AppMagic.Services.ICookieManagerSingletonKey)),this._cookieManager},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpPipeline",{get:function(){return this._httpPipeline||(this._httpPipeline=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.AuthenticatedHttpPipeline)),this._httpPipeline},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"httpClient",{get:function(){return this._httpClient||(this._httpClient=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.AuthenticatedHttpClient)),this._httpClient},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"identityService",{get:function(){var e=this;return this._identityService||(this._identityService=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.IdentityService),this._identityService.identityChangeEvent.addListener((function(t){return e._onIdentityChange()}))),this._identityService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userService",{get:function(){return this._userService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isIdentityServiceCreated",{get:function(){return null!==this._identityService},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"dataLossPreventionClient",{get:function(){return this._dataLossPreventionClient||(this._dataLossPreventionClient=new AppMagic.PowerApps.DataLossPrevention.DataLossPreventionClient(new AppMagic.PowerApps.DataLossPrevention.DataLossPreventionService(this.identityService,this.userService,this.httpClient))),this._dataLossPreventionClient},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"powerAppsService",{get:function(){return this._powerAppsService},enumerable:!1,configurable:!0}),t.prototype._createUserInstance=function(){return new c.UserInstance(this.identityService.identity,this.httpClient,Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.CacheSettingsProviderManager),this.brokerManagerFactory.getAzureBrokerManager(),r.CacheSettings.FeaturesCacheSettings,this.networkSettingsProvider)},t.prototype._initializePowerAppsService=function(){this._powerAppsService=new AppMagic.PowerApps.PowerAppsService(this.identityService,this.httpClient,new AppMagic.PowerApps.PostConnectionUsageManager(this._userService),this._userService),this._npsService=new AppMagic.PowerApps.NpsService(this.identityService,this.httpClient)},t.prototype._initializing=function(){var t=this;e.prototype._initializing.call(this),this._clientConfigurationLoader=new i.ClientConfigurationLoader(this.httpClient),this._clientConfigurationLoader.initialize(),this._remoteNotificationContext=a.Context.create(this.settingsProvider,this.httpClient,(function(){return t.identityService}))},t.prototype._loadIdentityServiceAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e;return __generator(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,this.identityService.loadAsync()];case 1:return t.sent(),this.identityService.hasIdentity||this._updateTelemetrySession(),[3,3];case 2:return e=t.sent(),Core.Log.error("ClientRuntime._loadIdentityServiceAsync",e),[3,3];case 3:return[2]}}))}))},t.prototype._loadingAsync=function(){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,s=this;return __generator(this,(function(a){switch(a.label){case 0:return a.trys.push([0,8,,9]),[4,e.prototype._loadingAsync.call(this)];case 1:return a.sent(),[4,this._clientConfigurationLoader.loadAsync()];case 2:return a.sent(),[4,this.settingsProvider.load()];case 3:if(!a.sent())throw new Error("The settings provider could not be loaded.");return[4,(t=Core.Loader.ObjectFactory.instance.getSingleton(o.ComponentKeys.UnencryptedSettingsProvider)).load()];case 4:if(!a.sent())throw new Error("The unencrypted settings provider could not be loaded.");return n={skipLoadUserImage:Core.Environment.isWebPlayer(),skipEnroll:Core.Environment.isWebPlayer()},Core.Environment.isTestMode()?this._userService=new p.UserService(this.httpClient,this.identityService,t,(function(){return s._createUserInstance()}),n):this._userService=new u.UserServiceWithNotifications(this.httpClient,this.identityService,this.remoteNotificationContext,t,(function(){return s._createUserInstance()}),n),this._initializePowerAppsService(),this._isWebAuthoring?(this._loadIdentityAndUserServicesAsync(),[3,7]):[3,5];case 5:return[4,this._loadIdentityAndUserServicesAsync()];case 6:a.sent(),a.label=7;case 7:return[3,9];case 8:return r=a.sent(),i=Core.PromiseUtils.formatError(r),Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.appClientRuntimeLoadFailed,{error:i}),Core.Log.error("ClientRuntime._loadingAsync",r),[2,Promise.reject(r)];case 9:return[2]}}))}))},t.prototype._loadIdentityAndUserServicesAsync=function(){return __awaiter(this,void 0,void 0,(function(){return __generator(this,(function(e){switch(e.label){case 0:return[4,this._loadIdentityServiceAsync()];case 1:return e.sent(),[4,this._userService.loadAsync()];case 2:return e.sent(),[2]}}))}))},t.prototype._onLoaded=function(){e.prototype._onLoaded.call(this),Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.appClientRuntimeLoadSucceeded)},t.prototype._disposing=function(){this._remoteNotificationContext&&this._remoteNotificationContext.dispose(),this._powerAppsService.dispose(),e.prototype._disposing.call(this)},t.prototype.refreshIdentityServiceAsync=function(){return this.identityService.refreshIdentityServiceAsync()},t.prototype._onIdentityChange=function(){this.identityService.hasIdentity?(this._updateTelemetrySession(),Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.signin)):(Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.signout),this._updateTelemetrySession())},t.prototype._updateTelemetrySession=function(){Core.Telemetry.Log.identifyUser(this._getUserIdentityTelemetryData()),Core.PromiseUtils.catchAndLogErrorsAsync(Core.Telemetry.Log.trackSessionAsync(),"ClientRuntime._updateTelemetrySession"),this._dumpWebAuthBootstrapTelemetry()},t.prototype._getUserIdentityTelemetryData=function(){if(this.identityService.hasIdentity){var e=this.identityService.identity;return this.settingsProvider.currentTenantId=e.tenantId,this.settingsProvider.currentObjectId=e.objectId,Core.Telemetry.createUserIdentityData(e.tenantId,e.objectId)}return{tenantId:null,oid:null,distinct_id:null}},t.prototype._dumpWebAuthBootstrapTelemetry=function(){if(Core.Environment.isWebAuthoring()&&window._webAuthConfig&&window.WebAuthenticationBootstrap){var e=(new Date).getTime(),t=window.WebAuthenticationBootstrap.getNumAttempts(),n=window.WebAuthenticationBootstrap.getBeforeLoginTimestamp(),r=window.WebAuthenticationBootstrap.getAfterLoginTimestamp();if(t||n||r){var i={numAttempts:t,aadLoginElapsedMs:n&&r?r-n:-1,runtimeLoadedIdentityElapsedMs:r?e-r:-1};Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.webAuthClientDrivenAuthLogin,i),window.WebAuthenticationBootstrap.allGoodConfirmed()}}},t.prototype.provisionLanguageForUserInCdsLite=function(e){var t,n,r;if(!this._provisionLanguageCalled&&l.CdsLanguageProvisionHelper.checkEnvironmentSupportsProvisionLanguage(null===(n=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.linkedEnvironmentMetadata)||void 0===n?void 0:n.version,null===(r=null==e?void 0:e.properties)||void 0===r?void 0:r.environmentSku)){var i=e.properties.linkedEnvironmentMetadata.instanceUrl,o=Core.Globalization.currentCulture().currentLocaleName;this._provisionLanguageCalled=!0,this.trackAnonymous(l.CdsLanguageProvisionHelper.provisionLanguageForUserInCdsLiteAsync(this._httpClient,i,o))}},t}(Core.LifeCycleComponent)},function(e,t,n){"use strict";n.r(t),n.d(t,"ChannelState",(function(){return r})),n.d(t,"ChannelManager",(function(){return o}));var r,i=n(22);!function(e){e[e.Stopped=0]="Stopped",e[e.Acquiring=1]="Acquiring",e[e.Acquired=2]="Acquired",e[e.Stopping=3]="Stopping"}(r||(r={}));var o=function(){function e(e,t){this._isNewSetup=!1,this._isDisposed=!1,this._acquireState=r.Stopped,this._channelRegistrar=e,this._notificationProcessor=t,this._workingPromise=null,this._workingPromiseAbortController=new AbortController}return Object.defineProperty(e.prototype,"acquireState",{get:function(){return this._acquireState},enumerable:!1,configurable:!0}),e.prototype.renewPushNotificationRegistration=function(e){if(this._userIdentity=e,this._acquireState!==r.Stopping&&this.acquireState!==r.Acquiring){if(this._acquireState===r.Stopped)return this._isNewSetup=!0,void this._registerNotification(e,this._isNewSetup);Core.Log.verbose("Start renewing push notification channel."),this._isNewSetup=!1,this._registerNotification(e,this._isNewSetup)}},e.prototype.startListening=function(e){this._userIdentity=e,this.acquireState!==r.Acquired&&this.acquireState!==r.Acquiring?(Core.Log.verbose("Start listening for notification."),this.acquireState===r.Stopping&&(this._acquireState=r.Stopped,null!==this._workingPromise&&(Core.PromiseUtils.abortPromise(this._workingPromise,this._workingPromiseAbortController),this._workingPromise=null,this._workingPromiseAbortController=null)),this._isNewSetup=!0,this._registerNotification(e,this._isNewSetup)):Core.Log.verbose("Notification channel is already created or is in the process of acquiring.")},e.prototype.stopListeningAsync=function(e){return this._userIdentity=e,this.acquireState===r.Stopped||this.acquireState===r.Stopping?(Core.Log.verbose("Notification channel is already closed, or is in the process of closing."),Promise.resolve()):(Core.Log.verbose("Starting to close Push Notification Service channel."),this.acquireState===r.Acquiring&&(Core.PromiseUtils.abortPromise(this._workingPromise,this._workingPromiseAbortController),this._workingPromise=null,this._workingPromiseAbortController=null),this._acquireState=r.Stopping,this._stopListeningAsync(e))},e.prototype.dispose=function(){this._isDisposed=!0,null!==this._workingPromise&&Core.PromiseUtils.abortPromise(this._workingPromise,this._workingPromiseAbortController),this._disposeNotificationEvents()},e.prototype.registerOperationEventListener=function(e,t){void 0===t&&(t=null),this._receivedOperationNotificationEvent||(this._receivedOperationNotificationEvent=new EventObject),this._receivedOperationNotificationEvent.addListener(e,t),Core.Log.verbose("The number of listeners on the _receivedOperationNotificationEvent is {0}.",this._receivedOperationNotificationEvent.numberOfListeners)},e.prototype.registerSystemEventListener=function(e){this._receivedSystemNotificationEvent||(this._receivedSystemNotificationEvent=new EventObject),this._receivedSystemNotificationEvent.addListener(e)},e.prototype._registerNotification=function(e,t){var n=this;this._acquireState=r.Acquiring,this._workingPromiseAbortController=new AbortController;var o=Core.PromiseUtils.createCancellablePromise(this._workingPromiseAbortController);this._workingPromise=o.promise;var s=this._channelRegistrar.getRegistrationOptions();this._pushProvider=null===Object(i.getInstance)()?PushNotification.init(s):Object(i.getInstance)(),this._pushProvider.on("registration",(function(r){Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.registerDeviceWithPNSSucceed),n._channelRegistrar.notifyRegistrationAsync(r,t,e).then((function(e){e?n._onAcquireChannelSuccess(r):n._onAcquireChannelFailure(),o.complete()}),(function(e){n._onAcquireChannelFailure(),Core.Utility.isCanceledError(e)?o.error(e):o.complete()}))})),this._pushProvider.on("notification",(function(e){Core.Log.verbose("Received push notification."),n._onReceivePushNotification(e)})),this._pushProvider.on("error",(function(e){Core.Log.error("ChannelManager._registerNotification",e,"Native call for push notification failed."),Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.registerDeviceWithPNSFailed),n._onAcquireChannelFailure(),o.complete()}))},e.prototype._stopListeningAsync=function(e){var t=this;return null===e?(Core.Log.error("ChannelManager._stopListeningAsync","We could not get userIdentity to unregister the device with backend. Closing channel with Push Notification Service."),this._workingPromiseAbortController=new AbortController,this._workingPromise=this._closePnsChannelAsync(this._workingPromiseAbortController),this._disposeNotificationEvents(),Promise.resolve()):this._channelRegistrar.notifyUnregisterAsync(e).then((function(e){if(!e)return t._workingPromiseAbortController=new AbortController,t._workingPromise=t._closePnsChannelAsync(t._workingPromiseAbortController),void t._disposeNotificationEvents();Core.Log.verbose("Successfully unregistered with backend server."),t._acquireState=r.Stopped,t._disposeNotificationEvents()}),(function(e){return Core.PromiseUtils.throwIfCanceled(e),Core.Log.error("ChannelManager._stopListeningAsync",e),Promise.resolve()}))},e.prototype._closePnsChannelAsync=function(e){var t=this;if(null===this._pushProvider)return Core.Log.warning("ChannelManager._closePnsChannelAsync","Unable to close PNS channel. The _pushProvider is null."),Promise.resolve();var n=Core.PromiseUtils.createCancellablePromise(e);return this._pushProvider.unregister((function(){Core.Log.verbose("Unregistration with Push Notification Service succeed."),t._acquireState=r.Stopped,n.complete()}),(function(){Core.Log.error("ChannelManager._closePnsChannelAsync","Unregistration with Push Notification Service failed."),t._acquireState=r.Acquired,n.complete()})),n.promise},e.prototype._onAcquireChannelFailure=function(){Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.acquiringRemoteNotificationChannelFailed),this._acquireState=r.Stopped},e.prototype._onAcquireChannelSuccess=function(e){Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.acquiringRemoteNotificationChannelSucceed),this._acquireState=r.Acquired,this._pushChannelInfo=e},e.prototype._onReceivePushNotification=function(e){if(null!==this._notificationProcessor){var t=this._notificationProcessor.processNotification(e);if(null!==t){switch(t.category){case AppMagic.Services.RemoteNotification.NotificationCategory.Operation:this._receivedOperationNotificationEvent&&this._receivedOperationNotificationEvent.dispatch(t);break;case AppMagic.Services.RemoteNotification.NotificationCategory.System:this._receivedSystemNotificationEvent&&this._receivedSystemNotificationEvent.dispatch(t);break;default:Core.Log.warning("ChannelManager._onReceivePushNotification","We received unknown notification category. We don't have any event to support it.")}Core.Environment.getCordovaPlatformId()===Core.Environment.CordovaPlatformId.iOS&&null!==this._pushProvider&&this._pushProvider.finish((function(){Core.Log.verbose("Finished processing a push notification.")}),(function(){Core.Log.error("ChannelManager._onReceivePushNotification","Error occurred in processing finish request in iOS push plugin.")}))}}},e.prototype._disposeNotificationEvents=function(){this._receivedOperationNotificationEvent&&(this._receivedOperationNotificationEvent.isDisposed||this._receivedOperationNotificationEvent.dispose(),this._receivedOperationNotificationEvent=null),this._receivedSystemNotificationEvent&&(this._receivedSystemNotificationEvent.isDisposed||this._receivedSystemNotificationEvent.dispose(),this._receivedSystemNotificationEvent=null)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"ApnsChannelRegistrar",(function(){return r}));var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getRegistrationOptions=function(){return{ios:{alert:"true",badge:"true",sound:"true"}}},t.prototype._createPowerAppsRegistrationRequest=function(e,n){return{pushNotificationIdentity:e.pushNotificationIdentity,oldPushNotificationIdentity:n,locale:Core.Environment.getCurrentLocale(),notificationService:t.notificationService,playerType:this._playerType}},t.prototype._createPowerAppsUnregisterRequest=function(e){return{notificationService:t.notificationService,pushNotificationIdentity:e.pushNotificationIdentity,playerType:this._playerType}},t.notificationService="ios",t}(n(11).ChannelRegistrar)},function(e,t,n){"use strict";n.r(t),n.d(t,"GcmChannelRegistrar",(function(){return r}));var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.getRegistrationOptions=function(){return{android:{senderID:AppMagic.Services.Azure.Region.getCurrentRegion().gcmSenderId,icon:"notification_icon",iconColor:"#99004C"}}},t.prototype._createPowerAppsRegistrationRequest=function(e,n){return{pushNotificationIdentity:e.pushNotificationIdentity,oldPushNotificationIdentity:n,locale:Core.Environment.getCurrentLocale(),notificationService:t.notificationService,playerType:this._playerType}},t.prototype._createPowerAppsUnregisterRequest=function(e){return{notificationService:t.notificationService,pushNotificationIdentity:e.pushNotificationIdentity,playerType:this._playerType}},t.notificationService="android",t}(n(11).ChannelRegistrar)},function(e,t,n){"use strict";var r,i;n.r(t),n.d(t,"RawWindowsPushNotification",(function(){return r})),n.d(t,"PushNotificationParser",(function(){return i})),function(e){e.isValid=function(e){return Core.Utility.isJsonObject(e)&&Core.Utility.isString(e.title)&&Core.Utility.isString(e.message)&&Core.Utility.isString(e.category)&&Core.Utility.isString(e.subcategory)&&Core.Utility.isAbsoluteUrlString(e.uri)&&Core.Utility.isObject(e.additionalData)&&Core.Utility.isBoolean(e.additionalData.coldstart)&&Core.Utility.isGuid(e.correlationId)}}(r||(r={})),function(e){e.parsePushNotificationWindows=function(e){return r.isValid(e)?{body:e.message,category:AppMagic.Services.RemoteNotification.NotificationCategories.parseCategory(e.category),subcategory:AppMagic.Services.RemoteNotification.NotificationCategories.parseSubcategory(e.subcategory),foreground:!e.additionalData.coldstart,soundFileName:"",title:e.title,uri:e.uri,correlationId:e.correlationId}:null}}(i||(i={}))},function(e,t,n){"use strict";n.r(t),n.d(t,"UserServiceWithNotifications",(function(){return r}));var r=function(e){function t(t,n,r,i,o,s){var a=this;return(a=e.call(this,t,n,i,o,s)||this)._remoteNotificationContext=r,a.registerLogOutPredicate((function(){return Promise.resolve(!0)}),(function(){return n.hasIdentity?Promise.resolve(a._remoteNotificationContext.setupPushNotification(n.identity)):Promise.resolve()})),a}return __extends(t,e),t.prototype.logInAsync=function(e){var t=this;return this._identityService.logInAsync(e).then((function(){return t._remoteNotificationContext.setupPushNotification(t._identityService.identity)}))},t.prototype.logOutAsync=function(){var t,n=this;return(t=(t=this._identityService.hasIdentity?this._remoteNotificationContext.stopPushNotificationAsync(this._identityService.identity):this._remoteNotificationContext.stopPushNotificationAsync(null)).then((function(){return e.prototype.logOutAsync.call(n)})).then((function(e){return Promise.resolve(e)}))).catch((function(e){Core.Utility.isCanceledError(e)||Core.Log.error("UserServiceWithNotifications.logOutAsync",e)})),t},t}(n(9).UserService)},function(e,t,n){"use strict";n.r(t),n.d(t,"ApiConsumptionSendHttpPipeline",(function(){return c}));var r=n(1),i=AppMagic.PowerApps.Constants.PowerAppEndpoints,o=AppMagic.Runtime.Client.ResourceNames,s=AppMagic.PowerApps.Constants.ApimFirstSegment,a=AppMagic.Services.ServiceType.RP,c=function(){function e(e,t){void 0===t&&(t=i.apiConsumptionInterval),this._sendHttpPipeline=e,this._apiConsumptionCounter=HashTableUtility.create(),this._period=t,this._lastSentTimestamp=Date.now()}return e.prototype._sendApiConsumptionDataToRPAsync=function(e){return __awaiter(this,void 0,void 0,(function(){var t,n,r,i;return __generator(this,(function(s){switch(s.label){case 0:s.label=1;case 1:return s.trys.push([1,3,,4]),(t=this.createApiConsumptionDataToRPUrl())?(n={url:t.toString(),method:AppMagic.Services.HttpConstants.Method.POST,headers:HashTableUtility.create({"Content-Type":"application/json"}),bodyData:JSON.stringify({apiConsumptions:e})},r=AppMagic.ConnectionHub.PowerAppsConnectionService.IsPowerPlatformApiEnabled?o.PowerPlatformService:o.PowerAppsService,AppMagic.Runtime.Client.addAuthorizationOptions(n.headers,{resource:r}),i=AppMagic.ConnectionHub.PowerAppsConnectionService.IsPowerPlatformApiEnabled?"ppapi":a,AppMagic.Services.addServiceErrorOptions(n,{serviceType:i}),AppMagic.Services.addTelemetryOptions(n,{operationName:"ApiConsumptionSendHttpPipeline._sendApiConsumptionDataToRPAsync"}),[4,this._sendHttpPipeline.sendHttpAsync(n)]):[2];case 2:return s.sent(),[3,4];case 3:return s.sent(),Core.Log.warningEx("ApiConsumptionSendHttpPipeline._sendApiConsumptionDataToRPAsync","Send api consumption to rp fails. This call is a best effort call and this error is harmless."),[3,4];case 4:return[2]}}))}))},e.prototype._countApiConsumption=function(e){var t;if(0!==this._period){var n=r.SendHttpUtility.getTargetServiceFromUrl(e),i=n.serviceName,o=n.split;if(i===s&&o.length>4){var a=o[4];a&&(this._apiConsumptionCounter[a]=(null!==(t=this._apiConsumptionCounter[a])&&void 0!==t?t:0)+1)}var c=Date.now();if(c-this._lastSentTimestamp>this._period&&(this._lastSentTimestamp=c,Object.keys(this._apiConsumptionCounter).length>0)){var p=this._apiConsumptionCounter;this._apiConsumptionCounter={},this._sendApiConsumptionDataToRPAsync(p)}}},e.prototype.createApiConsumptionDataToRPUrl=function(){var e=AppMagic.ConnectionHub.PowerAppsConnectionService.IsPowerPlatformApiEnabled?AppMagic.PowerApps.PowerAppsUtility.getPowerPlatformApiVersion():i.getApiVersion(),t=Core.Telemetry.Log.getAppId().split("/").pop(),n=Core.Telemetry.Log.getEnvironmentId().split("/").pop();if(!(e&&t&&n))return Core.Log.warningEx("ApiConsumptionSendHttpPipeline._sendApiConsumptionDataToRPAsync","Cannot send api consumption data to rp because ApiVersion, appId or environment id is null"),null;var r=AppMagic.ConnectionHub.PowerAppsConnectionService.IsPowerPlatformApiEnabled?AppMagic.PowerApps.PowerAppsUtility.createPowerPlatformPowerAppsUrlBuilder(n):new Core.UrlBuilder(AppMagic.PowerApps.PowerAppsUtility.getBaseUrl());return AppMagic.ConnectionHub.PowerAppsConnectionService.IsPowerPlatformApiEnabled||(r.appendPath(i.environmentsValue),r.appendPath(n)),r.appendPath("apps"),r.appendPath(t),r.appendPath("reportapiconsumption"),r.setQueryParam(i.apiVersionKey,e),r},e.prototype.sendHttpAsync=function(e){return this._countApiConsumption(e.url),this._sendHttpPipeline.sendHttpAsync(e)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"OfflineIdentityService",(function(){return r}));var r=function(e){function t(t,n){var r=this;return(r=e.call(this,t)||this)._identityStore=n,r}return __extends(t,e),Object.defineProperty(t.prototype,"offlineIdentity",{get:function(){return this._offlineIdentity},set:function(e){this._offlineIdentity=e,this._offlineIdentity&&(this._identityStore.userIdentity=this._offlineIdentity)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasIdentity",{get:function(){return this.isConnected||!!this.offlineIdentity},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"identity",{get:function(){return this.isConnected?e.prototype.getConnectedIdentity.call(this):this.offlineIdentity},enumerable:!1,configurable:!0}),t.prototype.testOnly_setIdentity=function(e){if(!Core.Environment.isTestMode())throw new Core.NotImplementedError("testOnly_setIdentity","Method only supported for test mode.");this.offlineIdentity=e},t.prototype.logOutAsync=function(){return this.offlineIdentity=null,this._identityStore.clear(),e.prototype.logOutAsync.call(this)},t.prototype._updateIdentity=function(t){if(e.prototype._updateIdentity.call(this,t))return this.offlineIdentity=this.isConnected?e.prototype.getConnectedIdentity.call(this):this.offlineIdentity,!(this.offlineIdentity&&!this.isConnected);if(!this.isConnected&&!this.offlineIdentity){var n=this._identityStore.userIdentity;if(n)return this.offlineIdentity=n,!0}return!1},t}(AppMagic.Runtime.Client.IdentityService)},function(e,t,n){"use strict";n.r(t),n.d(t,"WebClientDrivenAuthenticationPlugin",(function(){return o}));var r=n(46),i=function(e){function t(t,n){var r=e.call(this,t,"WrappedAdalError")||this;return r._error=t,r._errorDesc=n,r}return __extends(t,e),Object.defineProperty(t.prototype,"error",{get:function(){return this._error},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"errorDesc",{get:function(){return this._errorDesc},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shouldConsiderRetrying",{get:function(){return t.RetryableErrors.hasOwnProperty(this._error)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"shouldConsiderSilentlyRetrying",{get:function(){return this.shouldConsiderRetrying&&t.SilentlyRetryableErrorDesc.hasOwnProperty(this.errorDesc)},enumerable:!1,configurable:!0}),t.RetryableErrors={login_required:1,"login required":2,interaction_required:3,"Token Renewal Failed":4},t.SilentlyRetryableErrorDesc={"Token renewal operation failed due to timeout":1},t}(Core.ErrorBase),o=function(){function e(t){var n=this;this._tenantId="common",this._lazyAdalAuthContext=new Core.Lazy((function(){t.tenant=n._tenantId;var r=new AuthenticationContext(t);return r.config.redirectUri=t.redirectUri,window.Logging=window.Logging||{},window.Logging.level=r.CONSTANTS.LOGGING_LEVEL.INFO,window.Logging.log=function(t){return e._logAdalEvent(t)},r})),this._queue=new Core.PromiseUtils.PromiseQueue("WebClientDrivenAuthenticationPlugin")}return Object.defineProperty(e.prototype,"_adalAuthContext",{get:function(){return this._lazyAdalAuthContext.value},enumerable:!1,configurable:!0}),e.prototype.loadConfigurationAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(t){return this._tenantId=e.tenantId,[2]}))}))},e.prototype.promptUserReLoginAsync=function(e,t){var n="Re-login is not supported by this authentication plugin: ".concat(this.name);throw new Core.ApplicationError(n)},e.prototype.acquireTokenAsync=function(e,t,n,r){var i=this;return this._queue.pushJob((function(){return i._acquireTokenWithRetriesAsync(e,r.claims)}))},e.prototype.acquireTokenSilentAsync=function(e,t){var n=this;return this._queue.pushJob((function(){return n._acquireTokenWithRetriesAsync(e)}))},e.prototype._acquireTokenWithRetriesAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,r,o,s;return __generator(this,(function(a){switch(a.label){case 0:return n=0,t?[4,this._retryLoginWithRetriesAsync(e,"Additional claims needed.",t)]:[3,2];case 1:a.sent(),a.label=2;case 2:n++,a.label=3;case 3:return a.trys.push([3,5,,9]),[4,this._adalAcquireRawTokenWithRetriesAsync(e)];case 4:return r=a.sent(),Contracts.checkNonEmpty(r,"Received empty access token for resource '".concat(e,"'")),[2,this._createAuthenticationResult(e,r)];case 5:if(!((o=a.sent())instanceof i))throw o;return s="Unable to obtain access token for resource '".concat(e,"'. Error from ADAL.js: ").concat(o.error," (").concat(o.errorDesc,")."),o.shouldConsiderRetrying&&this.canRetryLoginOnError?(Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.webAuthAcquireFailedWillReLogin,{attempt:n,resourceUrl:e,acquireError:s}),[4,this._retryLoginWithRetriesAsync(e,s,t)]):[3,7];case 6:return a.sent(),[3,8];case 7:throw Core.Log.error("WebClientDrivenAuthenticationPlugin.acquireTokenWithRetryAsync",s),new AppMagic.Services.Adal.AuthenticationError(AppMagic.Services.Adal.AuthenticationErrorKind.Unspecified,s);case 8:return[3,9];case 9:return[3,2];case 10:return[2]}}))}))},e.prototype._retryLoginWithRetriesAsync=function(e,t,n){return __awaiter(this,void 0,Promise,(function(){var r,o,s,a=this;return __generator(this,(function(c){switch(c.label){case 0:r=0,o=function(){var o;return __generator(this,(function(c){switch(c.label){case 0:return r++,Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.webAuthShowingReLoginDialog,{attempt:r,resourceUrl:e,errorDetails:t}),o=Core.PromiseUtils.createCompletablePromise(),[4,s.promptUserReLoginAsync(t,(function(s){return __awaiter(a,void 0,void 0,(function(){var a;return __generator(this,(function(c){switch(c.label){case 0:Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.webAuthUserClickedReLogin,{attempt:r,resourceUrl:e}),c.label=1;case 1:return c.trys.push([1,3,4,5]),[4,this._adalLoginPopupAsync(e,n)];case 2:return c.sent(),Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.webAuthReLoginSuccess,{attempt:r,resourceUrl:e}),o.complete(!0),[3,5];case 3:return(a=c.sent())instanceof i?(t="Sign in attempt failed. Error from ADAL.js: ".concat(a.error," (").concat(a.errorDesc,")"),Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.webAuthReLoginFailure,{attempt:r,resourceUrl:e,reLoginError:t}),o.complete(!1),[3,5]):(o.error(a),[2]);case 4:return s&&s.close(),[7];case 5:return[2]}}))}))}))];case 1:return c.sent(),[4,o.promise];case 2:return c.sent()?[2,"break"]:[2]}}))},s=this,c.label=1;case 1:return[5,o()];case 2:if("break"===c.sent())return[3,4];c.label=3;case 3:return[3,1];case 4:return[2]}}))}))},e.prototype.clearAsync=function(){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){return this._adalAuthContext.logOut(),[2]}))}))},e.prototype._createAuthenticationResult=function(e,t){var n=this._adalAuthContext.getCachedIdToken(),i=r.TokenUtil.getRawAuthToken(t);Contracts.checkValue(i,"Unable to parse access token for resource '".concat(e,"'"));var o=i.exp;return{accessToken:t,idToken:n,expiresOn:new Date(1e3*o)}},e.prototype._adalAcquireRawTokenWithRetriesAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,o;return __generator(this,(function(s){switch(s.label){case 0:t=3,n=0,s.label=1;case 1:0,s.label=2;case 2:return s.trys.push([2,4,,5]),[4,this._adalAcquireRawTokenAsync(e)];case 3:return r=s.sent(),n>0&&Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.webAuthLoginRetrySuccess,{attempt:n,resourceUrl:e}),[2,r];case 4:if(o=s.sent(),n++,!this.canRetryLoginOnError)throw new i("Can not retry login","".concat(this.cannotRetryLoginOnErrorReason," - ").concat(o.errorDesc));if(n>=t)throw new i("interaction_required","Max login attempts exceeded - ".concat(o.errorDesc));if(o instanceof i&&!o.shouldConsiderSilentlyRetrying)throw o;return Core.Telemetry.Log.trackActivityEvent(Core.Telemetry.OperationNames.webAuthAcquireFailedWillRetry,{attempt:n,resourceUrl:e}),[3,5];case 5:return[3,1];case 6:return[2]}}))}))},e.prototype._adalAcquireRawTokenAsync=function(e){var t=Core.PromiseUtils.createCompletablePromise();return this._adalAuthContext.acquireToken(e,(function(e,n,r){(r||e)&&t.error(new i(r,e)),t.complete(n)})),t.promise},e.prototype._adalLoginPopupAsync=function(e,t){var n=this,r=Core.PromiseUtils.createCompletablePromise();return this._adalAuthContext.popUp=!0,this._adalAuthContext.callback=function(e,t,o){n._adalAuthContext.callback=null,(o||e)&&r.error(new i(o,e)),r.complete()},this._adalAuthContext.login(e,void 0,t),r.promise},e._logAdalEvent=function(e){Core.Log.verbose("[ADAL.js log] "+e)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"ICookieManagerSingletonKey",(function(){return r}));var r=Core.Loader.TypeKey.createForInterface("AppMagic.Services.ICookieManager")},function(e,t,n){"use strict";n.r(t),n.d(t,"SubscriptionToken",(function(){return r}));var r=function(){function e(e,t){this._event=e,this._callback=t}return e.prototype.unsubscribe=function(){this._event.unsubscribe(this._callback)},e}(),i=function(){function e(e){void 0===e&&(e=!1);var t=this;this._allowStopPropagation=e,this.fire=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];for(var r=t._subscribers,i=r.length-1;i>=0;i--){var o=r[i].apply(null,e);if(t._allowStopPropagation&&o)return!0}return!1},this._subscribers=[]}return e.prototype.dispose=function(){this._subscribers=[]},e.prototype.subscribe=function(e){return this._subscribers=this._subscribers.concat(e),new r(this,e)},e.prototype.unsubscribe=function(e){this._subscribers=this._subscribers.filter((function(t){return t!==e}))},e}();t.default=i},function(e,t,n){"use strict";n.r(t);var r=n(83),i=n.n(r),o=n(65),s=n(0),a=n(44),c="ObjectId",p="TenantId",u="EnvironmentId",l="Region",d="Browser",h="HostType",g="EmbeddingHost",f="ServerLocation",m="OS",y="HostVersion",v="AppVersion",C="Webplayer",A="Mobile",_="Webauth",P="Windows",S="None",b="Teams",I="Embedded",w="IOS",T="Android",M="MobileAppFlavor",R="BundleID",E=3e5,U=5e3,H="PowerApps",k="1.0.0.0",F="enablefallbackswitches",O=n(17);n.d(t,"EcsHelper",(function(){return N}));var N=function(e){function t(){var t=e.call(this)||this;return t.configUpdated=new o.default,t}return __extends(t,e),t.prototype.fetchEcsConfigAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){return t=L(e),n=this._getCachedConfig(t),this._getAndCacheServerConfigAsyncWithTimeout(e),[2,null==n?void 0:n.config]}))}))},t.prototype.setupFallbackSwitchesAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n;return __generator(this,(function(r){switch(r.label){case 0:if(!Core.FeatureGates.flighting.enableEcsFeatures)return[3,6];r.label=1;case 1:return r.trys.push([1,5,,6]),this._cacheProviderInstance||!Core.Loader.ObjectFactory.instance.isObjectRegistered(s.ComponentKeys.EcsSettingsProvider)?[3,3]:(this._cacheProviderInstance=Core.Loader.ObjectFactory.instance.getSingleton(s.ComponentKeys.EcsSettingsProvider),[4,this._cacheProviderInstance.load()]);case 2:r.sent(),r.label=3;case 3:return[4,this.fetchEcsConfigAsync(e)];case 4:return t=r.sent(),Core.FallbackSwitch.initializeWithEcsFeatures(null==t?void 0:t.FallbackSwitch,this._getLocalFallbackSwitches()),[3,6];case 5:return n=r.sent(),Core.Telemetry.Log.trackErrorEvent("EcsHelper.setupFallbackSwitchesAsync",{error:n}),Core.FallbackSwitch.initializeWithEcsFeatures(),[3,6];case 6:return[2]}}))}))},t.prototype._getLocalFallbackSwitches=function(){var e;if(Core.Environment.isWebPlayer())e=Core.Environment.getWebPlayerQueryParam(F);else if(Core.Environment.isWebAuthoring()){var t=Core.Loader.ObjectFactory.instance.getSingleton(Core.UrlHash.IUrlHashManagerSingletonKey),n=null==t?void 0:t.getParameterValue(Core.Utility.Constants.CanvasDesignerFlagsUrlParam),r="".concat(F,"=");if(Core.Utility.isNonEmptyNonWhitespaceString(n)&&-1!==n.indexOf(r)){var i=n.indexOf(r),o=r.length;e=n.substring(i+o)}else e=null==t?void 0:t.getParameterValue(F)}return e},Object.defineProperty(t.prototype,"_ecsClientInstanceMap",{get:function(){return this._ecsClientInstanceHashTable||(this._ecsClientInstanceHashTable=HashTableUtility.create()),this._ecsClientInstanceHashTable},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_cacheProvider",{get:function(){try{this._cacheProviderInstance||(this._cacheProviderInstance=Core.Loader.ObjectFactory.instance.getSingleton(s.ComponentKeys.UnencryptedSettingsProvider))}catch(e){Core.Telemetry.Log.trackErrorEvent("EcsHelper._cacheProvider",{error:e})}return this._cacheProviderInstance},enumerable:!1,configurable:!0}),t.prototype._getAndCacheServerConfigAsyncWithTimeout=function(e){return __awaiter(this,void 0,Promise,(function(){var t;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,Core.PromiseUtils.wrapWithTimeout(this._getAndCacheServerConfigAsync(e),U)];case 1:return n.sent().hasTimedOut&&Core.Telemetry.Log.trackActivityEvent("EcsHelper.fetchEcsConfigAsync",{timeOut:!0}),[3,3];case 2:return t=n.sent(),Core.Telemetry.Log.trackErrorEvent("EcsHelper.fetchEcsConfigAsync",{error:t}),[3,3];case 3:return[2]}}))}))},t.prototype._getAndCacheServerConfigAsync=function(e){return __awaiter(this,void 0,Promise,(function(){var t,n,r,i,o=this;return __generator(this,(function(s){switch(s.label){case 0:t=L(e),n=this._getEcsClientInstance(t),s.label=1;case 1:return s.trys.push([1,3,,4]),r={clientName:H,clientVersion:k,configsToFetch:[a.EcsConfigType.Default],hosts:[AppMagic.PowerApps.PowerAppsUtility.getEcsHostResource()],initialAppActiveState:!0,getEcsParameters:function(){return Object(O.Resolved)(o._buildEcsParameters(e))},fetchTimeout:U},[4,this._loadConfigAsync(n,r)];case 2:return[2,s.sent()];case 3:return i=s.sent(),Core.Telemetry.Log.trackErrorEvent("EcsHelper.fetchEcsConfigAsync",{cacheKey:t,error:i}),Core.Telemetry.Log.trackActivityEvent("EcsHelper.fetchEcsConfigAsync",{message:"Returning existing Ecs flags."}),[2,n.ecsSettings];case 4:return[2]}}))}))},t.prototype._getEcsClientInstance=function(e){return this._ecsClientInstanceMap[e]||(this._ecsClientInstanceMap[e]={cacheKey:e,ecsClient:new i.a,isInitialized:!1}),this._ecsClientInstanceMap[e]},t.prototype._loadConfigAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n=this;return __generator(this,(function(r){return e.isInitialized?[2,e.ecsSettings]:(e.ecsConfigLoadingPromise||(e.ecsConfigLoadingPromise=new Promise((function(r,i){e.telemetryEventAddedSubsToken=e.ecsClient.telemetryEventAdded.subscribe((function(e,t){e&&t&&Core.Telemetry.Log.trackActivityEvent("EcsHelper._loadConfigAsync - ".concat(e),t)})),e.configUpdatedSubsToken=e.ecsClient.configUpdated.subscribe((function(){var t,i,o,s,a=e.ecsClient.getConfig();if(null==a?void 0:a.config){var c=Date.now();a.expiration-c>E&&(a.expiration=c+E),(null===(i=null===(t=e.ecsSettings)||void 0===t?void 0:t.Headers)||void 0===i?void 0:i.ETag)!==(null===(o=a.config.Headers)||void 0===o?void 0:o.ETag)&&(n.configUpdated.fire(a.config),Core.Telemetry.Log.trackActivityEvent("EcsHelper.configUpdated",a)),e.ecsSettings=a.config,null===(s=n._cacheProvider)||void 0===s||s.setValue(e.cacheKey,a,!0),r(e.ecsSettings)}else r(e.ecsSettings)})),e.ecsClient.initialize(t).then((function(){e.isInitialized=!0}))}))),[2,e.ecsConfigLoadingPromise])}))}))},t.prototype._getCachedConfig=function(e){var t,n=null;try{n=null===(t=this._cacheProvider)||void 0===t?void 0:t.getValue(e),Core.Telemetry.Log.trackActivityEvent("EcsHelper.getCachedConfig",{cacheKey:e,wasCached:!!n})}catch(t){Core.Telemetry.Log.trackErrorEvent("EcsHelper._getCachedConfig",{cacheKey:e,error:t})}return n},t.prototype._buildEcsParameters=function(e){var t,n,r,i={};return(null==e?void 0:e.objectId)&&(i[c]=e.objectId),(null==e?void 0:e.tenantId)&&(i[p]=e.tenantId),(null==e?void 0:e.environmentId)&&(i[u]=e.environmentId),(null==e?void 0:e.appVersion)&&(i[v]=e.appVersion),(null==e?void 0:e.bundleID)&&(i[R]=e.bundleID),(null==e?void 0:e.mobileAppFlavor)&&(i[M]=e.mobileAppFlavor),(null===(t=Core.Environment.Version)||void 0===t?void 0:t.VERSION_NUMBER)&&(i[y]=null===(n=Core.Environment.Version)||void 0===n?void 0:n.VERSION_NUMBER),(null===(r=Core.Environment.getRegionConfig())||void 0===r?void 0:r.region)&&(i[l]=Core.Environment.getRegionConfig().region),(Core.Environment.isWebPlayer()||Core.Environment.isWebAuthoring())&&(i[d]=Core.Environment.BrowserId[Core.Environment.getBrowserId()]),Core.Environment.isWebPlayer()?(i[h]=C,Core.Environment.isSkypeTeams()?i[g]=b:Core.Environment.isIframed()?i[g]=I:i[g]=S,Core.Environment.getServerLocation()&&(i[f]=Core.Environment.getServerLocation())):Core.Environment.isWebAuthoring()?(i[h]=_,Core.Environment.isWebAuthoringTeamsEmbedded()?i[g]=b:Core.Environment.isWebAuthoringEmbedded()&&(i[g]=I),Core.Environment.getServerLocation()&&(i[f]=Core.Environment.getServerLocation())):Core.Environment.isReactNativePlayer()?(i[h]=A,Core.Environment.isReactNativeIOS()?i[m]=w:Core.Environment.isReactNativeAndroid()&&(i[m]=T)):Core.Environment.isWindows10UWP()&&(i[h]=P),i},t.prototype.dispose=function(){try{HashTableUtility.forEach(this._ecsClientInstanceMap,(function(e,t){var n,r;e.isInitialized&&(null===(n=e.configUpdatedSubsToken)||void 0===n||n.unsubscribe(),null===(r=e.telemetryEventAddedSubsToken)||void 0===r||r.unsubscribe(),e.ecsClient.configUpdated.dispose(),e.ecsClient.telemetryEventAdded.dispose(),e.ecsClient.pause())})),this.configUpdated.dispose(),this._ecsClientInstanceHashTable=null}catch(e){Core.Telemetry.Log.trackErrorEvent("EcsHelper.dispose",{error:e})}},t}(Core.Disposable);function L(e){var t,n,r,i,o;return"Ecs-".concat(null!==(t=null==e?void 0:e.objectId)&&void 0!==t?t:"objectId","-").concat(null!==(n=null==e?void 0:e.environmentId)&&void 0!==n?n:"environmentId","-").concat(null!==(i=null===(r=Core.Environment.Version)||void 0===r?void 0:r.VERSION_NUMBER)&&void 0!==i?i:"clientVersion","-").concat(null!==(o=null==e?void 0:e.appVersion)&&void 0!==o?o:"appVersion")}},function(e,t,n){"use strict";function r(){}n.d(t,"a",(function(){return o}));var i=/^(\w+)\:\/\//;function o(e){var t,n,o;if(!Core.FeatureGates.promises.useNativeXhr||Core.FallbackSwitch.isActivated("RuntimeClientKillNativeXhr")||Core.Environment.isWebPlayer()&&!(null===(n=null===(t=window.webPlayerServerConfig)||void 0===t?void 0:t.FeatureGates)||void 0===n?void 0:n.enableXhrReplacement))return WinJS.xhr(e);var s=!1;var a=Core.PromiseUtils.createCancellablePromise(e.signal,(function(){o.onreadystatechange=r,s=!0,o.abort()}));o=new XMLHttpRequest;var c=!1,p=i.exec(e.url.toLowerCase());return p?"file"===p[1]&&(c=!0):"file:"===location.protocol&&(c=!0),o.onreadystatechange=function(){s?o.onreadystatechange=r:4===o.readyState&&(o.status>=200&&o.status<300||c&&0===o.status?setTimeout((function(){return a.complete(o)})):setTimeout((function(){return a.error(o)})),o.onreadystatechange=r)},o.open(e.type||"GET",e.url,!0),o.responseType=e.responseType||"",Object.keys(e.headers||{}).forEach((function(t){o.setRequestHeader(t,e.headers[t])})),e.customRequestInitializer&&e.customRequestInitializer(o),void 0===e.data?o.send():o.send(e.data),a.promise}},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"CordovaAdalPlugin",(function(){return i}));function r(e){var t=Core.PromiseUtils.createCompletablePromise();return e.then((function(e){t.complete(e)}),(function(e){t.error(e)})),t.promise}var i=function(){function e(e,t,n){var r=this;this._commonAuthority=e,this._authority=e,this._tenantId="common",this._cordovaDeviceReadyPromise=Core.PromiseUtils.createCompletablePromise(),this._cordovaDeviceReadyPromise.promise.then((function(){r._authenticationContext=new Microsoft.ADAL.AuthenticationContext(e),Core.Environment.isWindows10UWP()||Microsoft.ADAL.AuthenticationSettings.setLogger((function(e){e.level===r.errorLevel&&Core.Telemetry.Log.trackActivityEvent("CordovaAdalPlugin.NativeLog",__assign(__assign({},e),{pluginName:r.name}))})),r.httpClient=t,r._name=n})),document.addEventListener("deviceready",(function(){return r._cordovaDeviceReadyPromise.complete()}))}return Object.defineProperty(e.prototype,"name",{get:function(){return this._name},enumerable:!1,configurable:!0}),e.prototype.loadConfigurationAsync=function(e){return __awaiter(this,void 0,Promise,(function(){return __generator(this,(function(e){return[2]}))}))},e.prototype.acquireTokenAsync=function(e,t,n,i){var o=this;return this._cordovaDeviceReadyPromise.promise.then((function(){return r(o._authenticationContext.acquireTokenAsync(e,t,n,i.userId,i.extraQueryParameters,i.claims))})).then((function(e){return o._onSuccess(e)}),(function(e){return Core.PromiseUtils.throwAsync(o._createAuthenticationError(e))}))},e.prototype.acquireTokenSilentAsync=function(e,t,n){var i=this;return this._cordovaDeviceReadyPromise.promise.then((function(){return r(i._authenticationContext.tokenCache.readItems())})).then((function(e){for(var o=0;o<e.length;o++){var s=e[o];if(s.clientId===t)return n||(n=s.userInfo?s.userInfo.userId:n),i._authority=s.authority,r(Microsoft.ADAL.AuthenticationContext.createAsync(i._authority))}return i._authenticationContext})).then((function(n){return i._authenticationContext=n,i._clearTokenIfExpired(e,t)})).then((function(){return r(i._authenticationContext.acquireTokenSilentAsync(e,t,n))})).then((function(e){return i._onSuccess(e)}),(function(t){var n=i._createAuthenticationError(t),r=n.errorKind===AppMagic.Services.Adal.AuthenticationErrorKind.RefreshTokenExpired,o=r?i.clearAsync():Promise.resolve();return r&&Core.Telemetry.Log.trackActivityEvent("CordovaAdalPlugin.acquireTokenSilentAsync",{resourceUrl:e,pluginName:i.name,message:"Clearing all the tokens as cache is invalid."}),o.then((function(){return Core.PromiseUtils.throwAsync(n)}))}))},e.prototype.setUseBrokerAsync=function(e){return r(Microsoft.ADAL.AuthenticationSettings.setUseBroker(e))},e.prototype._clearTokenIfExpired=function(e,t){var n=this;return this._cordovaDeviceReadyPromise.promise.then((function(){return r(n._authenticationContext.tokenCache.readItems())})).then((function(i){var o=i.find((function(n){return n.clientId===t&&n.resource===e&&n.expiresOn.getTime()<=Date.now()+3e5}));if(o)return Core.Telemetry.Log.trackActivityEvent("CordovaAdalPlugin._clearTokenIfExpired",{resourceUrl:e,tokenExpiryTime:o.expiresOn.getTime(),pluginName:n.name,message:"Clearing specific token as it is expired beyond our sliding window."}),r(n._authenticationContext.tokenCache.deleteItem(o))}))},e.prototype.clearAsync=function(){var e=this;return Core.PromiseUtils.wrapWithFinally(this._cordovaDeviceReadyPromise.promise.then((function(){return r(e._authenticationContext.tokenCache.clear())})).then((function(){var t=new Core.UrlBuilder("https://login.windows.net/");t.appendSegment(e._tenantId),t.appendPath("/oauth2/logout");var n={url:t.doneToString(),method:AppMagic.Services.HttpConstants.Method.GET};return AppMagic.Services.addTelemetryOptions(n,{operationName:"CordovaAdalPlugin.clearAsync"}),e.httpClient.sendHttpIgnoreResponseAsync(n)})),(function(){e._authority=e._commonAuthority,e._tenantId="common",e._authenticationContext=new Microsoft.ADAL.AuthenticationContext(e._authority)}))},e.prototype._onSuccess=function(e){return this._tenantId=e.tenantId,e},e.prototype._createAuthenticationError=function(e){Core.PromiseUtils.throwIfCanceled(e);var t=Core.Utility.generate128BitUUID(),n=AppMagic.Services.Adal.DataInterfaces.PluginError.safeCast(e);return n?new AppMagic.Services.Adal.AuthenticationError(this.toAuthenticationErrorKind(n),AppMagic.Services.Adal.DataInterfaces.PluginError.formatError(n),t):new AppMagic.Services.Adal.AuthenticationError(AppMagic.Services.Adal.AuthenticationErrorKind.ServerError,Core.PromiseUtils.formatError(e),t)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"NullAuthenticationPluginCreator",(function(){return i}));var r=n(45),i=function(){function e(){}return e.prototype.getAuthenticationPlugin=function(e){return new r.NullAuthenticationPlugin},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"ConnectionHelper",(function(){return o}));var r=n(5),i=n(7),o=function(){function e(){}return e.getAuthenticatedConnectionForApiAsync=function(e,t){return __awaiter(this,void 0,Promise,(function(){var n,o,s,a,c;return __generator(this,(function(p){switch(p.label){case 0:n=Core.Loader.ObjectFactory.instance.getSingleton(i.IClientRuntimeSingletonKey),p.label=1;case 1:return p.trys.push([1,10,,11]),[4,n.userService.getConnectionServiceAsync()];case 2:return[4,(o=p.sent()).tryGetConnectionAsync(e)];case 3:return(s=p.sent())?s.isAuthenticated?(Core.Log.verbose("ConnectionHelper: getAuthenticatedConnectionForApiAsync - Found authenticated connection."),[2,s]):s.isApiConsentRequired?(Core.Log.verbose("ConnectionHelper: getAuthenticatedConnectionForApiAsync - Found unauthenticated connection."),[4,r.getConnectionConsentAsync(o,s)]):[3,5]:[3,6];case 4:return[2,p.sent()];case 5:return[3,9];case 6:return Core.Log.verbose("ConnectionHelper: getAuthenticatedConnectionForApiAsync - Connection does not exist."),[4,o.tryGetApiByNameAsync(t)];case 7:return a=p.sent(),[4,r.addConnectionAsync(o,a)];case 8:return[2,p.sent()];case 9:return[3,11];case 10:return c=p.sent(),Core.Log.error("ConnectionHelper: getAuthenticatedConnectionForApiAsync",c),[2,Promise.reject(c)];case 11:return[2]}}))}))},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"TestProfilesLoader",(function(){return r}));var r=function(){function e(e){this._testProfiles=null,this._httpClient=e}return Object.defineProperty(e.prototype,"testProfiles",{get:function(){return this._testProfiles},enumerable:!1,configurable:!0}),e.prototype.loadAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=this,[4,this._downloadTestProfileAsync()];case 1:return e._testProfiles=n.sent(),[3,3];case 2:return t=n.sent(),Core.PromiseUtils.throwIfCanceled(t),Core.Log.error("TestProfilesLoader.loadAsync",t),[3,3];case 3:return[2]}}))}))},e.prototype._downloadTestProfileAsync=function(){return __awaiter(this,void 0,Promise,(function(){var e,t;return __generator(this,(function(n){switch(n.label){case 0:return e={url:"https://powerappsclient.blob.core.windows.net/testprofiles/testProfiles.json",method:AppMagic.Services.HttpConstants.Method.GET},AppMagic.Services.addTelemetryOptions(e,{operationName:"TestProfilesLoader._downloadTestProfileAsync"}),AppMagic.Services.appendCustomHeadersOptions(e,{addCustomHeaders:!0}),[4,this._httpClient.sendHttpJsonResponseAsync(e)];case 1:return t=n.sent(),[2,AppMagic.Runtime.Client.DataInterfaces.TestProfile.safeCast(t)]}}))}))},e}()},function(e,t,n){"use strict";n.r(t);var r=n(61),i=n(27),o=n(47),s=function(){function e(e,t){this._authResultKey="EmbeddedAuthBroker.AuthResult",this._startUri=e,this._callbackUri=t,this._oauthRequestId=Core.Utility.generateNonDashedUUID()}return Object.defineProperty(e.prototype,"appCallbackUri",{get:function(){return this._callbackUri.toString()+"?id="+this._oauthRequestId},enumerable:!1,configurable:!0}),e.prototype.prepareForAuthentication=function(){this.isLocalStorageSupported()&&microsoftTeams.authentication.authenticate({url:this._startUri.toString(),successCallback:this.onAuthenticationSuccess.bind(this),failureCallback:this.onAuthenticationFailure.bind(this),width:600,height:400})},e.prototype.authenticateAsync=function(e,t){return this.isLocalStorageSupported()?(this._consentCompletablePromise=Core.PromiseUtils.createCompletablePromise(),localStorage.setItem("TeamsAuthBroker.RedirectUri",e),this._consentCompletablePromise.promise):Promise.resolve({responseData:"",authenticationStatus:AppMagic.Services.AuthenticationStatus.httpError,navigatedUris:[]})},e.prototype.onAuthenticationSuccess=function(){var e=localStorage.getItem(this._authResultKey),t=new Core.Url(e),n=t.getQueryParamFirstValue(AppMagic.ConnectionHub.Constants.ConsentServerResponseError),r=t.getQueryParamFirstValue(AppMagic.ConnectionHub.Constants.ConsentServerFlowId);!Core.Utility.isNonEmptyNonWhitespaceString(n)&&Core.Utility.isNonEmptyNonWhitespaceString(r)&&r===this._oauthRequestId?this._consentCompletablePromise.complete({responseData:e,authenticationStatus:AppMagic.Services.AuthenticationStatus.success,navigatedUris:[]}):(Core.Log.error("TeamsAuthenticationBroker._onAuthenticationSuccess","Failed to do consent flow for flowId: ".concat(r," and requestId: ").concat(this._oauthRequestId," with error: ").concat(n)),this._consentCompletablePromise.complete({responseData:e,authenticationStatus:AppMagic.Services.AuthenticationStatus.httpError,navigatedUris:[]})),this.cleanup()},e.prototype.onAuthenticationFailure=function(){this._consentCompletablePromise.complete({responseData:null,authenticationStatus:AppMagic.Services.AuthenticationStatus.cancel,navigatedUris:[]}),this.cleanup()},e.prototype.cleanup=function(){this._consentCompletablePromise=null,localStorage.removeItem("TeamsAuthBroker.RedirectUri"),localStorage.removeItem(this._authResultKey)},e.prototype.dispose=function(){this.cleanup()},e.prototype.isLocalStorageSupported=function(){try{return localStorage.setItem("TeamsAuthBroker.Text","test"),localStorage.getItem("TeamsAuthBroker.Text"),localStorage.removeItem("TeamsAuthBroker.Text"),!0}catch(e){return Core.Telemetry.Log.trackErrorEvent("TeamsAuthenticationBroker.isLocalStorageSupported",{message:"LocalStorage is not supported, unable to authenticate."}),!1}},e}(),a=function(){function e(){}return Object.defineProperty(e.prototype,"appCallbackUri",{get:function(){return null},enumerable:!1,configurable:!0}),e.prototype.prepareForAuthentication=function(){},e.prototype.cleanup=function(){},e.prototype.dispose=function(){},e.prototype.authenticateAsync=function(e,t){Core.Log.warning("UnsupportedAuthenticationBroker.authenticateAsync","Auth using UnsupportedAuthenticationBroker.");var n=Core.PromiseUtils.createCompletablePromise(),r=new Core.UI.Popups.ErrorDialog({id:"UnsupportedAuthenticationBroker.authenticateAsync",message:AppMagic.Strings.AuthenticationBrokerManagerErrorNotSupported});return r.addButton(AppMagic.Strings.Cancel),r.showAsync().then((function(){var e={responseData:null,navigatedUris:[],authenticationStatus:AppMagic.Services.AuthenticationStatus.cancel};n.complete(e)})),n.promise},e}(),c=function(){function e(e,t,n,r){void 0===r&&(r="WebClientOAuthCallbackKey"),this._consentPopup=null,this._consentCompletablePromise=null,this._consentPopupTimeouthandle=null,this._cookiePollIntervalHandle=null,this._callbackUri=t,this._cookieManager=n,this._consentStartUri=e,this._oauthRequestId=Core.Utility.generateNonDashedUUID(),this._windowCallbackKey=r,this.cleanup()}return Object.defineProperty(e.prototype,"appCallbackUri",{get:function(){return this._callbackUri.toString()+"?id="+this._oauthRequestId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isDisposed",{get:function(){return null===this._cookieManager},enumerable:!1,configurable:!0}),e.prototype.prepareForAuthentication=function(){this._openConsentPopup()},e.prototype.authenticateAsync=function(e,t){var n=this;if(!this._consentPopup)return Core.Log.error("WebClientAuthenticationBroker.authenticateAsync","No consent dialog open to render manual sign-in page."),Core.PromiseUtils.throwAsync(new AppMagic.Services.ConsentDialogNotInitializedError(AppMagic.Strings.WebClientAuthenticationBrokerConsentDialogMissing));this._consentCompletablePromise=Core.PromiseUtils.createCompletablePromise(),window[this._windowCallbackKey]=this._onConsentCompletion.bind(this),this._consentPopup.location.href=e;var r=Core.Environment.getBrowserId()===Core.Environment.BrowserId.InternetExplorer||Core.Environment.getBrowserId()===Core.Environment.BrowserId.MicrosoftEdge;return this._cookiePollIntervalHandle=this._startPollingForCookie(r),this._consentPopupTimeouthandle=setTimeout((function(){var e;try{e=Core.Telemetry.Utility.scrubSensitiveDataSafe(n._consentPopup.location.href)}catch(t){e="<redirected to OAuth>"}n._consentCompletablePromise.error(Core.Utility.throwInline(new Core.PromiseUtils.AsyncOperationCancelledError("WebClientAuthenticationBroker.authenticateAsync","Consent popup timed out. Current window url: ".concat(e))))}),18e4),this._consentCompletablePromise.promise.then((function(){return n.cleanup()}),(function(){return n.cleanup()})),this._consentCompletablePromise.promise},e.prototype._tryDisplayWebPlayerPopupBanner=function(){var e="undefined"!=typeof Player?Player:{};return!!(e&&e.Client&&e.Client.Components&&e.Client.Components.WebPlayerPopupBanner&&e.Client.Components.WebPlayerPopupBanner.display)&&(Player.Client.Components.WebPlayerPopupBanner.display(),!0)},e.prototype._openConsentPopup=function(){var e=window.innerWidth/2-300,t=window.innerHeight/2-200,n="toolbar=no,location=no,statusbar=no,menubar=no,scrollbars=yes,resizable=yes,"+"width=".concat(600,",height=").concat(400,",")+"left=".concat(e,",top=").concat(t);if(this._consentPopup=window.open(this._consentStartUri.toString(),"AuthPopUp",n),!this._consentPopup){var r=AppMagic.Strings.WebClientAuthenticationBrokerPopupBlocked;if(Core.Environment.getBrowserId()===Core.Environment.BrowserId.InternetExplorer||Core.Environment.getBrowserId()===Core.Environment.BrowserId.MicrosoftEdge)try{var i=new Core.Url(window.location.href).host,o=new Core.Url(window.document.referrer).host;""!==i&&""!==o&&i!==o&&(r=Core.Utility.formatString(AppMagic.Strings.EdgeDisablePopUpBlockersMessage,i,o));var s=AppMagic.Strings.NewWindowPrompt,a=AppMagic.Strings.UrlIndication,c=Core.Environment.getFullPageWebPlayerUrl(window.location.href),p=Core.Utility.formatString(a,c);r="".concat(r,"\n").concat(s,"\n").concat(p);var u=this._tryDisplayWebPlayerPopupBanner();Core.Telemetry.Log.trackErrorEvent("WebClientAuthenticationBroker._openConsentPopup",{openedWebPlayerPopupBanner:u,popupMessage:r,frameHref:window.location.href,referrerHref:window.document.referrer})}catch(e){Core.Telemetry.Log.trackErrorEvent("WebClientAuthenticationBroker._openConsentPopup.catch",{frameHref:window.location.href,referrerHref:window.document.referrer,error:e.toString()})}throw new AppMagic.Services.ConsentDialogNotInitializedError(r)}this._consentPopup.focus()},e.prototype._startPollingForCookie=function(e){var t=this;return setInterval((function(){var n=t._cookieManager.getCookie(t._oauthRequestId);Core.Utility.isNonEmptyString(n)?t._onConsentCompletion(n):!e&&t._consentPopup.closed&&t._onUserCancelled()}),300)},e.prototype._onConsentCompletion=function(e){var t=new Core.Url(e),n=t.getQueryParamFirstValue(AppMagic.ConnectionHub.Constants.ConsentServerResponseError),r=t.getQueryParamFirstValue(AppMagic.ConnectionHub.Constants.ConsentServerFlowId);if(!Core.Utility.isNonEmptyNonWhitespaceString(n)&&Core.Utility.isNonEmptyNonWhitespaceString(r)&&r===this._oauthRequestId)return this._consentCompletablePromise.complete({responseData:e,authenticationStatus:AppMagic.Services.AuthenticationStatus.success,navigatedUris:[]});Core.Log.error("WebClientAuthenticationBroker._onConsentCompletion","Failed to do consent flow for flowId: ".concat(r," and requestId: ").concat(this._oauthRequestId," with error: ").concat(n)),this._consentCompletablePromise.complete({responseData:e,authenticationStatus:AppMagic.Services.AuthenticationStatus.httpError,navigatedUris:[]})},e.prototype._onUserCancelled=function(){this._consentCompletablePromise.complete({responseData:null,authenticationStatus:AppMagic.Services.AuthenticationStatus.cancel,navigatedUris:[]})},e.prototype.cleanup=function(){window[this._windowCallbackKey]=null,this._cookieManager.deleteCookie(this._oauthRequestId),this._cookiePollIntervalHandle&&(clearInterval(this._cookiePollIntervalHandle),this._cookiePollIntervalHandle=null),this._consentPopupTimeouthandle&&(clearTimeout(this._consentPopupTimeouthandle),this._consentPopupTimeouthandle=null),this._consentPopup&&(this._consentPopup.close(),this._consentPopup=null),this._consentCompletablePromise=null},e.prototype.dispose=function(){this.cleanup(),this._cookieManager=null},e}(),p=n(41),u=n(48),l=n(34),d=n(21),h=n(42),g=n(28),f=n(53),m=n(55),y=n(0),v=n(36),C=n(8),A=n(7),_=n(23),P=n(38),S=n(62),b=n(39),I=n(40),w=n(29),T=n(24),M=n(15),R=n(37),E=n(67);function U(e,t){e.register(y.ComponentKeys.SettingsProvider,[],(function(){return Core.IO.SettingsProviders.SettingsProviderFactory.getLocalAppSettingsStorage()})),e.register(y.ComponentKeys.UnencryptedSettingsProvider,[],(function(){return Core.IO.SettingsProviders.SettingsProviderFactory.getLocalStorageSettingsProvider("appsettings-unencrypted.json",!0)})),e.register(y.ComponentKeys.CacheSettingsProviderManager,[],(function(){return new g.CacheSettingsProviderManager})),e.register(y.ComponentKeys.ClientAuthenticationRuntime,[],(function(){return new f.ClientAuthenticationRuntime((function(){return Core.Loader.ObjectFactory.instance.getSingleton(y.ComponentKeys.AuthenticationPluginCreator)}))})),e.register(y.ComponentKeys.SendHttpCore,[],(function(){return new w.SendHttpCore(E.a,{requestTimeout:3e5})})),e.register(y.ComponentKeys.ResourceTimingProvider,[],(function(){var e;return"undefined"!=typeof performance&&I.ResourceTimingProvider.isCapabilitySupported(performance)&&(e=new I.ResourceTimingProvider(performance)),e}));var n=new AppMagic.Services.WinJSPABinaryResolver(E.a);e.register(y.ComponentKeys.NonAuthenticatedHttpPipeline,[y.ComponentKeys.SendHttpCore,y.ComponentKeys.ResourceTimingProvider],(function(e,t){var r=e;return r=new _.InvokeSendHttpPipeline(r),r=new b.OnlineCheckSendHttpPipeline(r),r=new R.ThrottleAndRetrySendHttpPipeline(r),r=new h.BatchSendHttpPipeline(r,n),r=new M.TelemetrySendHttpPipeline(r,t),r=new P.NormalizeRequestSendHttpPipeline(r),r=new v.CustomHeadersSendHttpPipeline(r),r=new T.ServiceErrorSendHttpPipeline(r)})),e.register(y.ComponentKeys.AuthenticatedHttpPipeline,[y.ComponentKeys.ClientAuthenticationRuntime,y.ComponentKeys.SendHttpCore,y.ComponentKeys.IdentityService,y.ComponentKeys.ResourceTimingProvider],(function(e,t,o,s){var a=t;return a=new _.InvokeSendHttpPipeline(a),a=new b.OnlineCheckSendHttpPipeline(a),a=new i.ApimConnectionSendHttpPipeline(a),a=new R.ThrottleAndRetrySendHttpPipeline(a),a=new h.BatchSendHttpPipeline(a,n),a=new M.TelemetrySendHttpPipeline(a,s),a=new P.NormalizeRequestSendHttpPipeline(a),a=new d.AuthenticationSendHttpPipeline(e.azureAuthenticationManager,o,a),a=new v.CustomHeadersSendHttpPipeline(a),a=new T.ServiceErrorSendHttpPipeline(a),a=new r.ApiConsumptionSendHttpPipeline(a)})),e.register(y.ComponentKeys.HttpClient,[y.ComponentKeys.NonAuthenticatedHttpPipeline],(function(e){return new AppMagic.Services.HttpClient(e)})),e.register(y.ComponentKeys.AuthenticatedHttpClient,[y.ComponentKeys.AuthenticatedHttpPipeline],(function(e){return new AppMagic.Services.HttpClient(e)})),e.register(y.ComponentKeys.IdentityService,[y.ComponentKeys.ClientAuthenticationRuntime,y.ComponentKeys.SettingsProvider],(function(e,t){var n=new AppMagic.Services.Azure.IdentityStore(t);return new S.OfflineIdentityService(e.azureAuthenticationManager,n)})),e.register(A.IClientRuntimeSingletonKey,[],(function(){var e=new m.ClientRuntime;return e.initialize(),e.loadAsync(),e}),!0,(function(e){return e.loaded.waitAsync()})),e.register(AppMagic.Services.ICookieManagerSingletonKey,[],(function(){return Core.Environment.isWebPlayer()?new p.WebCookieManager(window):new o.NullCookieManager})),e.register(C.IAuthenticationBrokerManagerFactorySingletonKey,[],(function(){return t?new l.AuthenticationBrokerManagerFactory(t):(e=Core.Environment.isSkypeTeams()?k():Core.Environment.isWebPlayer()?H(!0):Core.Environment.isWebAuthoring()?H(!1):new u.WebViewAuthenticationBroker,n=Core.Environment.isSkypeTeams()?k():Core.Environment.isWebPlayer()?H(!0):Core.Environment.isWebAuthoring()?H(!1):new a,new l.AuthenticationBrokerManagerFactory(e,n));var e,n})),e.register(y.ComponentKeys.clientSettingsSingletonKey,[],(function(){return new AppMagic.Runtime.Client.ClientSettings})),e.register(y.ComponentKeys.NetworkSettingsProvider,[],(function(){return new Core.IO.SettingsProviders.NetworkSettingsProvider})),e.register(y.ComponentKeys.EcsHelper,[],(function(){return new AppMagic.Runtime.Client.EcsHelper}))}function H(e){var t=new p.WebCookieManager,n=new Core.UrlBuilder(window.location.protocol+"//"+window.location.host),r=n.clone();return e?(Core.Environment.isServiceFabric()?(n.appendSegment("webplayer"),r.appendSegment("webplayer")):(n.appendSegment(Core.Environment.getWebPlayerPathSegment()),r.appendSegment(Core.Environment.getWebPlayerPathSegment())),n.appendPath("webClientAuthStart.html"),r.appendPath("webClientAuthRedirect.html")):(n.appendPath("global/webClientAuthStart"),r.appendPath("global/webClientAuthRedirect")),new c(n.toUrl(),r.toUrl(),t)}function k(){var e,t=new Core.UrlBuilder(window.location.protocol+"//"+window.location.host);return Core.Environment.isServiceFabric()?((e=t.clone()).appendPath("teams/auth/connector/start"),t.appendPath("teams/auth/connector/end")):(t.appendSegment(Core.Environment.getWebPlayerPathSegment()),(e=t.clone()).appendPath("teamsAuthStart.html"),t.appendPath("teamspopup")),new s(e.toUrl(),t.toUrl())}n.d(t,"registerClientRuntimeObjects",(function(){return U}))},function(e,t){!function(){e.exports=function(){return this?this:window}()["@pa-client/core"]}()},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.assert=function(e,t){if(!e)throw new Error(t)},t.isObject=function(e){return null!==e&&"object"==typeof e},t.isString=function(e){return"string"==typeof e},t.attempt=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];try{return e.apply(void 0,t)}catch(e){return new Error(e)}},t.remove=function(e,t){for(var n=e.length-1;n>=0;n--)e[n]===t&&e.splice(n,1)},t.clone=function(e){return Array.isArray(e)?e.map(t.clone):t.isObject(e)?Object.keys(e).reduce((function(n,i){var o;return r(r({},n),((o={})[i]=t.clone(e[i]),o))}),{}):e}},function(e,t,n){(function(e){var r=void 0!==e&&e||"undefined"!=typeof self&&self||window,i=Function.prototype.apply;function o(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new o(i.call(setTimeout,r,arguments),clearTimeout)},t.setInterval=function(){return new o(i.call(setInterval,r,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},o.prototype.unref=o.prototype.ref=function(){},o.prototype.close=function(){this._clearFn.call(r,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout((function(){e._onTimeout&&e._onTimeout()}),t))},n(85),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n(80))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(78);t.DEFAULT_TIME_GROW_FACTOR=2.718281828459045,t.DEFAULT_TIME_JITTER=.11962656472;var i=function(){function e(e,n,i,o){void 0===i&&(i=t.DEFAULT_TIME_GROW_FACTOR),void 0===o&&(o=t.DEFAULT_TIME_JITTER),this._initialTime=e,this._maxTime=n,this._growFactor=i,this._jitterFactor=o,r.assert(this._initialTime>0,"Initial delay must be positive"),r.assert(this._maxTime>0,"Delay upper bound must be positive"),r.assert(this._growFactor>=0,"Ratio must be non-negative"),r.assert(this._jitterFactor>=0,"Jitter factor must be non-negative"),this.reset()}return e.prototype.reset=function(){this._incrementCount=0,this._currentTime=Math.round(this._initialTime*(1+Math.random()*this._jitterFactor))},e.prototype.getTime=function(){return this._currentTime},e.prototype.getIncrementCount=function(){return this._incrementCount},e.prototype.calculateNext=function(){var e=this._currentTime*this._growFactor;return e>this._maxTime&&(e=this._maxTime),this._jitterFactor<1e-5?this._currentTime=e:this._currentTime=Math.round(Math.random()*e*this._jitterFactor+e),this._currentTime<this._initialTime&&(this._currentTime=this._initialTime),this._currentTime>this._maxTime&&(this._currentTime=this._maxTime),this._incrementCount++,this._currentTime},e.prototype.getTimeAndCalculateNext=function(){var e=this.getTime();return this.calculateNext(),e},e}();t.ExponentialTime=i},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o,s,a=n(17),c=n(78),p=n(81);function u(e){return!!e&&0===e.indexOf("application/json")}function l(e,t){return t.canceled||!t.statusCode||t.statusCode>=400&&t.statusCode<600?s.DoNotRetry:s.RetryCountedWithBackoff}!function(e){e[e.DontCare=0]="DontCare",e[e.Low=1]="Low",e[e.Normal=2]="Normal",e[e.High=3]="High",e[e.Critical=4]="Critical"}(o=t.WebRequestPriority||(t.WebRequestPriority={})),function(e){e[e.DoNotRetry=0]="DoNotRetry",e[e.RetryUncountedImmediately=1]="RetryUncountedImmediately",e[e.RetryUncountedWithBackoff=2]="RetryUncountedWithBackoff",e[e.RetryCountedWithBackoff=3]="RetryCountedWithBackoff",e[e.PauseUntilResumed=4]="PauseUntilResumed"}(s=t.ErrorHandlingType||(t.ErrorHandlingType={})),t.DefaultOptions={priority:o.Normal},t.SimpleWebRequestOptions={MaxSimultaneousRequests:5,HungRequestCleanupIntervalMs:1e4,setTimeout:function(e,t){return setTimeout(e,t)},clearTimeout:function(e){return clearTimeout(e)}},t.DefaultErrorHandler=l;var d,h=[],g=[],f=[],m=0,y=0,v=function(){function e(e,n,r,o,s){this._action=e,this._url=n,this.options=r,this._getHeaders=o,this._blockRequestUntil=s,this._aborted=!1,this._timedOut=!1,this._paused=!1,this._created=Date.now(),this._finishHandled=!1,this._retryExponentialTime=new p.ExponentialTime(1e3,3e5),this._options=i(i({},t.DefaultOptions),r)}return e.prototype.getPriority=function(){return this._options.priority||o.DontCare},e.checkQueueProcessing=function(){for(var e=function(){var e=h.shift();g.push(e),(e._blockRequestUntil&&e._blockRequestUntil()||a.Resolved()).finally((function(){c.remove(g,e)})).then((function(){f.length<t.SimpleWebRequestOptions.MaxSimultaneousRequests&&!e._aborted?(f.push(e),C._scheduleHungRequestCleanupIfNeeded(),e._fire()):e._enqueue()}),(function(t){e._respond("_blockRequestUntil rejected: "+t)}))};h.length>0&&f.length<t.SimpleWebRequestOptions.MaxSimultaneousRequests;)e()},e._scheduleHungRequestCleanupIfNeeded=function(){f.length>0&&void 0===d?d=t.SimpleWebRequestOptions.setTimeout(this._hungRequestCleanupTimerCallback,t.SimpleWebRequestOptions.HungRequestCleanupIntervalMs):0===f.length&&d&&(t.SimpleWebRequestOptions.clearTimeout(d),d=void 0)},e.prototype._removeFromQueue=function(){c.remove(f,this),c.remove(h,this)},e.prototype._assertAndClean=function(e,t){e||(this._removeFromQueue(),console.error(t),c.assert(e,t))},e.prototype._fire=function(){var n=this;this._xhr=new XMLHttpRequest,this._xhrRequestHeaders={};var r=c.attempt((function(){n._xhr.open(n._action,n._url,!0)}));if(r)this._respond(r.toString());else{if(this._options.timeout){var i=y;3!==i&&(this._assertAndClean(!this._requestTimeoutTimer,"Double-fired requestTimeoutTimer"),this._requestTimeoutTimer=t.SimpleWebRequestOptions.setTimeout((function(){n._requestTimeoutTimer=void 0,n._timedOut=!0,n.abort()}),this._options.timeout)),(3===i||i<=1)&&(this._xhr.timeout=this._options.timeout,this._xhr.ontimeout=function(){y=3,3===i&&(n._timedOut=!0,n._aborted=!0,n._respond("TimedOut"))})}var o=m;3!==o?(0===o&&(m=1),this._xhr.onreadystatechange=function(){n._xhr&&(3!==n._xhr.readyState||!n._options.streamingDownloadProgress||n._aborted?4===n._xhr.readyState&&(0===o&&1===m&&t.SimpleWebRequestOptions.setTimeout((function(){3!==m&&(m=2)}),1e4),n._respond()):n._options.streamingDownloadProgress(n._xhr.responseText))}):this._options.streamingDownloadProgress&&(this._xhr.onreadystatechange=function(){n._xhr&&3===n._xhr.readyState&&n._options.streamingDownloadProgress&&!n._aborted&&n._options.streamingDownloadProgress(n._xhr.responseText)}),2!==o&&(this._xhr.onload=function(){m=3,3===o&&n._respond()},this._xhr.onerror=function(){m=3,3===o&&n._respond()}),this._xhr.onabort=function(){n._aborted=!0,n._respond("Aborted")},this._xhr.upload&&this._options.onProgress&&(this._xhr.upload.onprogress=this._options.onProgress);var s=this._options.acceptType||"json",a=this._options.customResponseType||e._getResponseType(s),p=c.attempt((function(){n._xhr.responseType=a}));if(p&&"json"!==a)throw p;C._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Accept",e.mapContentType(s)),this._xhr.withCredentials=!!this._options.withCredentials;var u=this.getRequestHeaders(),l={};if(Object.keys(u).forEach((function(e){var t=u[e],r=e.toLowerCase();"content-type"!==r?"accept"!==r?(n._assertAndClean(!l[r],"Setting duplicate header key: "+l[r]+" and "+e),null!=t?(l[r]=!0,C._setRequestHeader(n._xhr,n._xhrRequestHeaders,e,t)):console.warn('Tried to set header "'+e+'" on request with "'+t+'" value, header will be dropped')):n._assertAndClean(!1,"Don't set Accept with options.headers -- use it with the options.acceptType property"):n._assertAndClean(!1,"Don't set Content-Type with options.headers -- use it with the options.contentType property")})),this._options.sendData){var d=e.mapContentType(this._options.contentType||"json");C._setRequestHeader(this._xhr,this._xhrRequestHeaders,"Content-Type",d);var h=e.mapBody(this._options.sendData,d);this._xhr.send(h)}else this._xhr.send()}},e._setRequestHeader=function(e,t,n,r){e.setRequestHeader(n,r),t[n]=r},e.mapContentType=function(e){return"json"===e?"application/json":"form"===e?"application/x-www-form-urlencoded":e},e.mapBody=function(e,t){if(u(t)){if(!c.isString(e))return JSON.stringify(e)}else if(function(e){return!!e&&0===e.indexOf("application/x-www-form-urlencoded")}(t)){if(!c.isString(e)&&c.isObject(e)){var n=e;return Object.keys(n).map((function(e){return encodeURIComponent(e)+(n[e]?"="+encodeURIComponent(n[e].toString()):"")})).join("&")}}else if(function(e){return!!e&&0===e.indexOf("multipart/form-data")}(t)){if(c.isObject(e)){var r=new FormData,i=e;return Object.keys(i).forEach((function(e){return r.append(e,i[e])})),r}c.assert(!1,"contentType multipart/form-data must include an object as sendData")}return e},e.prototype.setUrl=function(e){this._url=e},e.prototype.setHeader=function(e,t){this._options.augmentHeaders||(this._options.augmentHeaders={}),t?this._options.augmentHeaders[e]=t:delete this._options.augmentHeaders[e]},e.prototype.getRequestHeaders=function(){var e={};return!this._getHeaders||this._options.overrideGetHeaders||this._options.headers||(e=i(i({},e),this._getHeaders())),this._options.overrideGetHeaders&&(e=i(i({},e),this._options.overrideGetHeaders)),this._options.headers&&(e=i(i({},e),this._options.headers)),this._options.augmentHeaders&&(e=i(i({},e),this._options.augmentHeaders)),e},e.prototype.getOptions=function(){return c.clone(this._options)},e.prototype.setPriority=function(e){this._options.priority!==e&&(this._options.priority=e,this._paused||this._xhr||(c.remove(h,this),this._enqueue()))},e.prototype.resumeRetrying=function(){this._paused?(this._paused=!1,this._enqueue()):c.assert(!1,"resumeRetrying() called but not paused!")},e.prototype._enqueue=function(){var t=this;if(!this._aborted&&!(f.indexOf(this)>=0||g.indexOf(this)>=0||h.indexOf(this)>=0)){var n=h.findIndex((function(e){return e.getPriority()===t.getPriority()&&e._created>t._created||e.getPriority()<t.getPriority()}));n>-1?h.splice(n,0,this):h.push(this),e.checkQueueProcessing()}},e._getResponseType=function(e){return"blob"===e?"arraybuffer":"text/xml"===e||"application/xml"===e?"document":"text/plain"===e?"text":"json"},e._hungRequestCleanupTimerCallback=function(){d=void 0,f.filter((function(e){return!(!e._xhr||4!==e._xhr.readyState)&&(console.warn("SimpleWebRequests found a completed XHR that hasn't invoked it's callback functions, manually responding"),!0)})).forEach((function(e){e._respond()})),C._scheduleHungRequestCleanupIfNeeded()},e}();t.SimpleWebRequestBase=v;var C=function(e){function n(t,n,r,i,o){return e.call(this,t,n,r,i,o)||this}return r(n,e),n.prototype.abort=function(){this._aborted?c.assert(!1,"Already aborted "+this._action+" request to "+this._url):(this._aborted=!0,this._retryTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._deferred?(this._respond("Aborted"),this._xhr&&this._xhr.abort()):c.assert(!1,"Haven't even fired start() yet -- can't abort"))},n.prototype.start=function(){var e=this;return this._deferred?(c.assert(!1,"WebRequest already started"),a.Rejected("WebRequest already started")):(this._deferred=a.Defer(),this._deferred.onCancel((function(){e.abort()})),this._enqueue(),this._deferred.promise())},n.prototype._respond=function(e){var n=this;if(!this._finishHandled){this._finishHandled=!0,this._removeFromQueue(),this._retryTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._retryTimer),this._retryTimer=void 0),this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0);var r,i=0;if(this._xhr)try{i=this._xhr.status,r=this._xhr.statusText||e}catch(e){}else r=e||"Browser Error - Possible CORS or Connectivity Issue";var o,a,p={};if(this._xhr){if((this._xhr.getAllResponseHeaders()||"").split(/\r?\n/).forEach((function(e){if(0!==e.length){var t=e.indexOf(":");-1===t?p[e]="":p[e.substr(0,t).toLowerCase()]=e.substr(t+1).trim()}})),!p["content-type"]){var d=this._xhr.getResponseHeader("content-type");d&&(p["content-type"]=d)}if(o=this._xhr.response,p["content-type"]&&u(p["content-type"])&&(!o||!c.isObject(o))&&("text"===this._xhr.responseType||""===this._xhr.responseType)&&this._xhr.responseText)try{o=JSON.parse(this._xhr.responseText)}catch(e){a=e,console.warn("Failed to parse XHR JSON response")}}if(this._xhr&&4===this._xhr.readyState&&(i>=200&&i<300||304===i)){var h={url:this._xhr.responseURL||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:i,statusText:r,headers:p,body:o,responseParsingException:a};this._deferred.resolve(h)}else{var g={url:(this._xhr?this._xhr.responseURL:void 0)||this._url,method:this._action,requestOptions:this._options,requestHeaders:this._xhrRequestHeaders||{},statusCode:i,statusText:r,headers:p,body:o,canceled:this._aborted,timedOut:this._timedOut,responseParsingException:a};this._options.augmentErrorResponse&&this._options.augmentErrorResponse(g);var f=this._options.customErrorHandler?this._options.customErrorHandler(this,g):l(0,g);f!==s.DoNotRetry&&(this._options.retries&&this._options.retries>0||f===s.PauseUntilResumed||f===s.RetryUncountedImmediately||f===s.RetryUncountedWithBackoff)?(f===s.RetryCountedWithBackoff&&this._options.retries--,this._requestTimeoutTimer&&(t.SimpleWebRequestOptions.clearTimeout(this._requestTimeoutTimer),this._requestTimeoutTimer=void 0),this._aborted=!1,this._timedOut=!1,this._finishHandled=!1,this._xhr&&(this._xhr.onabort=null,this._xhr.onerror=null,this._xhr.onload=null,this._xhr.onprogress=null,this._xhr.onreadystatechange=null,this._xhr.ontimeout=null,this._xhr=void 0,this._xhrRequestHeaders=void 0),f===s.PauseUntilResumed?this._paused=!0:f===s.RetryUncountedImmediately?this._enqueue():this._retryTimer=t.SimpleWebRequestOptions.setTimeout((function(){n._retryTimer=void 0,n._enqueue()}),this._retryExponentialTime.getTimeAndCalculateNext())):this._deferred.reject(g)}v.checkQueueProcessing()}},n}(v);t.SimpleWebRequest=C},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(87),i=n(88),o=n(89),s=n(90),a=n(44);t.Models=a;var c=n(91),p=n(98),u=n(99),l=function(){function e(){this._allowBackgroundFetchData=new r.default,this._appActiveData=new i.default,this._config=new s.default,this._cache=new o.default(this._config),this._skypeTokenData=new p.default,this._telemetryManager=new u.default(this._cache),this._scheduler=new c.default(this._config,this._skypeTokenData,this._cache,this._appActiveData,this._allowBackgroundFetchData,this._telemetryManager),this.telemetryEventAdded=this._telemetryManager.telemetryEventAdded,this.configUpdated=this._cache.configUpdated}return e.prototype.initialize=function(e){var t=this;return this._config.initialize(e),this._skypeTokenData.putSkypeTokenData(e.initialSkypeTokenData),this._appActiveData.putAppActive(e.initialAppActiveState),this._cache.initialize().then((function(){t._scheduler.initialize()}))},e.prototype.getConfig=function(){return this._cache.getEcsConfig()},e.prototype.getConfigType=function(){var e=this._cache.getEcsConfig();if(e)return e.configType},e.prototype.requestUpdate=function(){this._scheduler.requestUpdate()},e.prototype.pause=function(){this._scheduler.pause()},e.prototype.resume=function(){this._scheduler.resume()},e.prototype.setAllowBackgroundFetch=function(e){this._allowBackgroundFetchData.putBackgroundFetchAllowed(e)},e.prototype.useSkypeToken=function(e,t){this._skypeTokenData.putSkypeTokenData({skypeToken:e,skypeTokenExpiration:t})},e.prototype.setAppActive=function(e){this._appActiveData.putAppActive(e)},e.prototype.setConfigsToFetch=function(e){var t=this;return this._config.setConfigsToFetch(e),this._cache.updateConfigsToFetch().then((function(){t._scheduler.updateConfigsToFetch()}))},e.prototype.setFetchTimeout=function(e){this._config.setFetchTimeout(e)},e}();t.default=l},function(e,t,n){n(101),e.exports=n(100)},function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var r,i=1,o={},s=!1,a=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"==={}.toString.call(e.process)?function(){r=function(e){t.nextTick((function(){u(e)}))}}():function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&u(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),r=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){u(e.data)},r=function(t){e.port2.postMessage(t)}}():a&&"onreadystatechange"in a.createElement("script")?function(){var e=a.documentElement;r=function(t){var n=a.createElement("script");n.onreadystatechange=function(){u(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():function(){r=function(e){setTimeout(u,0,e)}}(),c.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var s={callback:e,args:t};return o[i]=s,r(i),i++},c.clearImmediate=p}function p(e){delete o[e]}function u(e){if(s)setTimeout(u,0,e);else{var t=o[e];if(t){s=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}(t)}finally{p(e),s=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n(80),n(86))},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,p=[],u=!1,l=-1;function d(){u&&c&&(u=!1,c.length?p=c.concat(p):l=-1,p.length&&h())}function h(){if(!u){var e=a(d);u=!0;for(var t=p.length;t;){for(c=p,p=[];++l<t;)c&&c[l].run();l=-1,t=p.length}c=null,u=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function f(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new g(e,t)),1!==p.length||u||a(h)},g.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=f,i.addListener=f,i.once=f,i.off=f,i.removeListener=f,i.removeAllListeners=f,i.emit=f,i.prependListener=f,i.prependOnceListener=f,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=function(){function e(){this._isAllowed=!1}return e.prototype.putBackgroundFetchAllowed=function(e){if(this._isAllowed=e,this.isBackgroundFetchAllowed()&&this._isAllowedDeferral){var t=this._isAllowedDeferral;this._isAllowedDeferral=void 0,t.resolve(void 0)}},e.prototype.isBackgroundFetchAllowed=function(){return this._isAllowed},e.prototype.waitForBackgroundFetchAllowed=function(){return this.isBackgroundFetchAllowed()?r.Resolved():(this._isAllowedDeferral||(this._isAllowedDeferral=r.Defer()),this._isAllowedDeferral.promise())},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(17),i=function(){function e(){this._isActive=!1}return e.prototype.putAppActive=function(e){if(this._isActive=e,this.isAppActive()&&this._appActiveDeferral){var t=this._appActiveDeferral;this._appActiveDeferral=void 0,t.resolve(void 0)}},e.prototype.isAppActive=function(){return this._isActive},e.prototype.waitForAppActive=function(){return this.isAppActive()?r.Resolved():(this._appActiveDeferral||(this._appActiveDeferral=r.Defer()),this._appActiveDeferral.promise())},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(65),i=n(17),o=n(44),s=function(){function e(e){this._config=e,this.configUpdated=new r.default,this._cachedConfigs={}}return e.prototype.initialize=function(){return this.updateConfigsToFetch()},e.prototype.updateConfigsToFetch=function(){var e=this,t=this._config.getConfig(),n=t.databaseInterface,r=t.configsToFetch;if(!n)return i.Resolved();for(var o=[],s=function(t){if(a._cachedConfigs[t])return"continue";o.push(n.getData(t).then((function(n){n&&(e._cachedConfigs[t]=n)})).catch((function(){return i.Resolved()})))},a=this,c=0,p=r;c<p.length;c++){s(p[c])}return i.all(o).then((function(){o.length>0&&e.configUpdated.fire()}))},e.prototype.getEcsConfig=function(){return this._cachedConfigs[o.EcsConfigType.User]||this._cachedConfigs[o.EcsConfigType.Default]},e.prototype.getEcsConfigByType=function(e){return this._cachedConfigs[e]},e.prototype.putConfig=function(e){var t=this.getEcsConfig();this._cachedConfigs[e.configType]=e;var n=this.getEcsConfig();(n&&n.configType===e.configType||t&&n&&t.configType!==n.configType)&&this.configUpdated.fire();var r=this._config.getConfig().databaseInterface;return r?r.putData(e.configType,e):i.Resolved()},e}();t.default=s},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(){}return e.prototype.initialize=function(e){if(this._config)throw"ECS Configuration already initialized";this._config=e},e.prototype.getConfig=function(){if(!this._config)throw"ECS Configuration not yet initialized";return this._config},e.prototype.setConfigsToFetch=function(e){if(!this._config)throw"ECS Configuration not yet initialized";this._config=r({},this._config,{configsToFetch:e})},e.prototype.setFetchTimeout=function(e){if(!this._config)throw"ECS Configuration not yet initialized";this._config=r({},this._config,{fetchTimeout:e})},e}();t.default=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(44),i=n(92),o=function(){function e(e,t,n,o,s,a){var c=this;this._config=e,this._skypeTokenData=t,this._cache=n,this._isFetchingSettings={},this._pendingFetch={},this._paused=!1,this._fetchEcsSettingsIfNeeded=function(e){var t=c._config.getConfig(),n=c._cache.getEcsConfigByType(e);if(-1!==t.configsToFetch.indexOf(e)&&!c._isFetchingSettings[e])if(n||!c._pendingFetch[e]){var i=n?n.expiration-Date.now():-1;i<=0||n&&e===r.EcsConfigType.User&&c._skypeTokenData.isSkypeTokenValid()&&n.lastFetchTokenHash!==c._skypeTokenData.getSkypeTokenHash(c._skypeTokenData.getSkypeToken())?c._fetchSkypeEcsSettings(e):setTimeout((function(){return c._fetchEcsSettingsIfNeeded(e)}),i)}else c._fetchSkypeEcsSettings(e)},this._fetchSkypeEcsSettings=function(e,t){(void 0===t&&(t=!1),c._isFetchingSettings[e]||c._paused&&!t)?c._pendingFetch[e]=!0:(c._pendingFetch[e]=!1,c._isFetchingSettings[e]=!0,c._config.getConfig().getEcsParameters().catch((function(){return console.warn("ECS - Failed to fetch ECS fetching parameters"),{}})).then((function(t){return c._ecsClient.getConfig(c._cache.getEcsConfig(),e===r.EcsConfigType.User,t)})).then((function(t){console.log("ECS - Config fetch complete"),c._isFetchingSettings[e]=!1,c._cache.putConfig(t),c._fetchEcsSettingsIfNeeded(e)})))},this._ecsClient=new i.default(this._config,this._skypeTokenData,o,s,a)}return e.prototype.initialize=function(){var e=this;this.updateConfigsToFetch(),this._skypeTokenData.skypeTokenChanged.subscribe((function(){return e._fetchEcsSettingsIfNeeded(r.EcsConfigType.User)}))},e.prototype.updateConfigsToFetch=function(){for(var e=this._config.getConfig(),t=0,n=e.configsToFetch;t<n.length;t++){(o=n[t])in this._isFetchingSettings||(this._isFetchingSettings[o]=!1),o in this._isFetchingSettings||(this._pendingFetch[o]=!1)}for(var r=0,i=e.configsToFetch;r<i.length;r++){var o=i[r],s=this._cache.getEcsConfigByType(o);!s||s.appVersion&&s.appVersion!==e.clientVersion?this._fetchSkypeEcsSettings(o,!0):this._fetchEcsSettingsIfNeeded(o)}},e.prototype.requestUpdate=function(){for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchSkypeEcsSettings(n)}},e.prototype.pause=function(){this._paused=!0},e.prototype.resume=function(){this._paused=!1;for(var e=0,t=this._config.getConfig().configsToFetch;e<t.length;e++){var n=t[e];this._fetchEcsSettingsIfNeeded(n)}},e}();t.default=o},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o,s,a=n(93),c=n(17),p=n(44),u=n(96),l=function(e){function t(t,n,r,i,o,s,a,c){var p=e.call(this,t)||this;p._config=n,p._skypeTokenData=r,p._appActiveData=i,p._allowBackgroundFetchData=o,p._etag=s,p._getUserConfig=a;var u=p._config.getConfig();if(p._apiPath=u.clientTeam?"/config/v1/"+u.clientName+"/"+u.clientVersion+"/"+u.clientTeam:"/config/v1/"+u.clientName+"/"+u.clientVersion,c){var l=Object.keys(c).map((function(e){return encodeURIComponent(e)+"="+encodeURIComponent(c[e].toString())}));l&&(p._apiPath+="?"+l.join("&"))}return p}return r(t,e),t.prototype._blockRequestUntil=function(e){var t=this;if(this._getUserConfig&&!this._skypeTokenData.isSkypeTokenValid()&&console.log("ECS - Delaying User config fetch until we have a valid SkypeToken"),!this._appActiveData.isAppActive()&&!this._allowBackgroundFetchData.isBackgroundFetchAllowed()){var n=this._getUserConfig?"User config":"config";console.log("ECS - Delaying "+n+" fetch until the app is active (or background fetch is allowed)")}return c.race([this._appActiveData.waitForAppActive(),this._allowBackgroundFetchData.waitForBackgroundFetchAllowed()]).then((function(){if(t._getUserConfig)return t._skypeTokenData.waitForValidSkypeToken()})).then((function(){s=Date.now()}))},t.prototype._getHeaders=function(){var e={};return this._etag&&(e["If-None-Match"]=this._etag),this._getUserConfig&&(e.Authorization=this._skypeTokenData.getSkypeToken()),e},t.prototype.getConfig=function(){var t=this._config.getConfig().fetchTimeout;return void 0!==t&&(t<0?t=0:t>0&&t<3e4&&(t=3e4)),e.prototype.performApiGetDetailed.call(this,this._apiPath,{timeout:t})},t}(a.GenericRestClient),d=function(){function e(e,t,n,r,i){this._config=e,this._skypeTokenData=t,this._appActiveData=n,this._allowBackgroundFetchData=r,this._telemetryManager=i,this._ecsFailureBackoffTimer=new a.ExponentialTime(1e3,3e5),this._cacheMaxAgeRegex=/.*max-age=(\d+).*/gi,this._serverIndex=NaN}return e.prototype.getConfig=function(e,t,n){var r=this,o=this._config.getConfig().hosts;if((isNaN(this._serverIndex)||this._serverIndex>o.length-1)&&(this._serverIndex=Math.floor(Math.random()*o.length)),!o||!o.length)return c.Rejected(new Error("no configuration service endpoint"));var a=c.Defer(),d=0,h=function(){var g=e&&e.eTag?e.eTag:void 0,f=new l(o[r._serverIndex],r._config,r._skypeTokenData,r._appActiveData,r._allowBackgroundFetchData,g,t,n);d++,f.getConfig().then((function(n){var l=n.headers.etag,h=n.headers.expires;n.body&&n.body.Headers&&(l||(l=n.body.Headers.ETag),h||(h=n.body.Headers.Expires));var f=r._calculateResponseTimeInfo(e);if(!l||!h)return console.warn("ECS - Service returned an empty ETag or Expiration header: "+JSON.stringify(n)),c.Rejected({timedOut:!1,responseParsingException:new Error("ECS Service returned empty ETag or Expiration header"),responseCode:n.statusCode});var m,y=new Date(r._calculateExpirationDate(n.headers)).getTime();if(304===n.statusCode&&e)(m=i({},e)).configType=t?p.EcsConfigType.User:p.EcsConfigType.Default,m.eTag=l,m.expiration=y,m.cacheUpdateTime=f.lastResponseTime,m.lastFetchTokenHash=r._skypeTokenData.getSkypeTokenHash(n.requestHeaders.Authorization);else{if("object"!=typeof n.body)return console.warn("ECS - Service returned invalid response "+JSON.stringify(n)),c.Rejected({timedOut:!1,responseParsingException:new Error("ECS Service returned invalid response body"),responseCode:n.statusCode});m={config:n.body,configType:t?p.EcsConfigType.User:p.EcsConfigType.Default,eTag:l,expiration:y,cacheUpdateTime:s,lastFetchTokenHash:r._skypeTokenData.getSkypeTokenHash(n.requestHeaders.Authorization),appVersion:r._config.getConfig().clientVersion}}r._telemetryManager.sendTelemetryEvent(new u.EcsConfigFetchResponse(f.fetchDelayMs,n.statusCode,d,r._skypeTokenData.isSkypeTokenValid(),o[r._serverIndex],f.fetchDurationValid,!!g,JSON.stringify(n).length,f.cacheAge,!(e&&e.expiration-Date.now()>0),s,f.lastResponseTime,t,l)),r._ecsFailureBackoffTimer.reset(),a.resolve(m)})).catch((function(n){var i={timedOut:n&&n.timedOut||!1,responseParseError:n&&n.responseParsingException,responseCode:n&&n.statusCode||0,message:r._getErrorMessage(n)};console.error("ECS - Service request failed to return a response (timedOut: "+i.timedOut+", responseParseError: "+i.responseParseError+")");var a=r._calculateResponseTimeInfo(e);r._telemetryManager.sendTelemetryEvent(new u.EcsConfigFetchResponse(a.fetchDelayMs,i.responseCode,d,r._skypeTokenData.isSkypeTokenValid(),o[r._serverIndex],a.fetchDurationValid,!!g,0,a.cacheAge,!(e&&e.expiration-Date.now()>0),s,a.lastResponseTime,t,void 0,i.timedOut,i.responseParseError,i.message)),setTimeout((function(){h()}),r._ecsFailureBackoffTimer.getTimeAndCalculateNext())}))};return h(),a.promise()},e.prototype._calculateExpirationDate=function(e){var t=Date.now()+1728e5;if(e.date&&e.expires){var n=new Date(e.date).getTime(),r=Date.now()-n,i=new Date(e.expires).getTime();return isNaN(i)?t:Math.min(t,i+r)}var o=this._cacheMaxAgeRegex.exec(e["cache-control"]);return this._cacheMaxAgeRegex.lastIndex=0,o&&2===o.length?Math.min(t,Date.now()+1e3*Number(o[1])):Date.now()+18e5},e.prototype._calculateResponseTimeInfo=function(e){var t=(o=Date.now())-s;return{lastResponseTime:o,fetchDelayMs:t,fetchDurationValid:!(t<0||t>31536e6),cacheAge:e?o-e.cacheUpdateTime:0}},e.prototype._getErrorMessage=function(e){if(e)return"string"==typeof e?e:"object"==typeof e&&(e.statusText||e.message)?e.statusText||e.message:void 0},e}();t.default=d},function(e,t,n){e.exports=n(94)},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(81)),r(n(95)),r(n(82))},function(e,t,n){"use strict";var r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(78),o=n(82),s=function(){function e(e){this._defaultOptions={excludeEndpointUrl:!1,withCredentials:!1,retries:0},this._endpointUrl=e}return e.prototype._performApiCall=function(e,t,n,s){var a=this;void 0===s&&(s={});var c=r(r({},this._defaultOptions),s);n&&(c.sendData=n),c.eTag&&(c.augmentHeaders||(c.augmentHeaders={}),c.augmentHeaders["If-None-Match"]=c.eTag),c.contentType||(c.contentType=i.isString(c.sendData)?"form":"json");var p=c.excludeEndpointUrl?e:this._endpointUrl+e;return new o.SimpleWebRequest(t,p,c,(function(){return a._getHeaders(c)}),(function(){return a._blockRequestUntil(c)})).start().then((function(e){return a._processSuccessResponse(e),e}))},e.prototype._getHeaders=function(e){return{}},e.prototype._blockRequestUntil=function(e){},e.prototype._processSuccessResponse=function(e){},e.prototype.performApiGet=function(e,t){return this.performApiGetDetailed(e,t).then((function(e){return e.body}))},e.prototype.performApiGetDetailed=function(e,t){return this._performApiCall(e,"GET",void 0,t)},e.prototype.performApiPost=function(e,t,n){return this.performApiPostDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiPostDetailed=function(e,t,n){return this._performApiCall(e,"POST",t,n)},e.prototype.performApiPatch=function(e,t,n){return this.performApiPatchDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiPatchDetailed=function(e,t,n){return this._performApiCall(e,"PATCH",t,n)},e.prototype.performApiPut=function(e,t,n){return this.performApiPutDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiPutDetailed=function(e,t,n){return this._performApiCall(e,"PUT",t,n)},e.prototype.performApiDelete=function(e,t,n){return this.performApiDeleteDetailed(e,t,n).then((function(e){return e.body}))},e.prototype.performApiDeleteDetailed=function(e,t,n){return this._performApiCall(e,"DELETE",t,n)},e}();t.GenericRestClient=s},function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=function(e){function t(t,n,r,i,o,s,a,c,p,u,l,d,h,g,f,m,y){var v=e.call(this)||this;return v._responseTime=t,v._responseCode=n,v._fetchAttempts=r,v._hasValidToken=i,v._serverEndpoint=o,v._fetchDurationValid=s,v._cacheAvailable=a,v._responseSize=c,v._configAge=p,v._configExpired=u,v._fetchStart=l,v._fetchEnd=d,v._isUserConfig=h,v._etag=g,v._timedOut=f,v._responseParsingException=m,v._errorMessage=y,v}return r(t,e),t.prototype.getEventName=function(){return"ecs_tsclient_fetch_config"},t.prototype.getAttributes=function(){var t=e.prototype.getAttributes.call(this);return t.fetch_delay_ms=this._responseTime,t.fetch_response_code=this._responseCode,t.fetch_attempts=this._fetchAttempts,t.authenticated_user=this._hasValidToken,t.url=this._serverEndpoint,t.fetch_duration_valid=this._fetchDurationValid,t.cache_available=this._cacheAvailable,t.response_size=this._responseSize,t.config_age=this._configAge,t.config_expired=this._configExpired,t.fetch_start=this._fetchStart,t.fetch_end=this._fetchEnd,t.is_user_config=this._isUserConfig,this._etag&&(t.fetched_etag=this._etag),void 0!==this._timedOut&&(t.fetch_timed_out=this._timedOut),this._responseParsingException&&(t.fetch_response_parsing_error=this._responseParsingException.message),this._errorMessage&&(t.fetch_error_message=this._errorMessage),t},t}(n(97).TelemetryEventBase);t.EcsConfigFetchResponse=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getAttributes=function(){return{Source:"ecs_client"}},e}();t.TelemetryEventBase=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(65),i=n(17),o=function(){function e(){this.skypeTokenChanged=new r.default}return e.prototype.putSkypeTokenData=function(e){if(this._data=e,this.isSkypeTokenValid()&&this.skypeTokenChanged.fire(),this.isSkypeTokenValid()&&this._validSkypeTokenDeferral){var t=this._validSkypeTokenDeferral;this._validSkypeTokenDeferral=void 0,t.resolve(void 0)}},e.prototype.isSkypeTokenValid=function(){var e=this._data;return!!e&&!!e.skypeToken&&e.skypeTokenExpiration>Date.now()},e.prototype.getSkypeToken=function(){var e=this._data;if(!e||!e.skypeToken)throw"No Skype Token provided";return e.skypeToken},e.prototype.getSkypeTokenHash=function(e){return void 0===e?0:e.split("").reduce((function(e,t){return(101*e+t.charCodeAt(0))%999727999}),e.length)},e.prototype.waitForValidSkypeToken=function(){return this.isSkypeTokenValid()?i.Resolved():(this._validSkypeTokenDeferral||(this._validSkypeTokenDeferral=i.Defer()),this._validSkypeTokenDeferral.promise())},e}();t.default=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(65),i=function(){function e(e){this._cache=e,this.telemetryEventAdded=new r.default}return e.prototype.sendTelemetryEvent=function(t){var n=t.getEventName(),r=t.getAttributes(),i=!1,o=this._cache.getEcsConfig();if(o){if(e._containsEcsClientTelemetryConfig(o.config)){var s=o.config.ECSCONFIG;s&&s.ecsClientTelemetry&&(i=!!s.ecsClientTelemetry[n])}}else console.warn("No previously cached ECS telemetry config exists - fallback to sending event"),i=!0;i&&this.telemetryEventAdded.fire(n,r)},e._containsEcsClientTelemetryConfig=function(e){return!!e&&!!e.ECSCONFIG&&!!e.ECSCONFIG.ecsClientTelemetry},e}();t.default=i},function(e,t,n){"use strict";n.r(t);var r=n(70);n.d(t,"CordovaAdalPlugin",(function(){return r.CordovaAdalPlugin}));var i=n(45);n.d(t,"NullAuthenticationPlugin",(function(){return i.NullAuthenticationPlugin}));var o=n(71);n.d(t,"NullAuthenticationPluginCreator",(function(){return o.NullAuthenticationPluginCreator}));var s=n(46);n.d(t,"TokenUtil",(function(){return s.TokenUtil}));var a=n(63);n.d(t,"CloseableDialog",(function(){return a.CloseableDialog})),n.d(t,"WebClientDrivenAuthenticationPlugin",(function(){return a.WebClientDrivenAuthenticationPlugin}));var c=n(61);n.d(t,"ApiConsumptionSendHttpPipeline",(function(){return c.ApiConsumptionSendHttpPipeline}));var p=n(27);n.d(t,"ApimConnectionSendHttpPipeline",(function(){return p.ApimConnectionSendHttpPipeline})),n.d(t,"IApimHttpPipelineOptions",(function(){return p.IApimHttpPipelineOptions}));var u=n(43);n.d(t,"ApimHttpRequestCache",(function(){return u.ApimHttpRequestCache})),n.d(t,"ICacheOptions",(function(){return u.ICacheOptions})),n.d(t,"IUrlCacheItem",(function(){return u.IUrlCacheItem}));var l=n(19);n.d(t,"AppPreloadData",(function(){return l.AppPreloadData}));var d=n(25);n.d(t,"AppResourceManager",(function(){return d.AppResourceManager}));var h=n(49);n.d(t,"AppsManager",(function(){return h.AppsManager}));var g=n(76);n.d(t,"IAuthenticationBroker",(function(){return g.IAuthenticationBroker}));var f=n(64);n.d(t,"ICookieManager",(function(){return f.ICookieManager})),n.d(t,"ICookieManagerSingletonKey",(function(){return f.ICookieManagerSingletonKey}));var m=n(47);n.d(t,"NullCookieManager",(function(){return m.NullCookieManager}));var y=n(41);n.d(t,"WebCookieManager",(function(){return y.WebCookieManager}));var v=n(48);n.d(t,"WebViewAuthenticationBroker",(function(){return v.WebViewAuthenticationBroker}));var C=n(33);n.d(t,"AuthenticationBrokerManager",(function(){return C.AuthenticationBrokerManager}));var A=n(34);n.d(t,"AuthenticationBrokerManagerFactory",(function(){return A.AuthenticationBrokerManagerFactory}));var _=n(21);n.d(t,"AuthenticationSendHttpPipeline",(function(){return _.AuthenticationSendHttpPipeline})),n.d(t,"tryGetAuthorizationOptions",(function(){return _.tryGetAuthorizationOptions}));var P=n(42);n.d(t,"BatchSendHttpPipeline",(function(){return P.BatchSendHttpPipeline}));var S=n(6);n.d(t,"CacheableAppResources",(function(){return S.CacheableAppResources})),n.d(t,"AppMagicRuntimeClientCacheableAppResources_parse",(function(){return S.parse})),n.d(t,"tryParse",(function(){return S.tryParse}));var b=n(2);n.d(t,"CacheManager",(function(){return b.CacheManager})),n.d(t,"CacheType",(function(){return b.CacheType}));var I=n(3);n.d(t,"CacheSettings",(function(){return I.CacheSettings})),n.d(t,"ICacheVersion",(function(){return I.ICacheVersion})),n.d(t,"Version",(function(){return I.Version})),n.d(t,"compareCacheVersion",(function(){return I.compareCacheVersion})),n.d(t,"isValidCacheVersion",(function(){return I.isValidCacheVersion}));var w=n(52);n.d(t,"TimedCache",(function(){return w.TimedCache}));var T=n(28);n.d(t,"CacheSettingsProviderManager",(function(){return T.CacheSettingsProviderManager})),n.d(t,"ICacheSettingsProviderManager",(function(){return T.ICacheSettingsProviderManager}));var M=n(26);n.d(t,"ServerItemCache",(function(){return M.ServerItemCache})),n.d(t,"Timedache",(function(){return M.ServerItemCache}));var R=n(12);n.d(t,"CdsLanguageProvisionHelper",(function(){return R.CdsLanguageProvisionHelper}));var E=n(53);n.d(t,"ClientAuthenticationRuntime",(function(){return E.ClientAuthenticationRuntime}));var U=n(54);n.d(t,"ClientConfigurationLoader",(function(){return U.ClientConfigurationLoader}));var H=n(55);n.d(t,"ClientRuntime",(function(){return H.ClientRuntime}));var k=n(0);n.d(t,"ComponentKeys",(function(){return k.ComponentKeys}));var F=n(72);n.d(t,"ConnectionHelper",(function(){return F.ConnectionHelper}));var O=n(5);n.d(t,"addConnectionAsync",(function(){return O.addConnectionAsync})),n.d(t,"compareConnections",(function(){return O.compareConnections})),n.d(t,"ensureConnectionExistsAsync",(function(){return O.ensureConnectionExistsAsync})),n.d(t,"filterAndSortAvailableConnections",(function(){return O.filterAndSortAvailableConnections})),n.d(t,"getConnectionConsentAsync",(function(){return O.getConnectionConsentAsync})),n.d(t,"isConnectionAvailableForReference",(function(){return O.isConnectionAvailableForReference})),n.d(t,"startAsyncOperationWithConsent",(function(){return O.startAsyncOperationWithConsent})),n.d(t,"updateConnectionAsync",(function(){return O.updateConnectionAsync}));var N=n(36);n.d(t,"CustomHeadersSendHttpPipeline",(function(){return N.CustomHeadersSendHttpPipeline}));var L=n(4);n.d(t,"EnrollPropertiesManager",(function(){return L.EnrollPropertiesManager})),n.d(t,"IUserEnrollProperties",(function(){return L.IUserEnrollProperties})),n.d(t,"IUserPlanProperties",(function(){return L.IUserPlanProperties})),n.d(t,"UserPlanSource",(function(){return L.UserPlanSource}));var D=n(50);n.d(t,"EnvironmentInstance",(function(){return D.EnvironmentInstance}));var x=n(77);n.d(t,"IAuthenticationBrokerManager",(function(){return x.IAuthenticationBrokerManager}));var q=n(8);n.d(t,"IAuthenticationBrokerManagerFactory",(function(){return q.IAuthenticationBrokerManagerFactory})),n.d(t,"IAuthenticationBrokerManagerFactorySingletonKey",(function(){return q.IAuthenticationBrokerManagerFactorySingletonKey}));var B=n(7);n.d(t,"IClientRuntime",(function(){return B.IClientRuntime})),n.d(t,"IClientRuntimeSingletonKey",(function(){return B.IClientRuntimeSingletonKey}));var j=n(68);n.d(t,"IPerformanceResourceTiming",(function(){return j.IPerformanceResourceTiming})),n.d(t,"IResourceTimingProvider",(function(){return j.IResourceTimingProvider}));var V=n(23);n.d(t,"InvokeSendHttpPipeline",(function(){return V.InvokeSendHttpPipeline})),n.d(t,"setIsDisableInvokePatternEnabledForUnitTests",(function(){return V.setIsDisableInvokePatternEnabledForUnitTests}));var z=n(16);n.d(t,"ILaunchAppServiceFunctionParams",(function(){return z.ILaunchAppServiceFunctionParams})),n.d(t,"LaunchAppService",(function(){return z.LaunchAppService}));var W=n(38);n.d(t,"NormalizeRequestSendHttpPipeline",(function(){return W.NormalizeRequestSendHttpPipeline}));var G=n(74);n.d(t,"registerClientRuntimeObjects",(function(){return G.registerClientRuntimeObjects}));var K=n(62);n.d(t,"OfflineIdentityService",(function(){return K.OfflineIdentityService}));var J=n(39);n.d(t,"OnlineCheckSendHttpPipeline",(function(){return J.OnlineCheckSendHttpPipeline}));var Q=n(18);n.d(t,"ImmediateOperationsExecutor",(function(){return Q.ImmediateOperationsExecutor})),n.d(t,"OperationsExecutorFactory",(function(){return Q.OperationsExecutorFactory})),n.d(t,"PostAppOpenOperationsExecutor",(function(){return Q.PostAppOpenOperationsExecutor}));var X=n(51);n.d(t,"PlanDetailsTelemetryLogger",(function(){return X.PlanDetailsTelemetryLogger}));var Z=n(57);n.d(t,"ApnsChannelRegistrar",(function(){return Z.ApnsChannelRegistrar}));var Y=n(56);n.d(t,"ChannelManager",(function(){return Y.ChannelManager}));var $=n(11);n.d(t,"ChannelRegistrar",(function(){return $.ChannelRegistrar}));var ee=n(30);n.d(t,"Context",(function(){return ee.Context})),n.d(t,"NoOpContext",(function(){return ee.NoOpContext}));var te=n(22);n.d(t,"getInstance",(function(){return te.getInstance})),n.d(t,"setInstance",(function(){return te.setInstance}));var ne=n(58);n.d(t,"GcmChannelRegistrar",(function(){return ne.GcmChannelRegistrar}));var re=n(69);n.d(t,"INotificationHandler",(function(){return re.INotificationHandler})),n.d(t,"IPushNotificationHandlerCreator",(function(){return re.IPushNotificationHandlerCreator}));var ie=n(59);n.d(t,"IPushNotification",(function(){return ie.IPushNotification}));var oe=n(35);n.d(t,"WnsChannelRegistrar",(function(){return oe.WnsChannelRegistrar}));var se=n(40);n.d(t,"ResourceTimingProvider",(function(){return se.ResourceTimingProvider}));var ae=n(29);n.d(t,"ISendHttpCoreOptions",(function(){return ae.ISendHttpCoreOptions})),n.d(t,"SendHttpCore",(function(){return ae.SendHttpCore}));var ce=n(67);n.d(t,"XhrFunction",(function(){return ce.a}));var pe=n(1);n.d(t,"SendHttpUtility",(function(){return pe.SendHttpUtility}));var ue=n(24);n.d(t,"ServiceErrorSendHttpPipeline",(function(){return ue.ServiceErrorSendHttpPipeline})),n.d(t,"tryGetServiceErrorOptions",(function(){return ue.tryGetServiceErrorOptions}));var le=n(15);n.d(t,"TelemetrySendHttpPipeline",(function(){return le.TelemetrySendHttpPipeline})),n.d(t,"getTelemetryAdditionalData",(function(){return le.getTelemetryAdditionalData})),n.d(t,"tryGetTelemetryOptions",(function(){return le.tryGetTelemetryOptions}));var de=n(73);n.d(t,"TestProfilesLoader",(function(){return de.TestProfilesLoader}));var he=n(37);n.d(t,"ThrottleAndRetrySendHttpPipeline",(function(){return he.ThrottleAndRetrySendHttpPipeline}));var ge=n(10);n.d(t,"UserFeature",(function(){return ge.UserFeature})),n.d(t,"AppMagicRuntimeClientUserFeature_parse",(function(){return ge.parse}));var fe=n(31);n.d(t,"UserFeaturesManager",(function(){return fe.UserFeaturesManager}));var me=n(14);n.d(t,"UserInstance",(function(){return me.UserInstance})),n.d(t,"UserPropertyConstants",(function(){return me.UserPropertyConstants}));var ye=n(13);n.d(t,"IUserProfileClient",(function(){return ye.IUserProfileClient})),n.d(t,"UserProfileClient",(function(){return ye.UserProfileClient})),n.d(t,"GraphResourcePath",(function(){return ye.GraphResourcePath})),n.d(t,"getUserFullNameFromGraphUser",(function(){return ye.getUserFullNameFromGraphUser}));var ve=n(9);n.d(t,"IUserServiceOptions",(function(){return ve.IUserServiceOptions})),n.d(t,"UserService",(function(){return ve.UserService}));var Ce=n(60);n.d(t,"UserServiceWithNotifications",(function(){return Ce.UserServiceWithNotifications}));var Ae=n(20);n.d(t,"UserTenant",(function(){return Ae.UserTenant}));var _e=n(32);n.d(t,"UserTenantsManager",(function(){return _e.UserTenantsManager}));var Pe=n(66);n.d(t,"EcsHelper",(function(){return Pe.EcsHelper})),n.d(t,"PAEcsConfig",(function(){return Pe.PAEcsConfig}))},function(e,t,n){"use strict";n.r(t);var r=n(70);Core.exportToNamespace(["AppMagic","Runtime","Client","Adal"],r);var i=n(45);Core.exportToNamespace(["AppMagic","Runtime","Client","Adal"],i);var o=n(71);Core.exportToNamespace(["AppMagic","Runtime","Client","Adal"],o);var s=n(46);Core.exportToNamespace(["Util"],s);var a=n(63);Core.exportToNamespace(["AppMagic","Runtime","Client","Adal"],a);n(76);var c=n(64);Core.exportToNamespace(["AppMagic","Services"],c);var p=n(47);Core.exportToNamespace(["AppMagic","Services"],p);var u=n(41);Core.exportToNamespace(["AppMagic","Services"],u);var l=n(48);Core.exportToNamespace(["AppMagic","Services"],l);var d=n(25);Core.exportToNamespace(["AppMagic","Runtime","Client"],d);var h=n(19);Core.exportToNamespace(["AppMagic","Runtime","Client"],h);var g=n(49);Core.exportToNamespace(["AppMagic","Runtime","Client"],g);var f=n(33);Core.exportToNamespace(["AppMagic","Runtime","Client"],f);var m=n(34);Core.exportToNamespace(["AppMagic","Runtime","Client"],m);var y=n(21);Core.exportToNamespace(["AppMagic","Runtime","Client"],{AuthenticationSendHttpPipeline:y.AuthenticationSendHttpPipeline}),Core.exportToNamespace(["AppMagic","Runtime","Client","AuthenticationSendHttpPipeline"],y);var v=n(27);Core.exportToNamespace(["AppMagic","Runtime","Client"],v);var C=n(43);Core.exportToNamespace(["AppMagic","Runtime","Client"],C);var A=n(6);Core.exportToNamespace(["AppMagic","Runtime","Client"],{CacheableAppResources:A.CacheableAppResources}),Core.exportToNamespace(["AppMagic","Runtime","Client","CacheableAppResources"],A);var _=n(2);Core.exportToNamespace(["AppMagic","Runtime","Client","Caching"],_);var P=n(3);Core.exportToNamespace(["AppMagic","Runtime","Client","Caching"],P);var S=n(28);Core.exportToNamespace(["AppMagic","Runtime","Client","Caching"],S);var b=n(26);Core.exportToNamespace(["AppMagic","Runtime","Client","Caching"],b);var I=n(52);Core.exportToNamespace(["AppMagic","Runtime","Client","Caching"],I);var w=n(12);Core.exportToNamespace(["AppMagic","Runtime","Client"],w);var T=n(53);Core.exportToNamespace(["AppMagic","Runtime","Client"],T);var M=n(54);Core.exportToNamespace(["AppMagic","Runtime","Client"],M);var R=n(55);Core.exportToNamespace(["AppMagic","Runtime","Client"],R);var E=n(0);Core.exportToNamespace(["AppMagic","Runtime","Client"],E);var U=n(72);Core.exportToNamespace(["AppMagic","Runtime","Client"],U);var H=n(5);Core.exportToNamespace(["AppMagic","Runtime","Client","ConnectionOperations"],H);var k=n(36);Core.exportToNamespace(["AppMagic","Runtime","Client"],k);var F=n(4);Core.exportToNamespace(["AppMagic","Runtime","Client"],F);var O=n(50);Core.exportToNamespace(["AppMagic","Runtime","Client"],O);n(77);var N=n(8);Core.exportToNamespace(["AppMagic","Runtime","Client"],N);var L=n(7);Core.exportToNamespace(["AppMagic","Runtime","Client"],L);var D=n(23);Core.exportToNamespace(["AppMagic","Runtime","Client"],D);var x=n(37);Core.exportToNamespace(["AppMagic","Runtime","Client"],x);var q=n(42);Core.exportToNamespace(["AppMagic","Runtime","Client"],q);var B=n(1);Core.exportToNamespace(["AppMagic","Runtime","Client"],B);var j=n(18);Core.exportToNamespace(["AppMagic","Runtime","Client"],j);n(68);var V=n(16);Core.exportToNamespace(["AppMagic","Runtime","Client"],V);var z=n(38);Core.exportToNamespace(["AppMagic","Runtime","Client"],z);var W=n(74);Core.exportToNamespace(["AppMagic","Runtime","Client"],W);var G=n(62);Core.exportToNamespace(["AppMagic","Runtime","Client"],G);var K=n(39);Core.exportToNamespace(["AppMagic","Runtime","Client"],K);var J=n(51);Core.exportToNamespace(["AppMagic","Runtime","Client"],J);var Q=n(57);Core.exportToNamespace(["AppMagic","Services","RemoteNotification"],Q);var X=n(56);Core.exportToNamespace(["AppMagic","Services","RemoteNotification"],X);var Z=n(11);Core.exportToNamespace(["AppMagic","Services","RemoteNotification"],Z);var Y=n(30);Core.exportToNamespace(["AppMagic","Services","RemoteNotification"],Y);var $=n(22);Core.exportToNamespace(["PushPluginDependency"],$);var ee=n(58);Core.exportToNamespace(["AppMagic","Services","RemoteNotification"],ee);n(69);var te=n(59);Core.exportToNamespace(["AppMagic","Services","RemoteNotification"],te);var ne=n(35);Core.exportToNamespace(["AppMagic","Services","RemoteNotification"],ne);var re=n(40);Core.exportToNamespace(["AppMagic","Runtime","Client"],re);var ie=n(29);Core.exportToNamespace(["AppMagic","Runtime","Client"],ie);var oe=n(24);Core.exportToNamespace(["AppMagic","Runtime","Client"],oe);var se=n(15);Core.exportToNamespace(["AppMagic","Runtime","Client"],se);var ae=n(73);Core.exportToNamespace(["AppMagic","Runtime","Client"],ae);var ce=n(10);Core.exportToNamespace(["AppMagic","Runtime","Client"],{UserFeature:ce.UserFeature}),Core.exportToNamespace(["AppMagic","Runtime","Client","UserFeature"],ce);var pe=n(31);Core.exportToNamespace(["AppMagic","Runtime","Client"],pe);var ue=n(20);Core.exportToNamespace(["AppMagic","Runtime","Client"],ue);var le=n(32);Core.exportToNamespace(["AppMagic","Runtime","Client"],le);var de=n(14);Core.exportToNamespace(["AppMagic","Runtime","Client"],de);var he=n(13);Core.exportToNamespace(["AppMagic","Runtime","Client"],he);var ge=n(9);Core.exportToNamespace(["AppMagic","Runtime","Client"],ge);var fe=n(60);Core.exportToNamespace(["AppMagic","Runtime","Client"],fe);var me=n(61);Core.exportToNamespace(["AppMagic","Runtime","Client"],me);var ye=n(66);Core.exportToNamespace(["AppMagic","Runtime","Client"],ye)}]);
//# sourceMappingURL=D:/a/_work/1/s/obj/Assets/js/AppMagic.Runtime.Client/AppMagic.Runtime.Client.js.map