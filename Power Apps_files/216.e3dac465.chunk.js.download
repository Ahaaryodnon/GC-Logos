/*! For license information please see 216.e3dac465.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[216],{17342:function(e,t,n){"use strict";var r=n(17343);n.d(t,"a",(function(){return r.a}));var a=n(17344);n.d(t,"b",(function(){return a.a})),n.d(t,"f",(function(){return a.b})),n.d(t,"h",(function(){return a.c}));n(17347),n(17345);var o=n(17348);n.d(t,"g",(function(){return o.a}));var i=n(17346);n.d(t,"c",(function(){return i.a}));var l=n(17351);n.d(t,"d",(function(){return l.a})),n.d(t,"e",(function(){return l.b}))},17343:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var r=function(e){return e.Yes="Yes",e.No="No",e.NotSpecified="NotSpecified",e}({}),a={graphTenantDetails:[],tenant:{displayName:"",isTenantWhitelisted:!1,defaultLocation:"",isGccTenant:!1,isDisallowedForInternalPlans:!1},activeUserPlans:[],expiredUserPlans:[],enrollmentOptions:{}}},17344:function(e,t,n){"use strict";n.d(t,"b",(function(){return T})),n.d(t,"a",(function(){return A})),n.d(t,"c",(function(){return U}));var r,a,o=n(11019),i=n(11906),l=n(12056),s=n(11842),c=n(10920),u=n(11403),d=n(11870),p=n(11465),f=n(12068),v=n(11847),m=n(10926),b=n(17343),h=n(17345),y=n(17346),g=n(11205),O=n(12291);function E(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){S(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function S(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t,n,r,a,o,i){try{var l=e[o](i),s=l.value}catch(c){return void n(c)}l.done?t(s):Promise.resolve(s).then(r,a)}function P(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){w(o,r,a,i,l,"next",e)}function l(e){w(o,r,a,i,l,"throw",e)}i(void 0)}))}}function D(){return{enrollmentAndUserDetails:b.b,enrollmentLoadingStatus:s.a.NotLoaded,enrollmentLoadingError:null,enrollmentFullyLoaded:!1,shouldShowEnrollmentConsent:!1,getTenantCountryCode:"",hasUserEnrolledAtLeastOnce:!1}}function T(){return Object(o.n)()}var L=m.createContext(D());class k extends m.Component{constructor(e){var t;super(e),t=this,this.userHasEnrolledCacheKey="HasEnrolled",this.enrollDataPersistentStorageKey="enrollment",this.setStateFromEnrollData=function(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];t.setState({enrollmentAndUserDetails:e,enrollmentLoadingStatus:s.a.Loaded,shouldShowEnrollmentConsent:Object(h.b)(e),getTenantCountryCode:Object(h.a)(e),hasUserEnrolledAtLeastOnce:!0,enrollmentFullyLoaded:!n})};var n=D();n.hasUserEnrolledAtLeastOnce=this.getCachedUserHasEnrolled(),this.state=n}componentDidMount(){var e=this;return P((function*(){if(!Object(u.f)()||Object(o.n)())try{e.tryLoadFromPersistentStorage(),yield e.loadFromEnrollCall()}catch(t){e.setErrorState(t)}}))()}render(){if(this.state.enrollmentLoadingError)throw this.state.enrollmentLoadingError;return m.createElement(L.Provider,{value:j({},this.state)},m.createElement(m.Fragment,null,this.props.children))}tryLoadFromPersistentStorage(){var e=this;return P((function*(){var t=yield f.c.getItemAsync(e.enrollDataPersistentStorageKey);t&&e.state.enrollmentLoadingStatus===s.a.NotLoaded&&e.isSupportedTenant(t)&&e.setStateFromEnrollData(t,!0)}))()}loadFromEnrollCall(){var e=this;return P((function*(){var t="dev"===new URLSearchParams(e.props.location.search).get("offer"),n=O.a.provisionDevEnvironmentWithoutEnrollmentCall||!t&&y.a.enableSkipDevEnvironmentAutoProvision,s=j({"api-version":"".concat(e.props.deprecateLegacyPARPForEssentialServices?"1":"2017-06-01"),"source-identifier":Object(o.n)()?"PowerAppsTeams":void 0},n&&{action:"skipDevEnvironment"}),c=e.props.deprecateLegacyPARPForEssentialServices?Object(i.a)(r||(r=E(["https://ppapi/powerapps/tenants/:tenantId/enroll?",""])),s):Object(i.a)(a||(a=E(["https://pa-rp/api/providers/Microsoft.PowerApps/enroll?",""])),s),u=!1;try{var d=Object(p.h)(),v=(yield e.props.httpClient.post(c,{},{headers:{"accept-language":d}})).data;if(!e.isSupportedTenant(v)){u=!0,yield Object(p.p)("Enrollment");var m=Object(p.i)("Enrollment",Object(p.h)());throw new l.a(!0,m("EnrollmentProvider.errorTextGCCDisallowed"))}e.setStateFromEnrollData(v),v.activeUserPlans&&v.activeUserPlans.length>0?(f.c.setItemAsync(e.enrollDataPersistentStorageKey,v),e.setCachedUserHasEnrolled(!0)):(f.c.removeItemAsync(e.enrollDataPersistentStorageKey),e.setCachedUserHasEnrolled(!1))}catch(b){if(u)throw b}}))()}setErrorState(e){f.c.removeItemAsync(this.enrollDataPersistentStorageKey),this.state.enrollmentLoadingError||this.setState({enrollmentLoadingStatus:this.state.enrollmentLoadingStatus===s.a.Loaded?s.a.Loaded:s.a.Error,enrollmentLoadingError:Object(l.b)(e instanceof Error?e:new Error(e))})}isSupportedTenant(e){var{tenant:t}=e,n=!Object(h.c)(e)&&t.isDisallowedForInternalPlans,r=t&&t.isGccTenant&&!Object(c.k)(),a=t&&!t.isGccTenant&&Object(c.k)();return!(r&&n||a)}getCachedUserHasEnrolled(){return!!v.a.transientWithGlobalFallback.getItem(this.userHasEnrolledCacheKey)}setCachedUserHasEnrolled(e){e?v.a.transientWithGlobalFallback.setItem(this.userHasEnrolledCacheKey,"true"):v.a.transientWithGlobalFallback.removeItem(this.userHasEnrolledCacheKey)}}var A=Object(g.m)(Object(d.r)(k)),U=Object(s.b)(L,"enrollmentLoadingStatus")},17345:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return i}));var r=n(17343);function a(e){return e.enrollmentOptions&&!!e.enrollmentOptions.powerApps&&e.enrollmentOptions.powerApps.promotionalEmailOption===r.a.NotSpecified}function o(e){return e.graphTenantDetails&&e.graphTenantDetails.length>0?e.graphTenantDetails[0].countryLetterCode:""}function i(e){return l(e.activeUserPlans)||l(e.expiredUserPlans)}function l(e){return!!e&&!!e.length}},17346:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(11038),a=Object(r.d)({packageName:"powerappsEnrollment",features:{enableOakdaleTenantEnforcementMessaging:{owner:"ryleen",description:"Enables enforcement warnings/errors when DfT tenants approach/exceed their capacity limits",createdDate:"01/25/2021",enabledFor:{test:!1,preprod:!1,preview:!1,prod:!1,gov:!1,high:!1,dod:!1,mooncake:!1}},enableSkipDevEnvironmentAutoProvision:{owner:"jacalhou",description:"Enables skipping the auto-provisioning of a dev environment during enrollment, unless ?offer=dev is specified",createdDate:"10/11/2022",enabledFor:{test:!0,preprod:!0,preview:!0,prod:!0,gov:!0,high:!0,dod:!0,mooncake:!0}}}})},17347:function(e,t,n){"use strict";var r=n(10926),a=n(17343),o=n(17344);class i extends r.Component{constructor(e){super(e),this.setState({enrollAndUserDetails:a.b})}render(){var{tenant:e,activeUserPlans:t}=this.props.enrollmentAndUserDetails;return r.createElement("div",null,r.createElement("h3",null,"EnrollmentDemo (Displaying Tenant Info)"),r.createElement("div",null,"Tenant DisplayName: ","->"+e.displayName),r.createElement("div",null,"IsTenantWhiteListed: ","-> "+e.isTenantWhitelisted),r.createElement("div",null,"Tenant DefaultLocation ","-> "+e.defaultLocation),r.createElement("div",null,"Number of Active plans: ","-> "+t.length))}}Object(o.c)(i)},17348:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(13629),a=n(10926),o=n(17346),i=n(17349);function l(){var{genericClient:e}=Object(r.e)(),[t,n]=a.useState(void 0),l=Object(i.a)(e,"tenantCapacity",!o.a.enableOakdaleTenantEnforcementMessaging);return a.useEffect(()=>{l.tenantCapacity&&n(l.tenantCapacity)},[l.tenantCapacity]),{tenantCapacity:t}}},17349:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(11021),a=n(10926),o=n(13572),i=n(13555),l=n(13556),s=n(17350);function c(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=l.g.TenantCapacity,[u,d]=Object(a.useState)(),{loading:p,data:f}=Object(o.c)(s.a,{client:e||void 0,onCompleted:e=>{var t;u&&(u.complete({tenantCapacityId:e&&(null==e?void 0:e.tenantCapacity)&&(null==e||null===(t=e.tenantCapacity)||void 0===t?void 0:t.tenantId)}),d(void 0))},onError:e=>{if(u){var t=Object(i.b)(e,"Tenant Capacity Failed");u.failure({error:t,clientError:e&&(null==e?void 0:e.message)}),d(void 0)}},skip:n});return Object(a.useEffect)(()=>{p&&d(Object(r.X)(t,c))},[p]),{loading:p,tenantCapacity:null==f?void 0:f.tenantCapacity}}},17350:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r,a=n(13558);var o,i,l=n.n(a)()(r||(o=["\n  query GetTenantCapacity {\n    tenantCapacity {\n      tenantId\n      tenantCapacities {\n        CapacityType\n        CapacityUnits\n        TotalCapacity\n        Consumption {\n          Actual\n          Rated\n        }\n      }\n    }\n  }\n"],i||(i=o.slice(0)),r=Object.freeze(Object.defineProperties(o,{raw:{value:Object.freeze(i)}}))))},17351:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return l}));var r=n(14762),a=n(12287),o=n(17346);function i(e){return function(e){return e>=1?r.b.Severe:e>=.8?r.b.Warn:r.b.None}(function(e){var t=0;if(e)for(var n of e.tenantCapacities)if(n.CapacityType===r.a.M365Database){t=0!==n.TotalCapacity?n.Consumption.Rated/n.TotalCapacity:1;break}return t}(e))}function l(e,t,n){var l=a.a.enableOakdaleEnforcementMessaging?Object(r.c)(t,n):r.b.None,s=o.a.enableOakdaleTenantEnforcementMessaging?i(e):r.b.None;return l===r.b.Severe||s===r.b.Severe}}}]);
//# sourceMappingURL=https://sourcemaps.powerapps.com/srcmaps/static/js/module/216.e3dac465.chunk.js.map