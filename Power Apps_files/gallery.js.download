"use strict";
/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */
/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */
/*!
 * Copyright (C) Microsoft Corporation. All rights reserved.
 */var AppMagic;!function(e){!function(t){!function(t){var o=function(){function o(){}return o.prototype.getItemsElementBounds=function(e){var t=this.getItemsElementBoundsInPixels(e),o={};return e.isVerticalLayout?(o.width="auto",o.height=t.height+"px"):(o.width=t.width+"px",o.height="auto"),o},o.prototype.getItemsElementBoundsInPixels=function(e,o){var r=this._getNonVirtualizedItemsSize(e),i=Math.min(t.BROWSER_MAX_WIDTH_LIMIT,r),n={};return e.isVerticalLayout?n.height=i:n.width=i,n},o.prototype.getWindowIndices=function(e){var t=e.itemsLength,o={itemCount:t,minIndex:0,maxIndex:0,minVisibleIndex:0,maxVisibleIndex:0};if(t){var r=e.scaleHorizontally(e.templateWidthWithPadding),i=e.scaleVertically(e.templateHeightWithPadding),n=e.isVerticalLayout?e.scaleVertically(e.height):e.scaleHorizontally(e.width),l=e.isVerticalLayout?i:r,a=n/l;if(a>0){var s=e.wrapCount,c=Math.ceil(t/s),p=Math.floor(c-a)*l,u=e.hasScrolled?e.isVerticalLayout?e.scrollTop:e.scrollLeft:0,d=Math.min(p,u+e.pageOffset)/l,h=.75*a;o.minIndex=Math.max(0,s*Math.floor(d-h)),o.maxIndex=Math.min(t-1,s*Math.ceil(d+a+h)-1),o.minVisibleIndex=s*Math.floor(d),o.maxVisibleIndex=Math.min(t-1,s*Math.ceil(d+a)-1)}}return o},o.prototype.updateTemplateHeight=function(e,t){},o.prototype.getIndividualItemElementBounds=function(e,t){var o=this.getIndividualItemElementBoundsInPixels(e,t);return{left:"".concat(o.left,"px"),top:"".concat(o.top,"px")}},o.prototype.getIndividualItemElementBoundsInPixels=function(e,t){var o=e.scaleHorizontally(e.templateWidthWithPadding),r=e.scaleVertically(e.templateHeightWithPadding),i=e.templatePadding,n=e.scaleHorizontally(i),l=e.scaleVertically(i),a=e.wrapCount,s=Math.floor(t/a);return e.isVerticalLayout?{left:t%a*o,top:s*r+l-e.pageOffset}:{top:t%a*r,left:s*o+n-e.pageOffset}},o.prototype.getFirstItemInScrolledArea=function(e,t){void 0===t&&(t=0);var o=(e.isVerticalLayout?e.scrollTop:e.scrollLeft)+e.pageOffset+t,r=e.wrapCount,i=this._getScaledTemplateSizeWithPadding(e);return r*Math.floor(0===i?0:o/i)+1},o.prototype.getItemOffset=function(e,o){var r=o-1;r<0&&(r=0);var i=e.wrapCount,n=this._getScaledTemplateSizeWithPadding(e)*r/i,l=Math.floor(n/t.BROWSER_INCREMENTAL_OFFSET)*t.BROWSER_INCREMENTAL_OFFSET,a=n%t.BROWSER_INCREMENTAL_OFFSET,s={xOffset:0,yOffset:0,pageOffset:l};return e.isVerticalLayout?s.yOffset=a:s.xOffset=a,s},o.prototype._getNonVirtualizedItemsSize=function(t){var o=this._getScaledTemplateSizeWithPadding(t),r=t.wrapCount,i=t.itemsLength,n=e.Controls.converters.pxLogicalToNativeHorizontalConverter,l=e.Controls.converters.pxLogicalToNativeVerticalConverter,a=t.isVerticalLayout?l:n,s=(n(t.width),l(t.height),a(t.templatePadding));return o*Math.ceil(i/r)+s},o.prototype.calculateNewIteratedWindowInfo=function(e,o,r){var i=this._getScaledTemplateSizeWithPadding(e),n=e.wrapCount,l=e.pageOffset,a=0,s=this._getNonVirtualizedItemsSize(e);if(s<=t.BROWSER_MAX_WIDTH_LIMIT);else{var c=e.isTemplate&&r>0?r-1:r,p=Math.floor(c/n)*i-l;p>t.BROWSER_MAX_WIDTH_LIMIT-t.BROWSER_MAX_WIDTH_THRESHOLD?a=l+t.BROWSER_INCREMENTAL_OFFSET+t.BROWSER_MAX_WIDTH_LIMIT>s?s-t.BROWSER_MAX_WIDTH_LIMIT-l:t.BROWSER_INCREMENTAL_OFFSET:l>0&&p<t.BROWSER_MAX_WIDTH_THRESHOLD&&(a=l===s-t.BROWSER_MAX_WIDTH_LIMIT?Math.floor(l/t.BROWSER_INCREMENTAL_OFFSET)*t.BROWSER_INCREMENTAL_OFFSET-l:-t.BROWSER_INCREMENTAL_OFFSET)}var u;return e.isVerticalLayout?(u=e.scrollTop,0!==a&&(u-=a)):(u=e.scrollLeft,0!==a&&(u-=a)),{iteratedWindowBounds:{left:"0px",right:"0px",top:"0px"},updatedScrollOffset:u,newPageOffset:l+a}},o.prototype.needsRedrawOnVirtualPageChange=function(e){return!0},o.prototype.adjustTemplateSize=function(e){var t=e.templatePadding,o={width:0,height:0},r=e.wrapCount;return e.isVerticalLayout?(o.width=(e.width-t)/r-t,o.height=e.templateSize):(o.width=e.templateSize,o.height=(e.height-t)/r-t),o},o.prototype.handleAuthoringTemplateResize=function(e,t,o,r,i){var n={},l=e.templatePadding,a=t-e.offsetX,s=o-e.offsetY,c=e.x,p=e.y,u=e.wrapCount;if(n.Y=s,e.isVerticalLayout){n.X=a,n.Width=l+u*(r+l);var d=e.height+p-s;n.Height=d,i>d-l&&(i=d-l),n.TemplateSize=i}else{n.Height=l+u*(i+l);var h=e.width+c-a;n.X=a,n.Width=h,r>h-l&&(r=h-l),n.TemplateSize=r}return n},o.prototype._getScaledTemplateSizeWithPadding=function(e){return e.isVerticalLayout?e.scaleVertically(e.templateHeightWithPadding):e.scaleHorizontally(e.templateWidthWithPadding)},o}();t.AbsolutePositionGalleryLayoutManager=o}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o=e.Controls.converters,r=function(){function t(){this._templateHeight=0,this._templatePadding=0}return t.prototype.initialize=function(e){this._initialize(e.templateHeight,e.templatePadding)},t.prototype._initialize=function(e,t){this._templateHeight=e,this._templatePadding=t,this._templateHeights=[e],this._templateOffsets=[t,2*t+e],this._areTemplateOffsetsDirty=!1},t.prototype._updateOffsetsCacheLength=function(e){for(var t=this._templateHeights.length;t<e;)this._templateHeights.push(this._templateHeight),this._templateOffsets[t+1]=this._templateHeight+this._templatePadding+this._templateOffsets[t],t++},t.prototype.reset=function(e){this.initialize(e)},t.prototype.isLayoutInfoChanged=function(e){return this._areTemplateOffsetsDirty},t.prototype.onBeforeRendering=function(){this._areTemplateOffsetsDirty=!1},t.prototype.updateTemplateHeight=function(e,t){if(this._updateOffsetsCacheLength(e+1),t!==this._templateHeights[e]){this._areTemplateOffsetsDirty=!0,this._templateHeights[e]=t;for(var o=e+1,r=this._templateOffsets.length;o<r;o++)this._templateOffsets[o]=this._templateOffsets[o-1]+this._templateHeights[o-1]+this._templatePadding}},t.prototype.getItemsElementBounds=function(e,t){return{width:"auto",height:this.getItemsElementBoundsInPixels(e,t).height+"px"}},t.prototype.getItemsElementBoundsInPixels=function(t,o){var r=e.Controls.converters.pxLogicalToNativeVerticalConverter,i=0,n=t.itemsLength;return n>0&&(this._updateOffsetsCacheLength(n),i=r(this._templateHeights[n-1]+this._templateOffsets[n-1])),{height:Math.max(i,r(t.height))}},t.prototype.getWindowIndices=function(e){var t=e.itemsLength,o={itemCount:t,minIndex:0,maxIndex:0,minVisibleIndex:0,maxVisibleIndex:0};if(this._updateOffsetsCacheLength(t),t>0){var r=e.height,i=this._calculateScrollOffset(e);o.maxIndex=1/0;for(var n=0;n<t;n++){var l=this._templateOffsets[n];l<=i&&n>o.minIndex&&(o.minIndex=n),l-i>=r&&n<o.maxIndex&&(o.maxIndex=n)}o.minIndex=Math.max(0,o.minIndex-5),o.maxIndex=Math.min(o.maxIndex+5,t-1),o.minVisibleIndex=Math.max(0,o.minIndex),o.maxVisibleIndex=Math.min(o.maxIndex,t-1)}return o},t.prototype.canFitMoreItems=function(e,t){var o=e.itemsLength,r=e.height,i=this._calculateScrollOffset(e);return this._templateOffsets[t.maxIndex]-i<r&&t.maxIndex<o-1},t.prototype.getIndividualItemElementBounds=function(t,o){var r=e.Controls.converters.pxVerticalConverter.view,i=this.getIndividualItemElementBoundsInPixels(t,o);return{left:r(i.left),top:r(i.top),height:r(i.height)}},t.prototype.getIndividualItemElementBoundsInPixels=function(e,t){return this._updateOffsetsCacheLength(t+1),{left:0,top:this._templateOffsets[t],height:this._templateHeights[t]}},t.prototype.getFirstItemInScrolledArea=function(e,t){void 0===t&&(t=0);for(var o=this._calculateScrollOffset(e)+t,r=this._templateOffsets.length,i=0;i<r&&this._templateOffsets[i]<o;)i++;return i+1},t.prototype.getItemOffset=function(e,t){var o=Math.max(0,t-1);return{xOffset:0,yOffset:this._templateOffsets[o],pageOffset:0}},t.prototype.calculateNewIteratedWindowInfo=function(e,t,o){return{iteratedWindowBounds:{left:"0px",right:"0px",top:"0px"},updatedScrollOffset:e.scrollTop,newPageOffset:0}},t.prototype.needsRedrawOnVirtualPageChange=function(e){return!1},t.prototype.adjustTemplateSize=function(e){var t=e.templatePadding||0,o=e.templateSize||0,r={width:e.width-2*t,height:o};return this._initialize(o,t),r},t.prototype.handleAuthoringTemplateResize=function(e,t,o,r,i){var n={},l=e.templatePadding,a=t-e.offsetX,s=o-e.offsetY,c=e.y;n.Y=s,n.X=a,n.Width=2*l+r;var p=e.height;return p+=c-s,n.Height=p,i>p-l&&(i=p-l),n.TemplateSize=i,this._initialize(i,l),n},t.prototype._calculateScrollOffset=function(e){return(e.hasScrolled?e.scrollTop:0)/o.pxLogicalToNativeVerticalConverter(1)},t}();t.VariableHeightGalleryLayoutManager=r}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){e.BROWSER_MAX_WIDTH_LIMIT=1e6,e.BROWSER_MAX_WIDTH_THRESHOLD=5e4,e.BROWSER_INCREMENTAL_OFFSET=e.BROWSER_MAX_WIDTH_LIMIT-3*e.BROWSER_MAX_WIDTH_THRESHOLD}(e.Gallery||(e.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o={itemContainer:{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden"},itemWindow:{position:"absolute",top:0,left:0,overflow:"visible",width:"100%",height:"100%"}},r=function(r){function i(e){var t=r.call(this,e)||this;return t._ref=t._ref.bind(t),t._resetScrollState(),t}return __extends(i,r),i.prototype.render=function(){var t=this.props,r=t.layoutInfoProvider,i=t.templatePadding,n=r.scaleVertically(i),l=r.scaleVertically(i),a=e.Controls.converters,s=Object.assign({},o.itemWindow,{marginTop:n,marginBottom:n,marginLeft:l,marginRight:l,height:a.pxVerticalConverter.view(r.templateHeight),width:a.pxHorizontalConverter.view(r.templateWidth)});return React.createElement("div",{style:o.itemContainer,ref:this._ref,role:"list","data-control-part":"gallery-window"},React.createElement("div",{className:"react-gallery-items-window",style:s},this._renderTemplateItem()))},i.prototype.componentDidMount=function(){this._setScroll(this.props.defaultScrollOffset)},i.prototype.componentDidUpdate=function(e){this.props.resetCount!==e.resetCount&&this._setScroll(this.props.defaultScrollOffset)},i.prototype._renderTemplateItem=function(){var o,r,i=this.props,n=i.orientation,l=i.strings,a=i.templateItemInfo,s=i.templateSize,c=i.templateMaxWidth,p=n===t.GalleryLayout.Vertical,u=e.Controls.converters;return p?(o=u.pxVerticalConverter.view(s),r=c>0?c+"px":"100%"):(r=u.pxHorizontalConverter.view(s),o="100%"),React.createElement(t.GalleryItem,{key:t.GalleryItem.getRenderingKey(0,a),onClick:null,select:null,role:"listitem",index:0,total:1,transition:t.GalleryTemplateTransition.None,topPosition:0,leftPosition:0,width:r,height:o,strings:l,isVerticalLayout:p,_info:a})},i.prototype._resetScrollState=function(){0!==this.props.layoutInfoProvider.pageOffset&&(this.props.layoutInfoProvider.pageOffset=0,this.props.onScrollOriginChanged(0)),this.props.layoutInfoProvider.scrollTop=0,this.props.layoutInfoProvider.scrollLeft=0,this.props.layoutInfoProvider.hasScrolled=!1,this.props.onScroll(0)},i.prototype._setScroll=function(e){this._itemContainer&&(this.props.orientation===t.GalleryLayout.Vertical?(this._itemContainer.scrollTop=e,this.props.layoutInfoProvider.scrollTop=e):(this._itemContainer.scrollLeft=e,this.props.layoutInfoProvider.scrollLeft=e),this.props.onScroll(e))},i.prototype._ref=function(e){this._itemContainer=e},i}(React.Component);t.AuthoringModeNoItems=r}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o=e.Controls.LoadingSpinner,r=e.Controls.LoadingSpinnerEnum,i={position:"absolute",top:0,left:0,right:0,bottom:0,overflowX:"auto",overflowY:"auto",WebkitOverflowScrolling:"touch"},n={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden"},l={position:"absolute",top:0,left:0,right:0,overflow:"visible",width:"100%",height:"100%"},a=function(a){function s(e){var o=a.call(this,e)||this;return o._visibleIndex=0,o._firstItemIndex=0,o._lastItemIndex=0,o._delayRenderChildrenId=0,o._delaySetStateId=0,o._scrollSourceFixId=0,o._iOSScrollbarFixId=0,o._onScroll=o._onScroll.bind(o),o._scrollUpdates=o._scrollUpdates.bind(o),o._commonGalleryItemProps=null,o._galleryItemCache={},o._galleryItemTemplate=null,o._invalidateGalleryItemCache=!0,o._setScrollSuccess=!1,o._loadingSpinnerRef=React.createRef(),o._visibleItemsDataPromise=Promise.resolve([]),o._dataLoadingPromise=e.dataLoadingPromiseObservable.peek(),o._loadingSpinnerControlsPromise=Core.PromiseUtils.createCompletablePromise(),o._loadingSpinnerPromise=null,o._ref=o._ref.bind(o),o._scrollDebouncer=new t.ScrollDebouncer(o._scrollUpdates),o._lastScrollSource=o.props.initialScrollSource,o._lastScrollOffset=o.props.defaultScrollOffset,o._lastScrollOrigin=o.props.defaultScrollOrigin,o._lastScrollCorrectionOffset=0,o.props.layoutInfoProvider.pageOffset=o.props.defaultScrollOrigin,o.props.layoutInfoProvider.scrollTop=o.props.defaultScrollOffset,o.props.layoutInfoProvider.scrollLeft=o.props.defaultScrollOffset,o._dataLoadingPromiseSubscription=o.props.dataLoadingPromiseObservable.subscribe((function(e){o.props.loadingSpinner===r.Data&&(o._dataLoadingPromise=e,o._tryShowLoadingSpinner())})),o.state={hasPrevious:!1,hasNext:!0,renderChildren:!o.props.delayRenderChildren},o}return __extends(s,a),s.prototype._createGalleryItem=function(e,t,o){var r=this.props,i=r.layoutInfoProvider,n=r.layoutManager.getIndividualItemElementBoundsInPixels(i,t),l=n.left,a=n.top,s=this._commonGalleryItemProps.height,c=void 0!==s?s:n.height+"px";return React.cloneElement(this._galleryItemTemplate,{key:e,height:c,index:t,topPosition:a,leftPosition:l,_info:o})},s.prototype._getOrCreateGalleryItem=function(e){var o=this.props.getItemInfo(e),r=t.GalleryItem.getRenderingKey(e,o);if(this.props.isVariableTemplate)return this._createGalleryItem(r,e,o);var i=this._galleryItemCache[e];return i&&i.key===r||(i={key:r,item:this._createGalleryItem(r,e,o)},this._galleryItemCache[e]=i),i.item},s.prototype._getGalleryItemBindingContextPromise=function(e){var t=this.props.getItemInfo(e);return null==t?void 0:t.bindingContext.itemDataPromise},s.prototype._clearGalleryItemCache=function(){for(var e in this._galleryItemTemplate=null,this._galleryItemCache)delete this._galleryItemCache[e]},s.prototype._pruneGalleryItemCacheTo=function(e,t){for(var o in this._galleryItemCache){var r=Number(o);(r<e||t<r)&&delete this._galleryItemCache[o]}},s.prototype._createCommonGalleryItemProps=function(){var e,o,r=this.props,i=r.layoutInfoProvider,n=r.orientation,l=r.isVariableTemplate,a=r.strings,c=r.templateSize,p=r.templateMaxWidth,u=r.isSelectable,d=r.disabled,h=n===t.GalleryLayout.Vertical;return h?(e=l?void 0:s._pxVerticalConverter(c),o=p>0?p+"px":"100%"):(o=s._pxHorizontalConverter(c),e="100%"),{onClick:u?r.onItemClick:null,select:u?r.select:null,role:u?"option":"listitem",total:i.itemsLength,transition:d?t.GalleryTemplateTransition.None:r.transition,width:o,height:e,strings:a,templateWidth:i.templateWidth,templateHeight:i.templateHeight,isVerticalLayout:h,index:void 0,topPosition:void 0,leftPosition:void 0,_info:void 0}},s.prototype._renderGalleryItems=function(e){var o=this._createCommonGalleryItemProps();this._invalidateGalleryItemCache||!Core.Utility.objectShallowCompare(this._commonGalleryItemProps,o)?(this._commonGalleryItemProps=o,this._clearGalleryItemCache(),this._galleryItemTemplate=React.createElement(t.GalleryItem,__assign({},o)),this._invalidateGalleryItemCache=!1):this._pruneGalleryItemCacheTo(e.minIndex,e.maxIndex);for(var r=[],i=[],n=e.minIndex;n<=e.maxIndex;++n){var l=this._getOrCreateGalleryItem(n);r.push(l)}for(n=Math.max(0,e.minVisibleIndex);n<=e.maxVisibleIndex;++n){var a=this._getGalleryItemBindingContextPromise(n);i.push(a)}return this._visibleItemsDataPromise=Promise.all(i),this._tryShowLoadingSpinner(),r},s.prototype._onScroll=function(){this._scrollSourceFixId&&(window.clearTimeout(this._scrollSourceFixId),this._scrollSourceFixId=0),"user"!==this._lastScrollSource?(this._lastScrollSource="set"===this._lastScrollSource?"auto":"user",this.props.onScrollSourceChanged(this._lastScrollSource)):this._lastScrollCorrectionOffset=0;var e=this._getPhysicalScrollOffset();this.props.onScroll(e),this._scrollDebouncer.scroll()},s.prototype._scrollUpdates=function(){if(this._scrollContainer){var e=this._getPhysicalScrollOffset();this._updateVisibleItemsRangeAfterScroll(e)||(this._updateVisibleIndex(),this._updateNavigationArrows())}},s.prototype._updateVisibleItemsRangeAfterScroll=function(e){var t=this.props.layoutInfoProvider;e>=0&&(t.hasScrolled=0!==e,t.isVerticalLayout?t.scrollTop=e:t.scrollLeft=e);var o=this._computeWindowIndices(),r=this.props.layoutManager.calculateNewIteratedWindowInfo(t,o,o.minIndex),i=r.newPageOffset;if(t.pageOffset!==i){var n=r.updatedScrollOffset;this._setScroll(n,i)}return(this._firstItemIndex!==o.minIndex||this._lastItemIndex!==o.maxIndex)&&(this._shouldShowSpinnerForControls(o)?(this._loadingSpinnerControlsPromise=Core.PromiseUtils.createCompletablePromise(),this._tryShowLoadingSpinner(),this._delaySetState(),!1):(this.setState({}),!0))},s.prototype._updateVisibleIndex=function(){var e=this.props,t=e.layoutManager,o=e.layoutInfoProvider,r=t.getFirstItemInScrolledArea(o,this._lastScrollCorrectionOffset);r!==this._visibleIndex&&(this._visibleIndex=r,this.props.onVisibleIndexChanged(r))},s.prototype._computeWindowIndices=function(){var e=this.props,t=e.layoutManager,o=e.layoutInfoProvider,r=t.getWindowIndices(o),i=Math.max(0,r.maxIndex);return __assign(__assign({},r),{maxIndex:i})},s.prototype._updateNavigationArrows=function(){var e=this.props,o=e.layoutInfoProvider,r=e.layoutManager,i=e.orientation;if(e.showNavigation){var n=i===t.GalleryLayout.Vertical,l=!1,a=!1,s=r.getItemsElementBoundsInPixels(o),c=n?s.height:s.width;if(o.itemsLength<=1)l=!1,a=!1;else if(this._scrollContainer){var p=n?this._scrollContainer.clientHeight:this._scrollContainer.clientWidth,u=this._getPhysicalScrollOffset();l=!0,a=!0,c<=p?(l=!1,a=!1):u<1?l=!1:p+u+this._lastScrollCorrectionOffset>=c&&(a=!1)}this.state.hasNext===a&&this.state.hasPrevious===l||this.setState({hasPrevious:l,hasNext:a})}},s.prototype._scrollingWindowSize=function(){var e=this.props,o=e.layoutInfoProvider,r=e.layoutManager;if(0===o.itemsLength)return 0;var i=r.getItemsElementBoundsInPixels(o);return this.props.orientation===t.GalleryLayout.Vertical?i.height:i.width},s.prototype._setScroll=function(e,o,r){void 0===r&&(r=!1);var i=this._scrollContainer;if(i){var n=this.props,l=n.layoutInfoProvider,a=n.orientation,s=n.onScrollOriginChanged,c=n.textDirection;if(a===t.GalleryLayout.Vertical){this._lastScrollOffset=e;var p=i.scrollTop,u=i.clientHeight,d=i.scrollHeight;if(Math.abs(p-e)>=1||0===e&&0===d){r||(this._lastScrollSource="set",this.props.onScrollSourceChanged("auto")),i.scrollTop=e,p=i.scrollTop;var h=d-u;this._lastScrollCorrectionOffset=Math.min(e,h)-p}this._setScrollSuccess=this._setScrollSuccess||Math.abs(p-e)<1||0!==d&&e>=d-u}else{this._lastScrollOffset=e,"rtl"===c&&(e*=-1);var g=i.scrollLeft,m=i.clientWidth,f=i.scrollWidth;if(Math.abs(g-e)>=1||0===e&&0===f){r||(this._lastScrollSource="set",this.props.onScrollSourceChanged("auto")),i.scrollLeft=e,g=i.scrollLeft;h=f-m;this._lastScrollCorrectionOffset=Math.min(e,h)-g}this._setScrollSuccess=this._setScrollSuccess||Math.abs(g-e)<1||0!==f&&e>=f-m}this._lastScrollOrigin=o,o!==l.pageOffset&&(l.pageOffset=o,this.setState({}),s(o))}},s.prototype._scrollSourceFix=function(){var e=this;window.clearTimeout(this._scrollSourceFixId),this._scrollSourceFixId=window.setTimeout((function(){e._scrollSourceFixId=0,"set"===e._lastScrollSource&&(e._lastScrollSource="auto",e.props.onScrollSourceChanged(e._lastScrollSource))}),100)},s.prototype._getPhysicalScrollOffset=function(){if(!this._scrollContainer)return 0;var e=this.props.orientation===t.GalleryLayout.Vertical?this._scrollContainer.scrollTop:this._scrollContainer.scrollLeft;return Math.ceil(Math.abs(e))},s.prototype._isScrollOriginValid=function(e){if(0===e)return!0;if(e<0)return!1;var t=this.props,o=t.layoutInfoProvider,r=t.layoutManager,i=this._firstItemIndex+1;return r.getItemOffset(o,i).pageOffset>=e},s.prototype._ref=function(e){this._scrollContainer=e,this.props.onComponentReference(e)},s.prototype._iOSScrollbarFix=function(){var e=this;Core.Environment.getDeviceId()!==Core.Environment.DeviceId.iOSDevice||!this._scrollContainer||this._scrollDebouncer.isScrolling()||this.props.isVariableTemplate||(window.clearTimeout(this._iOSScrollbarFixId),this._scrollContainer.style.WebkitOverflowScrolling="auto",this._iOSScrollbarFixId=window.setTimeout((function(){e._scrollContainer&&(e._scrollContainer.style.WebkitOverflowScrolling="touch")}),10))},s.prototype._tryShowLoadingSpinner=function(){var e=this;if(this.props.loadingSpinner!==r.None){this._showSpinner(),this._loadingSpinnerPromise&&(this._loadingSpinnerPromise.cancel(),this._loadingSpinnerPromise=null);var t=[this._loadingSpinnerControlsPromise.promise];this.props.loadingSpinner!==r.Data||Core.FallbackSwitch.isActivated("Controls.GalleryLoadingSpinnerData")||t.push(this._dataLoadingPromise,this._visibleItemsDataPromise),this._loadingSpinnerPromise=Core.PromiseUtils.createCancellablePromise(),this._loadingSpinnerPromise.promise.then((function(){e._hideSpinner()})),Promise.allSettled(t).then((function(){var t;null===(t=e._loadingSpinnerPromise)||void 0===t||t.complete()}))}},s.prototype.componentWillReceiveProps=function(e){this.props.childCount===e.childCount&&this.props.wrapCount===e.wrapCount&&this.props.templatePadding===e.templatePadding&&this.props.textDirection===e.textDirection||(this._invalidateGalleryItemCache=!0),this.props.delayRenderChildren||this.state.renderChildren||this._delayRenderChildrenId&&(window.clearTimeout(this._delayRenderChildrenId),this._delayRenderChildrenId=0,this.setState({renderChildren:!0}))},s.prototype.render=function(){var e,a;this._renderStartTime=window.performance.now();var c=this.props,p=c.disabled,u=c.label,d=c.layoutInfoProvider,h=c.orientation,g=c.navigateBy,m=c.showNavigation,f=c.strings,_=c.tabIndex,y=c.templatePadding,C=c.templateMaxWidth,S=c.loadingSpinner,I=c.loadingSpinnerColor,v=c.textDirection,b=h===t.GalleryLayout.Vertical,x="rtl"===v,P=((e={})[b?"height":"width"]="".concat(this._scrollingWindowSize(),"px"),e);b?(P.width=C>0?C:"100%",P.minHeight="100%"):(P.minWidth="100%",P.height="100%");var O=Object.assign({},n,P),T=b?"auto":d.scaleVertically(y),w=b&&!x?d.scaleVertically(y):"auto",A=b&&x?d.scaleVertically(y):"auto",M=b?s._pxHorizontalConverter(d.templateWidth):"100%",L=b?"100%":s._pxVerticalConverter(d.templateHeight),R=Object.assign({},l,{marginTop:T,marginBottom:"auto",marginLeft:w,marginRight:A,height:L,width:M}),V=0,E=null;if(this.state.renderChildren){var G=this._computeWindowIndices();this._shouldShowSpinnerForControls(G)&&this._tryShowLoadingSpinner(),E=this._renderGalleryItems(G),this._firstItemIndex=G.minIndex,this._lastItemIndex=G.maxIndex,V=d.itemsLength}var D="virtualized-gallery",W=i;!(b&&C>0)&&(W=Object.assign({},W,((a={})[b?"overflowX":"overflowY"]="hidden",a))),this.props.showScrollbar||(D+=" hideScrollbar",W=Object.assign({},W,{msOverflowStyle:"none"}));var H=S!==r.None;return React.createElement(React.Fragment,null,React.createElement(t.GallerySummary,{label:this.props.label,firstItemIndex:this._firstItemIndex,lastItemIndex:this._lastItemIndex,total:V,strings:f}),React.createElement("div",{className:D,style:W,ref:this._ref,onScroll:this._onScroll,"aria-label":u,role:"list","data-control-part":"gallery-window",tabIndex:_<0?null:_},React.createElement("div",{style:O},React.createElement("div",{className:"react-gallery-items-window",style:R},E))),m&&React.createElement(t.GalleryNavigation,{disabled:p,orientation:h,showPrevious:this.state.hasPrevious,showNext:this.state.hasNext,strings:f,tabIndex:_,textDirection:v,navigateBy:g}),H&&React.createElement(o,{ref:this._loadingSpinnerRef,color:I,transitionDelay:100,capturePointerEvents:!1,visible:!1,zIndex:10}))},s.prototype.componentDidMount=function(){var e=this,t=window.performance.now(),o=this._isScrollOriginValid(this.props.defaultScrollOrigin)?this.props.defaultScrollOrigin:0;0===this.props.defaultScrollOffset&&o===this.props.layoutInfoProvider.pageOffset||this._setScroll(this.props.defaultScrollOffset,o,!0),this._scrollSourceFix(),this._updateVisibleIndex(),this._updateNavigationArrows(),this._iOSScrollbarFix(),this.state.renderChildren||(this._tryShowLoadingSpinner(),this._delayRenderChildrenId=window.setTimeout((function(){e._delayRenderChildrenId=0,e.setState({renderChildren:!0})}),100)),this._raiseRenderStats(this._renderStartTime,t)},s.prototype.componentDidUpdate=function(e){var t=window.performance.now();if(this.props.items!==e.items){var o=this.props.layoutInfoProvider,r=o.pageOffset;if(!this._isScrollOriginValid(r)){var i=o.isVerticalLayout?o.scrollTop:o.scrollLeft;this._setScroll(i,0)}}if(this.props.resetCount!==e.resetCount){r=this._isScrollOriginValid(this.props.defaultScrollOrigin)?this.props.defaultScrollOrigin:0;this._setScroll(this.props.defaultScrollOffset,r)}else this._setScrollSuccess&&"user"===this._lastScrollSource||this._setScroll(this._lastScrollOffset,this._lastScrollOrigin,"user"===this._lastScrollSource);this._scrollSourceFix(),this._updateVisibleIndex(),this._updateNavigationArrows(),this._iOSScrollbarFix(),this.state.renderChildren&&this._loadingSpinnerControlsPromise.complete(),this._raiseRenderStats(this._renderStartTime,t)},s.prototype._raiseRenderStats=function(e,t){var o={delayedRender:this.props.delayRenderChildren,duration:t-e,rowCount:this.state.renderChildren?this._lastItemIndex-this._firstItemIndex+1:0};this.props.onRenderStats(o)},s.prototype._hideSpinner=function(){var e=this._loadingSpinnerRef.current;e&&e.hide()},s.prototype._showSpinner=function(){var e=this._loadingSpinnerRef.current;e&&e.show()},s.prototype._shouldShowSpinnerForControls=function(e){return this.props.loadingSpinner!==r.None&&(e.minVisibleIndex<this._firstItemIndex||this._lastItemIndex<e.maxVisibleIndex)},s.prototype._delaySetState=function(){var e=this;this._delaySetStateId||(this._delaySetStateId=window.setTimeout((function(){e._delaySetStateId=0,e.setState({})}),1))},s.prototype.componentWillUnmount=function(){this._clearGalleryItemCache(),this._galleryItemCache=null,this._galleryItemTemplate=null,this._commonGalleryItemProps=null,this._scrollDebouncer.reset(),window.clearTimeout(this._iOSScrollbarFixId),window.clearTimeout(this._delaySetStateId),window.clearTimeout(this._delayRenderChildrenId),window.clearTimeout(this._scrollSourceFixId),this._dataLoadingPromiseSubscription.dispose(),this._dataLoadingPromiseSubscription=null},s._pxHorizontalConverter=e.Controls.converters.pxHorizontalConverter.view,s._pxVerticalConverter=e.Controls.converters.pxVerticalConverter.view,s}(React.Component);t.VirtualizedList=a}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(o){var r=function(r){function i(t){var o=r.call(this,t)||this;return o._resetCount=0,o._mutationObserver=null,o._hasLoggedOriginChangeEvent=!1,o._hasLoggedRenderEvent=!1,o._handleArrowsClick=o._handleArrowsClick.bind(o),o._getReplicatedContextAtIndex=o._getReplicatedContextAtIndex.bind(o),o._onScroll=o._onScroll.bind(o),o._onScrollOriginChanged=o._onScrollOriginChanged.bind(o),o._onScrollSourceChanged=o._onScrollSourceChanged.bind(o),o._onVisibleIndexChanged=o._onVisibleIndexChanged.bind(o),o._onComponentReference=o._onComponentReference.bind(o),o._onRenderStats=o._onRenderStats.bind(o),o._onItemClick=o._onItemClick.bind(o),o._selectItemBecauseOfInteraction=o._selectItemBecauseOfInteraction.bind(o),o._galleryId=t.controlInstance.control.OpenAjax.uniqueId,o._getTemplateControlInstance=o._getTemplateControlInstance.bind(o),i._strings||(i._strings={currentItemTemplate:e.Strings.GalleryCurrentItem,currentItemRangeTemplate:e.Strings.GalleryCurrentItemRange,defaultItemLabelTemplate:e.Strings.GalleryDefaultItemLabel,itemsCountTemplate:e.Strings.GalleryItemsCountMessage,itemSelectedTemplate:e.Strings.GalleryItemSelected,noItemsMessageTemplate:e.Strings.GalleryNoItemsMessage,showPrevious:e.Strings.GalleryShowPrevious,showNext:e.Strings.GalleryShowNext}),o}return __extends(i,r),i.prototype._getReplicatedContextAtIndex=function(e){var o=this.props.controlContext;return o._replicatedContext.bindingContextAt(e,o.properties.LoadingSpinner()===t.LoadingSpinnerEnum.Data)},i.prototype._getTransitionValue=function(e){switch(e){case"push":return o.GalleryTemplateTransition.Push;case"pop":return o.GalleryTemplateTransition.Pop;default:return o.GalleryTemplateTransition.None}},i.prototype._handleArrowsClick=function(e){this.props.controlInstance.control.nextOrPrevious(this.props.controlContext,e)},i.prototype._onScroll=function(e){var o=this.props.controlContext,r=this.props.controlInstance.control;o.initialized&&o.realized&&(o._layoutInfoProvider.isVerticalLayout||(OpenAjax.widget.controlManager.appModeObservable.peek()!==t.AppMode.Publish&&o.controlWidget.updateScrollX(e),o.modelProperties.HorizontalScrollPosition.getValue()!==e&&o.modelProperties.HorizontalScrollPosition.setValue(e)),r.updateScrollAdorners(o,e),o._lastObservedScrollOffset=e)},i.prototype._onScrollOriginChanged=function(e){this.props.controlContext._lastObservedScrollOrigin=e,e>0&&!this._hasLoggedOriginChangeEvent&&(t.TelemetryHelper.trackActivityEvent(Core.Telemetry.ControlOperationNames.galleryControlOnScrollOriginChanged,this.props.controlContext),this._hasLoggedOriginChangeEvent=!0)},i.prototype._onScrollSourceChanged=function(e){this.props.controlContext._currentScrollSource=e},i.prototype._onVisibleIndexChanged=function(e){var t=this.props.controlContext,o=Math.max(t._pagingManager.itemsLength(),1);t.modelProperties.VisibleIndex.setValue(Core.Utility.clamp(e,1,o))},i.prototype._onComponentReference=function(e){this._scrollContainer&&this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null),this._scrollContainer=e,this.props.controlInstance.control.isVariableTemplateHeightGallery&&this._startMutationObserver()},i.prototype._onRenderStats=function(e){this._hasLoggedRenderEvent||0===e.rowCount||(t.TelemetryHelper.trackActivityEvent(Core.Telemetry.ControlOperationNames.galleryControlRenderStats,this.props.controlContext,{delayedRender:e.delayedRender,duration:e.duration,rowCount:e.rowCount,childCount:this.props.controlInstance.childIds.length},!0),this._hasLoggedRenderEvent=!0)},i.prototype._getTemplateControlInstance=function(){var e=this.props,t=e.getControl,o=e.controlInstance.childIds.find((function(e){return"AppMagic.Controls.Gallery.Template"===t(e).type}));return o?t(o):null},i.prototype._onItemClick=function(t,o){var r=this.props.controlContext;if(r.viewState.displayMode()===e.Constants.DisplayMode.Edit&&0!==r._pagingManager.itemsLength()){var i=this._getItemTemplateControlContext(o);i&&t.target instanceof HTMLElement&&t.target.classList.contains(e.Constants.Controls.GalleryContentDivClassName)&&(r._currentSelectedSource="user",r._currentScrollSource="user",i.behaviors.OnSelect())}},i.prototype._selectItemBecauseOfInteraction=function(t){var o=this.props.controlContext;if(o.viewState.displayMode()===e.Constants.DisplayMode.Edit&&0!==o._pagingManager.itemsLength()){var r=this._getItemTemplateControlContext(t);r&&!r.isTemplate&&(o._currentSelectedSource="user",o._currentScrollSource="user",r._parentReplicatedContext.notifyBindingContextSelectionInteraction(r.bindingContext,!1))}},i.prototype._getItemTemplateControlContext=function(e){var t=this._getTemplateControlInstance(),o=this._getReplicatedContextAtIndex(e);return o&&o.controlContexts?o.controlContexts[t.name]:null},i.prototype._onScheduledDomAction=function(t,o,r,i,n){var l=this.props.controlContext,a=l.properties;if(!t||!l.realized)return function(){i&&i()};if(n)l._layoutManager.updateTemplateHeight(r,a.TemplateHeight()||0);else if(o.firstElementChild&&(o=o.firstElementChild),o&&(o.offsetWidth||o.getClientRects().length)){var s=o.scrollHeight/e.Controls.converters.pxLogicalToNativeVerticalConverter(1),c=l.modelProperties.MaxTemplateSize.getValue();("number"!=typeof c||isNaN(c)||c<=0)&&(c=s);var p=Core.Utility.clamp(s,0,c);l._layoutManager.updateTemplateHeight(r,p)}return function(){i&&i()}},i.prototype._scheduleAutoHeightForTemplate=function(e,t,o,r,i){void 0===r&&(r=!1);var n=this.props.controlInstance,l=n.control,a=this._galleryId+o.id,s=e.querySelector('[data-container-name="'.concat(n.name,'-container"]'));s&&Core.UI.DOMMutationScheduler.scheduleDOMAction(a,l.OpenAjax.nestingLevel,this._onScheduledDomAction.bind(this,e,s,t,i,r))},i.prototype._afterAdjustItemHeights=function(e){var t=this.props.controlContext;t.initialized&&t.realized&&(this.setState({}),(t._layoutManager.canFitMoreItems(t._layoutInfoProvider,e)||t._layoutManager.isLayoutInfoChanged(t._layoutInfoProvider))&&this._adjustItemHeights())},i.prototype._getGalleryItems=function(){var e=[];if(this._scrollContainer){var t=this._scrollContainer.id,o=!!t;o||(t="gallery-temp-id",this._scrollContainer.setAttribute("id",t));for(var r=Array.prototype.slice.call(this._scrollContainer.querySelectorAll("#".concat(t," [data-control-part='gallery-item']"))),i=Array.prototype.slice.call(this._scrollContainer.querySelectorAll("#".concat(t," [data-control-part='gallery-item'] [data-control-part='gallery-window'] [data-control-part='gallery-item']"))),n=0;n<r.length;++n)i.indexOf(r[n])<0&&e.push(r[n]);o||this._scrollContainer.removeAttribute("id")}return e},i.prototype._adjustItemHeights=function(){var e=this,t=this.props.controlContext,o=this.props.controlInstance.control;if(t.initialized&&t.realized&&o.isVariableTemplateHeightGallery&&t.isParentScreenActive.peek()&&this._scrollContainer)for(var r=t._layoutManager.getWindowIndices(t._layoutInfoProvider),i=this._getGalleryItems(),n=0;n<i.length;++n){var l=parseInt(i[n].getAttribute("aria-posinset"),10)-1,a=l===r.maxIndex;if(t.isTemplate&&0===l){var s=!o.isPublishOrPreviewOrInteractionMode.peek(),c=t.controlWidget.contextManager.authoringAreaBindingContext;this._scheduleAutoHeightForTemplate(i[l],l,c,s,a?function(){return e._afterAdjustItemHeights(r)}:null)}else{var p=t._replicatedContext,u=p.getBindingContextCount()>0?p.bindingContextAt(l):null;u&&this._scheduleAutoHeightForTemplate(i[n],l,u,!1,a?function(){return e._afterAdjustItemHeights(r)}:null)}}},i.prototype._startMutationObserver=function(){var e=this;!this._mutationObserver&&this._scrollContainer&&(this._mutationObserver=new MutationObserver((function(t){for(var o=!1,r=0;r<t.length;++r){var i=t[r].attributeName;if(!i||"id"!==i&&"tabindex"!==i&&!i.startsWith("data-")){o=!0;break}}o&&e._adjustItemHeights()})),this._mutationObserver.observe(this._scrollContainer,{subtree:!0,attributes:!0,childList:!0,characterData:!0}))},i.prototype._resetWithNoDefault=function(){if(0!==this.props.controlContext._pagingManager.itemsLength()){var e=this._getItemTemplateControlContext(0);e&&!e.isTemplate&&e._parentReplicatedContext.notifyBindingContextSelectionInteraction(e.bindingContext,!1)}},i.prototype._initParentVisibilityListener=function(t){var o=this;t._parentVisibilityListener=t.controlWidget.addParentPropertyChangeCallback(e.AuthoringTool.OpenAjaxPropertyNames.Visible,(function(e){e&&o.setState({})}))},i.prototype._disposeParentVisibilityListener=function(e){e._parentVisibilityListener&&(e._parentVisibilityListener.dispose(),e._parentVisibilityListener=null)},i.prototype.componentWillUpdate=function(){var e=this.props.controlContext;e.initialized&&e._layoutManager.onBeforeRendering&&e._layoutManager.onBeforeRendering(e._layoutInfoProvider)},i.prototype.componentWillMount=function(){var e=this.props.controlContext;if(this._initialScrollSource=e._currentScrollSource,this._shouldCreateAuthoringTemplate(e.bindingContext)){var t=this.props.controlInstance.control;t.initializeNestedCanvasIfNeeded(e),t.initializeAuthoringScrollingAdorners(e)}r.prototype.componentWillMount.call(this)},i.prototype.componentWillUnmount=function(){var e=this.props.controlContext;this._mutationObserver&&(this._mutationObserver.disconnect(),this._mutationObserver=null),this._isPublishOrPreviewOrInteractionModeSubscription&&(this._isPublishOrPreviewOrInteractionModeSubscription.dispose(),this._isPublishOrPreviewOrInteractionModeSubscription=null),this._scrollContainer=null,this._loadingSpinnerColor=null,e.initialized&&(this._disposeParentVisibilityListener(e),e._defaultScrollOffset=e._lastObservedScrollOffset,e._defaultScrollOrigin=e._lastObservedScrollOrigin),r.prototype.componentWillUnmount.call(this)},i.prototype.componentDidMount=function(){var e=this;r.prototype.componentDidMount.call(this);var t=this.props.controlContext;if(t.initialized){this._initParentVisibilityListener(t),t.controlWidget.addOnBeforeDisposeCallback(t,this._disposeParentVisibilityListener);var o=this.props.controlInstance.control;o.isVariableTemplateHeightGallery&&(this._isPublishOrPreviewOrInteractionModeSubscription=o.isPublishOrPreviewOrInteractionMode.subscribe((function(){e._adjustItemHeights()}))),"default"===t._currentSelectedSource&&"auto"===t._currentScrollSource&&o.ensureSelectedItemVisible(t)}},i.prototype.componentDidUpdate=function(){var e=this.props.controlContext;e.initialized&&(e._resetWithNoDefault&&(this._resetWithNoDefault(),e._resetWithNoDefault=!1),e._shouldReRender()&&e._shouldReRender(!1))},i.prototype._getOrCreateLoadingSpinnerColor=function(e){var t=e||0;return this._loadingSpinnerColorValue!==t&&(this._loadingSpinnerColorValue=t,this._loadingSpinnerColor=Core.Utility.Color.create(t)),this._loadingSpinnerColor},i.prototype._shouldCreateAuthoringTemplate=function(o){return e.AuthoringTool.Runtime.isAuthoring&&(o.isTemplate||t.ControlWidget.isFirstBindingContext(o))},i.prototype._shouldRenderAuthoringTemplate=function(e){return!this.props.controlInstance.control.isPublishOrPreviewOrInteractionMode()&&(e.isTemplate||t.ControlWidget.isFirstBindingContext(e))},i.prototype._getNestedChildCount=function(e){return this.props.controlContext.controlWidget.controlManager.getAllDescendantControlIds(e.id).length},i.prototype.renderCore=function(){var r=this.props.controlContext;if(!r.initialized)return null;var n=r.properties,l=this.props,a=l.controlInstance,s=l.textDirection,c=this._getNestedChildCount(a),p=a.control,u=(p.childControlsIds(),n.Items());r._shouldReRender()&&++this._resetCount;var d=0===r._pagingManager.itemsLength()&&this._shouldRenderAuthoringTemplate(r.bindingContext),h=this._getOrCreateLoadingSpinnerColor(n.LoadingSpinnerColor());return p.contentSizeUpdated(r),React.createElement(t.ContainerControlAccessibilityWrapper,{controlContext:r,isFocusable:!0},React.createElement(o.GalleryView,{controlContext:r,controlInstance:a,defaultScrollOffset:r._defaultScrollOffset,defaultScrollOrigin:r._defaultScrollOrigin,getControl:this.props.getControl,getReplicatedContextAtIndex:this._getReplicatedContextAtIndex,items:u,templateSize:n.TemplateSize(),templatePadding:n.TemplatePadding(),layout:"vertical"===n.Layout()?o.GalleryLayout.Vertical:o.GalleryLayout.Horizontal,transition:this._getTransitionValue(n.Transition()),showNavigation:!!n.ShowNavigation(),showScrollbar:p.shouldShowScrollbar(r),layoutInfoProvider:r._layoutInfoProvider,layoutManager:r._layoutManager,authoringItemOnly:d,onArrowsClickHandler:this._handleArrowsClick,onScroll:this._onScroll,onScrollOriginChanged:this._onScrollOriginChanged,onScrollSourceChanged:this._onScrollSourceChanged,onVisibleIndexChanged:this._onVisibleIndexChanged,onComponentReference:this._onComponentReference,onRenderStats:this._onRenderStats,onItemClick:this._onItemClick,select:this._selectItemBecauseOfInteraction,getTemplateControlInstance:this._getTemplateControlInstance,label:n.AccessibleLabel()||e.Strings.GalleryDefaultLabel,strings:i._strings,templateMaxWidth:n.TemplateMaximumWidth(),isSelectable:!!n.Selectable(),delayRenderChildren:!!n.DelayItemLoading(),loadingSpinner:n.LoadingSpinner(),loadingSpinnerColor:h,resetCount:this._resetCount,childCount:c,wrapCount:n.WrapCount(),textDirection:s,initialScrollSource:this._initialScrollSource,dataLoadingPromiseObservable:r._dataLoadingPromiseObservable}))},i}(t.ObservableComponent);o.GalleryContainer=r}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t={arrowGeneralStyle:{position:"absolute",width:"69px",height:"39px",margin:"0",fontFamily:"Symbols",fontSize:"9pt",zIndex:5e3},leftArrowStyle:{left:"0px",top:"50%",transform:"translateY(-50%) rotate(270deg)"},rightArrowStyle:{right:"0px",top:"50%",transform:"translateY(-50%) rotate(90deg)"},upArrowStyle:{top:"0px",left:"50%",transform:"translateX(-50%)"},downArrowStyle:{bottom:"0px",left:"50%",transform:"translateX(-50%) rotate(180deg)"}},o=function(o){function r(e){var t=o.call(this,e)||this;return t._showPrevious=t._showPrevious.bind(t),t._showNext=t._showNext.bind(t),t}return __extends(r,o),r.prototype.render=function(){var e=this.props.orientation;return React.createElement("div",null,this._renderPrevArrow(e),this._renderNextArrow(e))},r.prototype._showPrevious=function(){this.props.navigateBy(-1)},r.prototype._showNext=function(){this.props.navigateBy(1)},r.prototype._renderPrevArrow=function(o){if(!this.props.showPrevious)return null;var r=this.props,i=r.disabled,n=r.strings,l=r.tabIndex,a=r.textDirection,s=o===e.GalleryLayout.Vertical?t.upArrowStyle:"rtl"===a?t.rightArrowStyle:t.leftArrowStyle;return React.createElement("button",{className:"appmagic-gallery-navigation-button navigation-button prev",onClick:this._showPrevious,style:Object.assign({},t.arrowGeneralStyle,s),"aria-label":n.showPrevious,disabled:i,tabIndex:l})},r.prototype._renderNextArrow=function(o){if(!this.props.showNext)return null;var r=this.props,i=r.disabled,n=r.strings,l=r.tabIndex,a=r.textDirection,s=o===e.GalleryLayout.Vertical?t.downArrowStyle:"rtl"===a?t.leftArrowStyle:t.rightArrowStyle;return React.createElement("button",{className:"appmagic-gallery-navigation-button navigation-button next",onClick:this._showNext,style:Object.assign({},t.arrowGeneralStyle,s),"aria-label":n.showNext,disabled:i,tabIndex:l})},r}(React.Component);e.GalleryNavigation=o}(e.Gallery||(e.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(o){var r;!function(e){e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal"}(r=o.GalleryLayout||(o.GalleryLayout={})),function(e){e[e.None=0]="None",e[e.Push=1]="Push",e[e.Pop=2]="Pop"}(o.GalleryTemplateTransition||(o.GalleryTemplateTransition={}));var i=function(i){function n(e){var t=i.call(this,e)||this;return t.getGalleryItemControlInfo=t.getGalleryItemControlInfo.bind(t),t}return __extends(n,i),n.prototype.render=function(){var e=this.props,t=e.authoringItemOnly,o=e.layout;if(!(0,e.getTemplateControlInstance)())return null;var i=this._isDisabled()?"disabled":"",n=o===r.Horizontal?"horizontal":"vertical";return React.createElement("div",{className:"appmagic-gallery ".concat(i," ").concat(n)},t?this._renderAuthoringModeNoItemsList():this._renderList())},n.prototype._renderList=function(){var e=this.props,t=e.controlInstance.control,r=!!t&&t.isVariableTemplateHeightGallery;return React.createElement(o.VirtualizedList,{items:e.items,label:e.label,defaultScrollOffset:e.defaultScrollOffset,defaultScrollOrigin:e.defaultScrollOrigin,disabled:this._isDisabled(),templateSize:e.templateSize,templatePadding:e.templatePadding,templateMaxWidth:e.templateMaxWidth,orientation:e.layout,showNavigation:e.showNavigation,showScrollbar:e.showScrollbar,layoutInfoProvider:e.layoutInfoProvider,layoutManager:e.layoutManager,transition:e.transition,isVariableTemplate:r,navigateBy:e.onArrowsClickHandler,onScroll:e.onScroll,onScrollOriginChanged:e.onScrollOriginChanged,onScrollSourceChanged:e.onScrollSourceChanged,onVisibleIndexChanged:e.onVisibleIndexChanged,onComponentReference:e.onComponentReference,onRenderStats:e.onRenderStats,onItemClick:e.onItemClick,strings:e.strings,isSelectable:e.isSelectable,select:e.select,getItemInfo:this.getGalleryItemControlInfo,delayRenderChildren:e.delayRenderChildren,loadingSpinner:e.loadingSpinner,loadingSpinnerColor:e.loadingSpinnerColor,resetCount:e.resetCount,childCount:e.childCount,wrapCount:e.wrapCount,textDirection:e.textDirection,tabIndex:e.tabIndex,initialScrollSource:e.initialScrollSource,dataLoadingPromiseObservable:e.dataLoadingPromiseObservable})},n.prototype._renderAuthoringModeNoItemsList=function(){var e=this.props;return React.createElement(o.AuthoringModeNoItems,{defaultScrollOffset:e.defaultScrollOffset,layoutInfoProvider:e.layoutInfoProvider,layoutManager:e.layoutManager,orientation:e.layout,resetCount:e.resetCount,strings:e.strings,templateItemInfo:this.getGalleryItemControlInfo(0),templateMaxWidth:e.templateMaxWidth,templatePadding:e.templatePadding,templateSize:e.templateSize,onScroll:e.onScroll,onScrollOriginChanged:e.onScrollOriginChanged})},n.prototype.getGalleryItemControlInfo=function(e){var o=this._getTemplateControlContextForItem(e),r=this._getBindingContextForItem(e);if(!o||!r)return null;var i,n=this.props,l=n.getControl,a=n.controlInstance,s=n.textDirection;if(n.authoringItemOnly){var c=o.controlWidget.parentUniqueId;i=t.AccessibilityManager.getItemIdByControlId(c)}return i||(i=t.AccessibilityHelper.getParentAccessibilityId(o)),{bindingContext:r,controlContext:o,controlInstance:a,getControl:l,textDirection:s,parentId:i}},n.prototype._getTemplateControlContextForItem=function(e){var t=(0,this.props.getTemplateControlInstance)(),o=this._getBindingContextForItem(e);return o&&t?o.controlContexts[t.name]:null},n.prototype._getBindingContextForItem=function(e){var t=this.props,o=t.authoringItemOnly,r=t.controlContext,i=t.getReplicatedContextAtIndex,n=null;o?n=r.controlWidget.contextManager.authoringAreaBindingContext:r._pagingManager.itemsLength()&&(n=i(e));return n},n.prototype._isDisabled=function(){return this.props.controlContext.modelProperties.DisplayMode.getValue()===e.Constants.DisplayMode.Disabled},n}(React.Component);o.GalleryView=i}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t=function(e){function t(t){var o=e.call(this,t)||this;return o._onRef=o._onRef.bind(o),o}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=e.firstItemIndex,o=e.lastItemIndex,r=e.total,i=e.strings,n="";if(1===r)n=Core.Utility.formatString(i.currentItemTemplate,t+1);else if(r>1){var l=t+1,a=o+1;n=Core.Utility.formatString(i.currentItemRangeTemplate,l,a)}return React.createElement("div",{className:"a11y"}," ",React.createElement("div",{"aria-live":"polite","aria-atomic":!0,ref:this._onRef}),React.createElement("div",null,n))},t.prototype.componentDidMount=function(){this._element&&(this._element.textContent=this._itemCountMessage())},t.prototype.componentDidUpdate=function(e){if(this._element){var t=this.props,o=t.label;t.total===e.total&&o===e.label||(this._element.textContent=this._itemCountMessage())}},t.prototype._itemCountMessage=function(){var e=this.props,t=e.label,o=e.total,r=e.strings;return o?Core.Utility.formatString(r.itemsCountTemplate,t,o):Core.Utility.formatString(r.noItemsMessageTemplate,t)},t.prototype._onRef=function(e){this._element=e},t}(React.Component);e.GallerySummary=t}(e.Gallery||(e.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(o){var r=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"containerStyles",{get:function(){return{width:"auto",height:"auto",position:"static"}},enumerable:!1,configurable:!0}),t}(t.ControlsContainer),i=function(i){function n(e){var t=i.call(this,e)||this;if(t._onClick=t._onClick.bind(t),t._onKeydown=t._onKeydown.bind(t),t._select=t._select.bind(t),t._ref=t._ref.bind(t),!t.props._info)return t;var o=t.props._info.controlContext;return n._promoteTemplateProps(o),o.controlWidget.addOnBeforeDisposeCallback(o,n._demoteTemplateProps),t._initSubscriptions(o),t.state=t._computeState(),t._labelElementId="pa-gallery-label-".concat(++n._labelElementIdCounter),t}return __extends(n,i),n.getRenderingKey=function(e,t){return t?"".concat(e,"_").concat(t.controlContext.instanceId):e.toString()},n._promoteTemplateProps=function(e){var t=e.controlWidget,o=t.controlProperties;for(var r in o){if(!e.properties[r])t.controlProperties[r].promotePropertyForView(e,r)}e._propertiesPromoted=!0},n._demoteTemplateProps=function(e){var t=e.controlWidget,o=t.controlProperties;for(var r in o){if(e.properties[r])t.controlProperties[r].demotePropertyForView(e,r)}e._propertiesPromoted=!1},n.prototype._initSubscriptions=function(e){var t=this;this._isSelectedSubscription||(this._isSelectedSubscription=e.properties.IsSelected.subscribe((function(e){return t.setState({isSelected:e})}))),this._itemAccessibleLabelSubscription||(this._itemAccessibleLabelSubscription=e.properties.ItemAccessibleLabel.subscribe((function(e){return t.setState({label:e})}))),this._templateFillSubscription||(this._templateFillSubscription=e.properties.TemplateFill.subscribe((function(e){return t.setState({backgroundColor:e})})))},n.prototype._disposeSubscriptions=function(){this._isSelectedSubscription&&(this._isSelectedSubscription.dispose(),this._isSelectedSubscription=null),this._itemAccessibleLabelSubscription&&(this._itemAccessibleLabelSubscription.dispose(),this._itemAccessibleLabelSubscription=null),this._templateFillSubscription&&(this._templateFillSubscription.dispose(),this._templateFillSubscription=null)},n.prototype._computeState=function(){var e=this.props._info.controlContext,t=e.properties;e._propertiesPromoted;return{backgroundColor:t.TemplateFill(),label:t.ItemAccessibleLabel(),isSelected:t.IsSelected()}},n.prototype.componentWillUpdate=function(e){if(this.props._info){var t=this.props._info.controlContext,o=e._info.controlContext;o===t&&o._propertiesPromoted||(n._promoteTemplateProps(o),o.controlWidget.addOnBeforeDisposeCallback(o,n._demoteTemplateProps),this._disposeSubscriptions(),this._initSubscriptions(o))}},n.prototype.componentDidUpdate=function(e){if(this.props._info){var t=e._info.controlContext,o=this.props._info.controlContext;o===t&&o.bindingContext.recycleCount===t.bindingContext.recycleCount||this.setState(this._computeState()),this.props.select!==e.select&&this._updateInteractionListeners()}},n.prototype.componentDidMount=function(){if(this.props._info){var e=this.props,o=e.topPosition,r=e.leftPosition,i=e.isVerticalLayout,n=this.props._info,l=n.controlContext,a=n.controlInstance,s=n.parentId;l._accessibilityContainer&&(t.AccessibilityManager.unregisterContainer(l._accessibilityContainer),l._accessibilityContainer.dispose(),l._accessibilityContainer=null),l._accessibilityContainer=new t.ControlAccessibilityContainer(a.id,t.AccessibilityHelper.getAccessibilityId(a.id,l),s,s,r,o,i),t.AccessibilityManager.registerContainer(l._accessibilityContainer)}},n.prototype.componentWillUnmount=function(){if(this.props._info){this._disposeSubscriptions();var t=this.props._info.controlContext;t._accessibilityContainer&&(e.Controls.AccessibilityManager.unregisterContainer(t._accessibilityContainer),t._accessibilityContainer.dispose(),t._accessibilityContainer=null)}},n.prototype.render=function(){var t=this.props._info;if(!t)return null;var i="".concat(this.props.leftPosition,"px"),n="rtl"===t.textDirection,l={position:"absolute",width:this.props.width,height:this.props.height,left:n?null:i,right:n?i:null,top:this.props.topPosition+"px",backgroundColor:this.state.backgroundColor},a=aphrodite.StyleSheet.create({transforms:this._transformStyles()}),s="virtualized-gallery-item "+e.Constants.Controls.GalleryContentDivClassName+" "+aphrodite.css(a.transforms);return React.createElement("div",{ref:this._ref,onClick:this.props.onClick?this._onClick:null,className:s,style:l,"aria-labelledby":this._labelElementId,role:"listitem","aria-posinset":this.props.index+1,"aria-setsize":this.props.total,"data-control-part":"gallery-item"},React.createElement(o.GalleryItemLabel,{htmlId:this._labelElementId,label:this._generateVerboseLabel()}),React.createElement(r,__assign({},t)))},n.prototype._onClick=function(e){this.props.onClick(e,this.props.index)},n.prototype._select=function(){this.props.select(this.props.index)},n.prototype._ref=function(e){this._rootElement&&(this._rootElement.removeEventListener("click",this._select,!0),this._rootElement.removeEventListener("keydown",this._onKeydown,!0)),this._rootElement=e,this._updateInteractionListeners()},n.prototype._updateInteractionListeners=function(){this._rootElement&&(this.props.select?(this._rootElement.addEventListener("click",this._select,!0),this._rootElement.addEventListener("keydown",this._onKeydown,!0)):(this._rootElement.removeEventListener("click",this._select,!0),this._rootElement.removeEventListener("keydown",this._onKeydown,!0)))},n.prototype._onKeydown=function(e){var t=e.key;"Enter"!==t&&" "!==t||this._select()},n.prototype._transformStyles=function(){var e=this.props.transition,t={};return e===o.GalleryTemplateTransition.Push?t[":hover"]={transition:"transform 0.08s",transform:"scale(0.97)"}:e===o.GalleryTemplateTransition.Pop&&(t[":hover"]={transition:"transform 0.08s",transform:"scale(1.02)"}),t},n.prototype._generateVerboseLabel=function(){var e=this.state.label||Core.Utility.formatString(this.props.strings.defaultItemLabelTemplate,this.props.index+1);return"option"===this.props.role&&this.state.isSelected&&(e=Core.Utility.formatString(this.props.strings.itemSelectedTemplate,e)),e},n._labelElementIdCounter=0,n}(React.Component);o.GalleryItem=i}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t={position:"absolute",pointerEvents:"none",opacity:0,top:0,left:0,width:"100%",height:"100%",fontSize:"2px"};e.GalleryItemLabel=function(e){return React.createElement("div",{id:e.htmlId,style:t},e.label)}}(e.Gallery||(e.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.render=function(){var e=this.props,t=e.title,r=e.onClick;return React.createElement("div",{className:"".concat(aphrodite.css(o.authoringButtonContainer)," galleryEditButton")},React.createElement("div",{className:aphrodite.css(o.authoringButton),title:t,onClick:r}))},t.create=function(e,o){return React.createElement(t,{title:e,onClick:o})},t}(React.Component);e.GalleryEditTemplateButton=t;var o=aphrodite.StyleSheet.create({authoringButtonContainer:{top:"5px",left:"5px",position:"absolute",cursor:"pointer"},authoringButton:{backgroundRepeat:"no-repeat",backgroundSize:"contain",width:"41px",height:"41px",backgroundImage:"url(".concat(Core.Utility.getAbsoluteUri("images/CG_Edit_Rest.svg"),")"),":hover":{backgroundImage:"url(".concat(Core.Utility.getAbsoluteUri("images/CG_Edit_Hover.svg"),")")},":active":{backgroundImage:"url(".concat(Core.Utility.getAbsoluteUri("images/CG_Edit_Pressed.svg"),")")}}})}(e.Gallery||(e.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o=e.AuthoringTool.OpenAjaxPropertyNames,r=function(){function t(t){this._controlContext=t,this._verticalConverter=e.Controls.converters.pxLogicalToNativeVerticalConverter,this._horizontalConverter=e.Controls.converters.pxLogicalToNativeHorizontalConverter,this._hasScrolled=!1,this._scrollLeft=0,this._scrollTop=0,this._pageOffset=0}return t.prototype.dispose=function(){this._controlContext=null,this._verticalConverter=null,this._horizontalConverter=null},Object.defineProperty(t.prototype,"isVerticalLayout",{get:function(){return"vertical"===this._getPropertyValue(o.Layout)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"itemsLength",{get:function(){var e=this._controlContext;return e.initialized&&e._pagingManager?e._pagingManager.itemsLength():0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isTemplate",{get:function(){return this._controlContext.isTemplate},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"wrapCount",{get:function(){return this._getPropertyValue(o.WrapCount)||1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateWidth",{get:function(){return this._getPropertyValue(o.TemplateWidth)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateHeight",{get:function(){return this._getPropertyValue(o.TemplateHeight)||0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateWidthWithPadding",{get:function(){return Math.max(0,this.templateWidth+this.templatePadding)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateHeightWithPadding",{get:function(){return Math.max(0,this.templateHeight+this.templatePadding)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._getPropertyValue(o.Height)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._getPropertyValue(o.Width)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templateSize",{get:function(){return this._getPropertyValue(o.TemplateSize)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"x",{get:function(){return this._getPropertyValue(o.X)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"y",{get:function(){return this._getPropertyValue(o.Y)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"templatePadding",{get:function(){return this._getPropertyValue(o.TemplatePadding)||0},enumerable:!1,configurable:!0}),t.prototype.scaleVertically=function(e){return this._verticalConverter(e)},t.prototype.scaleHorizontally=function(e){return this._horizontalConverter(e)},Object.defineProperty(t.prototype,"offsetX",{get:function(){var e=this.isVerticalLayout?this.scrollTop:this.scrollLeft,t=this.templatePadding;return this.isVerticalLayout||(t-=e),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"offsetY",{get:function(){var e=this.isVerticalLayout?this.scrollTop:this.scrollLeft,t=this.templatePadding;return this.isVerticalLayout&&(t-=e),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasScrolled",{get:function(){return this._hasScrolled},set:function(e){this._hasScrolled=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollLeft",{get:function(){return this._scrollLeft},set:function(e){this._scrollLeft=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"scrollTop",{get:function(){return this._scrollTop},set:function(e){this._scrollTop=e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pageOffset",{get:function(){return this._pageOffset},set:function(e){this._pageOffset=e},enumerable:!1,configurable:!0}),t.prototype._getPropertyValue=function(e){return this._controlContext.modelProperties[e].getValue()},t}();t.GalleryLayoutInfoProvider=r}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(t){var o=e.Constants.Runtime,r=Promise.resolve(),i=function(){function t(e){this._galleryControl=e,this._retrievingItems=ko.observable(!1),this._itemsLength=ko.observable(0),this._queriedTable=null,this._nextItemsPagePromise=null,this._hasError=!1}return Object.defineProperty(t.prototype,"retrievingItems",{get:function(){return this._retrievingItems},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"itemsLength",{get:function(){return this._itemsLength},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasError",{get:function(){return this._hasError},enumerable:!1,configurable:!0}),t.prototype.dispose=function(){this._nextItemsPagePromise&&(Core.PromiseUtils.abortPromise(this._nextItemsPagePromise,this._nextItemsPageAbortController),this._nextItemsPagePromise=null,this._nextItemsPageAbortController=null),this._galleryControl=null,this._retrievingItems=null,this._itemsLength=null,this._queriedTable=null,this._bufferedData=null},t.prototype.processItems=function(e,t){this._propertyName=t,this._hasError=!1,this._bufferedData=null,this._queriedTable=null,this._retrievingItems(!1),e._replicatedContext.setObserver(null),this._nextItemsPagePromise&&(Core.PromiseUtils.abortPromise(this._nextItemsPagePromise,this._nextItemsPageAbortController),this._nextItemsPagePromise=null,this._nextItemsPageAbortController=null);var o=e.modelProperties.Items.getValue();if(o&&Core.Utility.isFunction(o.getNextResultsAsync))return this._queriedTable=o,this._fetchNextItemsPageAsync(e,!0);var i=o||[];return this._itemsLength(i.length),e._replicatedContext.applyInputTable(i,e._primaryKeyFn),r},t.prototype._handleError=function(e,t){e&&(this._finishedBuffering=!0,this._itemsLength(0)),this._retrievingItems(!1),this._hasError=!0,Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.galleryPagingManagerError,{errorMessage:t&&t.stack?t.stack:JSON.stringify(t),itemsLength:this._itemsLength.peek()})},t.prototype._createErrorContext=function(){var t=this._galleryControl.OpenAjax.getId();return e.AuthoringTool.Runtime.createErrorContext(t,this._propertyName,null)},t.prototype._addToScopeMonitor=function(t){var o=e.AuthoringTool.Runtime.currentApp;o&&o.scopeMonitor.trackPromise(this._galleryControl.OpenAjax.controlName,this._propertyName,t)},t.prototype._bindingContextRequested=function(e,t,o){return this._finishedBuffering||t<o-1||this._retrievingItems.peek()||-1!==e._expandForPrintHeight?r:this._queriedTable?this._fetchNextItemsPageAsync(e,!1):(this._finishedBuffering=!0,r)},t.prototype._fetchNextItemsPageAsync=function(t,r){var i=this;this._retrievingItems(!0);var n=this._createErrorContext(),l=new AbortController,a=Promise.resolve(),s=e.AuthoringTool.Runtime.currentApp;return s&&(a=a.then((function(){return i._queriedTable.getQueryKeyAsync()})).then((function(e){Core.PromiseUtils.throwIfAborted(l.signal);var o="".concat(n.entityName,".").concat(n.propertyName);s.dataManager.cacheDataChangeManager.register(e,o,t.bindingContext)}))),a=a.then((function(){Core.PromiseUtils.throwIfAborted(l.signal);var e=i._queriedTable.getNextResultsAsync(n,100,!0,void 0,void 0,l);return i._addToScopeMonitor(e),e})).then((function(n){if(Core.PromiseUtils.throwIfAborted(l.signal),t._replicatedContext){e.Data.DataValue.isBlankOrErrorValue(n)?(i._hasError=!0,n=[]):i._hasError=!1,r&&(i._bufferedData=[],i._bufferedData[o.idProperty]=i._queriedTable[o.idProperty]),Core.Telemetry.Log.trackEvent(Core.Telemetry.Strings.galleryPagedDataRequested,{current:i._bufferedData.length,received:n.length||0});for(var a=0,s=n;a<s.length;a++){var c=s[a];i._bufferedData.push(c)}i._finishedBuffering=(r||!i._hasError)&&0===n.length,i._itemsLength(i._bufferedData.length),i._retrievingItems(!1),r&&!i._hasError&&t._replicatedContext.setObserver({bindingContextRequested:i._bindingContextRequested.bind(i,t)}),!r&&i._finishedBuffering||t._replicatedContext.applyInputTable(i._bufferedData,t._primaryKeyFn)}})).catch((function(e){Core.PromiseUtils.throwIfCanceled(e),i._handleError(r,e)})),this._nextItemsPagePromise=a,this._nextItemsPageAbortController=l,Core.PromiseUtils.wrapWithFinally(this._nextItemsPagePromise,(function(){l.signal.aborted||i._nextItemsPagePromise!==a||(i._nextItemsPagePromise=null,i._nextItemsPageAbortController=null)}))},t}();t.GalleryPagingManager=i}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(t){!function(o){var r=["variableTemplateHeightGallery","BrowseLayout_Flexible_NewsFeed_fluentV9","BrowseLayout_Flexible_NewsFeed_pcfCore","BrowseLayout_Flexible_NewsFeed_ver4.0","BrowseLayout_Flexible_NewsFeed_ver5.0","BrowseLayout_Flexible_SocialFeed_fluentV9","BrowseLayout_Flexible_SocialFeed_pcfCore","BrowseLayout_Flexible_SocialFeed_ver4.0","BrowseLayout_Flexible_SocialFeed_ver5.0"],i=e.Constants.Runtime.idProperty,n={datatable:"datatable"},l=Core.FallbackSwitch.isActivated("Controls.PreserveGallerySelection"),a=function(a){function s(){var e=a.call(this)||this;return e.isPublishOrPreviewOrInteractionMode=null,e._galleryTemplateName=null,e._x=null,e._y=null,e._authoringCanvas=null,e.getAuthoringCanvasPlaceHolder=e.getAuthoringCanvasPlaceHolder.bind(e),e.getAuthoringVisualPlaceHolder=e.getAuthoringVisualPlaceHolder.bind(e),e}return __extends(s,a),Object.defineProperty(s.prototype,"isVariableTemplateHeightGallery",{get:function(){return this._isVariableTemplateHeightGallery},enumerable:!1,configurable:!0}),s.prototype.onLoad=function(){var e=this;Core.Log.verbose("[GalleryControl.onLoad] enter"),this.OpenAjax.initReplicatedContextManager(this._outputTableChanged.bind(this),this._outputRowChanged.bind(this),this.OpenAjax.notifyOutputPropertyValueChanged.bind(this.OpenAjax,"Selected")),this.isPublishOrPreviewOrInteractionMode=ko.pureComputed((function(){var o=e.OpenAjax.controlManager,r=o.appModeObservable();return r===t.AppMode.Publish||r===t.AppMode.Preview||o.authoringInteractionModeObservable()})),this.childControlsIds=ko.observableArray([]),this._isVariableTemplateHeightGallery=r.indexOf(this.OpenAjax.variantName)>-1},s.prototype.onUnload=function(){Core.Log.verbose("[GalleryControl.onUnload] enter"),this._x&&(this._x.dispose(),this._x=null),this._y&&(this._y.dispose(),this._y=null),this._authoringCanvas=null,this._scrollingAdorners=null,this.childControlsIds=null,this.OpenAjax.disposeReplicatedContextManager(),this.isPublishOrPreviewOrInteractionMode.dispose(),this.isPublishOrPreviewOrInteractionMode=null},s.prototype.initControlContext=function(e){var r=this;Core.Log.verbose("[GalleryControl.initControlContext] enter"),a.prototype.initControlContext.call(this,e),e._replicatedContext=this.OpenAjax.replicatedContextManager.replicatedContextFor(e.bindingContext),e._skipRenderingItems=!1,e._currentItemCount=-1,e._currentSelectedBindingContextId=null,e._currentSelectedIndex=-1,e._currentSelectedPrimaryKey=null,e._currentSelectedSource="default",e._currentScrollSource="auto",e._accessibilityContainer=null,e._pagingManager=new o.GalleryPagingManager(this),e._defaultScrollOffset=0,e._lastObservedScrollOffset=0,e._defaultScrollOrigin=0,e._lastObservedScrollOrigin=0,e._shouldReRender=ko.observable(!1),e._dataLoadingPromiseObservable=ko.observable(Promise.resolve()),e._layoutInfoProvider=new o.GalleryLayoutInfoProvider(e),e._layoutManager=this.isVariableTemplateHeightGallery?new o.VariableHeightGalleryLayoutManager:new o.AbsolutePositionGalleryLayoutManager,e._layoutManager.initialize&&e._layoutManager.initialize(e._layoutInfoProvider),this._adjustTemplateSize(e),this._processItems(e).then((function(){e.initialized&&(r._resetSelectedItem(e),e._pagingManager&&e._pagingManager.hasError&&t.TelemetryHelper.trackActivityEvent(Core.Telemetry.ControlOperationNames.galleryControlProcessItems,e,{message:"Failure",operationMode:"InitControlContext"}))}),Core.PromiseUtils.throwIfNotCanceled)},s.prototype.disposeControlContext=function(e){Core.Log.verbose("[GalleryControl.disposeControlContext] enter"),e._shouldReRender=null,e._dataLoadingPromiseObservable=null,e._layoutManager=null,e._primaryKeyFn=null,e._layoutInfoProvider&&(e._layoutInfoProvider.dispose(),e._layoutInfoProvider=null),e._replicatedContext&&(e._replicatedContext.clearInputTable(),e._replicatedContext=null),e._pagingManager&&(e._pagingManager.dispose(),e._pagingManager=null)},s.prototype.onWindowResize=function(e,t){this.setDefaultScrollOffset(e,e._lastObservedScrollOffset,e._lastObservedScrollOrigin)},s.prototype.onChildContextAdded=function(t,o){if(o.controlWidget.getAuthoringControlContext()===o){var r=this._getUniqueControlId(o);this.childControlsIds.push(r),this._galleryTemplateName||o.controlWidget.template.className!==e.Constants.Controls.GalleryTemplateTemplateClassName||(this._galleryTemplateName=o.controlWidget.controlName),this.isPublishOrPreviewOrInteractionMode.peek()||this.OpenAjax.controlManager.executeShellAction({id:"UpdateAuthoringCanvasPlaceholder"})}},s.prototype.onChildContextRemoved=function(e,t){var o=this._getUniqueControlId(t);-1!==this.childControlsIds.indexOf(o)&&(this.childControlsIds.remove(o),this.isPublishOrPreviewOrInteractionMode.peek()||this.OpenAjax.controlManager.executeShellAction({id:"UpdateAuthoringCanvasPlaceholder"}))},s.prototype.onChildAdded=function(t,o,r){this._galleryTemplateName||o.controlWidget.template.className!==e.Constants.Controls.GalleryTemplateTemplateClassName||(this._galleryTemplateName=o.controlWidget.controlName)},s.prototype.onChangeLayout=function(e,t){if(this._adjustTemplateSize(t),this.setDefaultScrollOffset(t,0,0),this._scrollingAdorners){var o=t._layoutInfoProvider.isVerticalLayout;this._scrollingAdorners.scrollableVertically=o,this._scrollingAdorners.scrollableHorizontally=!o}},s.prototype.onBeforeGetAllItems=function(e,t){if(t.initialized){var o=t._replicatedContext.getOutputTable();t.modelProperties.AllItems.setValue(o,!0)}},s.prototype.onBeforeGetAllItemsCount=function(e,t){if(t.initialized){var o=t._replicatedContext.getBindingContextCount();t.modelProperties.AllItemsCount.setValue(o,!0)}},s.prototype.onBeforeGetSelected=function(e,t){if(t.initialized){var o=t._replicatedContext.getSelectedItem();t.modelProperties.Selected.setValue(o,!0)}},s.prototype.onBeforeGetValid=function(t,o){if(o.initialized){var r=e.AuthoringTool.Runtime.getTopLevelChildrenForControl(this.OpenAjax.getId());if(0!==r.length){for(var i=o._replicatedContext.getOutputTable(),n=0;n<i.length;n++)for(var l=i[n],a=0;a<r.length;a++){var s=l[r[a]];if(Core.Utility.isDefined(s.Valid)&&!s.Valid)return void o.modelProperties.Valid.setValue(!1,!0)}o.modelProperties.Valid.setValue(!0,!0)}}},s.prototype.onChangeDefault=function(e,t){t._currentSelectedBindingContextId=null,t._currentSelectedIndex=-1,t._currentSelectedPrimaryKey=null,t._currentSelectedSource="default",t._currentScrollSource="auto",this.ensureDefaultItemVisible(t)},s.prototype.onBeforeChangeItems=function(t,o){var r,n,a=!!t.skipCompare,s=t.oldValue,c=t.newValue;o._currentSelectedBindingContextId=null,o._currentSelectedIndex=-1,o._currentSelectedPrimaryKey=null,o._primaryKeyFn=null,c&&(l?Core.Utility.isFunction(c.tryGetPrimaryKey)&&(o._primaryKeyFn=c.tryGetPrimaryKey.bind(c)):o._primaryKeyFn=e.Data.Record.Utility.tryGetPrimaryKeyFn(c));var p,u=!1,d=null;if(s&&c&&(l?Core.Utility.isFunction(s.tryGetPrimaryKey)&&o._primaryKeyFn&&Core.Utility.isString(s.dataSourceName)&&Core.Utility.isString(c.dataSourceName)?(u=s.dataSourceName===c.dataSourceName,d=s.tryGetPrimaryKey.bind(s),p=!0):(u=Core.Utility.isDefined(s[i])&&s[i]===c[i],p=!1):((u=e.Data.Record.Utility.isSameDataSource(s,c))&&(d=e.Data.Record.Utility.tryGetPrimaryKeyFn(s)),p=!!o._primaryKeyFn&&!!d)),u&&o._replicatedContext){var h=o._replicatedContext.getSelectedItem(),g=h?h._src:null,m=!p&&g?g._src:g;m&&(p?o._currentSelectedPrimaryKey=d(m):(o._currentSelectedBindingContextId=null!==(n=null===(r=o._replicatedContext.getSelectedBindingContext())||void 0===r?void 0:r.id)&&void 0!==n?n:null,o._currentSelectedIndex=o._replicatedContext.getRecordIndex(m)))}o._skipRenderingItems=!a&&e.Utility.deepCompare(t.oldValue,t.newValue,{_src:!0})},s.prototype.onChangeItems=function(o,r){var i=this;r._skipRenderingItems||this._processItems(r).then((function(){if(r.initialized&&r.realized&&(i.isVariableTemplateHeightGallery&&i._resetScroll(r),i._reRenderGallery(r)),r.initialized){var o=r.bindingContext;e.Utility.executeOnceAsync((function(){i._resetSelectedItem(r),"default"===r._currentSelectedSource&&"auto"===r._currentScrollSource&&i.ensureSelectedItemVisible(r)}),i.OpenAjax.getId()+"_setSelectedItem_"+o.id,1,(function(){return r.initialized})),r._pagingManager&&r._pagingManager.hasError&&t.TelemetryHelper.trackActivityEvent(Core.Telemetry.ControlOperationNames.galleryControlProcessItems,r,{message:"Failure",operationMode:"OnChangeItems"})}}),Core.PromiseUtils.throwIfNotCanceled)},s.prototype.onChangeWidth=function(e,t){this._adjustTemplateSize(t)},s.prototype.onChangeHeight=function(e,t){a.prototype.onChangeHeight.call(this,e,t)&&this._adjustTemplateSize(t)},s.prototype.onChangeLayoutWidth=function(e,t){this._adjustTemplateSize(t)},s.prototype.onChangeLayoutHeight=function(e,t){this._adjustTemplateSize(t)},s.prototype.onChangeTemplateSize=function(e,t){this._adjustTemplateSize(t)},s.prototype.onChangeTemplatePadding=function(e,t){this._adjustTemplateSize(t)},s.prototype.onChangeWrapCount=function(e,t){this._adjustTemplateSize(t)},s.prototype.onChangeAutoHeight=function(e,t){this._updateForAutoHeight(t)},s.prototype.onChangeTabIndex=function(e,o){o._accessibilityContainer&&t.AccessibilityManager.updateItemTabIndex(o._accessibilityContainer,o.modelProperties.TabIndex.getValue())},s.prototype.onChangeReset=function(e,t){e.newValue&&e.newValue!==e.oldValue&&this.resetControl(t)},s.prototype.shouldShowScrollbar=function(e){var o=!0;return this.OpenAjax.controlManager.appModeObservable()===t.AppMode.Editable&&e.isTemplate&&this._authoringCanvas&&(o=!this._authoringCanvas.ownerDescendantSelected),o&&e.properties.ShowScrollbar()},s.prototype.resetControl=function(e){e.initialized&&(e._currentSelectedBindingContextId=null,e._currentSelectedIndex=-1,e._currentSelectedPrimaryKey=null,e._currentSelectedSource="default",e._currentScrollSource="auto",e.modelProperties.Default.getValue()?this.ensureDefaultItemVisible(e):(e._resetWithNoDefault=!0,this.setDefaultScrollOffset(e,0,0)))},s.prototype.ensureDefaultItemVisible=function(t){var o=this,r=t.bindingContext;e.Utility.executeOnceAsync((function(){var e=o._resetSelectedItem(t)+1;e>0&&o._scrollToItem(t,e)}),this.OpenAjax.getId()+"_setSelectedItem_"+r.id,1,(function(){return t.initialized}))},s.prototype.ensureSelectedItemVisible=function(t){var o=this,r=t.bindingContext;e.Utility.executeOnceAsync((function(){var e=t._replicatedContext.getSelectedItemIndex();-1!==e&&o._scrollToItem(t,e+1)}),this.OpenAjax.getId()+"_scrollSelectedItem_"+r.id,1,(function(){return t.initialized}))},s.prototype.nextOrPrevious=function(e,t){var o=e.modelProperties.NavigationStep.getValue()*t,r=e.modelProperties.WrapCount.getValue(),i=e.modelProperties.VisibleIndex.getValue();this._scrollToItem(e,i+o*r)},s.prototype.getOnSelectControlContext=function(e){return e.controlContexts[this._galleryTemplateName]||null},s.prototype.isSupportedChild=function(e){return!(e in n)},s.prototype.setDefaultScrollOffset=function(e,t,o,r){void 0===r&&(r=!1),e.initialized&&(e._defaultScrollOffset=t,e._defaultScrollOrigin=o,e.realized&&(r||this.updateScrollAdorners(e,t),e._shouldReRender(!0)))},s.prototype.updateScrollAdorners=function(e,t){this._scrollingAdorners&&t>=0&&(e._layoutInfoProvider.isVerticalLayout?this._scrollingAdorners.scrollTop=t:this._scrollingAdorners.scrollLeft=t)},s.prototype.contentSizeUpdated=function(e){if(this._scrollingAdorners&&this.OpenAjax.controlManager.appModeObservable()!==t.AppMode.Publish){var o=e._layoutInfoProvider,r=e._layoutManager.getItemsElementBoundsInPixels(o);o.isVerticalLayout?this._scrollingAdorners.updateContentHeight(r.height):this._scrollingAdorners.updateContentWidth(r.width),this._updateForAutoHeight(e)}},s.prototype.calculatePrintHeight=function(e){if(this.isVariableTemplateHeightGallery||"vertical"!==e.modelProperties.Layout.getValue())return a.prototype.calculatePrintHeight.call(this,e);var t=e.modelProperties.TemplateSize.getValue(),o=e.modelProperties.TemplatePadding.getValue(),r=e.modelProperties.WrapCount.getValue(),i=e._pagingManager.itemsLength.peek();return Math.ceil(i/r)*(t+2*o)},s.prototype.onExpandForPrintAsync=function(t){for(var o=t._pagingManager.itemsLength.peek(),r=t._replicatedContext,i=[],n=0;n<o;++n)i.push(r.bindingContextAt(n).id);return e.AuthoringTool.Runtime.waitForPendingDataRulesToExecuteAsync(i)},s.prototype._scrollToItem=function(e,t){var o=e._layoutManager.getItemOffset(e._layoutInfoProvider,t),r="vertical"===e.modelProperties.Layout.getValue()?o.yOffset:o.xOffset;this.setDefaultScrollOffset(e,r,o.pageOffset)},s.prototype._reRenderGallery=function(e){this.setDefaultScrollOffset(e,e._lastObservedScrollOffset,e._lastObservedScrollOrigin)},s.prototype._resetScroll=function(e){this.setDefaultScrollOffset(e,0,0)},s.prototype._processItems=function(e){var t=e._pagingManager.processItems(e,"Items");return e._dataLoadingPromiseObservable(t),t},s.prototype._outputRowChanged=function(t,o,r){var i=t.bindingContext;t.modelProperties.Selected.getValue()===r&&this.OpenAjax.notifyOutputPropertyValueChanged("Selected",i),this.OpenAjax.notifyOutputPropertyValueChanged("Valid",i),this.OpenAjax.notifyOutputPropertyValueChanged("Updates",i);var n=t.bindingContext.rcManager.getControlWidget();if(n){var l=e.Controls.GlobalContextManager.bindingContext.controlContexts[n.getId()];l&&n.notifyOutputPropertyValueChanged("Updates",l.bindingContext)}},s.prototype._outputTableChanged=function(e){this.OpenAjax.notifyOutputPropertyValueChanged("AllItems",e);var t=e.controlContexts[this.OpenAjax.getId()],o=t._replicatedContext.getBindingContextCount();o!==t._currentItemCount&&(t._currentItemCount=o,this.OpenAjax.notifyOutputPropertyValueChanged("AllItemsCount",e)),this.OpenAjax.notifyOutputPropertyValueChanged("Valid",t.bindingContext)},s.prototype._resetSelectedItem=function(e){var t=this.OpenAjax.replicatedContextManager.replicatedContextFor(e.bindingContext),o=t.getBindingContextCount(),r=-1;if(o>0){if(null!==e._currentSelectedPrimaryKey)r=t.getRecordIndexByPrimaryKey(e._currentSelectedPrimaryKey);else if(null===e._currentSelectedBindingContextId||l||(r=e._replicatedContext.getItemIndexByBindingContextId(e._currentSelectedBindingContextId)),-1===r)if(e._currentSelectedIndex>=0)r=e._currentSelectedIndex;else{var i=e.modelProperties.Default.getValue();if(i){if(e._primaryKeyFn){var n=e._primaryKeyFn(i);null!==n&&(r=t.getRecordIndexByPrimaryKey(n))}-1===r&&(r=t.getRecordIndex(i))}else r=0}if(r>=o&&(r=o-1),r>=0&&e._replicatedContext){var a=e._replicatedContext.bindingContextAt(r);t.notifyBindingContextSelectionInteraction(a,!1)}}return r<0&&t.clearBindingContextSelection(),r},s.prototype._setSelectionByRowIndex=function(e,t,o){var r=t.getBindingContextCount();if(o>=0&&o<r){var i=e._replicatedContext.bindingContextAt(o);return e._currentSelectedSource="user",e._currentScrollSource="user",t.notifyBindingContextSelectionInteraction(i,!1),!0}return!1},s.prototype._onClickEditTemplateButton=function(){this._authoringCanvas.select();var e=this.OpenAjax.getAuthoringControlContext(),t=e.bindingContext;if(t&&t.parent){var o=t.rcManager,r=t.parent.replicatedContexts[o.managerId];r&&r.hasFirstItem()&&(e=r.bindingContextAt(0).controlContexts[this.OpenAjax.getId()])}this._scrollToItem(e,1)},s.prototype._onAuthoringTemplateResize=function(e,t,o,r,i){var n=e._layoutManager.handleAuthoringTemplateResize(e._layoutInfoProvider,t,o,r,i);Core.Utility.isNumber(n.X)&&this.OpenAjax.updateBoundsPropertyValue("X",n.X,!0),Core.Utility.isNumber(n.Y)&&this.OpenAjax.updateBoundsPropertyValue("Y",n.Y,!0),Core.Utility.isNumber(n.Width)&&this.OpenAjax.updateBoundsPropertyValue("Width",n.Width,!0),Core.Utility.isNumber(n.Height)&&this.OpenAjax.updateBoundsPropertyValue("Height",n.Height,!0),Core.Utility.isNumber(n.TemplateSize)&&this.OpenAjax.updateBoundsPropertyValue("TemplateSize",n.TemplateSize,!0)},s.prototype._adjustTemplateSize=function(e){var t=e.modelProperties,o=e._layoutInfoProvider,r=e._layoutManager.adjustTemplateSize(o);t.TemplateWidth.setValue(r.width||0),t.TemplateHeight.setValue(r.height||0)},s.prototype._shouldUpdateForAutoHeight=function(e){return!(!e.modelProperties.AutoHeight.getValue()||!e._layoutInfoProvider.isVerticalLayout||e._layoutInfoProvider.itemsLength<=0)&&(e.modelProperties.Visible.getValue()&&!e.controlWidget.isAncestorHidden(e))},s.prototype._updateForAutoHeight=function(e){this._shouldUpdateForAutoHeight(e)&&setTimeout((function(){e.initialized&&e.modelProperties.Height.setValue(e._layoutManager.getItemsElementBoundsInPixels(e._layoutInfoProvider).height,!1,!1,!0)}),0)},s.prototype._getUniqueControlId=function(e){return"".concat(e.controlWidget.uniqueId,"-").concat(e.bindingContext.id)},s.prototype.initializeNestedCanvasIfNeeded=function(e){var o=this;if(!this._authoringCanvas&&this.OpenAjax.controlManager.appModeObservable()!==t.AppMode.Publish){var r=e.controlWidget;this._x=ko.pureComputed((function(){return e.properties.TemplatePadding()})),this._y=ko.pureComputed((function(){return e.properties.TemplatePadding()})),this._authoringCanvas=r.controlManager.initializeNestedCanvas(r.getId(),0,null,e.properties.TemplateWidth,e.properties.TemplateHeight,{childCanvasId:1,replicateControls:!0,originOffsetX:this._x,originOffsetY:this._y,templateWidth:e.properties.TemplateWidth,templateHeight:e.properties.TemplateHeight,onCanvasResize:function(t,r,i,n){e.initialized&&o._onAuthoringTemplateResize(e,t,r,i,n)},canvasScrollable:{y:!1,x:!1},onDescendantSelected:function(){o.setDefaultScrollOffset(e,0,0)}})}},s.prototype.initializeAuthoringScrollingAdorners=function(e){var o=this,r=this.OpenAjax.controlManager;if(!this._scrollingAdorners&&r.appModeObservable()!==t.AppMode.Publish){var i=e._layoutInfoProvider,n=i.isVerticalLayout,l=e._layoutManager.getItemsElementBoundsInPixels(i),a=null,s=0,c=!1,p=function(o){if(!c){var r=Date.now();null!==a&&s!==o&&r-a<500&&(t.TelemetryHelper.trackActivityEvent(Core.Telemetry.ControlOperationNames.galleryControlLogScrollAdornerUsage,e),c=!0),a=r,s=o}};this._scrollingAdorners=r.initializeScrollingAdorner({scrollableHorizontally:!n,scrollableVertically:n,onXScroll:function(t){o.setDefaultScrollOffset(e,t,e._lastObservedScrollOrigin,!0),p(t)},onYScroll:function(t){o.setDefaultScrollOffset(e,t,e._lastObservedScrollOrigin,!0),p(t)},initialContentHeight:(n?l.height:e.modelProperties.Height.getValue())||0,initialContentWidth:(n?e.modelProperties.Width.getValue():l.width)||0})}},s.prototype.getAuthoringCanvasPlaceHolder=function(){return e.Controls.doesControlHaveVisualChildren(this.OpenAjax)?null:this.OpenAjax.controlManager.renderAuthoringPlaceholder({controlId:this.OpenAjax.uniqueId,allowAddVisual:!0,allowConnectToData:!0})},s.prototype.getAuthoringVisualPlaceHolder=function(){return this._authoringCanvas&&this._authoringCanvas.parentVisualSelected?o.GalleryEditTemplateButton.create(e.ControlStrings.EditGalleryTooltip,this._onClickEditTemplateButton.bind(this)):null},s.prototype.getAuthoringScrollableAdornerInfo=function(){return this.OpenAjax.getAuthoringControlContext().modelProperties.ShowScrollbar.getValue()?this._scrollingAdorners:null},s.prototype.interactWithControl=function(t,o){if(!t.initialized||!o)return null;var r=this.OpenAjax.replicatedContextManager.replicatedContextFor(t.bindingContext),i=!1,n=o.SelectedRow,l=o.Selected;if(Core.Utility.isNumber(n)){var a=n-1;if(i=this._setSelectionByRowIndex(t,r,a)){var s=t._layoutManager.getWindowIndices(t._layoutInfoProvider);(a<=s.minVisibleIndex||a>=s.maxVisibleIndex)&&this._scrollToItem(t,n)}}else if(Core.Utility.isObject(l)){var c=r.getRecordIndex(l);i=this._setSelectionByRowIndex(t,r,c)}return!i&&Core.Utility.isFunction(e.Functions.createItemNotFoundError)?e.Functions.createItemNotFoundError():null},s}(t.PrintableControl);o.GalleryControl=a,e.Controls.RegisterReactConvertedControl("AppMagic.Controls.Gallery.GalleryControl",e.Controls.Gallery.GalleryControl,e.Controls.Gallery.GalleryContainer,(function(){return!0}))}(t.Gallery||(t.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t=function(){function e(e){this._recordFrameDuration=this._recordFrameDuration.bind(this),this._callback=e,this._endScrollLaterId=0,this._performanceTrackerId=0,this.reset()}return e.prototype.scroll=function(){this._isScrolling||(this._scrollStartTime=Date.now(),this._isScrolling=!0),!this._hasInvokedRecently()&&this._isFastFrameRate()?(this._invokeCallback(),this._endScrollLater()):this._endScrollLater(!0)},e.prototype.isScrolling=function(){return this._isScrolling},e.prototype.reset=function(){window.cancelAnimationFrame(this._endScrollLaterId),window.cancelAnimationFrame(this._performanceTrackerId),this._endScrollLaterId=0,this._performanceTrackerId=0,this._lastInvokeTime=0,this._scrollStartTime=0,this._frameDurationHistory=[],this._isScrolling=!1},e.prototype._hasInvokedRecently=function(){var t=Math.max(this._scrollStartTime,this._lastInvokeTime);return Date.now()-t<e._updatePeriod},e.prototype._isFastFrameRate=function(){var t=this._frameDurationHistory.slice(-1*e._performanceSampleSize),o=0,r=0;return t.forEach((function(t){t<e._fastFrameDuration?++r:++o})),r>=o},e.prototype._endScrollLater=function(t){var o=this;window.cancelAnimationFrame(this._endScrollLaterId);var r=Date.now(),i=function(){Date.now()-r>(o._isFastFrameRate()?e._fastDebounceDelay:e._slowDebounceDelay)?(o._isScrolling=!1,t&&o._invokeCallback()):o._endScrollLaterId=window.requestAnimationFrame(i)};this._endScrollLaterId=window.requestAnimationFrame(i)},e.prototype._invokeCallback=function(){this._lastInvokeTime=Date.now(),this._performanceTrackerId=window.requestAnimationFrame(this._recordFrameDuration),this._callback()},e.prototype._recordFrameDuration=function(){this._frameDurationHistory.push(Date.now()-this._lastInvokeTime);var t=e._performanceSampleSize;this._frameDurationHistory.length>5*t&&(this._frameDurationHistory=this._frameDurationHistory.slice(-1*t))},e._fastDebounceDelay=50,e._fastFrameDuration=300,e._performanceSampleSize=8,e._slowDebounceDelay=180,e._updatePeriod=350,e}();e.ScrollDebouncer=t}(e.Gallery||(e.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={})),function(e){!function(e){!function(e){var t=Core.FallbackSwitch.isActivated("Controls.SelectGalleryTemplate"),o=function(){function e(){}return e.prototype.initControlContext=function(e){e._parentReplicatedContext=this.OpenAjax.parentReplicatedContextManager.replicatedContextFor(e.bindingContext.parent),e._selectionChangedListener=function(t){return e.modelProperties.IsSelected.setValue(t)},e._parentReplicatedContext.addSelectionChangedListener(e.bindingContext,e._selectionChangedListener),e._templateFillSubscription=null,e._propertiesPromoted=!1},e.prototype.disposeControlContext=function(e){e._parentReplicatedContext.removeSelectionChangedListener(e.bindingContext,e._selectionChangedListener),delete e._selectionChangedListener,e._parentReplicatedContext=null},e.prototype.onChangeIsSelected=function(e,o){t||e.newValue&&!e.oldValue&&o._parentReplicatedContext.getSelectedBindingContext()!==o.bindingContext&&o._parentReplicatedContext&&o._parentReplicatedContext.notifyBindingContextSelectionInteraction(o.bindingContext,!1)},e}();e.Template=o}(e.Gallery||(e.Gallery={}))}(e.Controls||(e.Controls={}))}(AppMagic||(AppMagic={}));
//# sourceMappingURL=Gallery.js.map